
/* /web_studio/static/src/client_action/action_editor/action_editor.js */
odoo.define('@web_studio/client_action/action_editor/action_editor',['@odoo/owl','@web/core/utils/hooks','@web/core/registry','@web/core/l10n/translation','@web/core/utils/arrays','@web/core/dropdown/dropdown','@web/core/dropdown/dropdown_item','@web/core/confirmation_dialog/confirmation_dialog','@web/webclient/actions/action_service','@web/views/record','@web/views/fields/many2many_tags/many2many_tags_field','@web/views/fields/char/char_field','@web/views/fields/text/text_field','@web_studio/studio_service','@web_studio/client_action/editor/new_view_dialogs/new_view_dialog','@web_studio/client_action/editor/new_view_dialogs/map_new_view_dialog'],function(require){'use strict';let __exports={};const{Component}=require("@odoo/owl");const{useOwnedDialogs,useService}=require("@web/core/utils/hooks");const{registry}=require("@web/core/registry");const{_lt}=require("@web/core/l10n/translation");const{sortBy}=require("@web/core/utils/arrays");const{Dropdown}=require("@web/core/dropdown/dropdown");const{DropdownItem}=require("@web/core/dropdown/dropdown_item");const{AlertDialog}=require("@web/core/confirmation_dialog/confirmation_dialog");const{standardActionServiceProps}=require("@web/webclient/actions/action_service");const{Record}=require("@web/views/record");const{Many2ManyTagsField,many2ManyTagsField,}=require("@web/views/fields/many2many_tags/many2many_tags_field");const{CharField}=require("@web/views/fields/char/char_field");const{TextField}=require("@web/views/fields/text/text_field");const{viewTypeToString,useStudioServiceAsReactive}=require("@web_studio/studio_service");const{NewViewDialog}=require("@web_studio/client_action/editor/new_view_dialogs/new_view_dialog");const{MapNewViewDialog}=require("@web_studio/client_action/editor/new_view_dialogs/map_new_view_dialog");function getViewCategories(){return{general:{title:_lt("General views"),viewTypes:["form","search","activity"],},multiple:{title:_lt("Multiple records views"),viewTypes:["list","kanban","map"],},timeline:{title:_lt("Timeline views"),viewTypes:["calendar","cohort","gantt"],},reporting:{title:_lt("Reporting views"),viewTypes:["graph","pivot"],},};}
const actionFieldsGet={id:{type:"integer"},name:{type:"char"},help:{type:"text"},groups_id:{type:"many2many",relation:"res.groups",string:"Groups"},};function getActionActiveFields(){const activeFields={};for(const fName of Object.keys(actionFieldsGet)){activeFields[fName]={};}
activeFields.groups_id.relatedFields=Object.fromEntries(many2ManyTagsField.relatedFields({options:{}}).map((f)=>[f.name,f]));return activeFields;}
function getActionValues(action){const values={};for(const fName of Object.keys(actionFieldsGet)){values[fName]=action[fName];}
return values;}
class ActionEditor extends Component{setup(){this.studio=useStudioServiceAsReactive();this.action=useService("action");this.notification=useService("notification");this.rpc=useService("rpc");this.user=useService("user");this.viewCategories=getViewCategories();this.addDialog=useOwnedDialogs();this.actionFieldsGet={...actionFieldsGet};}
get actionRecordProps(){const values=getActionValues(this.studio.editedAction);return{fields:this.actionFieldsGet,resModel:"ir.actions.act_window",resId:values.id,mode:"edit",values,activeFields:getActionActiveFields(),onRecordChanged:(record,changes)=>{return this.editAction(changes);},};}
get activeViews(){return this.studio.editedAction.views.map(([,name])=>name);}
getOrderedViewTypes(viewTypes){const activeViews=this.activeViews;const currentDefaultView=activeViews[0];const viewInfos=viewTypes.map((viewType)=>{return{name:viewType,title:viewTypeToString(viewType),isActive:activeViews.includes(viewType),isDefault:currentDefaultView===viewType,imgUrl:`/web_studio/static/src/img/view_type/${viewType}.png`,canBeDefault:!["form","search"].includes(viewType),canBeDisabled:viewType!=="search",};});return sortBy(viewInfos,({isDefault,isActive})=>{return isDefault?2:isActive?1:0;},"desc");}
setDefaultView(viewType){viewType=viewType==="tree"?"list":viewType;let viewModes=this.studio.editedAction.view_mode.split(",");viewModes=viewModes.filter((m)=>m!==viewType);viewModes.unshift(viewType);return this.editAction({view_mode:viewModes.join(",")});}
disableView(viewType){const viewMode=this.studio.editedAction.view_mode.split(",").filter((m)=>m!==viewType);if(!viewMode.length){this.addDialog(AlertDialog,{body:this.env._t("You cannot deactivate this view as it is the last one active."),});}else{return this.editAction({view_mode:viewMode.join(",")});}}
restoreDefaultView(viewType){return this.env.editionFlow.restoreDefaultView(null,viewType);}
async addViewType(viewType){const action=this.studio.editedAction;const viewMode=action.view_mode.split(",");viewMode.push(viewType);let viewAdded=await this.rpc("/web_studio/add_view_type",{action_type:action.type,action_id:action.id,res_model:action.res_model,view_type:viewType,args:{view_mode:viewMode.join(",")},context:this.user.context,});if(viewAdded!==true){viewAdded=await new Promise((resolve)=>{let DialogClass;const dialogProps={confirm:async()=>{resolve(true);},cancel:()=>resolve(false),};if(["gantt","calendar","cohort"].includes(viewType)){DialogClass=NewViewDialog;dialogProps.viewType=viewType;}else if(viewType==="map"){DialogClass=MapNewViewDialog;}else{this.addDialog(AlertDialog,{body:this.env._t("Creating this type of view is not currently supported in Studio."),});resolve(false);}
this.addDialog(DialogClass,dialogProps);});}
if(viewAdded){await this.editAction({view_mode:viewMode.join(",")});}
return viewAdded;}
editView(viewType){this.studio.setParams({viewType,editorTab:"views"});}
async onThumbnailClicked(viewType){if(this.activeViews.includes(viewType)){return this.editView(viewType);}
const resModel=this.studio.editedAction.res_model;if(viewType==="activity"){const activityAllowed=await this.studio.isAllowed("activity",resModel);if(!activityAllowed){this.notification.add(this.env._t("Activity view unavailable on this model"),{title:false,type:"danger",});return;}}
if(await this.addViewType(viewType)){return this.editView(viewType);}}
openFormAction(){return this.action.doAction({type:"ir.actions.act_window",res_model:"ir.actions.act_window",res_id:this.studio.editedAction.id,views:[[false,"form"]],target:"current",},{stackPosition:"replacePreviousAction",});}
async editAction(changes){await this.rpc("/web_studio/edit_action",{action_id:this.studio.editedAction.id,action_type:"ir.actions.act_window",args:changes,});return this.studio.reload({},false);}}
ActionEditor.template="web_studio.ActionEditor";ActionEditor.components={Dropdown,DropdownItem,Record,CharField,TextField,Many2ManyTagsField,};ActionEditor.props={...standardActionServiceProps};registry.category("actions").add("web_studio.action_editor",ActionEditor);return __exports;});;

/* /web_studio/static/src/client_action/app_creator/app_creator.js */
odoo.define('@web_studio/client_action/app_creator/app_creator',['@odoo/owl','@web/core/utils/hooks','@web_studio/utils','@web_studio/client_action/model_configurator/model_configurator','@web_studio/client_action/icon_creator/icon_creator','@web_studio/client_action/menu_creator/menu_creator'],function(require){'use strict';let __exports={};const{Component,reactive,useExternalListener,useState}=require("@odoo/owl");const{useAutofocus,useService}=require("@web/core/utils/hooks");const{BG_COLORS,COLORS,ICONS}=require("@web_studio/utils");const{ModelConfigurator}=require("@web_studio/client_action/model_configurator/model_configurator");const{IconCreator}=require("@web_studio/client_action/icon_creator/icon_creator");const{MenuCreator,MenuCreatorModel}=require("@web_studio/client_action/menu_creator/menu_creator");class AppCreatorState{constructor({onFinished}){this._onFinished=onFinished;this.step="welcome";this.fieldsValidators={appName:()=>!!this.data.appName,menu:(_this)=>_this.menuCreatorModel.isValid,};this.menuCreatorModel=reactive(new MenuCreatorModel());this.data={appName:"",iconData:{backgroundColor:BG_COLORS[5],color:COLORS[4],iconClass:ICONS[0],type:"custom_icon",},menu:this.menuCreatorModel.data,modelOptions:[],};this._steps={welcome:{next:()=>"app",},app:{previous:"welcome",next:()=>"model",fields:["appName"],},model:{previous:"app",next:(data)=>{return data.menu.modelChoice==="new"?"model_configuration":"";},fields:["menu"],},model_configuration:{previous:"model",},};}
get step(){return this._step;}
set step(step){this._step=step;this.showValidation=false;}
get nextStep(){const next=this._next;return this._stepInvalidFields.length?false:next;}
get hasPrevious(){return"previous"in this._currentStep;}
isFieldValid(fieldName){return this.showValidation?this.fieldsValidators[fieldName](this):true;}
next(){this.showValidation=true;const invalidFields=this._stepInvalidFields;if(invalidFields.length){return;}
const next=this._next;if(next){this.step=next;}else{return this._onFinished();}}
previous(){if(this._currentStep.previous){this.step=this._currentStep.previous;}}
get _currentStep(){return this._steps[this._step];}
get _next(){return this._currentStep.next?this._currentStep.next(this.data):"";}
get _stepInvalidFields(){return(this._currentStep.fields||[]).filter((fName)=>{return!this.fieldsValidators[fName](this);});}}
const AppCreator=__exports.AppCreator=class AppCreator extends Component{static template="web_studio.AppCreator";static components={IconCreator,ModelConfigurator,MenuCreator};static props={onNewAppCreated:{type:Function},};setup(){this.state=useState(new AppCreatorState({onFinished:this.createNewApp.bind(this),}));this.uiService=useService("ui");this.rpc=useService("rpc");this.user=useService("user");useAutofocus();useExternalListener(window,"keydown",this.onKeydown);}
async createNewApp(){this.uiService.block();const data=this.state.data;const iconData=data.iconData;const iconValue=iconData.type==="custom_icon"?[iconData.iconClass,iconData.color,iconData.backgroundColor]:iconData.uploaded_attachment_id;try{const result=await this.rpc("/web_studio/create_new_app",{app_name:data.appName,menu_name:data.menu.menuName,model_choice:data.menu.modelChoice,model_id:data.menu.modelChoice&&data.menu.modelId[0],model_options:data.modelOptions,icon:iconValue,context:this.user.context,});await this.props.onNewAppCreated(result);}finally{this.uiService.unblock();}}
onKeydown(ev){if(ev.key==="Enter"&&!(ev.target.classList&&ev.target.classList.contains("o_web_studio_app_creator_previous"))){ev.preventDefault();this.state.next();}}
onConfirmOptions(options){this.state.data.modelOptions=options;return this.state.next();}}
return __exports;});;

/* /web_studio/static/src/client_action/editor/app_menu_editor/app_menu_editor.js */
odoo.define('@web_studio/client_action/editor/app_menu_editor/app_menu_editor',['@odoo/owl','@web/core/utils/hooks','@web/core/dialog/dialog','@web/core/l10n/localization','@web/views/view_dialogs/form_view_dialog','@web_studio/client_action/menu_creator/menu_creator','@web_studio/client_action/utils','@web/core/l10n/translation'],function(require){'use strict';let __exports={};const{Component,useEffect,useRef,useState,useSubEnv}=require("@odoo/owl");const{useBus,useService,useOwnedDialogs}=require("@web/core/utils/hooks");const{Dialog}=require("@web/core/dialog/dialog");const{localization}=require("@web/core/l10n/localization");const{FormViewDialog}=require("@web/views/view_dialogs/form_view_dialog");const{MenuCreatorDialog}=require("@web_studio/client_action/menu_creator/menu_creator");const{useDialogConfirmation}=require("@web_studio/client_action/utils");const{_t}=require("@web/core/l10n/translation");function useSubEnvAndServices(env){const services=env.services;const bus=env.bus;useSubEnv(env);useSubEnv({services,bus});}
class FormViewDialogWithEnv extends FormViewDialog{static props={...FormViewDialog.props,env:{type:Object}};setup(){useSubEnvAndServices(this.props.env);super.setup();}}
const EditMenuDialogProps={...Dialog.props};EditMenuDialogProps.env={type:Object};EditMenuDialogProps.close={type:Function};delete EditMenuDialogProps.slots;class EditMenuDialog extends Component{static components={Dialog};static template="web_studio.AppMenuEditor.EditMenuDialog";static props=EditMenuDialogProps;setup(){const originalBus=this.env.bus;useBus(originalBus,"MENUS:APP-CHANGED",()=>(this.state.tree=this.getTree()));useSubEnvAndServices(this.props.env);this.menus=useService("menu");this.addDialog=useOwnedDialogs();this.orm=useService("orm");this.user=useService("user");this.rpc=useService("rpc");useBus(this.env.bus,"ACTION_MANAGER:UPDATE",()=>this.cancel());this.title=_t("Edit Menu");this.state=useState({tree:{},flatMenus:{},renderId:1});this.state.tree=this.getTree();this.toMove={};this.toDelete=[];const root=useRef("root");const itemsList={get el(){return root.el.querySelector(".oe_menu_editor");},};useEffect(()=>{const el=itemsList.el;if(!el){return;}
$(el).nestedSortable({listType:"ul",handle:".o-draggable-handle",items:"li",maxLevels:5,toleranceElement:"> div",forcePlaceholderSize:true,opacity:0.6,placeholder:"oe_menu_placeholder",doNotClear:true,tolerance:"pointer",attribute:"data-item-id",relocate:this.moveMenu.bind(this),rtl:localization.direction==="rtl",});return()=>{$(el).nestedSortable("destroy");};});const{confirm,cancel}=useDialogConfirmation({confirm:async()=>{await this.saveChanges();},});this.confirm=confirm;this.cancel=cancel;}
get flatMenus(){return this.state.flatMenus;}
get mainItem(){return this.state.tree;}
getTree(){let currentApp=this.menus.getCurrentApp();if(!currentApp){return null;}
currentApp=this.menus.getMenuAsTree(currentApp.id);const item=this._getItemFromMenu(currentApp,null);item.isDraggable=false;item.isRemovable=false;return item;}
_getItemFromMenu(menu,parentId){const item={id:menu.id,name:menu.name,isDraggable:true,isRemovable:true,parentId,};item.children=menu.childrenTree.map((menu)=>this._getItemFromMenu(menu,item.id));this.flatMenus[item.id]=item;return item;}
moveMenu(ev,uiHelper){const menuId=parseInt(uiHelper.item[0].dataset.itemId);const menu=this.flatMenus[menuId];let parentMenu=this.flatMenus[menu.parentId];parentMenu.children=parentMenu.children.filter((m)=>m.id!==menuId);const parentLi=uiHelper.item[0].parentElement?.closest("li");const parentMenuId=parentLi?parseInt(parentLi.dataset.itemId):this.mainItem.id;if(parentMenuId!==parentMenu.id){parentMenu=this.flatMenus[parentMenuId];menu.parentId=parentMenu.id;}
let previous=uiHelper.item[0].previousElementSibling;let next=uiHelper.item[0].nextElementSibling;if(previous){previous=this.flatMenus[previous.dataset.itemId];const index=parentMenu.children.findIndex((child)=>child===previous);parentMenu.children.splice(index+1,0,menu);}else if(next){next=this.flatMenus[next.dataset.itemId];const index=parentMenu.children.findIndex((child)=>child===next);parentMenu.children.splice(index,0,menu);}else{parentMenu.children.push(menu);}
this.state.renderId++;this.toMove[menuId]={parent_menu_id:menu.parentId,};parentMenu.children.forEach((m,index)=>{this.toMove[m.id]=this.toMove[m.id]||{};this.toMove[m.id].sequence=index+1;});}
removeItem(menu){const parentMenu=this.flatMenus[menu.parentId];if(!parentMenu){return;}
parentMenu.children=parentMenu.children.filter((m)=>m.id!==menu.id);this.toDelete.push(menu.id);this.state.renderId++;}
editItem(menu){this.addDialog(FormViewDialogWithEnv,{resModel:"ir.ui.menu",resId:menu.id,env:this.props.env,onRecordSaved:async()=>{await this.saveChanges(true);},});}
async saveChanges(reload=false){if(Object.keys(this.toMove).length||this.toDelete.length){await this.orm.call("ir.ui.menu","customize",[],{to_move:this.toMove,to_delete:this.toDelete,});reload=true;}
if(reload){await this.menus.reload();}}
onNewMenu(){this.addDialog(MenuCreatorDialog,{confirm:async(data)=>{await this.rpc("/web_studio/create_new_menu",{menu_name:data.menuName,model_id:data.modelId[0],model_choice:data.modelChoice,model_options:data.modelOptions||{},parent_menu_id:this.mainItem.id,context:this.user.context,});this.env.bus.trigger("CLEAR-CACHES");this.menus.reload();},});}}
const AppMenuEditor=__exports.AppMenuEditor=class AppMenuEditor extends Component{static props={env:{type:Object},};static template="web_studio.AppMenuEditor";setup(){this.menus=useService("menu");this.addDialog=useOwnedDialogs();useBus(this.env.bus,"MENUS:APP-CHANGED",()=>this.render());}
onClick(ev){ev.preventDefault();this.addDialog(EditMenuDialog,{env:this.props.env});}}
return __exports;});;

/* /web_studio/static/src/client_action/editor/edition_flow.js */
odoo.define('@web_studio/client_action/editor/edition_flow',['@odoo/owl','@web_studio/client_action/utils','@web/core/confirmation_dialog/confirmation_dialog','@web/core/utils/concurrency'],function(require){'use strict';let __exports={};const{toRaw,useState,useEnv,reactive,onMounted,onWillUnmount,markRaw}=require("@odoo/owl");const{Reactive}=require("@web_studio/client_action/utils");const{ConfirmationDialog}=require("@web/core/confirmation_dialog/confirmation_dialog");const{KeepLast}=require("@web/core/utils/concurrency");const EditionFlow=__exports.EditionFlow=class EditionFlow extends Reactive{constructor(env,services){super();this.env=env;for(const[servName,serv]of Object.entries(services)){this[servName]=serv;}
this.setup();}
setup(){let requestId;const updateBreadcrumbs=(studio)=>{if(studio.requestId!==requestId){this.breadcrumbs=[];}
requestId=studio.requestId;};const studio=reactive(this.studio,()=>updateBreadcrumbs(studio));this.studio=studio;this.breadcrumbs=[];updateBreadcrumbs(studio);}
pushBreadcrumb(crumb){const bcLength=this.breadcrumbs.length;const handler=()=>{this.breadcrumbs.length=bcLength+1;this.studio.setParams({},false);};this.breadcrumbs.push({...crumb,handler});}
async loadViews({forceSearch=false}={}){const editedAction=this.studio.editedAction;const{context,res_model,id}=editedAction;const views=[...editedAction.views];if(forceSearch&&!views.some((tuple)=>tuple[1]==="search")){views.push([false,"search"]);}
const newContext={...context,studio:true,lang:false,no_address_format:true};const options={loadIrFilters:true,loadActionMenus:false,id};const res=await this.view.loadViews({resModel:res_model,views,context:newContext},options);return JSON.parse(JSON.stringify(res));}
restoreDefaultView(viewId,viewType){return new Promise((resolve)=>{const confirm=async()=>{if(!viewId&&viewType){const result=await this.loadViews();viewId=result.views[viewType].id;}
const res=await this.rpc("/web_studio/restore_default_view",{view_id:viewId,});this.env.bus.trigger("CLEAR-CACHES");resolve(res);};this.dialog.add(ConfirmationDialog,{body:this.env._t("Are you sure you want to restore the default view?\r\nAll customization done with studio on this view will be lost."),confirm,cancel:()=>resolve(false),});});}}
__exports.useEditorBreadcrumbs=useEditorBreadcrumbs;function useEditorBreadcrumbs(initialCrumb){const env=useEnv();const editionFlow=env.editionFlow;if(initialCrumb&&!editionFlow.breadcrumbs.length){onMounted(()=>editionFlow.pushBreadcrumb(initialCrumb));}
const crumbs=useState(editionFlow.breadcrumbs);const push=(crumb)=>editionFlow.pushBreadcrumb(crumb);return{crumbs,push};}
__exports.useEditorFlowFeatures=useEditorFlowFeatures;function useEditorFlowFeatures({snackBarIndicator,editorOperations}){const editionFlow=useEnv().editionFlow;onMounted(()=>{if(snackBarIndicator){editionFlow.snackBarIndicator=snackBarIndicator;}
if(editorOperations){editionFlow.editorOperations=editorOperations;}});onWillUnmount(()=>{const rawEditionFlow=toRaw(editionFlow);if(rawEditionFlow.snackBarIndicator===snackBarIndicator){editionFlow.snackBarIndicator=null;}
if(rawEditionFlow.editorOperations===editorOperations){editionFlow.editorOperations=null;}});}
const SnackbarIndicator=__exports.SnackbarIndicator=class SnackbarIndicator extends Reactive{constructor(){super();this.state="";this.keepLast=markRaw(new KeepLast());}
add(prom){this.state="loading";const raw=this.raw();this.pending=Promise.all([raw.pending,prom]);this.keepLast.add(raw.pending).then(()=>(this.state="loaded")).catch(()=>{this.state="error";}).finally(()=>{this.pending=null;});return prom;}}
const EditorOperations=__exports.EditorOperations=class EditorOperations extends Reactive{constructor(params){super();this.operations=[];this.undone=[];this._lock="";this._keepLast=markRaw(new KeepLast());this._callbacks={do:params.do,onError:params.onError,onDone:params.onDone,};}
get canUndo(){return this.operations.length||(this.pending&&this.pending.length);}
get canRedo(){return this.undone.length||(this.pendingUndone&&this.pendingUndone.length);}
_wrapPromise(prom){return this._keepLast.add(prom);}
_prepare(mode){const raw=this.raw();const lock=raw._lock;if(lock&&lock!==mode){this._wrapPromise(Promise.resolve());this._close();return false;}
this._lock=mode;const pending=raw.pending;if(!pending){this.pending=[...raw.operations];this.pendingUndone=[...raw.undone];}
return true;}
async _do(mode,pending,lastOp){let result;let error;try{result=await this._wrapPromise(this._callbacks.do({mode,operations:pending,lastOp}));}catch(e){error=e;}
if(error){return{error};}
return{result};}
_close(done=null){const raw=this.raw();const mode=raw._lock;this._lock=null;const pending=raw.pending;const pendingUndone=raw.pendingUndone;this.pending=null;this.pendingUndone=null;if(!done){return;}
if("result"in done){this.operations=pending;this.undone=pendingUndone;if(typeof done.result!=="boolean"){return this._callbacks.onDone({mode,pending,pendingUndone,result:done.result,});}}
if("error"in done){return this._callbacks.onError({mode,pending,error:done.error});}}
async undo(canRedo=true){if(!this._prepare("undo")){this._close();return;}
const ops=this.raw().pending;if(!ops||!ops.length){this._close();return;}
const op=ops.pop();if(canRedo){this.pendingUndone.push(op);}
const done=await this._do("undo",this.raw().pending,op);this._close(done);}
pushOp(op){this.operations.push(op);}
async redo(){if(!this._prepare("redo")){this._close();return;}
const ops=this.raw().pendingUndone;if(!ops||!ops.length){this._close();return;}
const op=ops.pop();this.pending.push(op);const done=await this._do("do",this.raw().pending,op);this._close(done);}
async doMulti(ops=[]){if(!ops.length){return;}
let prom;for(let i=0;i<ops.length;i++){let silent=true;if(i===ops.length-1){silent=false;}
prom=this.do(ops[i],silent);}
return prom;}
async do(op,silent=false){if(!this._prepare("do")||!op){this._close();return;}
this.pending.push(op);this.pendingUndone=[];let done={};if(!silent){done=await this._do("do",this.raw().pending,op);}else{done={result:true};}
this._close(done);}
clear(all=true){this.operations=[];if(all){this.undone=[];}}}
return __exports;});;

/* /web_studio/static/src/client_action/editor/editor.js */
odoo.define('@web_studio/client_action/editor/editor',['@odoo/owl','@web/core/registry','@web/webclient/actions/action_service','@web/core/utils/hooks','@web_studio/client_action/editor/studio_action_container','@web_studio/client_action/editor/editor_menu/editor_menu','@web/legacy/backend_utils','@web_studio/client_action/editor/app_menu_editor/app_menu_editor','@web_studio/client_action/editor/new_model_item/new_model_item','@web_studio/client_action/editor/edition_flow','@web_studio/studio_service'],function(require){'use strict';let __exports={};const{Component,EventBus,onWillDestroy,useSubEnv}=require("@odoo/owl");const{registry}=require("@web/core/registry");const{actionService}=require("@web/webclient/actions/action_service");const{useBus,useService}=require("@web/core/utils/hooks");const{StudioActionContainer}=require("@web_studio/client_action/editor/studio_action_container");const{EditorMenu}=require("@web_studio/client_action/editor/editor_menu/editor_menu");const{mapDoActionOptionAPI}=require("@web/legacy/backend_utils");const{AppMenuEditor}=require("@web_studio/client_action/editor/app_menu_editor/app_menu_editor");const{NewModelItem}=require("@web_studio/client_action/editor/new_model_item/new_model_item");const{EditionFlow}=require("@web_studio/client_action/editor/edition_flow");const{useStudioServiceAsReactive}=require("@web_studio/studio_service");const actionServiceStudio={dependencies:["studio"],start(env,{studio}){const action=actionService.start(env);const _doAction=action.doAction;async function doAction(actionRequest,options){if(actionRequest==="web_studio.action_edit_report"){return studio.setParams({editedReport:options.report,});}
return _doAction(...arguments);}
return Object.assign(action,{doAction});},};const menuButtonsRegistry=registry.category("studio_navbar_menubuttons");const Editor=__exports.Editor=class Editor extends Component{static menuButtonsId=1;setup(){const services=Object.create(this.env.services);const globalBus=this.env.bus;const newBus=new EventBus();newBus.on("CLEAR-CACHES",this,()=>globalBus.trigger("CLEAR-CACHES"));useSubEnv({bus:newBus,services,});services.router={current:{hash:{}},pushState(){},};this.studio=useService("studio");services.action=actionServiceStudio.start(this.env,{studio:this.studio});const editionFlow=new EditionFlow(this.env,{rpc:useService("rpc"),dialog:useService("dialog"),studio:useStudioServiceAsReactive(),view:useService("view"),});useSubEnv({editionFlow,});this.actionService=useService("action");this.rpc=useService("rpc");this.state=owl.useState({actionContainerId:1});useBus(this.studio.bus,"UPDATE",async()=>{this.state.actionContainerId++;});menuButtonsRegistry.getEntries().forEach(([name])=>{if(name.startsWith("app_menu_editor_")||name.startsWith("new_model_item_")){menuButtonsRegistry.remove(name);}});const menuButtonsId=this.constructor.menuButtonsId++;menuButtonsRegistry.add(`app_menu_editor_${menuButtonsId}`,{Component:AppMenuEditor,props:{env:this.env},});menuButtonsRegistry.add(`new_model_item_${menuButtonsId}`,{Component:NewModelItem});onWillDestroy(()=>{menuButtonsRegistry.remove(`app_menu_editor_${menuButtonsId}`);menuButtonsRegistry.remove(`new_model_item_${menuButtonsId}`);});}
switchView({viewType}){this.studio.setParams({viewType,editorTab:"views"});}
switchViewLegacy(ev){this.studio.setParams({viewType:ev.detail.view_type});}
switchTab({tab}){this.studio.setParams({editorTab:tab});}
onDoAction(ev){const payload=ev.detail;const legacyOptions=mapDoActionOptionAPI(payload.options);this.actionService.doAction(payload.action,Object.assign(legacyOptions||{},{clearBreadcrumbs:true}));}}
Editor.template="web_studio.Editor";Editor.props={};Editor.components={EditorMenu,StudioActionContainer,};return __exports;});;

/* /web_studio/static/src/client_action/editor/editor_menu/editor_menu.js */
odoo.define('@web_studio/client_action/editor/editor_menu/editor_menu',['@web/core/utils/hooks','@web/core/l10n/translation','@web/core/l10n/localization','@web/core/registry','@odoo/owl'],function(require){'use strict';let __exports={};const{useService}=require("@web/core/utils/hooks");const{_lt}=require("@web/core/l10n/translation");const{localization}=require("@web/core/l10n/localization");const{registry}=require("@web/core/registry");const{Component,useState}=require("@odoo/owl");const editorTabRegistry=registry.category("web_studio.editor_tabs");const EditorMenu=__exports.EditorMenu=class EditorMenu extends Component{setup(){this.l10n=localization;this.editionFlow=useState(this.env.editionFlow);this.studio=useService("studio");this.rpc=useService("rpc");this.nextCrumbId=1;}
get breadcrumbs(){const{editorTab}=this.studio;const currentTab=this.editorTabs.find((tab)=>tab.id===editorTab);const crumbs=[{name:currentTab.name,handler:()=>this.openTab(currentTab.id),},];if(currentTab.id==="reports"&&this.studio.editedReport){crumbs.push({name:this.studio.editedReport.data.name,handler:()=>this.studio.setParams({}),});}
const breadcrumbs=this.editionFlow.breadcrumbs;breadcrumbs.forEach((data)=>{crumbs.push({...data});});for(const crumb of crumbs){crumb.id=this.nextCrumbId++;}
return crumbs;}
get activeViews(){const action=this.studio.editedAction;const viewTypes=(action._views||action.views).map(([,type])=>type);return this.constructor.viewTypes.filter((vt)=>viewTypes.includes(vt.type));}
get editorTabs(){const entries=editorTabRegistry.getEntries();return entries.map((entry)=>Object.assign({},entry[1],{id:entry[0]}));}
openTab(tab){this.props.switchTab({tab});}}
EditorMenu.props={switchTab:Function,switchView:Function,};EditorMenu.template="web_studio.EditorMenu";EditorMenu.viewTypes=[{title:_lt("Form"),type:"form",iconClasses:"fa fa-address-card",},{title:_lt("List"),type:"list",iconClasses:"oi oi-view-list",},{title:_lt("Kanban"),type:"kanban",iconClasses:"oi oi-view-kanban",},{title:_lt("Map"),type:"map",iconClasses:"fa fa-map-marker",},{title:_lt("Calendar"),type:"calendar",iconClasses:"fa fa-calendar",},{title:_lt("Graph"),type:"graph",iconClasses:"fa fa-area-chart",},{title:_lt("Pivot"),type:"pivot",iconClasses:"oi oi-view-pivot",},{title:_lt("Gantt"),type:"gantt",iconClasses:"fa fa-tasks",},{title:_lt("Cohort"),type:"cohort",iconClasses:"oi oi-view-cohort",},{title:_lt("Activity"),type:"activity",iconClasses:"fa fa-clock-o",},{title:_lt("Search"),type:"search",iconClasses:"oi oi-search",},];editorTabRegistry.add("views",{name:_lt("Views"),action:"web_studio.action_editor"}).add("reports",{name:_lt("Reports")}).add("automations",{name:_lt("Automations")}).add("acl",{name:_lt("Access Control")}).add("filters",{name:_lt("Filter Rules")});return __exports;});;

/* /web_studio/static/src/client_action/editor/new_model_item/new_model_item.js */
odoo.define('@web_studio/client_action/editor/new_model_item/new_model_item',['@odoo/owl','@web/core/l10n/translation','@web/core/utils/hooks','@web/core/dialog/dialog','@web_studio/client_action/model_configurator/model_configurator','@web_studio/client_action/utils'],function(require){'use strict';let __exports={};const{Component,useState}=require("@odoo/owl");const{_t}=require("@web/core/l10n/translation");const{useBus,useService,useOwnedDialogs}=require("@web/core/utils/hooks");const{Dialog}=require("@web/core/dialog/dialog");const{ModelConfiguratorDialog}=require("@web_studio/client_action/model_configurator/model_configurator");const{useDialogConfirmation}=require("@web_studio/client_action/utils");class SimpleNewModelDialog extends Component{static template="web_studio.SimpleNewModelDialog";static components={Dialog};static props={close:{type:Function}};setup(){this.addDialog=useOwnedDialogs();this.rpc=useService("rpc");this.menus=useService("menu");this.user=useService("user");this.action=useService("action");this.studio=useService("studio");this.state=useState({modelName:"",showValidation:false});const{confirm,cancel}=useDialogConfirmation({confirm:async(data)=>{const{menu_id,action_id}=await this.rpc("/web_studio/create_new_menu",{menu_name:this.state.modelName,model_id:false,model_choice:"new",model_options:data.modelOptions,parent_menu_id:this.menus.getCurrentApp().id,context:this.user.context,});await this.menus.reload();const action=await this.action.loadAction(action_id);this.menus.setCurrentMenu(menu_id);this.studio.setParams({action,viewType:"form"});},});this._confirm=confirm;this._cancel=cancel;}
get title(){return _t("Create a new Model");}
confirm(data={}){return this._confirm(data);}
onConfigureModel(){if(!this.state.modelName){this.state.showValidation=true;return;}
this.addDialog(ModelConfiguratorDialog,{confirmLabel:_t("Create Model"),confirm:(data)=>{this.confirm({modelOptions:data});},});}}
const NewModelItem=__exports.NewModelItem=class NewModelItem extends Component{static props={};static template="web_studio.NewModelItem";setup(){this.addDialog=useOwnedDialogs();this.menus=useService("menu");this.studio=useService("studio");this.action=useService("action");useBus(this.env.bus,"MENUS:APP-CHANGED",()=>this.render());}
onClick(ev){ev.preventDefault();this.addDialog(SimpleNewModelDialog);}}
return __exports;});;

/* /web_studio/static/src/client_action/editor/new_view_dialogs/map_new_view_dialog.js */
odoo.define('@web_studio/client_action/editor/new_view_dialogs/map_new_view_dialog',['@web_studio/client_action/editor/new_view_dialogs/new_view_dialog','@web/core/utils/hooks','@web/core/confirmation_dialog/confirmation_dialog'],function(require){'use strict';let __exports={};const{NewViewDialog}=require("@web_studio/client_action/editor/new_view_dialogs/new_view_dialog");const{useService}=require("@web/core/utils/hooks");const{AlertDialog}=require("@web/core/confirmation_dialog/confirmation_dialog");const MapNewViewDialog=__exports.MapNewViewDialog=class MapNewViewDialog extends NewViewDialog{setup(){super.setup();this.dialog=useService("dialog");this.fieldsChoice={res_partner:null,};}
get viewType(){return"map";}
computeSpecificFields(fields){this.partnerFields=fields.filter((field)=>field.type==="many2one"&&field.relation==="res.partner");if(!this.partnerFields.length){this.dialog.add(AlertDialog,{body:this.env._t("Contact Field Required"),contentClass:"o_web_studio_preserve_space",});this.props.close();}else{this.fieldsChoice.res_partner=this.partnerFields[0].name;}}}
MapNewViewDialog.template="web_studio.MapNewViewDialog";MapNewViewDialog.props={...NewViewDialog.props,};delete MapNewViewDialog.props.viewType;return __exports;});;

/* /web_studio/static/src/client_action/editor/new_view_dialogs/new_view_dialog.js */
odoo.define('@web_studio/client_action/editor/new_view_dialogs/new_view_dialog',['@web/core/utils/hooks','@web/core/utils/strings','@web/core/confirmation_dialog/confirmation_dialog','@odoo/owl'],function(require){'use strict';let __exports={};const{useService}=require("@web/core/utils/hooks");const{sprintf}=require("@web/core/utils/strings");const{ConfirmationDialog}=require("@web/core/confirmation_dialog/confirmation_dialog");const{onWillStart}=require("@odoo/owl");const NewViewDialog=__exports.NewViewDialog=class NewViewDialog extends ConfirmationDialog{setup(){super.setup();this.orm=useService("orm");this.rpc=useService("rpc");this.studio=useService("studio");this.user=useService("user");this.mandatoryStopDate=["gantt","cohort"].includes(this.viewType);this.title=sprintf(this.env._t("Generate %s View"),this.viewType);this.fieldsChoice={date_start:null,date_stop:null,};onWillStart(async()=>{const fieldsGet=await this.orm.call(this.studio.editedAction.res_model,"fields_get");const fields=Object.entries(fieldsGet).map(([fName,field])=>{field.name=fName;return field;});fields.sort((first,second)=>{if(first.string===second.string){return 0;}
if(first.string<second.string){return-1;}
if(first.string>second.string){return 1;}});this.computeSpecificFields(fields);});}
get viewType(){return this.props.viewType;}
computeSpecificFields(fields){this.dateFields=[];this.rowFields=[];this.measureFields=[];fields.forEach((field)=>{if(field.store){if(field.type==="date"||field.type==="datetime"){this.dateFields.push(field);}
if(this.constructor.GROUPABLE_TYPES.includes(field.type)){this.rowFields.push(field);}
if(this.constructor.MEASURABLE_TYPES.includes(field.type)){if(field.name!=="id"&&field.name!=="sequence"){this.measureFields.push(field);}}}});if(this.dateFields.length){this.fieldsChoice.date_start=this.dateFields[0].name;this.fieldsChoice.date_stop=this.dateFields[0].name;}}
async _confirm(){await this.rpc("/web_studio/create_default_view",{model:this.studio.editedAction.res_model,view_type:this.viewType,attrs:this.fieldsChoice,context:this.user.context,});super._confirm();}}
NewViewDialog.template="web_studio.NewViewDialog";NewViewDialog.GROUPABLE_TYPES=["many2one","char","boolean","selection","date","datetime"];NewViewDialog.MEASURABLE_TYPES=["integer","float"];NewViewDialog.props={...ConfirmationDialog.props,viewType:String,};delete NewViewDialog.props.body;return __exports;});;

/* /web_studio/static/src/client_action/editor/report_editor_adapter.js */
odoo.define('@web_studio/client_action/editor/report_editor_adapter',['web.OwlCompatibility','web_studio.ReportEditorManager','@web/core/utils/hooks','@web/core/registry','@web/webclient/actions/action_service','web_studio.bus','@odoo/owl','@web_studio/client_action/editor/edition_flow'],function(require){'use strict';let __exports={};const{ComponentAdapter}=require("web.OwlCompatibility");const ReportEditorManager=require("web_studio.ReportEditorManager");const{useService}=require("@web/core/utils/hooks");const{registry}=require("@web/core/registry");const{standardActionServiceProps}=require("@web/webclient/actions/action_service");const studioBus=require("web_studio.bus");const{Component,onMounted,onWillUnmount,reactive,xml}=require("@odoo/owl");const{useEditorFlowFeatures}=require("@web_studio/client_action/editor/edition_flow");function useLegacyBus(bus,evName,callback){const obj={};onMounted(()=>bus.on(evName,obj,callback));onWillUnmount(()=>bus.off(evName,obj,callback));}
class ReportEditorAdapter extends ComponentAdapter{constructor(props){props.Component=ReportEditorManager;super(...arguments);}
setup(){super.setup();this.actionService=useService("action");this.user=useService("user");this.rpc=useService("rpc");this.orm=useService("orm");this.studio=useService("studio");this.reportEnv={};const snackBarIndicator=reactive({state:"",});useLegacyBus(studioBus,"toggle_snack_bar",(detail)=>{let state;if(detail==="saving"){state="loading";}else if(detail==="saved"){state="loaded";}
snackBarIndicator.state=state;});const editorOperations=reactive({undo:()=>studioBus.trigger("undo_clicked"),redo:()=>studioBus.trigger("redo_clicked"),canUndo:false,canRedo:false,});useLegacyBus(studioBus,"undo_available",()=>{editorOperations.canUndo=true;});useLegacyBus(studioBus,"undo_not_available",()=>{editorOperations.canUndo=false;});useLegacyBus(studioBus,"redo_available",()=>{editorOperations.canRedo=true;});useLegacyBus(studioBus,"redo_not_available",()=>{editorOperations.canRedo=false;});useEditorFlowFeatures({snackBarIndicator,editorOperations});this.env=Component.env;}
get handle(){return this.studio.editedReport;}
async onWillStart(){const proms=[];await this._readReport();await this._loadEnvironment();proms.push(this._readModels());proms.push(this._readWidgetsOptions());proms.push(this._getReportViews());proms.push(this._readPaperFormat());await Promise.all(proms);return super.onWillStart();}
get widgetArgs(){return[{env:this.reportEnv,models:this.models,paperFormat:this.paperFormat,report:this.report,reportHTML:this.reportViews.report_html,reportMainViewID:this.reportViews.main_view_id,reportViews:this.reportViews.views,widgetsOptions:this.widgetsOptions,},];}
async _loadEnvironment(){this.reportEnv.modelName=this.report.model;let domain=[];if(this.report.model==="account.move"){domain=[["move_type","!=","entry"]];}
const result=await this.orm.search(this.report.model,domain,{context:this.user.context,});this.reportEnv.ids=result;this.reportEnv.currentId=this.reportEnv.ids&&this.reportEnv.ids[0];}
async _readModels(){const models=await this.orm.searchRead("ir.model",[["transient","=",false],["abstract","=",false],],["name","model"],{context:this.user.context});this.models={};models.forEach((model)=>{this.models[model.model]=model.name;});}
async _readReport(){const result=await this.orm.read("ir.actions.report",[this.handle.res_id],undefined,{context:this.user.context,});this.report=result[0];}
async _readPaperFormat(){this.paperFormat="A4";const result=await this.rpc("/web_studio/read_paperformat",{report_id:this.handle.res_id,context:this.user.context,});this.paperFormat=result[0];}
async _readWidgetsOptions(){this.widgetsOptions=await this.rpc("/web_studio/get_widgets_available_options",{context:this.user.context,});}
async _getReportViews(){this.reportViews=await this.rpc("/web_studio/get_report_views",{record_id:this.reportEnv.currentId,report_name:this.report.report_name,});}
_trigger_up(ev){switch(ev.name){case"studio_edit_report":this._editReport(ev.data);break;case"open_record_form_view":this.actionService.doAction({type:"ir.actions.act_window",res_model:"ir.actions.report",res_id:this.handle.res_id,views:[[false,"form"]],target:"current",},{clearBreadcrumbs:true});break;}
super._trigger_up(...arguments);}
async _editReport(values){const result=await this.rpc("/web_studio/edit_report",{report_id:this.report.id,values:values,context:this.user.context,});this.report=result[0];this.render(true);}}
const ReportEditor=__exports.ReportEditor=class ReportEditor extends Component{}
ReportEditor.template=xml`<div class="o_web_studio_client_action"><ReportEditorAdapter /></div>`;ReportEditor.components={ReportEditorAdapter};ReportEditor.props={...standardActionServiceProps};registry.category("actions").add("web_studio.report_editor",ReportEditor);return __exports;});;

/* /web_studio/static/src/client_action/editor/studio_action_container.js */
odoo.define('@web_studio/client_action/editor/studio_action_container',['@web/webclient/actions/action_container','@web/core/utils/hooks','@web/core/registry','@web/core/utils/concurrency','@odoo/owl','@web_studio/studio_service','@web/views/view_compiler'],function(require){'use strict';let __exports={};const{ActionContainer}=require("@web/webclient/actions/action_container");const{useService}=require("@web/core/utils/hooks");const{registry}=require("@web/core/registry");const{KeepLast}=require("@web/core/utils/concurrency");const{onWillStart,onWillUpdateProps}=require("@odoo/owl");const{useStudioServiceAsReactive}=require("@web_studio/studio_service");const{resetViewCompilerCache}=require("@web/views/view_compiler");const editorTabRegistry=registry.category("web_studio.editor_tabs");const StudioActionContainer=__exports.StudioActionContainer=class StudioActionContainer extends ActionContainer{setup(){super.setup();this.actionService=useService("action");this.studio=useStudioServiceAsReactive();this.rpc=useService("rpc");let actionKey=1;const onUiUpdate=()=>{actionKey++;};this.env.bus.addEventListener("ACTION_MANAGER:UPDATE",onUiUpdate);owl.onWillUnmount(()=>this.env.bus.removeEventListener("ACTION_MANAGER:UPDATE",onUiUpdate));const doAction=async(action,options)=>{try{await this.actionService.doAction(action,options);this.actionKey=actionKey;}catch(e){if(action!=="web_studio.action_editor"){this.studio.setParams({editorTab:"views"});}
throw e;}};onWillStart(async()=>{const action=await this.getStudioAction();this.studioKey=this.studio.requestId;doAction(action);await Promise.resolve();});const willUpdateKeepLast=new KeepLast();onWillUpdateProps(async()=>{if(this.studio.requestId!==this.studioKey||this.actionKey!==actionKey){const action=await willUpdateKeepLast.add(this.getStudioAction());resetViewCompilerCache();return new Promise((_resolve)=>{const resolve=()=>{this.env.bus.removeEventListener("ACTION_MANAGER:UPDATE",resolve);_resolve();};this.studioKey=this.studio.requestId;doAction(action,{clearBreadcrumbs:true}).finally(()=>{this.env.bus.removeEventListener("ACTION_MANAGER:UPDATE",resolve);});this.env.bus.addEventListener("ACTION_MANAGER:UPDATE",resolve);});}});}
async getStudioAction(){const{editorTab,editedAction,editedReport,editedViewType}=this.studio;const tab=editorTabRegistry.get(editorTab);if(editorTab==="views"){if(editedViewType){return"web_studio.view_editor";}
return tab.action;}
if(tab.action){return tab.action;}else if(editorTab==="reports"&&editedReport){return"web_studio.report_editor";}else{const action=await this.rpc("/web_studio/get_studio_action",{action_name:editorTab,model:editedAction.res_model,view_id:editedAction.view_id&&editedAction.view_id[0],});action.help=action.help&&owl.markup(action.help);return action;}}}
StudioActionContainer.props={...ActionContainer.props,reloadId:{type:Number},};return __exports;});;

/* /web_studio/static/src/client_action/icon_creator/icon_creator.js */
odoo.define('@web_studio/client_action/icon_creator/icon_creator',['@web_studio/utils','@web/core/file_input/file_input','web.CustomFileInput','@web/core/utils/hooks','@odoo/owl'],function(require){'use strict';let __exports={};const{COLORS,BG_COLORS,ICONS}=require("@web_studio/utils");const{FileInput}=require("@web/core/file_input/file_input");const CustomFileInput=require("web.CustomFileInput");const{useService}=require("@web/core/utils/hooks");const{Component,onWillUpdateProps,useRef,useState}=require("@odoo/owl");const DEFAULT_ICON={backgroundColor:BG_COLORS[5],color:COLORS[4],iconClass:ICONS[0],};const IconCreator=__exports.IconCreator=class IconCreator extends Component{setup(){this.COLORS=COLORS;this.BG_COLORS=BG_COLORS;this.ICONS=ICONS;this.iconRef=useRef("app-icon");this.FileInput=FileInput;this.fileInputProps={acceptedFileExtensions:"image/png",resModel:"res.users",};try{const user=useService("user");this.orm=useService("orm");this.fileInputProps.resId=user.userId;}catch(e){if(e.message==="Service user is not available"){this.FileInput=CustomFileInput;this.fileInputProps={accepted_file_extensions:"image/png",action:"/web/binary/upload_attachment",id:this.env.session.uid,model:"res.users",};}}
this.rpc=useService("rpc");this.state=useState({iconClass:this.props.iconClass});this.show=useState({backgroundColor:false,color:false,iconClass:false,});onWillUpdateProps((nextProps)=>{if(this.constructor.enableTransitions&&nextProps.iconClass!==this.props.iconClass){this.applyIconTransition(nextProps.iconClass);}else{this.state.iconClass=nextProps.iconClass;}});}
applyIconTransition(nextIconClass){const iconEl=this.iconRef.el;if(!iconEl){return;}
iconEl.classList.remove("o-fading-in");iconEl.classList.remove("o-fading-out");iconEl.onanimationend=()=>{this.state.iconClass=nextIconClass;iconEl.onanimationend=()=>{iconEl.onanimationend=null;iconEl.classList.remove("o-fading-in");};iconEl.classList.remove("o-fading-out");iconEl.classList.add("o-fading-in");};iconEl.classList.add("o-fading-out");}
onDesignIconClick(){this.props.onIconChange({type:"custom_icon",...DEFAULT_ICON,});}
async onFileUploaded([file]){if(!file){return;}
let res;if(this.orm){res=await this.orm.read("ir.attachment",[file.id],["datas"]);}else{res=await this.rpc({model:"ir.attachment",method:"read",args:[[file.id],["datas"]],});}
this.props.onIconChange({type:"base64",uploaded_attachment_id:file.id,webIconData:"data:image/png;base64,"+res[0].datas.replace(/\s/g,""),});}
onPaletteItemClick(palette,value){if(this.props[palette]===value){return;}
this.props.onIconChange({backgroundColor:this.props.backgroundColor,color:this.props.color,iconClass:this.props.iconClass,type:"custom_icon",[palette]:value,});}
onTogglePalette(palette){for(const pal in this.show){if(pal===palette){this.show[pal]=!this.show[pal];}else if(this.show[pal]){this.show[pal]=false;}}}}
IconCreator.defaultProps=DEFAULT_ICON;IconCreator.props={backgroundColor:{type:String,optional:1},color:{type:String,optional:1},editable:{type:Boolean,optional:1},iconClass:{type:String,optional:1},type:{validate:(t)=>["base64","custom_icon"].includes(t)},uploaded_attachment_id:{type:Number,optional:1},webIconData:{type:String,optional:1},onIconChange:Function,};IconCreator.template="web_studio.IconCreator";IconCreator.enableTransitions=true;return __exports;});;

/* /web_studio/static/src/client_action/menu_creator/menu_creator.js */
odoo.define('@web_studio/client_action/menu_creator/menu_creator',['@odoo/owl','@web/core/utils/hooks','@web/core/dialog/dialog','@web/views/fields/many2one/many2one_field','@web/views/record','@web/core/l10n/translation','@web_studio/client_action/utils','@web_studio/client_action/model_configurator/model_configurator'],function(require){'use strict';let __exports={};const{Component,useState}=require("@odoo/owl");const{useOwnedDialogs}=require("@web/core/utils/hooks");const{Dialog}=require("@web/core/dialog/dialog");const{Many2OneField}=require("@web/views/fields/many2one/many2one_field");const{Record}=require("@web/views/record");const{_t}=require("@web/core/l10n/translation");const{useDialogConfirmation}=require("@web_studio/client_action/utils");const{ModelConfiguratorDialog}=require("@web_studio/client_action/model_configurator/model_configurator");const MenuCreatorModel=__exports.MenuCreatorModel=class MenuCreatorModel{constructor({allowNoModel}={}){this.data={modelId:false,menuName:"",modelChoice:"new",};this.modelIdfieldsInfo={modelId:{relation:"ir.model",domain:[["transient","=",false],["abstract","=",false],],type:"many2one",},};this.modelChoiceSelection={new:_t("New Model"),existing:_t("Existing Model"),};if(allowNoModel){this.modelChoiceSelection.parent=_t("Parent Menu");}}
validateField(fieldName){if(fieldName==="menuName"){return!!this.data.menuName;}else if(fieldName==="modelId"){return this.data.modelChoice==="existing"?!!this.data.modelId:true;}}
get isValid(){return["menuName","modelId"].every((fName)=>this.validateField(fName));}}
const MenuCreator=__exports.MenuCreator=class MenuCreator extends Component{static template="web_studio.MenuCreator";static components={Record,Many2OneField};static props={menuCreatorModel:{type:Object},showValidation:{type:Boolean,optional:true},};static defaultProps={showValidation:false,};setup(){this.state=useState(this.props.menuCreatorModel);}
isValid(fieldName){return this.props.showValidation?this.state.validateField(fieldName):true;}}
const MenuCreatorDialog=__exports.MenuCreatorDialog=class MenuCreatorDialog extends Component{static template="web_studio.MenuCreatorDialog";static components={Dialog,MenuCreator};static props={confirm:{type:Function},close:{type:Function}};setup(){this.addDialog=useOwnedDialogs();this.menuCreatorModel=useState(new MenuCreatorModel({allowNoModel:true}));this.state=useState({showValidation:false});this.title=_t("Create your menu");const{confirm,cancel}=useDialogConfirmation({confirm:async(data={})=>{if(!this.menuCreatorModel.isValid){this.state.showValidation=true;return false;}
await this.props.confirm(data);},});this._confirm=confirm;this._cancel=cancel;}
confirm(data={}){this._confirm({...this.menuCreatorModel.data,...data});}
onCreateNewModel(){if(!this.menuCreatorModel.isValid){this.state.showValidation=true;return;}
this.addDialog(ModelConfiguratorDialog,{confirmLabel:_t("Create Menu"),confirm:(data)=>{this.confirm({modelOptions:data});},});}}
return __exports;});;

/* /web_studio/static/src/client_action/model_configurator/model_configurator.js */
odoo.define('@web_studio/client_action/model_configurator/model_configurator',['@web/core/dialog/dialog','@odoo/owl','@web/core/l10n/translation','@web/session'],function(require){'use strict';let __exports={};const{Dialog}=require("@web/core/dialog/dialog");const{Component,useState}=require("@odoo/owl");const{_lt,_t}=require("@web/core/l10n/translation");const{session}=require("@web/session");function getModelOptions(){const modelOptions={use_partner:{label:_lt("Contact details"),help:_lt("Get contact, phone and email fields on records"),value:false,},use_responsible:{label:_lt("User assignment"),help:_lt("Assign a responsible to each record"),value:false,},use_date:{label:_lt("Date & Calendar"),help:_lt("Assign dates and visualize records in a calendar"),value:false,},use_double_dates:{label:_lt("Date range & Gantt"),help:_lt("Define start/end dates and visualize records in a Gantt chart"),value:false,},use_stages:{label:_lt("Pipeline stages"),help:_lt("Stage and visualize records in a custom pipeline"),value:false,},use_ltags:{label:_lt("Tags"),help:_lt("Categorize records with custom tags"),value:false,},use_image:{label:_lt("Picture"),help:_lt("Attach a picture to a record"),value:false,},lines:{label:_lt("Lines"),help:_lt("Add details to your records with an embedded list view"),value:false,},use_notes:{label:_lt("Notes"),help:_lt("Write additional notes or comments"),value:false,},use_value:{label:_lt("Monetary value"),help:_lt("Set a price or cost on records"),value:false,},use_company:{label:_lt("Company"),help:_lt("Restrict a record to a specific company"),value:false,},use_sequence:{label:_lt("Custom Sorting"),help:_lt("Manually sort records in the list view"),value:true,},use_mail:{label:_lt("Chatter"),help:_lt("Send messages, log notes and schedule activities"),value:true,},use_active:{label:_lt("Archiving"),help:_lt("Archive deprecated records"),value:true,},};if(!session.display_switch_company_menu){delete modelOptions.use_company;}
return modelOptions;}
const ModelConfigurator=__exports.ModelConfigurator=class ModelConfigurator extends Component{setup(){this.state=useState({saving:false});this.options=useState(getModelOptions());}
async onConfirm(){try{this.state.saving=true;const mappedOptions=Object.entries(this.options).filter((opt)=>opt[1].value).map((opt)=>opt[0]);await this.props.onConfirmOptions(mappedOptions);}finally{this.state.saving=false;}}}
ModelConfigurator.template="web_studio.ModelConfigurator";ModelConfigurator.components={};ModelConfigurator.props={embed:{type:Boolean,optional:true},label:{type:String},onConfirmOptions:Function,onPrevious:Function,};const ModelConfiguratorDialog=__exports.ModelConfiguratorDialog=class ModelConfiguratorDialog extends Component{static components={Dialog,ModelConfigurator};static template="web_studio.ModelConfiguratorDialog";static props={confirm:{type:Function},close:{type:Function},confirmLabel:{type:String,optional:true},};async onConfirm(data){await this.props.confirm(data);this.props.close();}
onPrevious(){this.props.close();}
get title(){return _t("Suggested features for your new model");}}
return __exports;});;

/* /web_studio/static/src/client_action/navbar/home_menu_customizer/home_menu_customizer.js */
odoo.define('@web_studio/client_action/navbar/home_menu_customizer/home_menu_customizer',['@web/core/dropdown/dropdown','@web/core/dropdown/dropdown_item','@web/core/utils/hooks','@web/core/browser/browser','@web/core/network/download','@web/core/confirmation_dialog/confirmation_dialog','@web/core/file_input/file_input','@odoo/owl'],function(require){'use strict';let __exports={};const{Dropdown}=require("@web/core/dropdown/dropdown");const{DropdownItem}=require("@web/core/dropdown/dropdown_item");const{useService}=require("@web/core/utils/hooks");const{browser}=require("@web/core/browser/browser");const{download}=require("@web/core/network/download");const{ConfirmationDialog}=require("@web/core/confirmation_dialog/confirmation_dialog");const{FileInput}=require("@web/core/file_input/file_input");const{Component}=require("@odoo/owl");const HomeMenuCustomizer=__exports.HomeMenuCustomizer=class HomeMenuCustomizer extends Component{setup(){this.rpc=useService("rpc");this.ui=useService("ui");this.notification=useService("notification");this.company=useService("company");this.user=useService("user");this.actionManager=useService("action");this.menus=useService("menu");this.dialogManager=useService("dialog");}
setBackgroundImage(attachment_id){return this.rpc("/web_studio/set_background_image",{attachment_id:attachment_id,context:this.user.context,});}
exportCusto(){download({url:"/web_studio/export",data:{}});}
importCusto(){const action={name:"Import modules",res_model:"base.import.module",views:[[false,"form"]],type:"ir.actions.act_window",target:"new",context:{dialog_size:"medium",},};const options={onClose:()=>this.menus.reload(),};this.actionManager.doAction(action,options);}
async confirmReset(){this.ui.block();try{await this.rpc("/web_studio/reset_background_image",{context:this.user.context,});browser.location.reload();}finally{this.ui.unblock();}}
resetBackground(){this.dialogManager.add(ConfirmationDialog,{body:this.env._t("Are you sure you want to reset the background image?"),title:this.env._t("Confirmation"),confirm:()=>this.confirmReset(),});}
async onBackgroundUpload([file]){if(!file){this.notification.add(this.env._t("Could not change the background"),{sticky:true,type:"warning",});}else{this.ui.block();try{await this.setBackgroundImage(file.id);browser.location.reload();}finally{this.ui.unblock();}}}}
HomeMenuCustomizer.template="web_studio.HomeMenuCustomizer";HomeMenuCustomizer.props={};HomeMenuCustomizer.components={Dropdown,DropdownItem,FileInput};return __exports;});;

/* /web_studio/static/src/client_action/navbar/navbar.js */
odoo.define('@web_studio/client_action/navbar/navbar',['@odoo/owl','@web/core/registry','@web/core/utils/hooks','@web_enterprise/webclient/navbar/navbar','@web_studio/client_action/navbar/home_menu_customizer/home_menu_customizer','@web_studio/studio_service'],function(require){'use strict';let __exports={};const{onMounted,onWillUnmount}=require("@odoo/owl");const{registry}=require("@web/core/registry");const{useService}=require("@web/core/utils/hooks");const{EnterpriseNavBar}=require("@web_enterprise/webclient/navbar/navbar");const{HomeMenuCustomizer}=require("@web_studio/client_action/navbar/home_menu_customizer/home_menu_customizer");const{useStudioServiceAsReactive,NotEditableActionError}=require("@web_studio/studio_service");const menuButtonsRegistry=registry.category("studio_navbar_menubuttons");const StudioNavbar=__exports.StudioNavbar=class StudioNavbar extends EnterpriseNavBar{setup(){super.setup();this.studio=useStudioServiceAsReactive();this.actionManager=useService("action");this.user=useService("user");this.dialogManager=useService("dialog");this.notification=useService("notification");onMounted(()=>{this.env.bus.off("HOME-MENU:TOGGLED",this);this._updateMenuAppsIcon();});const onMenuButtonsUpdate=()=>this.render();menuButtonsRegistry.addEventListener("UPDATE",onMenuButtonsUpdate);onWillUnmount(()=>menuButtonsRegistry.removeEventListener("UPDATE",onMenuButtonsUpdate));}
onMenuToggle(){this.studio.toggleHomeMenu();}
closeStudio(){this.studio.leave();}
async onNavBarDropdownItemSelection(menu){if(menu.actionID){try{await this.studio.open(this.studio.MODES.EDITOR,menu.actionID);}catch(e){if(e instanceof NotEditableActionError){const options={type:"danger"};this.notification.add(this.env._t("This action is not editable by Studio"),options);return;}
throw e;}}}
get hasBackgroundAction(){return this.studio.editedAction||this.studio.MODES.APP_CREATOR===this.studio.mode;}
get isInApp(){return this.studio.mode===this.studio.MODES.EDITOR;}
get menuButtons(){return Object.fromEntries(menuButtonsRegistry.getEntries());}}
StudioNavbar.template="web_studio.StudioNavbar";StudioNavbar.components.HomeMenuCustomizer=HomeMenuCustomizer;return __exports;});;

/* /web_studio/static/src/client_action/studio_client_action.js */
odoo.define('@web_studio/client_action/studio_client_action',['@web/core/registry','@web/core/utils/hooks','@web/legacy/utils','@web/webclient/actions/action_service','@web/webclient/menus/menu_helpers','@web_studio/client_action/app_creator/app_creator','@web_studio/client_action/editor/editor','@web_studio/client_action/navbar/navbar','@web_studio/client_action/studio_home_menu/studio_home_menu','@odoo/owl'],function(require){'use strict';let __exports={};const{registry}=require("@web/core/registry");const{useBus,useService}=require("@web/core/utils/hooks");const{cleanDomFromBootstrap}=require("@web/legacy/utils");const{standardActionServiceProps}=require("@web/webclient/actions/action_service");const{computeAppsAndMenuItems}=require("@web/webclient/menus/menu_helpers");const{AppCreator}=require("@web_studio/client_action/app_creator/app_creator");const{Editor}=require("@web_studio/client_action/editor/editor");const{StudioNavbar}=require("@web_studio/client_action/navbar/navbar");const{StudioHomeMenu}=require("@web_studio/client_action/studio_home_menu/studio_home_menu");const{Component,onWillStart,onMounted,onPatched,onWillUnmount}=require("@odoo/owl");const StudioClientAction=__exports.StudioClientAction=class StudioClientAction extends Component{setup(){this.studio=useService("studio");useBus(this.studio.bus,"UPDATE",()=>{this.render();cleanDomFromBootstrap();});this.menus=useService("menu");this.actionService=useService("action");this.homeMenuProps={apps:computeAppsAndMenuItems(this.menus.getMenuAsTree("root")).apps,};useBus(this.env.bus,"MENUS:APP-CHANGED",()=>{this.homeMenuProps={apps:computeAppsAndMenuItems(this.menus.getMenuAsTree("root")).apps,};this.render();});onWillStart(this.onWillStart);onMounted(this.onMounted);onPatched(this.onPatched);onWillUnmount(this.onWillUnmount);}
onWillStart(){return this.studio.ready;}
onMounted(){this.studio.pushState();document.body.classList.add("o_in_studio");}
onPatched(){this.studio.pushState();}
onWillUnmount(){document.body.classList.remove("o_in_studio");}
async onNewAppCreated({action_id,menu_id}){await this.menus.reload();this.menus.setCurrentMenu(menu_id);const action=await this.actionService.loadAction(action_id);let initViewType="form";if(!action.views.some((vTuple)=>vTuple[1]===initViewType)){initViewType=action.views[0][1];}
this.studio.setParams({mode:this.studio.MODES.EDITOR,editorTab:"views",action,viewType:initViewType,});}}
StudioClientAction.template="web_studio.StudioClientAction";StudioClientAction.props={...standardActionServiceProps};StudioClientAction.components={StudioNavbar,StudioHomeMenu,Editor,AppCreator,};StudioClientAction.target="fullscreen";registry.category("lazy_components").add("StudioClientAction",StudioClientAction);registry.category("actions").add("studio",StudioClientAction,{force:true});return __exports;});;

/* /web_studio/static/src/client_action/studio_home_menu/icon_creator_dialog/icon_creator_dialog.js */
odoo.define('@web_studio/client_action/studio_home_menu/icon_creator_dialog/icon_creator_dialog',['@web/core/dialog/dialog','@web/core/l10n/translation','@web/core/utils/hooks','@web_studio/client_action/icon_creator/icon_creator','@odoo/owl'],function(require){'use strict';let __exports={};const{Dialog}=require("@web/core/dialog/dialog");const{_lt}=require("@web/core/l10n/translation");const{useService}=require("@web/core/utils/hooks");const{IconCreator}=require("@web_studio/client_action/icon_creator/icon_creator");const{Component,useState}=require("@odoo/owl");const IconCreatorDialog=__exports.IconCreatorDialog=class IconCreatorDialog extends Component{setup(){this.user=useService("user");this.rpc=useService("rpc");this.menus=useService("menu");this.initialAppData={...this.props.editedAppData};this.editedAppData=useState(this.props.editedAppData);}
onIconChanged(icon){for(const key in this.editedAppData){delete this.editedAppData[key];}
for(const key in icon){this.editedAppData[key]=icon[key];}}
async saveIcon(){const{type}=this.initialAppData;const appId=this.props.appId;let iconValue;if(this.editedAppData.type!==type){if(this.editedAppData.type==="base64"){iconValue=this.editedAppData.uploaded_attachment_id;}else{const{iconClass,color,backgroundColor}=this.editedAppData;iconValue=[iconClass,color,backgroundColor];}}else if(this.editedAppData.type==="custom_icon"){const{iconClass,color,backgroundColor}=this.editedAppData;if(this.initialAppData.iconClass!==iconClass||this.initialAppData.color!==color||this.initialAppData.backgroundColor!==backgroundColor){iconValue=[iconClass,color,backgroundColor];}}else if(this.editedAppData.uploaded_attachment_id){iconValue=this.editedAppData.uploaded_attachment_id;}
if(iconValue){await this.rpc("/web_studio/edit_menu_icon",{context:this.user.context,icon:iconValue,menu_id:appId,});await this.menus.reload();}
this.props.close();}}
IconCreatorDialog.title=_lt("Edit Application Icon");IconCreatorDialog.props={editedAppData:Object,appId:Number,close:Function,};IconCreatorDialog.template="web_studio.IconCreatorDialog";IconCreatorDialog.components={Dialog,IconCreator};return __exports;});;

/* /web_studio/static/src/client_action/studio_home_menu/studio_home_menu.js */
odoo.define('@web_studio/client_action/studio_home_menu/studio_home_menu',['@web_enterprise/webclient/home_menu/home_menu','@web/core/l10n/translation','@web/core/utils/hooks','@web_studio/studio_service','@web_studio/client_action/studio_home_menu/icon_creator_dialog/icon_creator_dialog','@odoo/owl'],function(require){'use strict';let __exports={};const{HomeMenu}=require("@web_enterprise/webclient/home_menu/home_menu");const{_lt}=require("@web/core/l10n/translation");const{useService}=require("@web/core/utils/hooks");const{NotEditableActionError}=require("@web_studio/studio_service");const{IconCreatorDialog}=require("@web_studio/client_action/studio_home_menu/icon_creator_dialog/icon_creator_dialog");const{onMounted,onWillUnmount,useRef}=require("@odoo/owl");const NEW_APP_BUTTON={isNewAppButton:true,label:_lt("New App"),webIconData:"/web_studio/static/src/img/default_icon_app.png",};const StudioHomeMenu=__exports.StudioHomeMenu=class StudioHomeMenu extends HomeMenu{setup(){super.setup(...arguments);this.user=useService("user");this.studio=useService("studio");this.notifications=useService("notification");this.dialog=useService("dialog");this.root=useRef("root");onMounted(()=>{this.canEditIcons=true;document.body.classList.add("o_home_menu_background");document.body.classList.toggle("o_home_menu_background_custom",this.menus.getMenu("root").backgroundImage);});onWillUnmount(()=>{document.body.classList.remove("o_home_menu_background","o_home_menu_background_custom");})}
get displayedApps(){return[...super.displayedApps,NEW_APP_BUTTON];}
async _openMenu(menu){if(menu.isNewAppButton){this.canEditIcons=false;return this.studio.open(this.studio.MODES.APP_CREATOR);}else{try{await this.studio.open(this.studio.MODES.EDITOR,menu.actionID);this.menus.setCurrentMenu(menu);}catch(e){if(e instanceof NotEditableActionError){const options={type:"danger"};this.notifications.add(this.env._t("This action is not editable by Studio"),options);return;}
throw e;}}}
onEditIconClick(app){if(!this.canEditIcons){return;}
const editedAppData={};if(app.webIconData){Object.assign(editedAppData,{webIconData:app.webIconData,type:"base64",});}else{Object.assign(editedAppData,{backgroundColor:app.webIcon.backgroundColor,color:app.webIcon.color,iconClass:app.webIcon.iconClass,type:"custom_icon",});}
const dialogProps={editedAppData,appId:app.id,};this.dialog.add(IconCreatorDialog,dialogProps);}}
StudioHomeMenu.props={apps:HomeMenu.props.apps};StudioHomeMenu.template="web_studio.StudioHomeMenu";return __exports;});;

/* /web_studio/static/src/client_action/utils.js */
odoo.define('@web_studio/client_action/utils',['@odoo/owl'],function(require){'use strict';let __exports={};const{reactive,useComponent,useEnv}=require("@odoo/owl");__exports.useDialogConfirmation=useDialogConfirmation;function useDialogConfirmation({confirm,cancel,before,close}){before=before||(()=>{});confirm=confirm||(()=>{});cancel=cancel||(()=>{});if(!close){const component=useComponent();close=()=>component.props.close();}
let isProtected=false;async function canExecute(){if(isProtected){return false;}
isProtected=true;await before();return true;}
async function execute(cb,...args){let succeeded=false;try{succeeded=await cb(...args);}catch(e){close();throw e;}
if(succeeded===undefined||succeeded){return close();}
isProtected=false;}
async function _confirm(...args){if(!(await canExecute())){return;}
return execute(confirm,...args);}
async function _cancel(...args){if(!(await canExecute())){return;}
return execute(cancel,...args);}
const env=useEnv();env.dialogData.close=()=>_cancel();return{confirm:_confirm,cancel:_cancel};}
const Reactive=__exports.Reactive=class Reactive{constructor(){const raw=this;this.raw=()=>{return raw;};return reactive(this);}}
return __exports;});;

/* /web_studio/static/src/client_action/view_editor/default_view_sidebar/default_view_sidebar.js */
odoo.define('@web_studio/client_action/view_editor/default_view_sidebar/default_view_sidebar',['@odoo/owl','@web_studio/client_action/view_editor/interactive_editor/interactive_editor_sidebar','@web_studio/client_action/view_editor/interactive_editor/sidebar_view_toolbox/sidebar_view_toolbox'],function(require){'use strict';let __exports={};const{Component,useState}=require("@odoo/owl");const{InteractiveEditorSidebar}=require("@web_studio/client_action/view_editor/interactive_editor/interactive_editor_sidebar");const{SidebarViewToolbox}=require("@web_studio/client_action/view_editor/interactive_editor/sidebar_view_toolbox/sidebar_view_toolbox");const DefaultViewSidebar=__exports.DefaultViewSidebar=class DefaultViewSidebar extends Component{static template="web_studio.ViewEditor.DefaultViewSidebar";static props={openViewInForm:{type:Function,optional:true},openDefaultValues:{type:Function,optional:true},};static components={InteractiveEditorSidebar,SidebarViewToolbox,};setup(){this.viewEditorModel=useState(this.env.viewEditorModel);}}
return __exports;});;

/* /web_studio/static/src/client_action/view_editor/editors/calendar/calendar_editor.js */
odoo.define('@web_studio/client_action/view_editor/editors/calendar/calendar_editor',['@web/views/calendar/calendar_view','@web/core/registry','@odoo/owl','@web_studio/client_action/view_editor/interactive_editor/interactive_editor_sidebar','@web_studio/client_action/view_editor/property/property','@web_studio/client_action/view_editor/interactive_editor/sidebar_view_toolbox/sidebar_view_toolbox','@web_studio/client_action/view_editor/editors/utils','@web/views/calendar/calendar_controller','@web_studio/client_action/view_editor/view_editor_model'],function(require){'use strict';let __exports={};const{calendarView}=require("@web/views/calendar/calendar_view");const{registry}=require("@web/core/registry");const{Component,useState}=require("@odoo/owl");const{InteractiveEditorSidebar}=require("@web_studio/client_action/view_editor/interactive_editor/interactive_editor_sidebar");const{Property}=require("@web_studio/client_action/view_editor/property/property");const{SidebarViewToolbox}=require("@web_studio/client_action/view_editor/interactive_editor/sidebar_view_toolbox/sidebar_view_toolbox");const{fieldsToChoices}=require("@web_studio/client_action/view_editor/editors/utils");const{SCALE_LABELS}=require("@web/views/calendar/calendar_controller");const{useEditNodeAttributes}=require("@web_studio/client_action/view_editor/view_editor_model");const CalendarEditorSidebar=__exports.CalendarEditorSidebar=class CalendarEditorSidebar extends Component{static template="web_studio.ViewEditor.CalendarEditorSidebar";static props={openViewInForm:{type:Function,optional:true},openDefaultValues:{type:Function,optional:true},};static components={InteractiveEditorSidebar,Property,SidebarViewToolbox,};setup(){this.viewEditorModel=useState(this.env.viewEditorModel);this.editArchAttributes=useEditNodeAttributes({isRoot:true});}
get archInfo(){return this.viewEditorModel.controllerProps.archInfo;}
onViewAttributeChanged(value,name){value=value?value:"";return this.editArchAttributes({[name]:value});}
get quickCreateFields(){return fieldsToChoices(this.viewEditorModel.fields,(field)=>field.type==="char"&&field.store);}
get startDateFields(){return fieldsToChoices(this.viewEditorModel.fields,(field)=>["date","datetime"].includes(field.type));}
get delayFields(){return fieldsToChoices(this.viewEditorModel.fields,(field)=>["float","integer"].includes(field.type));}
get colorFields(){return fieldsToChoices(this.viewEditorModel.fields,(field)=>["many2one","selection"].includes(field.type));}
get allDayFields(){return fieldsToChoices(this.viewEditorModel.fields,(field)=>field.type==="boolean");}
get modeChoices(){return this.viewEditorModel.controllerProps.archInfo.scales.map((value)=>{return{value,label:SCALE_LABELS[value],};});}}
registry.category("studio_editors").add("calendar",{...calendarView,Sidebar:CalendarEditorSidebar,});return __exports;});;

/* /web_studio/static/src/client_action/view_editor/editors/cohort/cohort_editor.js */
odoo.define('@web_studio/client_action/view_editor/editors/cohort/cohort_editor',['@odoo/owl','@web/core/l10n/translation','@web/core/registry','@web_cohort/cohort_view','@web_studio/client_action/view_editor/property/property','@web_studio/client_action/view_editor/interactive_editor/interactive_editor_sidebar','@web_studio/client_action/view_editor/interactive_editor/sidebar_view_toolbox/sidebar_view_toolbox','@web_studio/client_action/view_editor/editors/utils','@web_studio/client_action/view_editor/view_editor_model'],function(require){'use strict';let __exports={};const{Component,useState}=require("@odoo/owl");const{_lt}=require("@web/core/l10n/translation");const{registry}=require("@web/core/registry");const{cohortView}=require("@web_cohort/cohort_view");const{Property}=require("@web_studio/client_action/view_editor/property/property");const{InteractiveEditorSidebar}=require("@web_studio/client_action/view_editor/interactive_editor/interactive_editor_sidebar");const{SidebarViewToolbox}=require("@web_studio/client_action/view_editor/interactive_editor/sidebar_view_toolbox/sidebar_view_toolbox");const{fieldsToChoices}=require("@web_studio/client_action/view_editor/editors/utils");const{useEditNodeAttributes}=require("@web_studio/client_action/view_editor/view_editor_model");const CohortEditorSidebar=__exports.CohortEditorSidebar=class CohortEditorSidebar extends Component{static template="web_studio.ViewEditor.CohortEditorSidebar";static props={openViewInForm:{type:Function,optional:true},openDefaultValues:{type:Function,optional:true},};static components={InteractiveEditorSidebar,Property,SidebarViewToolbox,};setup(){this.viewEditorModel=useState(this.env.viewEditorModel);this.editArchAttributes=useEditNodeAttributes({isRoot:true});}
onViewAttributeChanged(value,name){value=value?value:"";return this.editArchAttributes({[name]:value});}
get modelParams(){return this.env.viewEditorModel.controllerProps.modelParams;}
get dateFields(){return fieldsToChoices(this.viewEditorModel.fields,(field)=>field.store&&["date","datetime"].includes(field.type));}
get measureFields(){return fieldsToChoices(this.viewEditorModel.fields,(field)=>field.name!=="id"&&field.store&&["integer","float","monetary"].includes(field.type));}
get intervalChoices(){return[{label:_lt("Day"),value:"day"},{label:_lt("Week"),value:"week"},{label:_lt("Month"),value:"month"},{label:_lt("Year"),value:"year"},];}
get modeChoices(){return[{label:_lt("Retention"),value:"retention"},{label:_lt("Churn"),value:"churn"},];}
get timelineChoices(){return[{label:_lt("Forward"),value:"forward"},{label:_lt("Backwards"),value:"backward"},];}}
registry.category("studio_editors").add("cohort",{...cohortView,Sidebar:CohortEditorSidebar,});return __exports;});;

/* /web_studio/static/src/client_action/view_editor/editors/components/field_content_overlay.js */
odoo.define('@web_studio/client_action/view_editor/editors/components/field_content_overlay',['@web/core/l10n/translation','@odoo/owl','@web_studio/studio_service','@web/core/utils/strings'],function(require){'use strict';let __exports={};const{_t}=require("@web/core/l10n/translation");const{Component,xml}=require("@odoo/owl");const{viewTypeToString}=require("@web_studio/studio_service");const{sprintf}=require("@web/core/utils/strings");const FieldContentOverlay=__exports.FieldContentOverlay=class FieldContentOverlay extends Component{static template=xml`
    <div class="position-relative">
      <t t-slot="default" />
      <div class="o-web-studio-edit-x2manys-buttons w-100 h-100 d-flex justify-content-center gap-3 position-absolute start-0 top-0 opacity-75 bg-dark" t-if="props.displayOverlay" style="z-index: 1000;">
          <button class="btn btn-primary btn-secondary o_web_studio_editX2Many align-self-center"
          t-foreach="['list', 'form']" t-as="vType" t-key="vType"
          t-on-click.stop="() => props.onEditViewType(vType)"
          t-att-data-type="vType">
          <t t-esc="getButtonText(vType)" />
          </button>
      </div>
    </div>`;static props={displayOverlay:{type:Boolean},slots:{type:Object},onEditViewType:{type:Function},};getButtonText(viewType){return sprintf(_t("Edit %s view"),viewTypeToString(viewType));}}
return __exports;});;

/* /web_studio/static/src/client_action/view_editor/editors/components/field_selector_dialog.js */
odoo.define('@web_studio/client_action/view_editor/editors/components/field_selector_dialog',['@web/core/dialog/dialog','@odoo/owl'],function(require){'use strict';let __exports={};const{Dialog}=require("@web/core/dialog/dialog");const{Component,useRef}=require("@odoo/owl");const FieldSelectorDialog=__exports.FieldSelectorDialog=class FieldSelectorDialog extends Component{static props={close:{type:Function},onConfirm:{type:Function},fields:{type:Array},showNew:{type:Boolean,optional:true},};static defaultProps={showNew:false,};setup(){this.selectRef=useRef("select");}
onConfirm(){const field=this.selectRef.el.value;this.props.onConfirm(field);this.props.close();}
onCancel(){this.props.close();}}
FieldSelectorDialog.template="web_studio.FieldSelectorDialog";FieldSelectorDialog.components={Dialog};return __exports;});;

/* /web_studio/static/src/client_action/view_editor/editors/components/field_studio.js */
odoo.define('@web_studio/client_action/view_editor/editors/components/field_studio',['@web/views/fields/field','@web_studio/client_action/view_editor/editors/components/field_content_overlay','@web_studio/client_action/view_editor/editors/utils','@odoo/owl'],function(require){'use strict';let __exports={};const{Field}=require("@web/views/fields/field");const{FieldContentOverlay}=require("@web_studio/client_action/view_editor/editors/components/field_content_overlay");const{useStudioRef,studioIsVisible}=require("@web_studio/client_action/view_editor/editors/utils");const{useState}=require("@odoo/owl");const FieldStudio=__exports.FieldStudio=class FieldStudio extends Field{setup(){super.setup();this.state=useState({displayOverlay:false,});useStudioRef("rootRef",this.onClick);}
get fieldComponentProps(){const fieldComponentProps=super.fieldComponentProps;delete fieldComponentProps.studioXpath;delete fieldComponentProps.hasEmptyPlaceholder;delete fieldComponentProps.hasLabel;delete fieldComponentProps.studioIsVisible;return fieldComponentProps;}
get classNames(){const classNames=super.classNames;classNames["o_web_studio_show_invisible"]=!studioIsVisible(this.props);classNames["o-web-studio-editor--element-clickable"]=!!this.props.studioXpath;if(this.studioIsEmpty()){delete classNames["o_field_empty"];classNames["o_web_studio_widget_empty"]=true;}
return classNames;}
studioIsEmpty(){const{name,record,hasLabel}=this.props;if(hasLabel){return false;}
return"isEmpty"in this.field?this.field.isEmpty(record,name):!record.data[name];}
getEmptyPlaceholder(){const{hasEmptyPlaceholder,name,record}=this.props;if(!hasEmptyPlaceholder){return false;}
return this.studioIsEmpty()&&record.activeFields[name].string;}
isX2ManyEditable(props){const{name,record}=props;const field=record.fields[name];if(!["one2many","many2many"].includes(field.type)){return false;}
return!!this.props.fieldInfo.field.useSubView;}
onEditViewType(viewType){const{name,record,studioXpath}=this.props;this.env.viewEditorModel.editX2ManyView({viewType,fieldName:name,record,xpath:studioXpath,fieldContext:this.fieldComponentProps.context,});}
onClick(ev){if(ev.target.classList.contains("o_web_studio_editX2Many")){return;}
ev.stopPropagation();ev.preventDefault();this.env.config.onNodeClicked(this.props.studioXpath);this.state.displayOverlay=!this.state.displayOverlay;}}
FieldStudio.components={...Field.components,FieldContentOverlay};FieldStudio.template="web_studio.Field";return __exports;});;

/* /web_studio/static/src/client_action/view_editor/editors/components/studio_hook_component.js */
odoo.define('@web_studio/client_action/view_editor/editors/components/studio_hook_component',['@odoo/owl'],function(require){'use strict';let __exports={};const{Component,xml}=require("@odoo/owl");const formGrid=xml`
    <div class="o_web_studio_hook"
        t-attf-class="g-col-sm-{{ props.colSpan }}"
        t-att-data-xpath="props.xpath"
        t-att-data-position="props.position"
        t-att-data-type="props.type">
            <span class="o_web_studio_hook_separator" />
    </div>
`;const kanbanRecord=xml`
    <span class="o_web_studio_hook"
        t-att-data-xpath="props.xpath"
        t-att-data-position="props.position"
        t-att-data-type="props.type" />
`;const defaultTemplate=xml`
<div class="o_web_studio_hook" t-att-data-xpath="props.xpath" t-att-data-position="props.position" t-att-data-type="props.type" t-att-data-infos="props.infos">
    <span class="o_web_studio_hook_separator" />
</div>
`;const StudioHook=__exports.StudioHook=class StudioHook extends Component{getTemplate(templateName){return this.constructor.subTemplates[templateName||"defaultTemplate"];}}
StudioHook.template=xml`<t t-call="{{ getTemplate(props.subTemplate) }}" />`;StudioHook.props=["xpath?","position?","type?","colSpan?","subTemplate?","width?","infos?"];StudioHook.subTemplates={formGrid,defaultTemplate,kanbanRecord,};return __exports;});;

/* /web_studio/static/src/client_action/view_editor/editors/components/view_button_studio.js */
odoo.define('@web_studio/client_action/view_editor/editors/components/view_button_studio',['@web/views/view_button/view_button','@web_studio/client_action/view_editor/editors/utils','@web/core/utils/hooks'],function(require){'use strict';let __exports={};const{ViewButton}=require("@web/views/view_button/view_button");const{useStudioRef,studioIsVisible}=require("@web_studio/client_action/view_editor/editors/utils");const{useBus}=require("@web/core/utils/hooks");const ViewButtonStudio=__exports.ViewButtonStudio=class ViewButtonStudio extends ViewButton{setup(){super.setup();useStudioRef("rootRef");if(this.props.studioApproval){useBus(this.env.viewEditorModel.env.bus,"approval-update",()=>{this.approval.fetchApprovals();});}}
getClassName(){let className=super.getClassName();if(!studioIsVisible(this.props)){className+=" o_web_studio_show_invisible";}
if(this.props.studioXpath){className+=" o-web-studio-editor--element-clickable";}
return className;}
onClick(ev){if(this.props.tag==="a"){ev.preventDefault();}
if(!this.props.studioXpath){return;}
this.env.config.onNodeClicked(this.props.studioXpath);}}
ViewButtonStudio.template="web_studio.ViewButton";ViewButtonStudio.props=[...ViewButton.props,"studioIsVisible?","studioXpath?"];return __exports;});;

/* /web_studio/static/src/client_action/view_editor/editors/components/widget_studio.js */
odoo.define('@web_studio/client_action/view_editor/editors/components/widget_studio',['@web/views/widgets/widget'],function(require){'use strict';let __exports={};const{Widget}=require("@web/views/widgets/widget");const WidgetStudio=__exports.WidgetStudio=class WidgetStudio extends Widget{get widgetProps(){const widgetProps=super.widgetProps;delete widgetProps.studioXpath;delete widgetProps.hasEmptyPlaceholder;delete widgetProps.hasLabel;delete widgetProps.studioIsVisible;return widgetProps;}}
return __exports;});;

/* /web_studio/static/src/client_action/view_editor/editors/form/chatter_container.js */
odoo.define('@web_studio/client_action/view_editor/editors/form/chatter_container',['@mail/web/chatter','@odoo/owl'],function(require){'use strict';let __exports={};const{Chatter}=require("@mail/web/chatter");const{Component}=require("@odoo/owl");const ChatterContainer=__exports.ChatterContainer=class ChatterContainer extends Chatter{onClick(ev){this.env.config.onNodeClicked(this.props.studioXpath);}}
ChatterContainer.template="web_studio.ChatterContainer";ChatterContainer.props=[...Chatter.props,"studioXpath?"];const ChatterContainerHook=__exports.ChatterContainerHook=class ChatterContainerHook extends Component{onClick(){this.env.viewEditorModel.doOperation({type:"chatter",model:this.env.viewEditorModel.resModel,...this.props.chatterData,});}}
ChatterContainerHook.template="web_studio.ChatterContainerHook";ChatterContainerHook.components={Chatter};ChatterContainerHook.props={chatterData:Object,threadModel:String,};return __exports;});;

/* /web_studio/static/src/client_action/view_editor/editors/form/form_editor.js */
odoo.define('@web_studio/client_action/view_editor/editors/form/form_editor',['@web/views/form/form_view','@web_studio/client_action/view_editor/editors/form/form_editor_renderer/form_editor_renderer','@web_studio/client_action/view_editor/editors/form/form_editor_controller/form_editor_controller','@web_studio/client_action/view_editor/editors/form/form_editor_compiler','@web/core/registry','@web/core/utils/objects','@web_studio/client_action/view_editor/editors/utils','@web/views/view_compiler','@web_studio/client_action/view_editor/editors/form/form_editor_sidebar/form_editor_sidebar'],function(require){'use strict';let __exports={};const{formView}=require("@web/views/form/form_view");const{FormEditorRenderer}=require("@web_studio/client_action/view_editor/editors/form/form_editor_renderer/form_editor_renderer");const{FormEditorController}=require("@web_studio/client_action/view_editor/editors/form/form_editor_controller/form_editor_controller");const{FormEditorCompiler}=require("@web_studio/client_action/view_editor/editors/form/form_editor_compiler");const{registry}=require("@web/core/registry");const{omit}=require("@web/core/utils/objects");const{makeModelErrorResilient}=require("@web_studio/client_action/view_editor/editors/utils");const{getModifier}=require("@web/views/view_compiler");const{FormEditorSidebar}=require("@web_studio/client_action/view_editor/editors/form/form_editor_sidebar/form_editor_sidebar");const{getStudioNoFetchFields}=require("@web_studio/client_action/view_editor/editors/utils");class EditorArchParser extends formView.ArchParser{parse(arch,models,modelName){const parsed=super.parse(...arguments);const noFetch=getStudioNoFetchFields(parsed.fieldNodes);parsed.fieldNodes=omit(parsed.fieldNodes,...noFetch.fieldNodes);parsed.activeFields=omit(parsed.activeFields,...noFetch.fieldNames);return parsed;}
parseXML(){const result=super.parseXML(...arguments);const copy=result.cloneNode(true);Array.from(copy.querySelectorAll("field > tree, field > form, field > kanban")).forEach((el)=>{if(getModifier(el,"invisible")){el.remove();}});return copy;}}
class Model extends formView.Model{}
Model.Record=class RecordNoEdit extends formView.Model.Record{get isInEdition(){return false;}};const formEditor={...formView,ArchParser:EditorArchParser,Compiler:FormEditorCompiler,Renderer:FormEditorRenderer,Controller:FormEditorController,props(genericProps,editor,config){const props=formView.props(genericProps,editor,config);props.Model=makeModelErrorResilient(Model);props.preventEdit=true;return props;},Sidebar:FormEditorSidebar,};registry.category("studio_editors").add("form",formEditor);const HOOK_CLASS_WHITELIST=["o_web_studio_field_signature","o_web_studio_field_html","o_web_studio_field_many2many","o_web_studio_field_one2many","o_web_studio_field_tabs","o_web_studio_field_columns","o_web_studio_field_lines",];const HOOK_TYPE_BLACKLIST=["genericTag","afterGroup","afterNotebook","insideSheet"];const isBlackListedHook=(draggedEl,hookEl)=>!HOOK_CLASS_WHITELIST.some((cls)=>draggedEl.classList.contains(cls))&&HOOK_TYPE_BLACKLIST.some((t)=>hookEl.dataset.type===t);function canDropNotebook(hookEl){if(hookEl.dataset.type==="page"){return false;}
if(hookEl.closest(".o_group")||hookEl.closest(".o_inner_group")){return false;}
return true;}
function canDropGroup(hookEl){if(hookEl.dataset.type==="insideGroup"){return false;}
if(hookEl.closest(".o_group")||hookEl.closest(".o_inner_group")){return false;}
return true;}
function isValidFormHook({hook,element}){const draggingStructure=element.dataset.structure;switch(draggingStructure){case"notebook":{if(!canDropNotebook(hook)){return false;}
break;}
case"group":{if(!canDropGroup(hook)){return false;}
break;}}
if(isBlackListedHook(element,hook)){return false;}
return true;}
formEditor.isValidHook=isValidFormHook;return __exports;});;

/* /web_studio/static/src/client_action/view_editor/editors/form/form_editor_compiler.js */
odoo.define('@web_studio/client_action/view_editor/editors/form/form_editor_compiler',['@web/views/view_compiler','@web_studio/client_action/view_editor/editors/xml_utils','@web/core/utils/xml','@web/views/form/form_view','@web/views/form/form_compiler'],function(require){'use strict';let __exports={};const{isComponentNode}=require("@web/views/view_compiler");const{computeXpath,applyInvisible,}=require("@web_studio/client_action/view_editor/editors/xml_utils");const{createElement}=require("@web/core/utils/xml");const{formView}=require("@web/views/form/form_view");const{objectToString}=require("@web/views/form/form_compiler");const interestingSelector=[":not(field) sheet",":not(field) field",":not(field) notebook",":not(field) page",":not(field) button",":not(field) label",":not(field) group",":not(field) group group > *",":not(field) div.oe_chatter",":not(field) .oe_avatar",].join(", ");const FormEditorCompiler=__exports.FormEditorCompiler=class FormEditorCompiler extends formView.Compiler{compile(key,params={}){params.enableInvisible=true;const xml=this.templates[key];for(const el of xml.querySelectorAll(interestingSelector)){const xpath=computeXpath(el);el.setAttribute("studioXpath",xpath);}
this.addChatter=true;this.chatterData={remove_message_ids:false,remove_follower_ids:false,remove_activity_ids:false,};this.avatars=[];const compiled=super.compile(key,params);const sheetBg=compiled.querySelector(".o_form_sheet_bg");if(sheetBg){const studioHook=createElement("StudioHook",{xpath:`"${sheetBg.getAttribute("studioXpath")}"`,position:"'inside'",type:"'insideSheet'",});sheetBg.querySelector(".o_form_sheet").prepend(studioHook);}
if(this.addChatter){const chatterContainerHook=createElement("ChatterContainerHook",{threadModel:`__comp__.props.record.resModel`,chatterData:objectToString(this.chatterData),});const el=compiled.querySelector(".o_form_sheet")||compiled;el.after(chatterContainerHook);}else{const parent=compiled.querySelector(".o-mail-Form-chatter");parent.removeAttribute("t-attf-class");parent.removeAttribute("t-if");}
const fieldStatus=compiled.querySelector(`Field[type="'statusbar'"]`);if(!fieldStatus){const addStatusBar=!compiled.querySelector(".o_form_statusbar");const statusBarFieldHook=createElement("StatusBarFieldHook",{addStatusBar});const el=compiled.querySelector(".o_form_sheet_bg")||compiled;el.prepend(statusBarFieldHook);}
const buttonBoxXml=xml.querySelector("div[name='button_box']:not(field div)");let buttonBox;const buttonBoxContainer=createElement("div",{class:"d-flex justify-content-end my-2",});if(buttonBoxXml){buttonBox=this.compileNode(buttonBoxXml,params);}else{buttonBox=createElement("ButtonBox");}
buttonBoxContainer.append(buttonBox);const el=compiled.querySelector(".o_form_sheet_bg")||compiled;el.prepend(buttonBoxContainer);const buttonHook=createElement("t",[createElement("ButtonHook",{add_buttonbox:!buttonBoxXml})],{"t-set-slot":`slot_button_hook`});buttonBox.insertAdjacentElement("afterbegin",buttonHook);const title=compiled.querySelector(".oe_title");if(title){if(!title.querySelector(":scope > h1 > [isAvatar]")&&!title.parentElement.querySelector(":scope > [isAvatar]")){const avatarHook=createElement("AvatarHook",{fields:`__comp__.props.record.fields`,});avatarHook.setAttribute("class",`'oe_avatar d-flex align-items-center justify-content-center ms-3 o_web_studio_avatar h4'`);title.before(avatarHook);}}
for(const el of this.avatars){el.removeAttribute("isAvatar");}
compiled.querySelectorAll(":not(.o_form_statusbar) Field").forEach((el)=>{el.setAttribute("hasEmptyPlaceholder","true");});compiled.querySelectorAll(`InnerGroup > t[t-set-slot][subType="'item_component'"] Field`).forEach((el)=>{el.setAttribute("hasLabel","true");});return compiled;}
applyInvisible(invisible,compiled,params){return applyInvisible(invisible,compiled,params);}
createLabelFromField(fieldId,fieldName,fieldString,label,params){const studioXpath=label.getAttribute("studioXpath");const formLabel=super.createLabelFromField(...arguments);formLabel.setAttribute("studioXpath",`"${studioXpath}"`);if(formLabel.hasAttribute("t-if")){formLabel.setAttribute("studioIsVisible",formLabel.getAttribute("t-if"));formLabel.removeAttribute("t-if");}
return formLabel;}
compileNode(node,params={},evalInvisible=true){const nodeType=node.nodeType;const currentSlot=params.currentSlot;if(nodeType===1&&currentSlot&&!currentSlot.hasAttribute("studioXpath")){const parentElement=node.parentElement;if(parentElement&&parentElement.tagName==="page"){const xpath=computeXpath(node.parentElement);currentSlot.setAttribute("studioXpath",`"${xpath}"`);if(!parentElement.querySelector(":scope > group:last-child > group")){const pageHookProps={position:"'inside'",type:"'page'",xpath:`"${xpath}"`,};currentSlot.setAttribute("studioHookProps",objectToString(pageHookProps));}}else{const xpath=node.getAttribute("studioXpath");currentSlot.setAttribute("studioXpath",`"${xpath}"`);}}
if(nodeType===1&&node.getAttribute("studio_no_fetch")){return;}
const compiled=super.compileNode(node,params,true);if(nodeType===1){if(node.hasAttribute("studioXpath")){const xpath=node.getAttribute("studioXpath");if(isComponentNode(compiled)){compiled.setAttribute("studioXpath",`"${xpath}"`);}else if(!compiled.hasAttribute("studioXpath")){compiled.setAttribute("studioXpath",xpath);}}
if(node.tagName==="notebook"){const originalChildren=Array.from(node.children).filter((e)=>e.tagName==="page");Array.from(compiled.children).forEach((elem,index)=>{if(!elem.hasAttribute("studioXpath")){const studioXpath=originalChildren[index].getAttribute("studioXpath");elem.setAttribute("studioXpath",`"${studioXpath}"`);const pageHookProps={position:"'inside'",type:"'page'",xpath:`"${studioXpath}"`,};elem.setAttribute("studioHookProps",objectToString(pageHookProps));}});}
if(node.classList.contains("oe_chatter")){this.addChatter=false;const chatterNode=compiled.querySelector("t[t-component='__comp__.mailComponents.Chatter']");const xpath=node.getAttribute("studioXpath");chatterNode.setAttribute("studioXpath",`"${xpath}"`);compiled.setAttribute("data-studio-xpath",xpath);compiled.classList.add("o-web-studio-editor--element-clickable");}
if(node.classList.contains("oe_avatar")){compiled.setAttribute("isAvatar",true);this.avatars.push(compiled);}
const name=node.getAttribute("name");if(name==="message_ids"){this.chatterData.remove_message_ids=true;}else if(name==="message_follower_ids"){this.chatterData.remove_follower_ids=true;}else if(name==="activity_ids"){this.chatterData.remove_activity_ids=true;}}
return compiled;}
isAlwaysInvisible(){return false;}}
return __exports;});;

/* /web_studio/static/src/client_action/view_editor/editors/form/form_editor_controller/form_editor_controller.js */
odoo.define('@web_studio/client_action/view_editor/editors/form/form_editor_controller/form_editor_controller',['@web/views/form/form_view'],function(require){'use strict';let __exports={};const{formView}=require("@web/views/form/form_view");function rebindLegacyDatapoint(datapoint,basicModel,evalContext){const newDp={};const descrs=Object.getOwnPropertyDescriptors(datapoint);Object.defineProperties(newDp,descrs);const getRecordEvalContext=basicModel._getRecordEvalContext.bind(basicModel);basicModel._getRecordEvalContext=(record,forDomain)=>{if(record.id==="__can'ttouchthis__"){return evalContext;}
return getRecordEvalContext(record,forDomain);};newDp.id="__can'ttouchthis__";newDp.evalModifiers=basicModel._evalModifiers.bind(basicModel,newDp);newDp.getContext=basicModel._getContext.bind(basicModel,newDp);newDp.getDomain=basicModel._getDomain.bind(basicModel,newDp);newDp.getFieldNames=basicModel._getFieldNames.bind(basicModel,newDp);newDp.isDirty=basicModel.isDirty.bind(basicModel,newDp.id);newDp.isNew=basicModel.isNew.bind(basicModel,newDp.id);return newDp;}
function applyParentRecordOnModel(model,parentRecord){const legacyHandle=parentRecord.__bm_handle__;const legacyDp=parentRecord.model.__bm__.localData[legacyHandle];const evalContext=parentRecord.model.__bm__._getRecordEvalContext(legacyDp);const load=model.load;model.load=async(...args)=>{const res=await load.call(model,...args);const localData=model.__bm__.localData;const parentDp=rebindLegacyDatapoint(legacyDp,model.__bm__,evalContext);localData[parentDp.id]=parentDp;const rootDp=localData[model.root.__bm_handle__];rootDp.parentID=parentDp.id;return res;};}
const FormEditorController=__exports.FormEditorController=class FormEditorController extends formView.Controller{setup(){super.setup();this.mailTemplate=null;this.hasAttachmentViewerInArch=false;if(this.props.parentRecord){applyParentRecordOnModel(this.model,this.props.parentRecord);}}}
FormEditorController.props={...formView.Controller.props,parentRecord:{type:[Object,{value:null}],optional:true},};return __exports;});;

/* /web_studio/static/src/client_action/view_editor/editors/form/form_editor_renderer/form_editor_groups.js */
odoo.define('@web_studio/client_action/view_editor/editors/form/form_editor_renderer/form_editor_groups',['@web/views/form/form_view','@web_studio/client_action/view_editor/editors/utils','@web_studio/client_action/view_editor/editors/components/studio_hook_component','@odoo/owl'],function(require){'use strict';let __exports={};const{formView}=require("@web/views/form/form_view");const{studioIsVisible}=require("@web_studio/client_action/view_editor/editors/utils");const{StudioHook}=require("@web_studio/client_action/view_editor/editors/components/studio_hook_component");const{Component,useEffect,useRef,useState}=require("@odoo/owl");const components=formView.Renderer.components;function extendGroup(GroupClass){class Group extends GroupClass{setup(){super.setup();this.viewEditorModel=useState(this.env.viewEditorModel);this.rootRef=useRef("rootRef");}
get allClasses(){let classes=super.allClasses;if(!studioIsVisible(this.props)){classes=`${classes || ""} o_web_studio_show_invisible`;}
if(this.props.studioXpath){classes=`${classes || ""} o-web-studio-editor--element-clickable`;}
return classes;}
_getItems(){const items=super._getItems();return items.map(([k,v])=>{v=Object.assign({},v);v.studioIsVisible=v.isVisible;v.isVisible=v.isVisible||this.viewEditorModel.showInvisible;if(v.subType==="item_component"){v.props.studioIsVisible=v.studioIsVisible;v.props.studioXpath=v.studioXpath;}
return[k,v];});}
onGroupClicked(ev){if(ev.target.closest(".o-web-studio-editor--element-clickable")!==this.rootRef.el){return;}
this.env.config.onNodeClicked(this.props.studioXpath);}}
Group.props=[...GroupClass.props,"studioXpath?","studioIsVisible?"];Group.components={...GroupClass.components,StudioHook};return Group;}
class InnerGroupItemComponent extends Component{static props={cell:{type:Object},slots:{type:Object},};setup(){const labelRef=useRef("labelRef");const fieldRef=useRef("fieldRef");this.labelRef=labelRef;useEffect((studioIsVisible,labelEl,fieldEl)=>{if(labelEl){const clickable=labelEl.querySelector(".o-web-studio-editor--element-clickable");if(clickable){clickable.classList.remove("o-web-studio-editor--element-clickable");}
labelEl.classList.add("o-web-studio-editor--element-clickable");const invisible=labelEl.querySelector(".o_web_studio_show_invisible");if(invisible){invisible.classList.remove("o_web_studio_show_invisible");}
labelEl.classList.toggle("o_web_studio_show_invisible",!studioIsVisible);labelEl.classList.add("o-draggable");}
if(fieldEl){const clickable=fieldEl.querySelector(".o-web-studio-editor--element-clickable");if(clickable){clickable.classList.remove("o-web-studio-editor--element-clickable");}
const invisible=fieldEl.querySelector(".o_web_studio_show_invisible");if(invisible){invisible.classList.remove("o_web_studio_show_invisible");}
fieldEl.classList.add("o-web-studio-element-ghost");}},()=>[this.cell.studioIsVisible,labelRef.el,fieldRef.el]);this.onMouseFieldIO=(ev)=>{labelRef.el.classList.toggle("o-web-studio-ghost-hovered",ev.type==="mouseover");};}
get cell(){return this.props.cell;}
onClicked(ev){if(ev.target.closest(".o-web-studio-element-ghost")){ev.stopPropagation();}
this.env.config.onNodeClicked(this.cell.studioXpath);}}
InnerGroupItemComponent.template="web_studio.Form.InnerGroup.ItemComponent";const _InnerGroup=extendGroup(components.InnerGroup);const InnerGroup=__exports.InnerGroup=class InnerGroup extends _InnerGroup{getRows(){const rows=super.getRows();if(!this.viewEditorModel.showInvisible){rows.forEach((row)=>{row.isVisible=row.some((cell)=>cell.studioIsVisible);});}
return rows;}
getStudioHooks(){const hooks=new Map();const rows=this.getRows();const hasRows=rows.length>=1&&rows[0].length;if(!hasRows){hooks.set("inside",{xpath:this.props.studioXpath,position:"inside",subTemplate:"formGrid",colSpan:this.props.maxCols,});}
for(const rowIdx in rows){const row=rows[rowIdx];const colSpan=row.reduce((acc,val)=>acc+val.itemSpan||1,0);if(!hooks.has("beforeFirst")){const cell=row[0];if(cell){hooks.set("beforeFirst",{xpath:cell.studioXpath,position:"before",subTemplate:"formGrid",width:cell.width,colSpan,});}}
if(row.every((cell)=>!cell.studioIsVisible)&&!this.viewEditorModel.showInvisible){continue;}
const cell=row[row.length-1];if(cell){hooks.set(`afterRow ${rowIdx}`,{xpath:cell.studioXpath,position:"after",subTemplate:"formGrid",width:cell.width,colSpan,});}}
return hooks;}}
InnerGroup.components.InnerGroupItemComponent=InnerGroupItemComponent;InnerGroup.template="web_studio.Form.InnerGroup";const OuterGroup=__exports.OuterGroup=extendGroup(components.OuterGroup);OuterGroup.template="web_studio.Form.OuterGroup";return __exports;});;

/* /web_studio/static/src/client_action/view_editor/editors/form/form_editor_renderer/form_editor_renderer.js */
odoo.define('@web_studio/client_action/view_editor/editors/form/form_editor_renderer/form_editor_renderer',['@odoo/owl','@web/views/form/form_view','@web_studio/client_action/view_editor/editors/form/form_editor_renderer/form_editor_renderer_components','@web_studio/client_action/view_editor/editors/form/chatter_container','@web_studio/client_action/view_editor/editors/components/studio_hook_component','@web_studio/client_action/view_editor/editors/components/field_studio','@web_studio/client_action/view_editor/editors/components/widget_studio','@web_studio/client_action/view_editor/editors/components/view_button_studio','@web_studio/client_action/view_editor/editors/form/form_editor_renderer/form_editor_groups'],function(require){'use strict';let __exports={};const{useRef,useEffect,useState}=require("@odoo/owl");const{formView}=require("@web/views/form/form_view");const formEditorRendererComponents=require("@web_studio/client_action/view_editor/editors/form/form_editor_renderer/form_editor_renderer_components");const{ChatterContainer,ChatterContainerHook}=require("@web_studio/client_action/view_editor/editors/form/chatter_container");const{StudioHook}=require("@web_studio/client_action/view_editor/editors/components/studio_hook_component");const{FieldStudio}=require("@web_studio/client_action/view_editor/editors/components/field_studio");const{WidgetStudio}=require("@web_studio/client_action/view_editor/editors/components/widget_studio");const{ViewButtonStudio}=require("@web_studio/client_action/view_editor/editors/components/view_button_studio");const{InnerGroup,OuterGroup}=require("@web_studio/client_action/view_editor/editors/form/form_editor_renderer/form_editor_groups");const components=formView.Renderer.components;const FormEditorRenderer=__exports.FormEditorRenderer=class FormEditorRenderer extends formView.Renderer{setup(){super.setup();const rootRef=useRef("compiled_view_root");this.rootRef=rootRef;const viewEditorModel=this.env.viewEditorModel;this.viewEditorModel=useState(viewEditorModel);this.mailComponents.Chatter=ChatterContainer;useEffect((rootEl,showInvisible)=>{if(!rootEl){return;}
rootEl.classList.add("o_web_studio_form_view_editor");if(showInvisible){rootEl.querySelectorAll(":not(.o-mail-Form-chatter) .o_invisible_modifier").forEach((el)=>{el.classList.add("o_web_studio_show_invisible");el.classList.remove("o_invisible_modifier");});}else{rootEl.querySelectorAll(":not(.o-mail-Form-chatter) .o_web_studio_show_invisible").forEach((el)=>{el.classList.remove("o_web_studio_show_invisible");el.classList.add("o_invisible_modifier");});}},()=>[rootRef.el,viewEditorModel.showInvisible]);useEffect((rootEl)=>{if(rootEl){const optCols=rootEl.querySelectorAll("i.o_optional_columns_dropdown_toggle");for(const col of optCols){col.classList.add("text-muted");}}},()=>[rootRef.el]);}}
class Setting extends formView.Renderer.components.Setting{static props={...formView.Renderer.components.Setting.props,studioXpath:{type:String,optional:true},studioIsVisible:{type:Boolean,optional:true},};}
FormEditorRenderer.components={...components,...formEditorRendererComponents,Field:FieldStudio,Widget:WidgetStudio,ViewButton:ViewButtonStudio,ChatterContainerHook,InnerGroup,OuterGroup,StudioHook,Setting,};return __exports;});;

/* /web_studio/static/src/client_action/view_editor/editors/form/form_editor_renderer/form_editor_renderer_components.js */
odoo.define('@web_studio/client_action/view_editor/editors/form/form_editor_renderer/form_editor_renderer_components',['@web/views/form/form_view','@web_studio/client_action/view_editor/editors/components/studio_hook_component','@web_studio/client_action/view_editor/editors/form/form_editor_sidebar/properties/button_properties/new_button_box_dialog','@web_studio/client_action/view_editor/editors/components/field_selector_dialog','@web_studio/client_action/view_editor/interactive_editor/field_configuration/selection_content_dialog','@web_studio/client_action/view_editor/editors/utils','@web/core/l10n/translation','@web/core/utils/hooks','@odoo/owl'],function(require){'use strict';let __exports={};const{formView}=require("@web/views/form/form_view");const{StudioHook}=require("@web_studio/client_action/view_editor/editors/components/studio_hook_component");const{NewButtonBoxDialog}=require("@web_studio/client_action/view_editor/editors/form/form_editor_sidebar/properties/button_properties/new_button_box_dialog");const{FieldSelectorDialog}=require("@web_studio/client_action/view_editor/editors/components/field_selector_dialog");const{SelectionContentDialog}=require("@web_studio/client_action/view_editor/interactive_editor/field_configuration/selection_content_dialog");const{randomName,studioIsVisible,useStudioRef,}=require("@web_studio/client_action/view_editor/editors/utils");const{_t}=require("@web/core/l10n/translation");const{useOwnedDialogs}=require("@web/core/utils/hooks");const{Component,useState}=require("@odoo/owl");const components=formView.Renderer.components;const FormLabel=__exports.FormLabel=class FormLabel extends components.FormLabel{static template="web_studio.FormLabel";static props={...components.FormLabel.props,studioXpath:String,studioIsVisible:{type:Boolean,optional:true},};setup(){super.setup();useStudioRef("rootRef",this.onClick);}
get className(){let className=super.className;if(!studioIsVisible(this.props)){className+=" o_web_studio_show_invisible";}
className+=" o-web-studio-editor--element-clickable";return className;}
onClick(ev){ev.preventDefault();ev.stopPropagation();this.env.config.onNodeClicked(this.props.studioXpath);}}
const Notebook=__exports.Notebook=class Notebook extends components.Notebook{static template="web_studio.Notebook.Hook";static components={...components.Notebook.components,StudioHook};static props={...components.Notebook.props,studioIsVisible:{type:Boolean,optional:true},studioXpath:String,};setup(){this.viewEditorModel=useState(this.env.viewEditorModel);super.setup();}
computePages(props){const pages=super.computePages(props);pages.forEach((p)=>{p[1].studioIsVisible=p[1].isVisible;p[1].isVisible=p[1].isVisible||this.viewEditorModel.showInvisible;});return pages;}
onNewPageClicked(){const vem=this.viewEditorModel;const node={tag:"page",attrs:{string:_t("New Page"),name:randomName("studio_page"),},};vem.doOperation({type:"add",node,target:vem.getFullTarget(this.props.studioXpath),position:"inside",});}}
const StatusBarFieldHook=__exports.StatusBarFieldHook=class StatusBarFieldHook extends Component{static template="web_studio.StatusBarFieldHook";static props={addStatusBar:{type:Boolean},};setup(){this.addDialog=useOwnedDialogs();}
onClick(){this.addDialog(SelectionContentDialog,{defaultChoices:[["status1",_t("First Status")],["status2",_t("Second Status")],["status3",_t("Third Status")],],onConfirm:(choices)=>{const viewEditorModel=this.env.viewEditorModel;if(this.props.addStatusBar){viewEditorModel.pushOperation({type:"statusbar"});}
const target={tag:"header",};const subViewXpath=viewEditorModel.getSubviewXpath();if(subViewXpath){target.subview_xpath=subViewXpath;}
viewEditorModel.doOperation({type:"add",target,position:"inside",node:{attrs:{widget:"statusbar",options:"{'clickable': '1'}",},field_description:{default_value:true,field_description:_t("Pipeline status bar"),model_name:viewEditorModel.resModel,name:randomName(`x_studio_selection_field`),selection:JSON.stringify(choices),type:"selection",},tag:"field",},});},});}}
const AvatarHook=__exports.AvatarHook=class AvatarHook extends Component{static template="web_studio.AvatarHook";static props={fields:Object,class:{type:String,optional:true}};setup(){this.addDialog=useOwnedDialogs();}
onClick(){const fields=[];for(const field of Object.values(this.props.fields)){if(field.type==="binary"){fields.push(field);}}
this.addDialog(FieldSelectorDialog,{fields,showNew:true,onConfirm:(field)=>{this.env.viewEditorModel.doOperation({type:"avatar_image",field,});},});}}
const ButtonHook=__exports.ButtonHook=class ButtonHook extends Component{static template="web_studio.ButtonHook";static props={add_buttonbox:{type:Boolean,optional:true},studioIsVisible:{type:Boolean,optional:true},};setup(){this.addDialog=useOwnedDialogs();}
onClick(){this.addDialog(NewButtonBoxDialog,{model:this.env.viewEditorModel,isAddingButtonBox:Boolean(this.props.add_buttonbox),});}}
const ButtonBox=__exports.ButtonBox=class ButtonBox extends components.ButtonBox{static props={...components.ButtonBox.props,studioIsVisible:{type:Boolean,optional:true},};getButtons(){const maxVisibleButtons=this.getMaxButtons();const visible=[];const additional=[];for(const[slotName,slot]of Object.entries(this.props.slots)){if(this.env.viewEditorModel.showInvisible||!("isVisible"in slot)||slot.isVisible){if(visible.length>=maxVisibleButtons){additional.push(slotName);}else{visible.push(slotName);}}}
return{visible,additional};}}
return __exports;});;

/* /web_studio/static/src/client_action/view_editor/editors/form/form_editor_sidebar/form_editor_sidebar.js */
odoo.define('@web_studio/client_action/view_editor/editors/form/form_editor_sidebar/form_editor_sidebar',['@odoo/owl','@web/core/utils/hooks','@web_studio/client_action/view_editor/interactive_editor/interactive_editor_sidebar','@web_studio/client_action/view_editor/view_structures/view_structures','@web_studio/client_action/view_editor/property/property','@web_studio/client_action/view_editor/interactive_editor/properties/properties','@web_studio/client_action/view_editor/editors/form/form_editor_sidebar/properties/button_properties/button_properties','@web_studio/client_action/view_editor/interactive_editor/properties/field_properties/field_properties','@web_studio/client_action/view_editor/editors/form/form_editor_sidebar/properties/group_properties/group_properties','@web_studio/client_action/view_editor/editors/form/form_editor_sidebar/properties/label_properties/label_properties','@web_studio/client_action/view_editor/editors/form/form_editor_sidebar/properties/page_properties/page_properties','@web/core/l10n/translation','@web_studio/client_action/view_editor/interactive_editor/sidebar_view_toolbox/sidebar_view_toolbox','@web_studio/client_action/view_editor/editors/form/form_editor_sidebar/properties/chatter_properties/chatter_properties','@web_studio/client_action/view_editor/view_editor_model'],function(require){'use strict';let __exports={};const{Component,useState}=require("@odoo/owl");const{useService}=require("@web/core/utils/hooks");const{InteractiveEditorSidebar}=require("@web_studio/client_action/view_editor/interactive_editor/interactive_editor_sidebar");const{ExistingFields,NewFields,}=require("@web_studio/client_action/view_editor/view_structures/view_structures");const{Property}=require("@web_studio/client_action/view_editor/property/property");const{Properties}=require("@web_studio/client_action/view_editor/interactive_editor/properties/properties");const{ButtonProperties}=require("@web_studio/client_action/view_editor/editors/form/form_editor_sidebar/properties/button_properties/button_properties");const{FieldProperties}=require("@web_studio/client_action/view_editor/interactive_editor/properties/field_properties/field_properties");const{GroupProperties}=require("@web_studio/client_action/view_editor/editors/form/form_editor_sidebar/properties/group_properties/group_properties");const{LabelProperties}=require("@web_studio/client_action/view_editor/editors/form/form_editor_sidebar/properties/label_properties/label_properties");const{PageProperties}=require("@web_studio/client_action/view_editor/editors/form/form_editor_sidebar/properties/page_properties/page_properties");const{_t}=require("@web/core/l10n/translation");const{SidebarViewToolbox}=require("@web_studio/client_action/view_editor/interactive_editor/sidebar_view_toolbox/sidebar_view_toolbox");const{ChatterProperties}=require("@web_studio/client_action/view_editor/editors/form/form_editor_sidebar/properties/chatter_properties/chatter_properties");const{useEditNodeAttributes}=require("@web_studio/client_action/view_editor/view_editor_model");class FormComponents extends Component{static template="web_studio.FormEditor.Sidebar.Components";static props={};get structures(){return{notebook:{name:_t("Tabs"),class:"o_web_studio_field_tabs",},group:{name:_t("Columns"),class:"o_web_studio_field_columns",},};}}
const FormEditorSidebar=__exports.FormEditorSidebar=class FormEditorSidebar extends Component{static template="web_studio.ViewEditor.FormEditorSidebar";static props={openViewInForm:{type:Function,optional:true},openDefaultValues:{type:Function,optional:true},};static components={InteractiveEditorSidebar,FormComponents,NewFields,ExistingFields,Property,Properties,SidebarViewToolbox,};setup(){this.rpc=useService("rpc");this.dialog=useService("dialog");this.viewEditorModel=useState(this.env.viewEditorModel);this.editArchAttributes=useEditNodeAttributes({isRoot:true});this.propertiesComponents={button:{component:ButtonProperties,},field:{component:FieldProperties,props:{availableOptions:["invisible","required","readonly","string","help"],},},group:{component:GroupProperties,},label:{component:LabelProperties,},page:{component:PageProperties,},div:{component:ChatterProperties,},};}
get activeActions(){return this.viewEditorModel.controllerProps.archInfo.activeActions;}
getActiveAction(name){return this.activeActions[name]===true;}
onAttributeChanged(value,name){return this.editArchAttributes({[name]:value});}}
return __exports;});;

/* /web_studio/static/src/client_action/view_editor/editors/form/form_editor_sidebar/properties/button_properties/button_properties.js */
odoo.define('@web_studio/client_action/view_editor/editors/form/form_editor_sidebar/properties/button_properties/button_properties',['@odoo/owl','@web/core/checkbox/checkbox','@web/core/domain_selector_dialog/domain_selector_dialog','@web/views/fields/relational_utils','@web/core/select_menu/select_menu','@web_studio/client_action/view_editor/property/property','@web/core/utils/hooks','@web_studio/client_action/view_editor/interactive_editor/properties/limit_group_visibility/limit_group_visibility','@web_studio/client_action/view_editor/editors/form/form_editor_sidebar/properties/button_properties/rainbow_effect','@web_studio/client_action/view_editor/interactive_editor/properties/sidebar_properties_toolbox/sidebar_properties_toolbox','@web_studio/client_action/view_editor/view_editor_model','@web_studio/client_action/view_editor/view_editor_hook'],function(require){'use strict';let __exports={};const{Component,onWillStart,onWillUpdateProps,useState}=require("@odoo/owl");const{CheckBox}=require("@web/core/checkbox/checkbox");const{DomainSelectorDialog}=require("@web/core/domain_selector_dialog/domain_selector_dialog");const{Many2XAutocomplete}=require("@web/views/fields/relational_utils");const{SelectMenu}=require("@web/core/select_menu/select_menu");const{Property}=require("@web_studio/client_action/view_editor/property/property");const{useService}=require("@web/core/utils/hooks");const{LimitGroupVisibility}=require("@web_studio/client_action/view_editor/interactive_editor/properties/limit_group_visibility/limit_group_visibility");const{RainbowEffect}=require("@web_studio/client_action/view_editor/editors/form/form_editor_sidebar/properties/button_properties/rainbow_effect");const{SidebarPropertiesToolbox}=require("@web_studio/client_action/view_editor/interactive_editor/properties/sidebar_properties_toolbox/sidebar_properties_toolbox");const{useEditNodeAttributes}=require("@web_studio/client_action/view_editor/view_editor_model");const{useSnackbarWrapper}=require("@web_studio/client_action/view_editor/view_editor_hook");const ButtonProperties=__exports.ButtonProperties=class ButtonProperties extends Component{static template="web_studio.ViewEditor.InteractiveEditorProperties.Button";static props={node:{type:Object},};static components={CheckBox,LimitGroupVisibility,Many2XAutocomplete,RainbowEffect,SelectMenu,Property,SidebarPropertiesToolbox,};setup(){this.dialog=useService("dialog");this.orm=useService("orm");this.rpc=useService("rpc");this.state=useState({});this.editNodeAttributes=useEditNodeAttributes();this.decoratedOrmCall=useSnackbarWrapper(this.orm.call.bind(this.orm));this.decoratedOrmWrite=useSnackbarWrapper(this.orm.write.bind(this.orm));onWillStart(()=>{if(this.props.node.attrs.studio_approval){this.updateApprovalSpec();}});onWillUpdateProps((nextProps)=>{if(nextProps.node.attrs.studio_approval){this.updateApprovalSpec(this.getApprovalParams(nextProps.node));}else{delete this.state.approvalSpec;}});}
onChangeAttribute(value,name){return this.editNodeAttributes({[name]:value});}
onEnableApproval(enable){this.env.viewEditorModel.doOperation({enable,type:"enable_approval",btn_name:this.props.node.attrs.name,btn_type:this.props.node.attrs.type,model:this.env.viewEditorModel.controllerProps.resModel,view_id:this.env.viewEditorModel.view.id,});}
get showRainbowMan(){const attrs=this.props.node.attrs;return attrs.class!=="oe_stat_button"&&attrs.type==="object";}
get isApprovalEnabled(){return this.props.node.attrs.studio_approval==="True";}
async createApprovalRule(){const params=this.getApprovalParams();await this.decoratedOrmCall("studio.approval.rule","create_rule",params);this.updateApprovalSpec();}
getApprovalParams(node=this.props.node){let method,action=false;if(node.attrs.type==="object"){method=node.attrs.name;}else{action=node.attrs.name;}
return[this.env.viewEditorModel.resModel,method,action];}
async getApprovalSpec(approvalParams){return await this.orm.call("studio.approval.rule","get_approval_spec",approvalParams);}
async onApprovalArchive(id){await this.decoratedOrmWrite("studio.approval.rule",[id],{active:false,});this.updateApprovalSpec();}
async onApprovalEdit(name,id,value){const isMethod=this.props.node.attrs.type==="object";await this.rpc("/web_studio/edit_approval",{model:this.env.viewEditorModel.resModel,method:isMethod?this.props.node.attrs.name:false,action:isMethod?false:this.props.node.attrs.name,operations:[[name,id,value]],});this.updateApprovalSpec();}
onApprovalSelectDomain(id){const domain=this.state.approvalSpec.rules.find((r)=>r.id===id).domain;this.dialog.add(DomainSelectorDialog,{resModel:this.env.viewEditorModel.resModel,domain:JSON.stringify(domain||[]),isDebugMode:!!this.env.debug,onConfirm:async(domain)=>{await this.decoratedOrmWrite("studio.approval.rule",[id],{domain,});this.updateApprovalSpec();},});}
async onApprovalSelectRule(ruleProperty,selection,id){if(selection&&selection.length){await this.decoratedOrmWrite("studio.approval.rule",[id],Object.fromEntries([[ruleProperty,selection[0].id]]));this.updateApprovalSpec();}}
async updateApprovalSpec(params=this.getApprovalParams()){this.state.approvalSpec=await this.getApprovalSpec(params);this.env.viewEditorModel.env.bus.trigger("approval-update");}}
return __exports;});;

/* /web_studio/static/src/client_action/view_editor/editors/form/form_editor_sidebar/properties/button_properties/new_button_box_dialog.js */
odoo.define('@web_studio/client_action/view_editor/editors/form/form_editor_sidebar/properties/button_properties/new_button_box_dialog',['@odoo/owl','@web/core/dialog/dialog','@web/views/fields/relational_utils','@web/core/l10n/translation','@web/core/utils/hooks','@web_studio/utils'],function(require){'use strict';let __exports={};const{Component,useState}=require("@odoo/owl");const{Dialog}=require("@web/core/dialog/dialog");const{Many2XAutocomplete}=require("@web/views/fields/relational_utils");const{_t}=require("@web/core/l10n/translation");const{useService}=require("@web/core/utils/hooks");const{ICONS}=require("@web_studio/utils");const NewButtonBoxDialog=__exports.NewButtonBoxDialog=class NewButtonBoxDialog extends Component{static template="web_studio.NewButtonBoxDialog";static components={Dialog,Many2XAutocomplete,};static props={isAddingButtonBox:{type:Boolean},model:{type:Object},close:{type:Function},};setup(){this.orm=useService("orm");this.notification=useService("notification");this.state=useState({icon:"fa-diamond",field:undefined,});this.text=undefined;}
get icons(){return ICONS;}
get title(){return _t("Add a Button");}
async update(selection){if(!selection[0].name){const resId=selection[0].id;const fields=["display_name"];const record=await this.orm.read("ir.model.fields",[resId],fields);selection[0].name=record[0].display_name;}
this.state.field=selection[0];}
getDomain(){return[["relation","=",this.props.model.resModel],["ttype","in",["many2one","many2many"]],["store","=",true],];}
onConfirm(){if(!this.state.field?.id){return this.notification.add(_t("Select a related field."));}
if(this.props.isAddingButtonBox){this.props.model.pushOperation({type:"buttonbox"});}
this.props.model.doOperation({type:"add",target:{tag:"div",attrs:{class:"oe_button_box",},},position:"inside",node:{tag:"button",field:this.state.field.id,string:this.text||_t("New button"),attrs:{class:"oe_stat_button",icon:this.state.icon,},},});this.props.close();}}
return __exports;});;

/* /web_studio/static/src/client_action/view_editor/editors/form/form_editor_sidebar/properties/button_properties/rainbow_effect.js */
odoo.define('@web_studio/client_action/view_editor/editors/form/form_editor_sidebar/properties/button_properties/rainbow_effect',['@odoo/owl','@web/core/file_input/file_input','@web/core/select_menu/select_menu','@web_studio/client_action/view_editor/property/property','@web/core/utils/hooks','@web/core/l10n/translation','@web/core/py_js/py'],function(require){'use strict';let __exports={};const{Component}=require("@odoo/owl");const{FileInput}=require("@web/core/file_input/file_input");const{SelectMenu}=require("@web/core/select_menu/select_menu");const{Property}=require("@web_studio/client_action/view_editor/property/property");const{useService}=require("@web/core/utils/hooks");const{_t}=require("@web/core/l10n/translation");const{evaluateExpr}=require("@web/core/py_js/py");const RainbowEffect=__exports.RainbowEffect=class RainbowEffect extends Component{static template="web_studio.ViewEditorSidebar.RainbowEffect";static props={effect:{type:true,optional:true},onChange:{type:Function},};static components={FileInput,SelectMenu,Property,};setup(){this.user=useService("user");}
get choices(){return[{label:_t("Fast"),value:"fast"},{label:_t("Medium"),value:"medium"},{label:_t("Slow"),value:"slow"},{label:_t("None"),value:"no"},];}
get rainbowEffect(){const effect=this.props.effect;if(effect===undefined){return null;}
if(effect==="True"){return{};}
return evaluateExpr(effect);}
onRainbowEffectChange(name,value){const effect=this.rainbowEffect;if(!value||!value.length){delete effect[name];}else{effect[name]=value;}
this.props.onChange(effect,"effect");}}
return __exports;});;

/* /web_studio/static/src/client_action/view_editor/editors/form/form_editor_sidebar/properties/chatter_properties/chatter_properties.js */
odoo.define('@web_studio/client_action/view_editor/editors/form/form_editor_sidebar/properties/chatter_properties/chatter_properties',['@odoo/owl','@web/core/utils/hooks','@web_studio/client_action/view_editor/property/property','@web_studio/client_action/view_editor/interactive_editor/properties/sidebar_properties_toolbox/sidebar_properties_toolbox'],function(require){'use strict';let __exports={};const{Component,useState,onWillStart,onWillUpdateProps}=require("@odoo/owl");const{useService}=require("@web/core/utils/hooks");const{Property}=require("@web_studio/client_action/view_editor/property/property");const{SidebarPropertiesToolbox}=require("@web_studio/client_action/view_editor/interactive_editor/properties/sidebar_properties_toolbox/sidebar_properties_toolbox");const ChatterProperties=__exports.ChatterProperties=class ChatterProperties extends Component{static template="web_studio.ViewEditor.InteractiveEditorProperties.Chatter";static components={Property,SidebarPropertiesToolbox};setup(){this.rpc=useService("rpc");this.state=useState({});onWillStart(async()=>{const alias=await this.getMailAlias(this.props.node);this.state.mailAlias=alias.email_alias;this.state.aliasDomain=alias.alias_domain;});onWillUpdateProps(async(nextProps)=>{const alias=await this.getMailAlias(nextProps.node);this.state.mailAlias=alias.email_alias;this.state.aliasDomain=alias.alias_domain;});}
async getMailAlias(node){const mailAliasObj=await this.rpc("/web_studio/get_email_alias",{model_name:this.env.viewEditorModel.resModel,});return mailAliasObj;}
onChangeMailAlias(value){this.rpc("/web_studio/set_email_alias",{model_name:this.env.viewEditorModel.resModel,value,});}}
return __exports;});;

/* /web_studio/static/src/client_action/view_editor/editors/form/form_editor_sidebar/properties/group_properties/group_properties.js */
odoo.define('@web_studio/client_action/view_editor/editors/form/form_editor_sidebar/properties/group_properties/group_properties',['@odoo/owl','@web_studio/client_action/view_editor/property/property','@web_studio/client_action/view_editor/interactive_editor/properties/limit_group_visibility/limit_group_visibility','@web_studio/client_action/view_editor/interactive_editor/properties/sidebar_properties_toolbox/sidebar_properties_toolbox','@web_studio/client_action/view_editor/interactive_editor/properties/modifiers/modifiers_properties','@web_studio/client_action/view_editor/view_editor_model'],function(require){'use strict';let __exports={};const{Component}=require("@odoo/owl");const{Property}=require("@web_studio/client_action/view_editor/property/property");const{LimitGroupVisibility}=require("@web_studio/client_action/view_editor/interactive_editor/properties/limit_group_visibility/limit_group_visibility");const{SidebarPropertiesToolbox}=require("@web_studio/client_action/view_editor/interactive_editor/properties/sidebar_properties_toolbox/sidebar_properties_toolbox");const{ModifiersProperties}=require("@web_studio/client_action/view_editor/interactive_editor/properties/modifiers/modifiers_properties");const{useEditNodeAttributes}=require("@web_studio/client_action/view_editor/view_editor_model");const GroupProperties=__exports.GroupProperties=class GroupProperties extends Component{static template="web_studio.ViewEditor.InteractiveEditorProperties.Group";static components={ModifiersProperties,LimitGroupVisibility,Property,SidebarPropertiesToolbox,};setup(){this.editNodeAttributes=useEditNodeAttributes();}
onChangeAttribute(value,name){return this.editNodeAttributes({[name]:value});}}
return __exports;});;

/* /web_studio/static/src/client_action/view_editor/editors/form/form_editor_sidebar/properties/label_properties/label_properties.js */
odoo.define('@web_studio/client_action/view_editor/editors/form/form_editor_sidebar/properties/label_properties/label_properties',['@odoo/owl','@web_studio/client_action/view_editor/property/property','@web_studio/client_action/view_editor/interactive_editor/properties/sidebar_properties_toolbox/sidebar_properties_toolbox','@web_studio/client_action/view_editor/view_editor_model'],function(require){'use strict';let __exports={};const{Component}=require("@odoo/owl");const{Property}=require("@web_studio/client_action/view_editor/property/property");const{SidebarPropertiesToolbox}=require("@web_studio/client_action/view_editor/interactive_editor/properties/sidebar_properties_toolbox/sidebar_properties_toolbox");const{useEditNodeAttributes}=require("@web_studio/client_action/view_editor/view_editor_model");const LabelProperties=__exports.LabelProperties=class LabelProperties extends Component{static template="web_studio.ViewEditor.InteractiveEditorProperties.Label";static components={Property,SidebarPropertiesToolbox};setup(){this.editNodeAttributes=useEditNodeAttributes();}
onChangeAttribute(value,name){return this.editNodeAttributes({[name]:value});}}
return __exports;});;

/* /web_studio/static/src/client_action/view_editor/editors/form/form_editor_sidebar/properties/page_properties/page_properties.js */
odoo.define('@web_studio/client_action/view_editor/editors/form/form_editor_sidebar/properties/page_properties/page_properties',['@odoo/owl','@web_studio/client_action/view_editor/property/property','@web_studio/client_action/view_editor/interactive_editor/properties/limit_group_visibility/limit_group_visibility','@web_studio/client_action/view_editor/interactive_editor/properties/sidebar_properties_toolbox/sidebar_properties_toolbox','@web_studio/client_action/view_editor/interactive_editor/properties/modifiers/modifiers_properties','@web_studio/client_action/view_editor/view_editor_model'],function(require){'use strict';let __exports={};const{Component}=require("@odoo/owl");const{Property}=require("@web_studio/client_action/view_editor/property/property");const{LimitGroupVisibility}=require("@web_studio/client_action/view_editor/interactive_editor/properties/limit_group_visibility/limit_group_visibility");const{SidebarPropertiesToolbox}=require("@web_studio/client_action/view_editor/interactive_editor/properties/sidebar_properties_toolbox/sidebar_properties_toolbox");const{ModifiersProperties}=require("@web_studio/client_action/view_editor/interactive_editor/properties/modifiers/modifiers_properties");const{useEditNodeAttributes}=require("@web_studio/client_action/view_editor/view_editor_model");class PageNodeToolbox extends SidebarPropertiesToolbox{removeNodeFromArch(){const node=this.node;let xpathToRemove=node.xpath;if(node.arch.parentElement.children.length<=1){xpathToRemove=node.xpath.split("/").slice(0,-1).join("/");}
return super.removeNodeFromArch(xpathToRemove);}}
const PageProperties=__exports.PageProperties=class PageProperties extends Component{static template="web_studio.ViewEditor.InteractiveEditorProperties.Page";static components={Property,LimitGroupVisibility,PageNodeToolbox,ModifiersProperties,};setup(){this.editNodeAttributes=useEditNodeAttributes();}
onChangeAttribute(value,name){return this.editNodeAttributes({[name]:value});}
static props={node:{type:Object},}}
return __exports;});;

/* /web_studio/static/src/client_action/view_editor/editors/gantt/gantt_editor_sidebar.js */
odoo.define('@web_studio/client_action/view_editor/editors/gantt/gantt_editor_sidebar',['@web_gantt/gantt_view','@web/core/registry','@odoo/owl','@web/core/l10n/translation','@web_studio/client_action/view_editor/interactive_editor/interactive_editor_sidebar','@web_studio/client_action/view_editor/property/property','@web_studio/client_action/view_editor/interactive_editor/sidebar_view_toolbox/sidebar_view_toolbox','@web_studio/client_action/view_editor/view_editor_model'],function(require){'use strict';let __exports={};const{ganttView}=require("@web_gantt/gantt_view");const{registry}=require("@web/core/registry");const{Component,useState}=require("@odoo/owl");const{_t}=require("@web/core/l10n/translation");const{InteractiveEditorSidebar}=require("@web_studio/client_action/view_editor/interactive_editor/interactive_editor_sidebar");const{Property}=require("@web_studio/client_action/view_editor/property/property");const{SidebarViewToolbox}=require("@web_studio/client_action/view_editor/interactive_editor/sidebar_view_toolbox/sidebar_view_toolbox");const{useEditNodeAttributes}=require("@web_studio/client_action/view_editor/view_editor_model");const GanttEditorSidebar=__exports.GanttEditorSidebar=class GanttEditorSidebar extends Component{static template="web_studio.ViewEditor.GanttEditorSidebar";static props={openViewInForm:{type:Function,optional:true},openDefaultValues:{type:Function,optional:true},};static components={InteractiveEditorSidebar,Property,SidebarViewToolbox,};setup(){this.viewEditorModel=useState(this.env.viewEditorModel);this.editArchAttributes=useEditNodeAttributes({isRoot:true});}
get modelParams(){return this.viewEditorModel.controllerProps.modelParams.metaData;}
get colorChoices(){return this.modelParams.decorationFields.map((value)=>{return{label:this.modelParams.fields[value].string,value,};});}
get currentDayPrecision(){return this.dayPrecisionChoices.find((e)=>e.value===this.precisionValues.day)?.value;}
get currentWeekPrecision(){return this.weekAndMonthPrecisionChoices.find((e)=>e.value===this.precisionValues.week)?.value;}
get currentMonthPrecision(){return this.weekAndMonthPrecisionChoices.find((e)=>e.value===this.precisionValues.month)?.value;}
get dayPrecisionChoices(){return[{label:_t("Quarter Hour"),value:"hour:quarter"},{label:_t("Half Hour"),value:"hour:half"},{label:_t("Hour"),value:"hour:full"},];}
get defaultScalesChoices(){return Object.values(this.modelParams.scales).map((value)=>{return{label:value.description,value:value.id};});}
get fieldsChoices(){return Object.values(this.modelParams.fields).filter((f)=>f.store&&this.viewEditorModel.GROUPABLE_TYPES.includes(f.type)).map((f)=>{return{label:f.string,value:f.name,};});}
get fieldsDateChoices(){return Object.values(this.modelParams.fields).filter((f)=>f.store&&["date","datetime"].includes(f.type)).map((f)=>{return{label:f.string,value:f.name,};});}
get weekAndMonthPrecisionChoices(){return[{label:_t("Half Day"),value:"day:half"},{label:_t("Day"),value:"day:full"},];}
get precisionValues(){const precision=this.viewEditorModel.xmlDoc.querySelector("gantt").getAttribute("precision")?.replace(/'/g,'"')||"{}";return JSON.parse(precision);}
onDefaultGroupByChanged(selection){this.onViewAttributeChanged(selection.join(","),"default_group_by");}
onPrecisionChanged(value,name){const precision=this.precisionValues;precision[name]=value;this.onViewAttributeChanged(JSON.stringify(precision),"precision");}
onViewAttributeChanged(value,name){return this.editArchAttributes({[name]:value});}}
registry.category("studio_editors").add("gantt",{...ganttView,Sidebar:GanttEditorSidebar,});return __exports;});;

/* /web_studio/static/src/client_action/view_editor/editors/graph/graph_editor.js */
odoo.define('@web_studio/client_action/view_editor/editors/graph/graph_editor',['@odoo/owl','@web/core/l10n/translation','@web/core/registry','@web/views/graph/graph_view','@web_studio/client_action/view_editor/property/property','@web_studio/client_action/view_editor/interactive_editor/interactive_editor_sidebar','@web_studio/client_action/view_editor/interactive_editor/sidebar_view_toolbox/sidebar_view_toolbox','@web_studio/client_action/view_editor/operations_utils','@web_studio/client_action/view_editor/editors/utils','@web_studio/client_action/view_editor/view_editor_model'],function(require){'use strict';let __exports={};const{Component,onWillPatch,useState}=require("@odoo/owl");const{_lt}=require("@web/core/l10n/translation");const{registry}=require("@web/core/registry");const{graphView}=require("@web/views/graph/graph_view");const{Property}=require("@web_studio/client_action/view_editor/property/property");const{InteractiveEditorSidebar}=require("@web_studio/client_action/view_editor/interactive_editor/interactive_editor_sidebar");const{SidebarViewToolbox}=require("@web_studio/client_action/view_editor/interactive_editor/sidebar_view_toolbox/sidebar_view_toolbox");const operationUtils=require("@web_studio/client_action/view_editor/operations_utils");const{fieldsToChoices}=require("@web_studio/client_action/view_editor/editors/utils");const{useEditNodeAttributes}=require("@web_studio/client_action/view_editor/view_editor_model");const GraphEditorSidebar=__exports.GraphEditorSidebar=class GraphEditorSidebar extends Component{static template="web_studio.ViewEditor.GraphEditorSidebar";static props={openViewInForm:{type:Function,optional:true},openDefaultValues:{type:Function,optional:true},};static components={InteractiveEditorSidebar,Property,SidebarViewToolbox,};setup(){this.viewEditorModel=useState(this.env.viewEditorModel);this.editArchAttributes=useEditNodeAttributes({isRoot:true});onWillPatch(()=>{this.oldFieldValues={firstDimension:this.modelParams.groupBy[0],secondDimension:this.modelParams.groupBy[1],measure:this.modelParams.measure==="__count"?undefined:this.modelParams.measure,};});}
onViewAttributeChanged(value,name){value=value?value:"";return this.editArchAttributes({[name]:value});}
onGroupByChanged(type,newField,oldField){const operation=operationUtils.viewGroupByOperation("graph",type,newField,oldField);this.viewEditorModel.doOperation(operation);}
get modelParams(){return this.viewEditorModel.controllerProps.modelParams;}
get typeChoices(){return[{label:_lt("Bar"),value:"bar"},{label:_lt("Line"),value:"line"},{label:_lt("Pie"),value:"pie"},];}
get orderChoices(){return[{label:_lt("Ascending"),value:"asc"},{label:_lt("Descending"),value:"desc"},];}
get firstGroupbyChoices(){return fieldsToChoices(this.viewEditorModel.fields,(field)=>field.store&&this.viewEditorModel.GROUPABLE_TYPES.includes(field.type)&&field.name!==this.modelParams.groupBy[1]);}
get secondGroupbyChoices(){return fieldsToChoices(this.viewEditorModel.fields,(field)=>field.store&&this.viewEditorModel.GROUPABLE_TYPES.includes(field.type)&&field.name!==this.modelParams.groupBy[0]);}
get mesureChoices(){return fieldsToChoices(this.viewEditorModel.fields,(field)=>field.name!=="id"&&field.store&&["integer","float","monetary"].includes(field.type));}}
registry.category("studio_editors").add("graph",{...graphView,Sidebar:GraphEditorSidebar,});return __exports;});;

/* /web_studio/static/src/client_action/view_editor/editors/kanban/kanban_editor.js */
odoo.define('@web_studio/client_action/view_editor/editors/kanban/kanban_editor',['@web/core/registry','@web/core/utils/objects','@web/views/kanban/kanban_view','@web_studio/client_action/view_editor/editors/kanban/kanban_editor_renderer','@web_studio/client_action/view_editor/editors/utils','@web_studio/client_action/view_editor/editors/kanban/kanban_editor_sidebar/kanban_editor_sidebar'],function(require){'use strict';let __exports={};const{registry}=require("@web/core/registry");const{omit}=require("@web/core/utils/objects");const{kanbanView}=require("@web/views/kanban/kanban_view");const{KanbanEditorRenderer}=require("@web_studio/client_action/view_editor/editors/kanban/kanban_editor_renderer");const{makeModelErrorResilient}=require("@web_studio/client_action/view_editor/editors/utils");const{KanbanEditorSidebar}=require("@web_studio/client_action/view_editor/editors/kanban/kanban_editor_sidebar/kanban_editor_sidebar");const{getStudioNoFetchFields}=require("@web_studio/client_action/view_editor/editors/utils");class EditorArchParser extends kanbanView.ArchParser{parse(arch,models,modelName){const parsed=super.parse(...arguments);const noFetch=getStudioNoFetchFields(parsed.fieldNodes);parsed.fieldNodes=omit(parsed.fieldNodes,...noFetch.fieldNodes);parsed.activeFields=omit(parsed.activeFields,...noFetch.fieldNames);return parsed;}}
class OneRecordModel extends kanbanView.Model{async load(){this.progressAttributes=false;await super.load(...arguments);let list=this.root;let hasRecords;const isGrouped=list.isGrouped;if(!isGrouped){hasRecords=list.records.length;}else{hasRecords=list.groups.some((g)=>g.list.records.length);}
if(!hasRecords){if(isGrouped){const params={...list.commonGroupParams,isFolded:false,count:0,value:"",displayName:"",aggregates:{},groupByField:list.groupByField,groupDomain:[],rawContext:list.rawContext,};if(["date","datetime"].includes(list.groupByField.type)){params.range={};}
const group=this.createDataPoint("group",params);list.groups.push(group);list=group.list;}
await list.createRecord();list.editedRecord=null;}}
createDataPoint(){const dp=super.createDataPoint(...arguments);if(dp instanceof kanbanView.Model.DynamicGroupList){dp.limit=1;}
return dp;}}
const kanbanEditor={...kanbanView,ArchParser:EditorArchParser,Renderer:KanbanEditorRenderer,Model:OneRecordModel,Sidebar:KanbanEditorSidebar,props(genericProps,editor,config){const props=kanbanView.props(genericProps,editor,config);props.defaultGroupBy=props.archInfo.defaultGroupBy;props.Model=makeModelErrorResilient(OneRecordModel);props.limit=1;props.Renderer=KanbanEditorRenderer;return props;},};registry.category("studio_editors").add("kanban",kanbanEditor);return __exports;});;

/* /web_studio/static/src/client_action/view_editor/editors/kanban/kanban_editor_compiler.js */
odoo.define('@web_studio/client_action/view_editor/editors/kanban/kanban_editor_compiler',['@web/views/kanban/kanban_compiler','@web_studio/client_action/view_editor/editors/xml_utils','@web/views/view_compiler','@web/core/utils/xml','@web/core/l10n/translation'],function(require){'use strict';let __exports={};const{KanbanCompiler}=require("@web/views/kanban/kanban_compiler");const{computeXpath,applyInvisible}=require("@web_studio/client_action/view_editor/editors/xml_utils");const{isComponentNode}=require("@web/views/view_compiler");const{createElement}=require("@web/core/utils/xml");const{_lt}=require("@web/core/l10n/translation");const interestingSelector=["field","widget",".dropdown","img.oe_kanban_avatar",".o_kanban_record_body",".o_kanban_record_bottom",].join(", ");const KanbanEditorCompiler=__exports.KanbanEditorCompiler=class KanbanEditorCompiler extends KanbanCompiler{constructor(){super(...arguments);const kanbanBox=this.templates["kanban-box"];this.isDashboard=kanbanBox.closest("kanban").classList.contains("o_kanban_dashboard");}
applyInvisible(invisible,compiled,params){return applyInvisible(invisible,compiled,params);}
compile(key,params={}){params.enableInvisible=true;const xml=this.templates[key];const mainDiv=xml.querySelector("div");const interestingArchNodes=[...xml.querySelectorAll(interestingSelector)];if(mainDiv){interestingArchNodes.push(mainDiv);}
for(const el of interestingArchNodes){const xpath=computeXpath(el,"kanban");el.setAttribute("studioXpath",xpath);}
const compiled=super.compile(key,params);const isKanbanBox=key==="kanban-box";if(isKanbanBox&&!this.isDashboard&&mainDiv){const tagsWidget=xml.querySelector("field[widget='many2many_tags']");if(!tagsWidget){this.addTagsWidgetHook(compiled);}
const priorityWidget=xml.querySelector("field[widget='priority']");const favoriteWidget=xml.querySelector("field[widget='boolean_favorite']");if(!priorityWidget&&!favoriteWidget){this.addPriorityHook(compiled);}
const dropdown=this.templates["kanban-menu"];if(!dropdown){this.addDropdownHook(compiled);}
const avatarImg=xml.querySelector("img.oe_kanban_avatar");if(!avatarImg){this.addAvatarHook(compiled);}}
compiled.querySelectorAll(".oe_kanban_avatar").forEach((el)=>{const tIf=el.closest("[t-if]");if(tIf){const tElse=createElement("t",{"t-else":"","t-call":"web_studio.KanbanEditorRecord.AvatarPlaceholder",});tIf.insertAdjacentElement("afterend",tElse);}});return compiled;}
compileField(node){const compiled=super.compileField(...arguments);if(compiled.tagName==="span"){const fieldName=node.getAttribute("name");compiled.setAttribute("data-field-name",fieldName);}else{compiled.setAttribute("hasEmptyPlaceholder",true);}
return compiled;}
addStudioHook(node,compiled){const tNode=createElement("t");if(compiled.hasAttribute("t-if")){tNode.setAttribute("t-if",compiled.getAttribute("t-if"));compiled.removeAttribute("t-if");}
tNode.appendChild(compiled);const xpath=node.getAttribute("studioXpath");const studioHook=createElement("StudioHook",{xpath:`"${xpath}"`,position:"'after'",});tNode.appendChild(studioHook);return tNode;}
compileNode(node,params){const nodeType=node.nodeType;if(nodeType===1&&(isComponentNode(node)||node.getAttribute("studio_no_fetch"))){return;}
let compiled=super.compileNode(...arguments);if(nodeType===1&&compiled){if(node.hasAttribute("studioXpath")){const xpath=node.getAttribute("studioXpath");if(isComponentNode(compiled)){compiled.setAttribute("studioXpath",`"${xpath}"`);}else if(!compiled.hasAttribute("studioXpath")){compiled.setAttribute("studioXpath",xpath);}
if(node.classList.contains("oe_kanban_avatar")){compiled.setAttribute("t-on-click",`(ev) => __comp__.env.config.onNodeClicked("${xpath}")`);compiled.classList.add("o-web-studio-editor--element-clickable");}
if(node.tagName==="field"&&!isComponentNode(compiled)){compiled.setAttribute("t-on-click",`(ev) => __comp__.env.config.onNodeClicked("${xpath}")`);compiled.classList.add("o-web-studio-editor--element-clickable");const fieldName=node.getAttribute("name");const isEmptyExpr=`__comp__.isFieldValueEmpty(record["${fieldName}"].value)`;const tattfClassEmpty=`{{ ${isEmptyExpr} ? "o_web_studio_widget_empty" : "" }}`;const tattfClass=compiled.getAttribute("t-attf-class");const nextAttfClass=tattfClass?`${tattfClass} ${tattfClassEmpty}`:tattfClassEmpty;compiled.setAttribute("t-attf-class",nextAttfClass);const tOut=compiled.getAttribute("t-out");compiled.setAttribute("t-out",`${isEmptyExpr} ? __comp__.props.record.activeFields["${fieldName}"].string : ${tOut}`);}
if(node.tagName==="field"||node.tagName==="widget"){if(!Array.from(node.getAttributeNames()).filter((att)=>["t-if","t-elif","t-else"].includes(att))[0]){compiled=this.addStudioHook(node,compiled);}}}}
return compiled;}
addTagsWidgetHook(compiled){const parentElement=compiled.querySelector(".o_kanban_record_body")||compiled.querySelector("div");const tagsHook=createElement("span",{class:"o_web_studio_add_kanban_tags","t-on-click":`() => __comp__.onAddTagsWidget({
                xpath: "${parentElement.getAttribute("studioXpath")}"
            })`,});tagsHook.textContent=_lt("Add tags");if(parentElement.firstChild){parentElement.insertBefore(tagsHook,parentElement.firstChild);}else{parentElement.appendChild(tagsHook);}}
addDropdownHook(compiled){const rootSibling=compiled.querySelector("div");const dropdownHook=createElement("div",[createElement("a",{class:"btn fa fa-ellipsis-v",}),],{class:"o_web_studio_add_dropdown o_dropdown_kanban dropdown position-absolute end-0",style:"z-index: 1;","t-on-click":"() => __comp__.onAddDropdown()",});rootSibling.insertAdjacentElement("afterend",dropdownHook);}
addPriorityHook(compiled){const parentElement=compiled.querySelector("div");const priorityHook=createElement("div",{class:"o_web_studio_add_priority oe_kanban_bottom_left align-self-start flex-grow-0",style:"z-index: 1;","t-on-click":"() => __comp__.onAddPriority()",});priorityHook.textContent=_lt("Add a priority");parentElement.appendChild(priorityHook);}
addAvatarHook(compiled){const parentElement=compiled.querySelector(".o_kanban_record_bottom")||compiled.querySelector("div");const avatarHook=createElement("div",{class:"o_web_studio_add_kanban_image oe_kanban_bottom_right pe-auto",style:"z-index: 1;","t-on-click":"() => __comp__.onAddAvatar()",});avatarHook.textContent=_lt("Add an avatar");parentElement.appendChild(avatarHook);}
validateNode(){}}
return __exports;});;

/* /web_studio/static/src/client_action/view_editor/editors/kanban/kanban_editor_record.js */
odoo.define('@web_studio/client_action/view_editor/editors/kanban/kanban_editor_record',['@web/views/kanban/kanban_view','@web_studio/client_action/view_editor/editors/kanban/kanban_editor_compiler','@web_studio/client_action/view_editor/editors/components/field_studio','@web_studio/client_action/view_editor/editors/components/widget_studio','@web_studio/client_action/view_editor/editors/components/view_button_studio','@web_studio/client_action/view_editor/editors/components/studio_hook_component','@web_studio/client_action/view_editor/editors/components/field_selector_dialog','@web_studio/client_action/view_editor/editors/xml_utils','@web/core/utils/hooks','@web/core/confirmation_dialog/confirmation_dialog','@odoo/owl'],function(require){'use strict';let __exports={};const{kanbanView}=require("@web/views/kanban/kanban_view");const{KanbanEditorCompiler}=require("@web_studio/client_action/view_editor/editors/kanban/kanban_editor_compiler");const{FieldStudio}=require("@web_studio/client_action/view_editor/editors/components/field_studio");const{WidgetStudio}=require("@web_studio/client_action/view_editor/editors/components/widget_studio");const{ViewButtonStudio}=require("@web_studio/client_action/view_editor/editors/components/view_button_studio");const{StudioHook}=require("@web_studio/client_action/view_editor/editors/components/studio_hook_component");const{FieldSelectorDialog}=require("@web_studio/client_action/view_editor/editors/components/field_selector_dialog");const{computeXpath}=require("@web_studio/client_action/view_editor/editors/xml_utils");const{useService}=require("@web/core/utils/hooks");const{AlertDialog,ConfirmationDialog}=require("@web/core/confirmation_dialog/confirmation_dialog");const{Component,toRaw,useEnv,useState,xml,useEffect,useRef,onError}=require("@odoo/owl");class FieldStudioKanbanRecord extends FieldStudio{isX2ManyEditable(){return false;}}
const OriginDropdown=kanbanView.Renderer.components.KanbanRecord.components.Dropdown;class Dropdown extends OriginDropdown{setup(){super.setup();const rootRef=useRef("root");this.rootRef=rootRef;useEffect((rootEl)=>{if(this.props.studioXpath){rootEl.classList.add("o-web-studio-editor--element-clickable");rootEl.dataset.studioXpath=this.props.studioXpath;}
if(this.props.hasCoverSetter){rootEl.dataset.hasCoverSetter=true;}},()=>[rootRef.el]);}
onTogglerClick(){this.env.config.onNodeClicked(this.props.studioXpath);}}
Dropdown.template="web_studio.KanbanEditorRecord.Dropdown";Dropdown.props={...OriginDropdown.props,studioXpath:{type:String,optional:1},hasCoverSetter:{type:Boolean,optional:1},};const KanbanRecord=kanbanView.Renderer.components.KanbanRecord;function useSafeKanban(){const state=useState({hasError:false});const viewEditorModel=toRaw(useEnv().viewEditorModel);onError((error)=>{const hasError=state.hasError;if(hasError||viewEditorModel.isInEdition){throw error;}
state.hasError=true;});return state;}
class SafeKanbanRecord extends KanbanRecord{setup(){super.setup();this.safe=useSafeKanban();}}
SafeKanbanRecord.template="web_studio.SafeKanbanRecord";class _KanbanEditorRecord extends KanbanRecord{setup(){super.setup();this.viewEditorModel=useState(this.env.viewEditorModel);if(this.constructor.KANBAN_MENU_ATTRIBUTE in this.props.templates){const compiledTemplateMenu=this.props.templates[this.constructor.KANBAN_MENU_ATTRIBUTE];this.dropdownXpath=computeXpath(compiledTemplateMenu,"kanban");this.dropdownHasCoverSetter=Boolean(compiledTemplateMenu.querySelectorAll("a[data-type='set_cover']").length);}
this.dialogService=useService("dialog");this.safe=useSafeKanban();useEffect((el)=>{if(!el){return;}
el.classList.remove("oe_kanban_global_click","oe_kanban_global_click_edit");},()=>[this.rootRef.el]);}
onGlobalClick(){}
isFieldValueEmpty(value){if(value===null){return true;}
if(Array.isArray(value)){return!value.length;}
return!value;}
onAddTagsWidget({xpath}){const fields=[];for(const[fName,field]of Object.entries(this.props.record.fields)){if(field.type==="many2many"){const _field={...field,name:fName};fields.push(_field);}}
if(!fields.length){this.dialogService.add(AlertDialog,{body:this.env._t("You first need to create a many2many field in the form view."),});return;}
this.dialogService.add(FieldSelectorDialog,{fields,onConfirm:(field)=>{const operation={type:"add",node:{tag:"field",attrs:{name:field},},target:this.env.viewEditorModel.getFullTarget(xpath),position:"inside",};this.env.viewEditorModel.doOperation(operation);},});}
onAddDropdown(){this.dialogService.add(ConfirmationDialog,{body:this.env._t("Do you want to add a dropdown with colors?"),confirm:()=>{this.env.viewEditorModel.doOperation({type:"kanban_dropdown",});},});}
onAddPriority(){const fields=[];const activeFields=Object.keys(this.props.record.activeFields);for(const[fName,field]of Object.entries(this.props.record.fields)){if(field.type==="selection"&&!activeFields.includes(fName)){const _field={...field,name:fName};fields.push(_field);}}
this.dialogService.add(FieldSelectorDialog,{fields,showNew:true,onConfirm:(field)=>{this.env.viewEditorModel.doOperation({type:"kanban_priority",field,});},});}
onAddAvatar(){const fields=[];for(const[fName,field]of Object.entries(this.props.record.fields)){if(field.type==="many2one"&&(field.relation==="res.partner"||field.relation==="res.users")){const _field={...field,name:fName};fields.push(_field);}}
this.dialogService.add(FieldSelectorDialog,{fields,onConfirm:(field)=>{this.env.viewEditorModel.doOperation({type:"kanban_image",field,});},});}}
_KanbanEditorRecord.components={...KanbanRecord.components,Dropdown,Field:FieldStudioKanbanRecord,Widget:WidgetStudio,StudioHook,ViewButton:ViewButtonStudio,};_KanbanEditorRecord.menuTemplate="web_studio.SafeKanbanRecordMenu";_KanbanEditorRecord.template="web_studio.SafeKanbanRecord";const KanbanEditorRecord=__exports.KanbanEditorRecord=class KanbanEditorRecord extends Component{static props=[...KanbanRecord.props];get KanbanRecord(){if(this.env.viewEditorModel.mode!=="interactive"){return SafeKanbanRecord;}else{return _KanbanEditorRecord;}}
get kanbanRecordProps(){const props={...this.props};if(this.env.viewEditorModel.mode==="interactive"){props.Compiler=KanbanEditorCompiler;}
return props;}}
KanbanEditorRecord.template=xml`<t t-component="KanbanRecord" t-props="kanbanRecordProps" />`;return __exports;});;

/* /web_studio/static/src/client_action/view_editor/editors/kanban/kanban_editor_renderer.js */
odoo.define('@web_studio/client_action/view_editor/editors/kanban/kanban_editor_renderer',['@web/views/kanban/kanban_view','@web_studio/client_action/view_editor/editors/kanban/kanban_editor_record','@odoo/owl'],function(require){'use strict';let __exports={};const{kanbanView}=require("@web/views/kanban/kanban_view");const{KanbanEditorRecord}=require("@web_studio/client_action/view_editor/editors/kanban/kanban_editor_record");const{useRef,useEffect}=require("@odoo/owl");const KanbanEditorRenderer=__exports.KanbanEditorRenderer=class KanbanEditorRenderer extends kanbanView.Renderer{setup(){super.setup();const rootRef=useRef("root");useEffect((el)=>{if(!el){return;}
el.classList.add("o_web_studio_kanban_view_editor");},()=>[rootRef.el]);}
get canUseSortable(){return false;}
get showNoContentHelper(){return false;}
getGroupsOrRecords(){const{list}=this.props;const groupsOrRec=super.getGroupsOrRecords(...arguments);if(list.isGrouped){return[groupsOrRec.filter((el)=>el.group.list.records.length)[0]];}else{return[groupsOrRec[0]];}}
canCreateGroup(){return false;}
getGroupUnloadedCount(){return 0;}}
KanbanEditorRenderer.template="web_studio.KanbanEditorRenderer";KanbanEditorRenderer.components={...kanbanView.Renderer.components,KanbanRecord:KanbanEditorRecord,};return __exports;});;

/* /web_studio/static/src/client_action/view_editor/editors/kanban/kanban_editor_sidebar/kanban_editor_sidebar.js */
odoo.define('@web_studio/client_action/view_editor/editors/kanban/kanban_editor_sidebar/kanban_editor_sidebar',['@odoo/owl','@web_studio/client_action/view_editor/interactive_editor/interactive_editor_sidebar','@web_studio/client_action/view_editor/view_structures/view_structures','@web_studio/client_action/view_editor/property/property','@web_studio/client_action/view_editor/interactive_editor/sidebar_view_toolbox/sidebar_view_toolbox','@web_studio/client_action/view_editor/interactive_editor/properties/properties','@web_studio/client_action/view_editor/interactive_editor/properties/field_properties/field_properties','@web_studio/client_action/view_editor/editors/kanban/kanban_editor_sidebar/properties/kanban_cover_properties/kanban_cover_properties','@web_studio/client_action/view_editor/view_editor_model','@web_studio/client_action/view_editor/editors/utils'],function(require){'use strict';let __exports={};const{Component,useState}=require("@odoo/owl");const{InteractiveEditorSidebar}=require("@web_studio/client_action/view_editor/interactive_editor/interactive_editor_sidebar");const{ExistingFields}=require("@web_studio/client_action/view_editor/view_structures/view_structures");const{Property}=require("@web_studio/client_action/view_editor/property/property");const{SidebarViewToolbox}=require("@web_studio/client_action/view_editor/interactive_editor/sidebar_view_toolbox/sidebar_view_toolbox");const{Properties}=require("@web_studio/client_action/view_editor/interactive_editor/properties/properties");const{FieldProperties}=require("@web_studio/client_action/view_editor/interactive_editor/properties/field_properties/field_properties");const{KanbanCoverProperties}=require("@web_studio/client_action/view_editor/editors/kanban/kanban_editor_sidebar/properties/kanban_cover_properties/kanban_cover_properties");const{useEditNodeAttributes}=require("@web_studio/client_action/view_editor/view_editor_model");const{fieldsToChoices}=require("@web_studio/client_action/view_editor/editors/utils");class KanbanFieldProperties extends FieldProperties{onChangeAttribute(value,name){if(name==="bold"&&!value){return this.editNodeAttributes({[name]:""});}
return super.onChangeAttribute(...arguments);}}
const KanbanEditorSidebar=__exports.KanbanEditorSidebar=class KanbanEditorSidebar extends Component{static template="web_studio.ViewEditor.KanbanEditorSidebar";static props={openViewInForm:{type:Function,optional:true},openDefaultValues:{type:Function,optional:true},};static components={InteractiveEditorSidebar,ExistingFields,Property,Properties,SidebarViewToolbox,};setup(){this.viewEditorModel=useState(this.env.viewEditorModel);this.editArchAttributes=useEditNodeAttributes({isRoot:true});this.propertiesComponents={field:{component:KanbanFieldProperties,props:{availableOptions:["invisible","string","bold"],},},t:{component:KanbanCoverProperties,},};}
get archInfo(){return this.viewEditorModel.controllerProps.archInfo;}
get defaultGroupBy(){return{choices:fieldsToChoices(this.viewEditorModel.fields,(field)=>{return field.store&&this.viewEditorModel.GROUPABLE_TYPES.includes(field.type);}),required:false,};}
editAttribute(value,name){return this.editArchAttributes({[name]:value});}
editDefaultGroupBy(value){this.editAttribute(value||"","default_group_by");}}
return __exports;});;

/* /web_studio/static/src/client_action/view_editor/editors/kanban/kanban_editor_sidebar/properties/kanban_cover_properties/kanban_cover_properties.js */
odoo.define('@web_studio/client_action/view_editor/editors/kanban/kanban_editor_sidebar/properties/kanban_cover_properties/kanban_cover_properties',['@odoo/owl','@web_studio/client_action/view_editor/property/property','@web/core/utils/hooks','@web_studio/client_action/view_editor/editors/components/field_selector_dialog','@web_studio/client_action/view_editor/interactive_editor/properties/sidebar_properties_toolbox/sidebar_properties_toolbox'],function(require){'use strict';let __exports={};const{Component}=require("@odoo/owl");const{Property}=require("@web_studio/client_action/view_editor/property/property");const{useService}=require("@web/core/utils/hooks");const{FieldSelectorDialog}=require("@web_studio/client_action/view_editor/editors/components/field_selector_dialog");const{SidebarPropertiesToolbox}=require("@web_studio/client_action/view_editor/interactive_editor/properties/sidebar_properties_toolbox/sidebar_properties_toolbox");const KanbanCoverProperties=__exports.KanbanCoverProperties=class KanbanCoverProperties extends Component{static template="web_studio.ViewEditor.InteractiveEditorProperties.KanbanCoverProperties";static props={node:{type:Object},};static components={Property,SidebarPropertiesToolbox};setup(){this.dialog=useService("dialog");}
get coverNode(){return this.env.viewEditorModel.xmlDoc.querySelector("a[data-type='set_cover'],a[type='set_cover']");}
get coverValue(){return!!this.coverNode;}
setCover(value,name){const fields=[];for(const field of Object.values(this.env.viewEditorModel.fields)){if(field.type==="many2one"&&field.relation==="ir.attachment"){fields.push(field);}}
this.dialog.add(FieldSelectorDialog,{fields:fields,showNew:true,onConfirm:(field)=>{const operation={type:"kanban_set_cover",field:field,};this.env.viewEditorModel.doOperation(operation);},});}
onChangeCover(value,name){if(!value){const vem=this.env.viewEditorModel;const fieldToRemove=Object.entries(vem.controllerProps.archInfo.activeFields).filter(([fName,fInfo])=>{return fInfo.widget==="attachment_image";});if(fieldToRemove.length!==1){return;}
const extraNode=this.coverNode;const relevantAttr=["type","data-type"].filter((att)=>{return extraNode.hasAttribute(att)&&extraNode.getAttribute(att)==="set_cover";})[0];const operation={target:{attrs:{name:fieldToRemove[0][0]},tag:"field",extra_nodes:[{tag:extraNode.tagName,attrs:{[relevantAttr]:"set_cover",},},],},type:"remove",};vem.doOperation(operation);}else{this.setCover(value,name);}}}
return __exports;});;

/* /web_studio/static/src/client_action/view_editor/editors/list/list_editor.js */
odoo.define('@web_studio/client_action/view_editor/editors/list/list_editor',['@web/views/list/list_view','@web_studio/client_action/view_editor/editors/xml_utils','@web/core/registry','@web/core/utils/objects','@web_studio/client_action/view_editor/editors/list/list_editor_renderer','@web/views/relational_model','@odoo/owl','@web_studio/client_action/view_editor/editors/list/list_editor_sidebar/list_editor_sidebar','@web_studio/client_action/view_editor/editors/utils'],function(require){'use strict';let __exports={};const{listView}=require("@web/views/list/list_view");const{computeXpath}=require("@web_studio/client_action/view_editor/editors/xml_utils");const{registry}=require("@web/core/registry");const{omit}=require("@web/core/utils/objects");const{ListEditorRenderer,columnsStyling}=require("@web_studio/client_action/view_editor/editors/list/list_editor_renderer");const{RelationalModel}=require("@web/views/relational_model");const{Component,xml}=require("@odoo/owl");const{ListEditorSidebar}=require("@web_studio/client_action/view_editor/editors/list/list_editor_sidebar/list_editor_sidebar");const{getStudioNoFetchFields}=require("@web_studio/client_action/view_editor/editors/utils");function parseStudioGroups(node){if(node.hasAttribute("studio_groups")){return node.getAttribute("studio_groups");}}
class EditorArchParser extends listView.ArchParser{isColumnVisible(){return true;}
parse(arch,models,modelName){const parsed=super.parse(...arguments);const noFetch=getStudioNoFetchFields(parsed.fieldNodes);parsed.fieldNodes=omit(parsed.fieldNodes,...noFetch.fieldNodes);const noFetchFieldNames=noFetch.fieldNames;parsed.activeFields=omit(parsed.activeFields,...noFetchFieldNames);parsed.columns=parsed.columns.filter((field)=>!noFetchFieldNames.includes(field.name));return parsed;}
parseFieldNode(node,models,modelName){const parsed=super.parseFieldNode(...arguments);parsed.studioXpath=computeXpath(node,"list, tree");parsed.studio_groups=parseStudioGroups(node);return parsed;}
parseWidgetNode(node,models,modelName){const parsed=super.parseWidgetNode(...arguments);parsed.studioXpath=computeXpath(node,"list, tree");parsed.studio_groups=parseStudioGroups(node);return parsed;}
processButton(node){const parsed=super.processButton(node);if(!node.closest("header")){parsed.studioXpath=computeXpath(node,"list, tree");parsed.studio_groups=parseStudioGroups(node);}
return parsed;}}
function modelUsesParentRecord(model,parentRecord,resIds){if(!(model instanceof RelationalModel)){throw new Error("The model instance is not of the right type to accept a parent record.");}
model.rootType="static_list";const parentEvalContext=parentRecord.evalContext;model.rootParams.getParentRecordContext=()=>parentEvalContext;const createDataPoint=model.createDataPoint.bind(model);const modelLoad=model.load.bind(model);model.load=(...args)=>{model.createDataPoint=(...args)=>{const dataPoint=createDataPoint(...args);dataPoint.setCurrentIds(resIds);dataPoint.selection=[];dataPoint.isReadonly=()=>true;model.createDataPoint=createDataPoint;return dataPoint;};return modelLoad(...args);};}
class ListEditorController extends listView.Controller{setup(){super.setup();if(this.props.parentRecord){modelUsesParentRecord(this.model,this.props.parentRecord,this.props.resIds);}}}
ListEditorController.props={...listView.Controller.props,parentRecord:{type:Object,optional:true},};class ControllerShadow extends Component{static props={...ListEditorController.props};get Component(){return ListEditorController;}
get componentProps(){const props={...this.props};props.groupBy=[];return props;}}
ControllerShadow.template=xml`<t t-component="Component" t-props="componentProps" />`;const listEditor={...listView,Controller:ControllerShadow,ArchParser:EditorArchParser,Renderer:ListEditorRenderer,props(){const props=listView.props(...arguments);props.allowSelectors=false;props.editable=false;props.showButtons=false;return props;},Sidebar:ListEditorSidebar,};registry.category("studio_editors").add("list",listEditor);const colNearestHookClass="o_web_studio_nearest_hook";listEditor.styleNearestHook=function styleNearestColumn(mainRef,nearestHook){const xpath=nearestHook.dataset.xpath;const position=nearestHook.dataset.position;columnsStyling(mainRef.el,`.o_web_studio_hook[data-xpath='${xpath}'][data-position='${position}']`,[colNearestHookClass]);};listEditor.styleClickedElement=(mainRef,params)=>{columnsStyling(mainRef.el,`[data-studio-xpath='${params.xpath}']:not(.o_web_studio_hook)`,["o-web-studio-editor--element-clicked",]);};return __exports;});;

/* /web_studio/static/src/client_action/view_editor/editors/list/list_editor_renderer.js */
odoo.define('@web_studio/client_action/view_editor/editors/list/list_editor_renderer',['@web/views/list/list_view','@web/core/utils/timing','@odoo/owl'],function(require){'use strict';let __exports={};const{listView}=require("@web/views/list/list_view");const{useThrottleForAnimation}=require("@web/core/utils/timing");const{reactive,useEffect,useState}=require("@odoo/owl");const colSelectedClass="o-web-studio-editor--element-clicked";const colHoverClass="o-web-studio--col-hovered";function cleanStyling(mainEl,classNames){mainEl.querySelectorAll(`${classNames.map((c) => `.${c}`)}`).forEach((el)=>{el.classList.remove(...classNames);});}
__exports.columnsStyling=columnsStyling;function columnsStyling(mainEl,colSelector,classNames){mainEl.querySelectorAll(`td${colSelector}, th${colSelector}`).forEach((el)=>{el.classList.add(...classNames);});}
function getSelectableCol(target,colSelector){if(target.closest("button")){return null;}
const colEl=target.closest(`td${colSelector}, th${colSelector}`);return colEl;}
const ListEditorRenderer=__exports.ListEditorRenderer=class ListEditorRenderer extends listView.Renderer{setup(){const viewEditorModel=useState(this.env.viewEditorModel);this.viewEditorModel=reactive(viewEditorModel,()=>{this.state.columns=this.getActiveColumns(this.props.list);});super.setup();this.onTableHover=useThrottleForAnimation(this.onTableHover);useEffect((rootEl)=>{rootEl.classList.add("o_web_studio_list_view_editor");},()=>[this.rootRef.el]);}
get canResequenceRows(){return false;}
getColumnHookData(col,position){let xpath;if(!col){return{xpath:"/tree",position:"inside"};}
if(col.type==="button_group"){if(position==="before"){xpath=col.buttons[0].studioXpath;}else{xpath=col.buttons[col.buttons.length-1].studioXpath;}}else{xpath=col.studioXpath;}
return{xpath,position,};}
addColsHooks(_cols){const attrs={width:"1px"};const options={};const cols=[];let hookId=0;const firstCol=_cols.find((c)=>c.optional!=="hide");const{xpath,position}=this.getColumnHookData(firstCol,"before");cols.push({type:"studio_hook",position,xpath,id:`studio_hook_${hookId++}_${(firstCol && firstCol.id) || 0}`,attrs,options,});for(const col of _cols){if(col.optional==="hide"){continue;}
cols.push(col);const{xpath,position}=this.getColumnHookData(col,"after");cols.push({type:"studio_hook",position,xpath,id:`studio_hook_${hookId++}_${col.id}`,attrs,options,});}
return cols;}
get allColumns(){let cols=this._allColumns;if(this.viewEditorModel.showInvisible){cols=cols.map((c)=>{return{...c,optional:false,studioIsInvisible:c.optional==="hide"||(c.modifiers&&c.modifiers.column_invisible===true),};});}else{cols=cols.filter((c)=>!c.modifiers||c.modifiers.column_invisible!==true);}
return this.addColsHooks(cols);}
set allColumns(cols){this._allColumns=cols;}
onTableHover(ev){const table=this.tableRef.el;cleanStyling(table,[colHoverClass]);if(ev.type!=="mouseover"){return;}
const colEl=getSelectableCol(ev.target,"[data-studio-xpath]");if(!colEl){return;}
const xpath=colEl.dataset.studioXpath;columnsStyling(table,`[data-studio-xpath='${xpath}']:not(.o_web_studio_hook)`,[colHoverClass,]);}
onTableClicked(ev){ev.stopPropagation();ev.preventDefault();const table=ev.currentTarget;cleanStyling(table,[colSelectedClass]);const colEl=getSelectableCol(ev.target,"[data-studio-xpath]");if(!colEl){return;}
this.env.config.onNodeClicked(colEl.dataset.studioXpath);}}
ListEditorRenderer.template="web_studio.ListEditorRenderer";ListEditorRenderer.recordRowTemplate="web_studio.ListEditorRenderer.RecordRow";return __exports;});;

/* /web_studio/static/src/client_action/view_editor/editors/list/list_editor_sidebar/list_editor_sidebar.js */
odoo.define('@web_studio/client_action/view_editor/editors/list/list_editor_sidebar/list_editor_sidebar',['@odoo/owl','@web_studio/client_action/view_editor/interactive_editor/interactive_editor_sidebar','@web_studio/client_action/view_editor/view_structures/view_structures','@web_studio/client_action/view_editor/property/property','@web_studio/client_action/view_editor/interactive_editor/sidebar_view_toolbox/sidebar_view_toolbox','@web_studio/client_action/view_editor/interactive_editor/properties/properties','@web/core/l10n/translation','@web/core/utils/strings','@web_studio/client_action/view_editor/interactive_editor/properties/field_properties/field_properties','@web_studio/client_action/view_editor/view_editor_model','@web_studio/client_action/view_editor/editors/utils'],function(require){'use strict';let __exports={};const{Component,useState}=require("@odoo/owl");const{InteractiveEditorSidebar}=require("@web_studio/client_action/view_editor/interactive_editor/interactive_editor_sidebar");const{ExistingFields,NewFields,}=require("@web_studio/client_action/view_editor/view_structures/view_structures");const{Property}=require("@web_studio/client_action/view_editor/property/property");const{SidebarViewToolbox}=require("@web_studio/client_action/view_editor/interactive_editor/sidebar_view_toolbox/sidebar_view_toolbox");const{Properties}=require("@web_studio/client_action/view_editor/interactive_editor/properties/properties");const{_lt,_t}=require("@web/core/l10n/translation");const{sprintf}=require("@web/core/utils/strings");const{FieldProperties}=require("@web_studio/client_action/view_editor/interactive_editor/properties/field_properties/field_properties");const{useEditNodeAttributes}=require("@web_studio/client_action/view_editor/view_editor_model");const{fieldsToChoices}=require("@web_studio/client_action/view_editor/editors/utils");class ListFieldNodeProperties extends FieldProperties{onChangeAttribute(value,name){if(name!=="aggregate"){return super.onChangeAttribute(...arguments);}
const activeNode=this.env.viewEditorModel.activeNode;const newAttrs={avg:"",sum:"",};if(value&&value!=="none"){const humanName=value==="sum"?_t("Sum of %s"):_t("Average of %s");const fieldString=activeNode.attrs.string||activeNode.field.label;newAttrs[value]=sprintf(humanName,fieldString);}
return this.editNodeAttributes(newAttrs);}}
const ListEditorSidebar=__exports.ListEditorSidebar=class ListEditorSidebar extends Component{static template="web_studio.ViewEditor.ListEditorSidebar";static props={openViewInForm:{type:Function,optional:true},openDefaultValues:{type:Function,optional:true},};static components={InteractiveEditorSidebar,NewFields,ExistingFields,Property,Properties,SidebarViewToolbox,};setup(){this.viewEditorModel=useState(this.env.viewEditorModel);this.editArchAttributes=useEditNodeAttributes({isRoot:true});this.propertiesComponents={field:{component:ListFieldNodeProperties,props:{availableOptions:["invisible","required","readonly","string","help","optional",],},},};}
get archInfo(){return this.viewEditorModel.controllerProps.archInfo;}
get defaultOrder(){if(this.archInfo.defaultOrder.length>=1){return this.archInfo.defaultOrder[0];}else{return{name:"",asc:true};}}
get editableChoices(){return[{value:"",label:_lt("Open form view")},{value:"top",label:_lt("Add record on top")},{value:"bottom",label:_lt("Add record at the bottom")},];}
get sortChoices(){return fieldsToChoices(this.archInfo.activeFields);}
get orderChoices(){return[{value:"asc",label:_lt("Ascending")},{value:"desc",label:_lt("Descending")},];}
get defaultGroupbyChoices(){return fieldsToChoices(this.viewEditorModel.fields,(field)=>field.store&&this.viewEditorModel.GROUPABLE_TYPES.includes(field.type));}
setSortBy(value){this.onSortingChanged(value,this.defaultOrder.asc?"asc":"desc");}
setOrder(value){this.onSortingChanged(this.defaultOrder.name,value);}
onSortingChanged(sortBy,order){if(sortBy){this.onAttributeChanged(`${sortBy} ${order}`,"default_order");}else{this.onAttributeChanged("","default_order");}}
onAttributeChanged(value,name){return this.editArchAttributes({[name]:value});}}
return __exports;});;

/* /web_studio/static/src/client_action/view_editor/editors/map/map_editor_sidebar.js */
odoo.define('@web_studio/client_action/view_editor/editors/map/map_editor_sidebar',['@web_map/map_view/map_view','@web/core/registry','@odoo/owl','@web_studio/client_action/view_editor/interactive_editor/interactive_editor_sidebar','@web_studio/client_action/view_editor/property/property','@web_studio/client_action/view_editor/interactive_editor/sidebar_view_toolbox/sidebar_view_toolbox','@web/views/record','@web/views/fields/many2many_tags/many2many_tags_field','@web_studio/client_action/view_editor/view_editor_model'],function(require){'use strict';let __exports={};const{mapView}=require("@web_map/map_view/map_view");const{registry}=require("@web/core/registry");const{Component,useState}=require("@odoo/owl");const{InteractiveEditorSidebar}=require("@web_studio/client_action/view_editor/interactive_editor/interactive_editor_sidebar");const{Property}=require("@web_studio/client_action/view_editor/property/property");const{SidebarViewToolbox}=require("@web_studio/client_action/view_editor/interactive_editor/sidebar_view_toolbox/sidebar_view_toolbox");const{Record}=require("@web/views/record");const{Many2ManyTagsField}=require("@web/views/fields/many2many_tags/many2many_tags_field");const{useEditNodeAttributes}=require("@web_studio/client_action/view_editor/view_editor_model");const MapEditorSidebar=__exports.MapEditorSidebar=class MapEditorSidebar extends Component{static template="web_studio.ViewEditor.MapEditorSidebar";static props={openViewInForm:{type:Function,optional:true},openDefaultValues:{type:Function,optional:true},};static components={InteractiveEditorSidebar,Property,SidebarViewToolbox,Record,Many2ManyTagsField,};setup(){this.viewEditorModel=useState(this.env.viewEditorModel);this.editArchAttributes=useEditNodeAttributes({isRoot:true});const irModelDefinition={field_ids:{type:"many2many",relation:"ir.model.fields",domain:[["model","=",this.viewEditorModel.resModel],["ttype","not in",["many2many","one2many","binary"]],],relatedFields:{display_name:{type:"char"},},},};this.additionalFieldsRecord={fields:irModelDefinition,activeFields:irModelDefinition,onRecordChanged:this.changeAdditionalFields.bind(this),};}
get modelParams(){return this.viewEditorModel.controllerProps.modelParams;}
get currentAdditionalFieldsIds(){return(JSON.parse(this.viewEditorModel.xmlDoc.firstElementChild.getAttribute("studio_map_field_ids"))||[]);}
onViewAttributeChanged(value,name){value=value?value:"";return this.editArchAttributes({[name]:value});}
get contactFieldChoices(){return Object.values(this.viewEditorModel.fields).filter((field)=>field.type==="many2one"&&field.relation==="res.partner").map((field)=>({label:`${field.string} (${field.name})`,value:field.name}));}
get defaultOrderChoices(){return Object.values(this.viewEditorModel.fields).filter((field)=>field.store&&["one2many","many2many","binary"].includes(field.type)).map((field)=>({label:`${field.string} (${field.name})`,value:field.name}));}
changeAdditionalFields(record,changes){const newFullIds=record.data.field_ids.currentIds;const currentFullIds=this.currentAdditionalFieldsIds;const newIds=newFullIds.filter((id)=>!currentFullIds.includes(id));let toRemoveIds;const operationType=newIds.length?"add":"remove";if(operationType==="remove"){toRemoveIds=currentFullIds.filter((id)=>!newFullIds.includes(id));}
this.viewEditorModel.doOperation({type:"map_popup_fields",target:{operation_type:operationType,field_ids:operationType==="add"?newIds:toRemoveIds,},});}}
registry.category("studio_editors").add("map",{...mapView,Sidebar:MapEditorSidebar,});return __exports;});;

/* /web_studio/static/src/client_action/view_editor/editors/pivot/pivot_editor.js */
odoo.define('@web_studio/client_action/view_editor/editors/pivot/pivot_editor',['@odoo/owl','@web/core/registry','@web/views/pivot/pivot_view','@web_studio/client_action/view_editor/property/property','@web_studio/client_action/view_editor/interactive_editor/interactive_editor_sidebar','@web_studio/client_action/view_editor/interactive_editor/sidebar_view_toolbox/sidebar_view_toolbox','@web_studio/client_action/view_editor/operations_utils','@web_studio/client_action/view_editor/editors/utils','@web/views/record','@web/views/fields/many2many_tags/many2many_tags_field','@web_studio/client_action/view_editor/view_editor_model','@web/views/utils'],function(require){'use strict';let __exports={};const{Component,useState}=require("@odoo/owl");const{registry}=require("@web/core/registry");const{pivotView}=require("@web/views/pivot/pivot_view");const{Property}=require("@web_studio/client_action/view_editor/property/property");const{InteractiveEditorSidebar}=require("@web_studio/client_action/view_editor/interactive_editor/interactive_editor_sidebar");const{SidebarViewToolbox}=require("@web_studio/client_action/view_editor/interactive_editor/sidebar_view_toolbox/sidebar_view_toolbox");const operationUtils=require("@web_studio/client_action/view_editor/operations_utils");const{fieldsToChoices}=require("@web_studio/client_action/view_editor/editors/utils");const{Record}=require("@web/views/record");const{Many2ManyTagsField}=require("@web/views/fields/many2many_tags/many2many_tags_field");const{useEditNodeAttributes}=require("@web_studio/client_action/view_editor/view_editor_model");const{computeReportMeasures}=require("@web/views/utils");function getFieldNameFromGroupby(str){return str.split(":")[0];}
const PivotEditorSidebar=__exports.PivotEditorSidebar=class PivotEditorSidebar extends Component{static template="web_studio.ViewEditor.PivotEditorSidebar";static props={openViewInForm:{type:Function,optional:true},openDefaultValues:{type:Function,optional:true},};static components={InteractiveEditorSidebar,Property,SidebarViewToolbox,Record,Many2ManyTagsField,};setup(){this.viewEditorModel=useState(this.env.viewEditorModel);this.editArchAttributes=useEditNodeAttributes({isRoot:true});const irModelDefinition={field_ids:{type:"many2many",relation:"ir.model.fields",domain:[["model","=",this.viewEditorModel.resModel],["name","in",Object.keys(this.possibleMeasures)],],relatedFields:{display_name:{type:"char"},},},};this.measureFieldsRecord={fields:irModelDefinition,activeFields:irModelDefinition,onRecordChanged:this.changeMeasureFields.bind(this),};}
get possibleMeasures(){const{fieldAttrs,activeMeasures}=this.archInfo;return computeReportMeasures(this.viewEditorModel.fields,fieldAttrs,activeMeasures);}
get currentMeasureFields(){return(JSON.parse(this.viewEditorModel.xmlDoc.firstElementChild.getAttribute("studio_pivot_measure_field_ids"))||[]);}
get archInfo(){return this.viewEditorModel.controllerProps.modelParams.metaData;}
get rowGroupBys(){return this.archInfo.rowGroupBys.map((fName)=>getFieldNameFromGroupby(fName));}
get colGroupBys(){return this.archInfo.colGroupBys.map((fName)=>getFieldNameFromGroupby(fName));}
changeMeasureFields(record){const newFullIds=record.data.field_ids.currentIds;const currentFullIds=this.currentMeasureFields;const newIds=newFullIds.filter((id)=>!currentFullIds.includes(id));let toRemoveIds;const operationType=newIds.length?"add":"remove";if(operationType==="remove"){toRemoveIds=currentFullIds.filter((id)=>!newFullIds.includes(id));}
this.viewEditorModel.doOperation({type:"pivot_measures_fields",target:{operation_type:operationType,field_ids:operationType==="add"?newIds:toRemoveIds,},});}
onGroupByChanged(type,newValue,oldValue){const operation=operationUtils.viewGroupByOperation("pivot",type,newValue,oldValue);this.viewEditorModel.doOperation(operation);}
onViewAttributeChanged(value,name){value=value?value:"";return this.editArchAttributes({[name]:value});}
get columnGroupbyChoices(){return fieldsToChoices(this.viewEditorModel.fields,(field)=>field.store&&this.viewEditorModel.GROUPABLE_TYPES.includes(field.type)&&![this.archInfo.rowGroupBys[0],this.archInfo.rowGroupBys[1]].includes(field.name));}
get rowGroupbyChoices_first(){return fieldsToChoices(this.viewEditorModel.fields,(field)=>field.store&&this.viewEditorModel.GROUPABLE_TYPES.includes(field.type)&&![this.archInfo.colGroupBys[0],this.archInfo.rowGroupBys[1]].includes(field.name));}
get rowGroupbyChoices_second(){return fieldsToChoices(this.viewEditorModel.fields,(field)=>field.store&&this.viewEditorModel.GROUPABLE_TYPES.includes(field.type)&&![this.archInfo.colGroupBys[0],this.archInfo.rowGroupBys[0]].includes(field.name));}}
registry.category("studio_editors").add("pivot",{...pivotView,Sidebar:PivotEditorSidebar,});return __exports;});;

/* /web_studio/static/src/client_action/view_editor/editors/search/search_editor.js */
odoo.define('@web_studio/client_action/view_editor/editors/search/search_editor',['@odoo/owl','@web/core/registry','@web_studio/client_action/view_editor/editors/xml_utils','@web/core/utils/xml','@web_studio/client_action/view_editor/editors/components/studio_hook_component','@web_studio/client_action/view_editor/interactive_editor/interactive_editor_sidebar','@web_studio/client_action/view_editor/view_structures/view_structures','@web_studio/client_action/view_editor/property/property','@web_studio/client_action/view_editor/interactive_editor/sidebar_view_toolbox/sidebar_view_toolbox','@web/core/l10n/translation','@web/core/utils/functions','@web/core/utils/hooks','@web_studio/client_action/view_editor/interactive_editor/properties/sidebar_properties_toolbox/sidebar_properties_toolbox','@web/views/standard_view_props'],function(require){'use strict';let __exports={};const{Component,useState}=require("@odoo/owl");const{registry}=require("@web/core/registry");const{computeXpath,getNodesFromXpath,}=require("@web_studio/client_action/view_editor/editors/xml_utils");const{XMLParser}=require("@web/core/utils/xml");const{StudioHook}=require("@web_studio/client_action/view_editor/editors/components/studio_hook_component");const{InteractiveEditorSidebar}=require("@web_studio/client_action/view_editor/interactive_editor/interactive_editor_sidebar");const{ExistingFields}=require("@web_studio/client_action/view_editor/view_structures/view_structures");const{Property}=require("@web_studio/client_action/view_editor/property/property");const{SidebarViewToolbox}=require("@web_studio/client_action/view_editor/interactive_editor/sidebar_view_toolbox/sidebar_view_toolbox");const{_t}=require("@web/core/l10n/translation");const{memoize}=require("@web/core/utils/functions");const{useOwnedDialogs}=require("@web/core/utils/hooks");const{SidebarPropertiesToolbox}=require("@web_studio/client_action/view_editor/interactive_editor/properties/sidebar_properties_toolbox/sidebar_properties_toolbox");const{standardViewProps}=require("@web/views/standard_view_props");function getGroupByFieldNameFromString(str){const matches=str.match(/(,\s*)?(["'])group_by\2\1(\s*:\s*)?\2(?<fieldName>.*)\2/);if(!matches){return null;}
if(!matches.groups){return null;}
return matches.groups.fieldName;}
function isFilterGroupBy(node){if(!node.hasAttribute("context")){return false;}
if(/(['"])group_by\1\s*:/.test(node.getAttribute("context"))){return true;}
return false;}
class SearchEditorArchParser extends XMLParser{parse(arch){const xmlDoc=this.parseXML(arch);this.fields=[];this.filters=[];this.groupBys=[];this.currentCategory=null;this.currentItems={items:[]};this.visitXML(xmlDoc,this.visitNode.bind(this));this.changeCategory(null,true);return{fields:this.fields,filters:this.filters,groupBys:this.groupBys,xmlDoc,};}
visitNode(node){if(node.nodeType!==1){return;}
const nodeName=node.nodeName;const studioXpath=computeXpath(node,"search");if(nodeName==="field"){this.changeCategory("field",true);const item=this.parseNode(node);item.studioXpath=studioXpath;this.fields.push(item);return false;}
if(nodeName==="filter"){const category=isFilterGroupBy(node)?"groupBy":"filter";this.changeCategory(category);const item=this.parseNode(node);item.studioXpath=studioXpath;this.pushItem(item);return false;}
if(nodeName==="separator"){this.changeCategory("filter",true);this.currentItems.separator=studioXpath;return false;}
if(nodeName==="group"){this.changeCategory(null,true);Array.from(node.children).forEach(this.visitNode.bind(this));this.changeCategory(null,true);return false;}}
parseNode(node){const nodeName=node.nodeName;const invisible=node.getAttribute("invisible");if(nodeName==="field"){return{type:"field",name:node.getAttribute("name"),label:node.getAttribute("string"),invisible,};}
if(nodeName==="separator"){return{type:"separator"};}
if(nodeName==="filter"){const item={type:"filter",name:node.getAttribute("name"),label:node.getAttribute("string")||node.getAttribute("help"),domain:node.getAttribute("domain"),invisible,};if(node.hasAttribute("context")){const groupBy=getGroupByFieldNameFromString(node.getAttribute("context"));if(groupBy){item.groupBy=groupBy;item.type="groupBy";}}
return item;}}
pushItem(item){this.currentItems.items.push(item);}
changeCategory(category,force){if(this.currentCategory!==category||force){let itemsToPushIn;if(this.currentCategory==="filter"){itemsToPushIn=this.filters;}else if(this.currentCategory==="groupBy"){itemsToPushIn=this.groupBys;}
if(itemsToPushIn){itemsToPushIn.push(this.currentItems);this.currentItems={items:[]};}}
this.currentCategory=category||this.currentCategory;}}
class SearchEditorController extends Component{static props={...standardViewProps,archInfo:{type:Object}};static template="web_studio.SearchEditorController";static components={StudioHook};setup(){this.viewEditorModel=useState(this.env.viewEditorModel);}
get filtersGroups(){return this.props.archInfo.filters;}
hasItems(group){return group.some((g)=>this.getItems(g.items));}
get autoCompleteFields(){return this.props.archInfo.fields;}
get groupByGroups(){return this.props.archInfo.groupBys;}
getItems(items){if(!this.viewEditorModel.showInvisible){return items.filter((i)=>!i.invisible);}
return items;}
getFirstHookProps(type){const xpath="/search";const position="inside";const group=type==="filter"?this.filtersGroups:this.groupByGroups;if(this.hasItems(group)){return false;}
const props={xpath,position,type,};if(type==="groupBy"){props.infos=JSON.stringify({create_group:true,});}
return props;}
getItemLabel(type,item){if(type==="filter"){return item.label;}
if(type==="groupBy"){let label=item.label||item.name;if(this.env.debug){label=`${label} (${item.groupBy})`;}
return label;}
if(type==="field"){let label=item.label||this.props.fields[item.name].string;if(this.env.debug){label=`${label} (${item.name})`;}
return label;}}
onItemClicked(ev,xpath){this.env.config.onNodeClicked(xpath);}}
class SearchComponents extends Component{static props={};static template="web_studio.SearchEditor.Sidebar.Components";get structures(){return{filter:{name:_t("Filter"),class:"o_web_studio_filter",},separator:{name:_t("Separator"),class:"o_web_studio_filter_separator",},};}}
class SimpleElementEditor extends Component{static props={node:{type:Object}};static components={Property,SidebarPropertiesToolbox};static template="web_studio.SearchEditor.SimpleElementEditor";setup(){this.addDialog=useOwnedDialogs();}
get viewEditorModel(){return this.env.viewEditorModel;}
get node(){return this.props.node;}
get label(){if(this.node.type==="field"&&!this.node.label){return this.env.viewEditorModel.fields[this.node.name].string;}
return this.node.label;}
get domain(){if(this.node.type==="filter"){return this.node.domain;}
return null;}
onChangeDomain(value){const operation={new_attrs:{domain:value},type:"attributes",position:"attributes",target:this.viewEditorModel.getFullTarget(this.viewEditorModel.activeNodeXpath),};this.viewEditorModel.doOperation(operation);}
onChangeLabel(value){const operation={new_attrs:{string:value},type:"attributes",position:"attributes",target:this.viewEditorModel.getFullTarget(this.viewEditorModel.activeNodeXpath),};this.viewEditorModel.doOperation(operation);}
onPropertyRemoved(){const activeNodeXpath=this.viewEditorModel.activeNodeXpath;this.viewEditorModel.activeNodeXpath=null;const operation={type:"remove",target:this.viewEditorModel.getFullTarget(activeNodeXpath),};this.viewEditorModel.doOperation(operation);}}
class SearchEditorSidebar extends Component{static template="web_studio.ViewEditor.SearchEditorSidebar";static props={openViewInForm:{type:Function,optional:true},openDefaultValues:{type:Function,optional:true},};static components={InteractiveEditorSidebar,ExistingFields,SearchComponents,Property,SidebarViewToolbox,SimpleElementEditor,};setup(){this.viewEditorModel=useState(this.env.viewEditorModel);const searchArchParser=new SearchEditorArchParser();this._getCurrentNode=memoize(()=>{const{activeNodeXpath,xmlDoc}=this.viewEditorModel;if(!activeNodeXpath){return null;}
const node=getNodesFromXpath(activeNodeXpath,xmlDoc);return searchArchParser.parseNode(node[0]);});}
get currentNode(){const{activeNodeXpath,arch}=this.viewEditorModel;return this._getCurrentNode(`${activeNodeXpath}_${arch}`);}}
const searchEditor={ArchParser:SearchEditorArchParser,Controller:SearchEditorController,props(genericProps,editor,config){const archInfo=new editor.ArchParser().parse(genericProps.arch);return{...genericProps,archInfo};},Sidebar:SearchEditorSidebar,};registry.category("studio_editors").add("search",searchEditor);const FILTER_TYPES=["date","datetime"];const GROUPABLE_TYPES=["many2one","many2many","char","boolean","selection","date","datetime",];function fieldCanBeFilter(field){return FILTER_TYPES.includes(field.type)&&field.store;}
function fieldCanBeGroupable(field){return GROUPABLE_TYPES.includes(field.type)&&field.store;}
const disabledDropClass="o-web-studio-search--drop-disable";searchEditor.isValidHook=function isValidSearchHook({hook,element,viewEditorModel}){if(hook.closest(`.${disabledDropClass}`)){return false;}
return true;};searchEditor.prepareForDrag=function({element,viewEditorModel,ref}){const draggingStructure=element.dataset.structure;switch(draggingStructure){case"field":{const fieldName=JSON.parse(element.dataset.drop).fieldName;const field=viewEditorModel.fields[fieldName];if(!fieldCanBeFilter(field)){ref.el.querySelector(`.o-web-studio-search--filters`).classList.add(disabledDropClass);}
if(!fieldCanBeGroupable(field)){ref.el.querySelector(`.o-web-studio-search--groupbys`).classList.add(disabledDropClass);}
break;}
case"separator":case"filter":{const els=ref.el.querySelectorAll(".o-web-studio-search--fields,.o-web-studio-search--groupbys");els.forEach((el)=>el.classList.add("o-web-studio-search--drop-disable"));break;}}
return()=>{ref.el.querySelectorAll(".o-web-studio-search--drop-disable").forEach((el)=>el.classList.remove("o-web-studio-search--drop-disable"));};};return __exports;});;

/* /web_studio/static/src/client_action/view_editor/editors/sidebar_safe_fields.js */
odoo.define('@web_studio/client_action/view_editor/editors/sidebar_safe_fields',[],function(require){'use strict';let __exports={};const SIDEBAR_SAFE_FIELDS=__exports.SIDEBAR_SAFE_FIELDS=["badge","selection_badge","handle","percentpie","radio","selection","image_url","ace","priority","date","datetime","remaining_days","email","phone","url","binary","image","pdf_viewer","boolean","state_selection","boolean_toggle","statusbar","float","float_time","integer","monetary","percentage","progressbar","text","boolean_favorite","boolean_icon","char","statinfo","html","text_emojis","CopyClipboardChar","CopyClipboardText","CopyClipboardURL","char_emojis","many2many_tags","many2one","many2many","one2many","sms_widget","reference","daterange",];return __exports;});;

/* /web_studio/static/src/client_action/view_editor/editors/utils.js */
odoo.define('@web_studio/client_action/view_editor/editors/utils',['@web/core/utils/arrays','@web/core/registry','@web_studio/client_action/view_editor/editors/sidebar_safe_fields'],function(require){'use strict';let __exports={};const{sortBy}=require("@web/core/utils/arrays");const{registry}=require("@web/core/registry");const{SIDEBAR_SAFE_FIELDS}=require("@web_studio/client_action/view_editor/editors/sidebar_safe_fields");const hookPositionTolerance=__exports.hookPositionTolerance=50;__exports.cleanHooks=cleanHooks;function cleanHooks(el){for(const hookEl of el.querySelectorAll(".o_web_studio_nearest_hook")){hookEl.classList.remove("o_web_studio_nearest_hook");}}
__exports.getActiveHook=getActiveHook;function getActiveHook(el){return el.querySelector(".o_web_studio_nearest_hook");}
__exports.isToXpathEquivalentFromXpath=isToXpathEquivalentFromXpath;function isToXpathEquivalentFromXpath(position,toXpath,fromXpath){if(toXpath===fromXpath){return true;}
const toParts=toXpath.split("/");const fromParts=fromXpath.split("/");if(toParts.slice(0,-1).join("/")!==fromParts.slice(0,-1).join("/")){return false;}
const nodeIdxRegExp=/(\w+)(\[(\d+)\])?/;const toMatch=toParts[toParts.length-1].match(nodeIdxRegExp);const fromMatch=fromParts[fromParts.length-1].match(nodeIdxRegExp);if(fromMatch[1]!==toMatch[1]){return false;}
if(position==="after"&&parseInt(toMatch[3]||1)+1===parseInt(fromMatch[3]||1)){return true;}
return false;}
__exports.getHooks=getHooks;function getHooks(el){return[...el.querySelectorAll(".o_web_studio_hook")];}
__exports.randomName=randomName;function randomName(baseName){const random=Math.floor(Math.random()*10000).toString(32)+"_"+Number(new Date()).toString(32);return`${baseName}_${random}`;}
__exports.studioIsVisible=studioIsVisible;function studioIsVisible(props){return props.studioIsVisible!==undefined?props.studioIsVisible:true;}
__exports.cleanClickedElements=cleanClickedElements;function cleanClickedElements(mainEl){for(const el of mainEl.querySelectorAll(".o-web-studio-editor--element-clicked")){el.classList.remove("o-web-studio-editor--element-clicked");}}
__exports.useStudioRef=useStudioRef;function useStudioRef(refName="studioRef",onClick){const comp=owl.useComponent();const ref=owl.useRef(refName);owl.useEffect((el)=>{if(el){el.setAttribute("data-studio-xpath",comp.props.studioXpath);}},()=>[ref.el]);if(onClick){const handler=onClick.bind(comp);owl.useEffect((el)=>{if(el){el.addEventListener("click",handler,{capture:true});return()=>{el.removeEventListener("click",handler);};}},()=>[ref.el]);}}
__exports.makeModelErrorResilient=makeModelErrorResilient;function makeModelErrorResilient(ModelClass){function logError(debug){if(!debug){return;}
console.warn("The onchange triggered an error. It may indicate either a faulty call to onchange, or a faulty model python side");}
if("_trigger_up"in ModelClass.prototype){return class ResilientModel extends ModelClass{_trigger_up(ev){const evType=ev.name;const payload=ev.data;if(evType==="call_service"&&payload.service==="ajax"&&payload.method==="rpc"){const args=payload.args||[];if(args[1]&&args[1].method==="onchange"){const _callback=payload.callback;payload.callback=(prom)=>{_callback(prom.catch((e)=>{logError(this.env.debug);return Promise.resolve({});}));};}}
return super._trigger_up(ev);}};}
return class ResilientModel extends ModelClass{setup(){super.setup(...arguments);const orm=this.orm;const debug=this.env.debug;this.orm=Object.assign(Object.create(orm),{async call(model,method){if(method==="onchange"){try{return await orm.call.call(orm,...arguments);}catch{logError(debug);}
return{};}
return orm.call.call(orm,...arguments);},});}};}
__exports.getWowlFieldWidgets=getWowlFieldWidgets;function getWowlFieldWidgets(fieldType,currentKey="",blacklistedKeys=[],debug=false){const wowlFieldRegistry=registry.category("fields");const widgets=[];for(const[widgetKey,Component]of wowlFieldRegistry.getEntries()){if(widgetKey!==currentKey){if(!Component.supportedTypes||!Component.supportedTypes.includes(fieldType)){continue;}
if(widgetKey.includes(".")||blacklistedKeys.includes(widgetKey)){continue;}
if(!debug&&!SIDEBAR_SAFE_FIELDS.includes(widgetKey)){continue;}}
widgets.push([widgetKey,Component.displayName]);}
return sortBy(widgets,(el)=>el[1]||el[0]);}
__exports.xpathToLegacyXpathInfo=xpathToLegacyXpathInfo;function xpathToLegacyXpathInfo(xpath){const xpathInfo=[];const matches=xpath.matchAll(/\/?(\w+)(\[(\d+)\])?/g);for(const m of matches){const info={tag:m[1],indice:parseInt(m[3]||1),};xpathInfo.push(info);}
return xpathInfo;}
__exports.fieldsToChoices=fieldsToChoices;function fieldsToChoices(fields,filterCallback=undefined){let values=Object.values(fields);if(filterCallback){values=values.filter(filterCallback);}
return values.map((field)=>({label:odoo.debug?`${field.string} (${field.name})`:field.string||field.name,value:field.name,}));}
__exports.getStudioNoFetchFields=getStudioNoFetchFields;function getStudioNoFetchFields(_fieldNodes){const fieldNames=[];const fieldNodes=[];Object.entries(_fieldNodes).filter(([fNode,field])=>field.attrs&&field.attrs.studio_no_fetch).forEach(([fNode,field])=>{fieldNames.push(field.name);fieldNodes.push(fNode);});return{fieldNames,fieldNodes,};}
return __exports;});;

/* /web_studio/static/src/client_action/view_editor/editors/xml_utils.js */
odoo.define('@web_studio/client_action/view_editor/editors/xml_utils',['@web/core/py_js/py','@web/views/view_compiler'],function(require){'use strict';let __exports={};const{evaluateExpr}=require("@web/core/py_js/py");const{isComponentNode,appendAttr}=require("@web/views/view_compiler");const nodeWeak=new WeakMap();__exports.countPreviousSiblings=countPreviousSiblings;function countPreviousSiblings(node){const countXpath=`count(preceding-sibling::${node.tagName})`;return node.ownerDocument.evaluate(countXpath,node,null,XPathResult.NUMBER_TYPE).numberValue;}
__exports.computeXpath=computeXpath;function computeXpath(node,upperBoundSelector="form"){if(nodeWeak.has(node)){return nodeWeak.get(node);}
const tagName=node.tagName;const count=countPreviousSiblings(node)+1;let xpath=`${tagName}[${count}]`;const parent=node.parentElement;if(!node.matches(upperBoundSelector)){const parentXpath=computeXpath(parent,upperBoundSelector);xpath=`${parentXpath}/${xpath}`;}else{xpath=`/${xpath}`;}
nodeWeak.set(node,xpath);return xpath;}
__exports.getNodeAttributes=getNodeAttributes;function getNodeAttributes(node){const attrs={};for(const att of node.getAttributeNames()){if(["modifiers","options"].includes(att)){attrs[att]=evaluateExpr(node.getAttribute(att));continue;}
attrs[att]=node.getAttribute(att);}
return attrs;}
function getXpathNodes(xpathResult){const nodes=[];let res;while((res=xpathResult.iterateNext())){nodes.push(res);}
return nodes;}
__exports.getNodesFromXpath=getNodesFromXpath;function getNodesFromXpath(xpath,xml){const owner="evaluate"in xml?xml:xml.ownerDocument;const xpathResult=owner.evaluate(xpath,xml,null,XPathResult.ORDERED_NODE_ITERATOR_TYPE);return getXpathNodes(xpathResult);}
const parser=new DOMParser();const parseStringToXml=__exports.parseStringToXml=(str)=>{return parser.parseFromString(str,"text/xml");};const serializer=new XMLSerializer();const serializeXmlToString=__exports.serializeXmlToString=(xml)=>{return serializer.serializeToString(xml);};__exports.applyInvisible=applyInvisible;function applyInvisible(invisible,compiled,params){if(!invisible){return compiled;}
let isVisileExpr;if(typeof invisible!=="boolean"){const recordExpr=params.recordExpr||"__comp__.props.record";isVisileExpr=`!__comp__.evalDomainFromRecord(${recordExpr},${JSON.stringify(invisible)})`;if(isComponentNode(compiled)){compiled.setAttribute("studioIsVisible",isVisileExpr);}else{appendAttr(compiled,"class",`o_web_studio_show_invisible:!${isVisileExpr}`);}}else{if(isComponentNode(compiled)){compiled.setAttribute("studioIsVisible","false");}else{appendAttr(compiled,"class",`o_web_studio_show_invisible:true`);}}
const studioShowExpr=`__comp__.viewEditorModel.showInvisible`;isVisileExpr=isVisileExpr?`(${isVisileExpr} or ${studioShowExpr})`:studioShowExpr;if(compiled.hasAttribute("t-if")){const formerTif=compiled.getAttribute("t-if");isVisileExpr=`( ${formerTif} ) and ${isVisileExpr}`;}
compiled.setAttribute("t-if",isVisileExpr);return compiled;}
return __exports;});;

/* /web_studio/static/src/client_action/view_editor/interactive_editor/field_configuration/field_configuration.js */
odoo.define('@web_studio/client_action/view_editor/interactive_editor/field_configuration/field_configuration',['@odoo/owl','@web/core/dialog/dialog','@web/core/confirmation_dialog/confirmation_dialog','@web/views/fields/many2one/many2one_field','@web/views/record','@web/core/model_field_selector/model_field_selector','@web_studio/client_action/utils','@web/core/utils/hooks','@web/session','@web/core/l10n/translation','@web/core/utils/strings','@web/core/domain_selector/domain_selector','@web_studio/client_action/view_editor/interactive_editor/field_configuration/selection_content_dialog'],function(require){'use strict';let __exports={};const{Component,useState,useSubEnv}=require("@odoo/owl");const{Dialog}=require("@web/core/dialog/dialog");const{ConfirmationDialog}=require("@web/core/confirmation_dialog/confirmation_dialog");const{Many2OneField}=require("@web/views/fields/many2one/many2one_field");const{Record}=require("@web/views/record");const{ModelFieldSelector}=require("@web/core/model_field_selector/model_field_selector");const{useDialogConfirmation}=require("@web_studio/client_action/utils");const{useOwnedDialogs,useService}=require("@web/core/utils/hooks");const{session}=require("@web/session");const{_t}=require("@web/core/l10n/translation");const{sprintf}=require("@web/core/utils/strings");const{DomainSelector}=require("@web/core/domain_selector/domain_selector");const{SelectionContentDialog}=require("@web_studio/client_action/view_editor/interactive_editor/field_configuration/selection_content_dialog");__exports.getCurrencyField=getCurrencyField;function getCurrencyField(fieldsGet){const field=Object.entries(fieldsGet).find(([fName,fInfo])=>{return(fInfo.type==="many2one"&&fInfo.relation==="res.currency"&&(fName==="currency_id"||fName==="x_currency_id"));});if(field){return field[0];}}
const SelectionValuesEditor=__exports.SelectionValuesEditor=class SelectionValuesEditor extends Component{static components={SelectionContentDialog,};static props={configurationModel:{type:Object},confirm:{type:Function},cancel:{type:Function},};static template="web_studio.SelectionValuesEditor";static Model=class SelectionValuesModel{constructor(){this.selection="[]";}
get isValid(){return true;}};get selection(){return JSON.parse(this.props.configurationModel.selection);}
onConfirm(choices){this.props.configurationModel.selection=JSON.stringify(choices);this.props.confirm();}}
const RelationalFieldConfigurator=__exports.RelationalFieldConfigurator=class RelationalFieldConfigurator extends Component{static template="web_studio.RelationalFieldConfigurator";static components={Record,Many2OneField};static props={configurationModel:{type:Object},resModel:{type:String},fieldType:{type:String},};static Model=class RelationalFieldModel{constructor(){this.relationId=false;}
get isValid(){return!!this.relationId;}};setup(){this.state=useState(this.props.configurationModel);const relationId={type:"many2one",context:{},};if(this.fieldType==="one2many"){relationId.relation="ir.model.fields";relationId.domain=[["relation","=",this.props.resModel],["ttype","=","many2one"],["model_id.abstract","=",false],['store','=',true],];}else{relationId.relation="ir.model";relationId.domain=[["transient","=",false],["abstract","=",false],];}
this.activeFields={relationId};const state=this.state;this.recordProps={activeFields:this.activeFields,fields:this.activeFields,get values(){return{relationId:state.relationId,};},onRecordChanged:(rec)=>{this.state.relationId=rec.data.relationId;},};}
get fieldType(){return this.props.fieldType;}}
class RelatedChainBuilderModel{static services=["field","dialog"];constructor({services,props}){this.services=services;this.relatedParams={};this.fieldInfo={resModel:props.resModel,fieldDef:null};this.shouldOpenCurrencyDialog=props.shouldOpenCurrencyDialog;this.resModel=props.resModel;}
get isValid(){return!!this.relatedParams.related;}
getRelatedFieldDescription(resModel,lastField){const fieldType=lastField.type;const relatedDescription={readonly:true,copy:false,string:lastField.string,type:fieldType,store:["one2many","many2many"].includes(fieldType)?false:lastField.store,};if(["many2one","many2many","one2many"].includes(fieldType)){relatedDescription.relation=lastField.relation;}
if(["one2many","many2many"].includes(fieldType)){relatedDescription.relational_model=resModel;}
if(fieldType==="selection"){relatedDescription.selection=lastField.selection;}
return relatedDescription;}
async confirm(){const relatedDescription=this.getRelatedFieldDescription(this.fieldInfo.resModel,this.fieldInfo.fieldDef);if(this.shouldOpenCurrencyDialog&&relatedDescription.type==="monetary"){const currencyDescription=await openCurrencyConfirmDialog(this.services.dialog.add,this.resModel);if(!currencyDescription){return false;}
const relatedCurrencyField=await this.getRelatedCurrencyField(this.fieldInfo.resModel);if(relatedCurrencyField){currencyDescription.related=relatedCurrencyField;}else{currencyDescription.related="";}
Object.assign(this.relatedParams,currencyDescription);return true;}else{Object.assign(this.relatedParams,relatedDescription);return true;}}
async getRelatedCurrencyField(resModel){const fields=await this.services.field.loadFields(resModel);const currencyField=getCurrencyField(fields);if(!currencyField){return null;}
const chainSplit=this.relatedParams.related.split(".");chainSplit.splice(chainSplit.length-1,1,currencyField);return chainSplit.join(".");}}
const RelatedChainBuilder=__exports.RelatedChainBuilder=class RelatedChainBuilder extends Component{static template=owl.xml`<ModelFieldSelector resModel="props.resModel" path="fieldChain" readonly="false" filter.bind="filter" update.bind="updateChain" />`;static components={ModelFieldSelector};static props={resModel:{type:String},configurationModel:{type:Object},shouldOpenCurrencyDialog:{type:Boolean},};static Model=RelatedChainBuilderModel;setup(){this.state=useState(this.props.configurationModel);this.relatedParams.related="";}
get relatedParams(){return this.state.relatedParams;}
get fieldChain(){return this.relatedParams.related;}
filter(fieldDef,path){if(!path){return fieldDef.type==="many2one";}
return fieldDef.type!=="properties";}
async updateChain(path,fieldInfo){this.relatedParams.related=path;this.state.fieldInfo=fieldInfo;}}
function useConfiguratorModel(Model,props){const services=Object.fromEntries((Model.services||[]).map((servName)=>{let serv;if(servName==="dialog"){serv={add:useOwnedDialogs()};}else{serv=useService(servName);}
return[servName,serv];}));const model=new Model({services,props});return useState(model);}
const FieldConfigurationDialog=__exports.FieldConfigurationDialog=class FieldConfigurationDialog extends Component{static props={confirm:{type:Function},cancel:{type:Function},close:{type:Function},env:{type:Object},Component:{type:Function},componentProps:{type:Object,optional:true},fieldType:{type:String,optional:true},isDialog:{type:Boolean,optional:true},title:{type:String,optional:true},size:{type:String,optional:true},};static template="web_studio.FieldConfigurationDialog";static components={Dialog};setup(){useSubEnv(this.props.env);useSubEnv({services:this.props.env.services,bus:this.props.env.bus});const{confirm,cancel}=useDialogConfirmation({confirm:async()=>{let confirmValues=false;if(!this.configurationModel.isValid){return false;}
if(this.configurationModel.confirm){const res=await this.configurationModel.confirm();if(res||res===undefined){confirmValues=this.configurationModel;}}else{confirmValues=this.configurationModel;}
return this.props.confirm(confirmValues);},cancel:()=>this.props.cancel(),});this.confirm=confirm;this.cancel=cancel;this.configurationModel=useConfiguratorModel(this.Component.Model,this.props.componentProps);}
get title(){if(this.props.title){return this.props.title;}
if(this.props.fieldType){return sprintf(_t("Field properties: %s"),this.props.fieldType);}
return"";}
get Component(){return this.props.Component;}
get canConfirm(){return this.configurationModel.isValid;}}
__exports.openCurrencyConfirmDialog=openCurrencyConfirmDialog;function openCurrencyConfirmDialog(add,resModel){const currencyFieldDescription={default_value:session.company_currency_id,field_description:"Currency",model_name:resModel,name:"x_currency_id",relation:"res.currency",type:"many2one",};return new Promise((resolve,reject)=>{add(ConfirmationDialog,{body:_t(`In order to use a monetary field, you need a currency field on the model. Do you want to create a currency field first? You can make this field invisible afterwards.`),confirm:()=>{resolve(currencyFieldDescription);},cancel:()=>resolve(false),});});}
const FilterConfiguration=__exports.FilterConfiguration=class FilterConfiguration extends Component{static components={DomainSelector};static template="web_studio.FilterConfiguration";static props={resModel:{type:String},configurationModel:{type:Object},};static Model=class FilterConfigurationModel{constructor(){this.filterLabel="";this.domain="[]";}
get isValid(){return!!this.filterLabel;}};setup(){this.state=useState(this.props.configurationModel);}
get domainSelectorProps(){return{resModel:this.props.resModel,readonly:false,domain:this.state.domain,update:(domainStr)=>{this.state.domain=domainStr;},isDebugMode:!!this.env.debug,};}}
return __exports;});;

/* /web_studio/static/src/client_action/view_editor/interactive_editor/field_configuration/selection_content_dialog.js */
odoo.define('@web_studio/client_action/view_editor/interactive_editor/field_configuration/selection_content_dialog',['@web/core/dialog/dialog','@web/core/l10n/translation','@web/core/utils/sortable','@odoo/owl'],function(require){'use strict';let __exports={};const{Dialog}=require("@web/core/dialog/dialog");const{_t}=require("@web/core/l10n/translation");const{useSortable}=require("@web/core/utils/sortable");const{Component,useRef,useState}=require("@odoo/owl");const SelectionContentDialog=__exports.SelectionContentDialog=class SelectionContentDialog extends Component{static components={Dialog,};static defaultProps={defaultChoices:[],};static props={defaultChoices:{type:Array,optional:true},onConfirm:{type:Function},close:{type:Function},};static template="web_studio.SelectionContentDialog";setup(){this.state=useState({choices:this.props.defaultChoices,});this.localState=useState({_newItem:[],editedItem:null,});const itemsList=useRef("itemsList");useSortable({enable:()=>!this.editedItem,handle:".o-draggable-handle",ref:itemsList,elements:".o-draggable",cursor:"move",onDrop:(params)=>this.resequenceItems(params),});this.oldValue=new WeakMap();}
getSelectionFromItem(item){if(item.id==="new"){return this.localState._newItem;}
return this.selection[item.id];}
get selection(){return this.state.choices;}
set selection(items){this.state.choices=items;}
get title(){return _t("Field Properties");}
selectionToItem(selection,params={}){return Object.assign({id:"new",key:selection[0],name:selection[0],label:selection[1],isDraggable:false,isRemovable:false,isInEdition:false,},params);}
get selectionToItems(){const inEdition=!!this.editedItem;return this.selection.map((sel,index)=>{return this.selectionToItem(sel,{id:index,key:inEdition?index:sel[0],isInEdition:this.editedItem?.id===this.selection.indexOf(sel)&&!this.shouldFullEdit,isDraggable:!inEdition,isRemovable:!inEdition,});});}
get newItem(){return this.selectionToItem(this.localState._newItem,{isInEdition:true,id:"new"});}
get editedItem(){return this.localState.editedItem;}
get shouldFullEdit(){return Boolean(this.env.debug);}
ensureUnique(item){const value=item[0];if(!value){return false;}
const otherElements=this.selection.filter((i)=>i!==item);if(otherElements.some((i)=>i[0]===value)){return false;}
return true;}
setItemValue(item,value){if(item.id!=="new"&&item.id!==this.editedItem.id){return;}
const isEditingLabel=item.id!=="new";item=this.getSelectionFromItem(item);item[0]=isEditingLabel?this.editedItem.name:value;item[1]=value;}
addItem(item){if(!this.ensureUnique(item)){return;}
this.selection.push(item);this.localState._newItem=[];}
removeItem(item){this.selection=this.selection.filter((i)=>i[0]!==item.name);}
editItem(item){const selItem=this.getSelectionFromItem(item);if(item.id==="new"){return this.addItem(selItem);}
if(this.editedItem?.id===item.id){if(!this.ensureUnique(selItem)){return;}
this.localState.editedItem=null;this.oldValue.delete(selItem);return;}
this.oldValue.set(selItem,[...selItem]);this.localState.editedItem=item;}
discardItemChanges(item){if(item.id==="new"){return this.setItemValue(item,"");}
const selItem=this.getSelectionFromItem(item);const oldValue=this.oldValue.get(selItem);selItem[0]=oldValue[0];selItem[1]=oldValue[1];this.localState.editedItem=null;}
resequenceItems(params){const{previous,next,element}=params;const itemId=parseInt(element.dataset.itemId);let items=this.selection;const item=items[itemId];items=items.filter((i)=>i!==item);let toIndex;if(previous){toIndex=parseInt(previous.dataset.itemId)+1;}else if(next){toIndex=parseInt(next.dataset.itemId);}
items.splice(toIndex,0,item);this.selection=items;}
async onConfirm(){if(this.newItem.name?.length){this.editItem(this.newItem);}
await this.props.onConfirm(this.selection);this.props.close();}
onKeyPressed(item,key){if(key==="Enter"){this.editItem(item);}}}
return __exports;});;

/* /web_studio/static/src/client_action/view_editor/interactive_editor/interactive_editor.js */
odoo.define('@web_studio/client_action/view_editor/interactive_editor/interactive_editor',['@odoo/owl','@web/core/utils/ui','@web/core/utils/draggable','@web/core/utils/hooks','@web/core/l10n/translation','@web/core/utils/strings','@web_studio/client_action/view_editor/editors/utils','@web/core/confirmation_dialog/confirmation_dialog','@web_studio/client_action/view_editor/interactive_editor/field_configuration/field_configuration','@web_studio/client_action/view_editor/editors/xml_utils','@web_studio/client_action/view_editor/default_view_sidebar/default_view_sidebar'],function(require){'use strict';let __exports={};const{Component,toRaw}=require("@odoo/owl");const{closest,touching}=require("@web/core/utils/ui");const{useDraggable}=require("@web/core/utils/draggable");const{useOwnedDialogs,useService}=require("@web/core/utils/hooks");const{_lt,_t}=require("@web/core/l10n/translation");const{sprintf}=require("@web/core/utils/strings");const{isToXpathEquivalentFromXpath,cleanHooks,getActiveHook,getHooks,hookPositionTolerance,randomName,}=require("@web_studio/client_action/view_editor/editors/utils");const{ConfirmationDialog}=require("@web/core/confirmation_dialog/confirmation_dialog");const{FieldConfigurationDialog,SelectionValuesEditor,RelationalFieldConfigurator,RelatedChainBuilder,getCurrencyField,openCurrencyConfirmDialog,FilterConfiguration,}=require("@web_studio/client_action/view_editor/interactive_editor/field_configuration/field_configuration");const{getNodesFromXpath,countPreviousSiblings,}=require("@web_studio/client_action/view_editor/editors/xml_utils");const{DefaultViewSidebar}=require("@web_studio/client_action/view_editor/default_view_sidebar/default_view_sidebar");const NO_M2O_AVAILABLE=_lt(`
    There are no many2one fields related to the current model.
    To create a one2many field on the current model, you must first create its many2one counterpart on the model you want to relate to.
`);function copyElementOnDrag(){let element;let copy;function clone(_element){element=_element;copy=element.cloneNode(true);}
function insert(){if(element){element.insertAdjacentElement("beforebegin",copy);}}
function clean(){if(copy){copy.remove();}
copy=null;element=null;}
return{clone,insert,clean};}
const InteractiveEditor=__exports.InteractiveEditor=class InteractiveEditor extends Component{static template="web_studio.InteractiveEditor";static components={};static props={editor:true,slots:{type:Object},editorContainerRef:{type:Object},rendererRef:{type:Object},};setup(){this.defaultSidebar=DefaultViewSidebar;this.action=useService("action");this.orm=useService("orm");this.addDialog=useOwnedDialogs();this.notification=useService("notification");const getNearestHook=this.getNearestHook.bind(this);const prepareForDrag=this.props.editor.prepareForDrag;const isValidHook=this.props.editor.isValidHook||(()=>true);const styleNearestHook=this.props.editor.styleNearestHook||((ref,hook)=>{hook.classList.add("o_web_studio_nearest_hook");});function removeBootStrapClasses(element){const bootstrapClasses=Array.from(element.classList).filter((c)=>c.startsWith("position-")||c.startsWith("w-")||c.startsWith("h-"));if(!bootstrapClasses.length){return()=>{};}
element.classList.remove(...bootstrapClasses);return()=>{element.classList.add(...bootstrapClasses);};}
let cleanUps;const copyOnDrag=copyElementOnDrag();useDraggable({ref:this.props.editorContainerRef,elements:".o-draggable",onWillStartDrag:({element})=>{cleanUps=[];if(element.closest(".o_web_studio_component")){copyOnDrag.clone(element);}},onDragStart:({element})=>{cleanUps.push(removeBootStrapClasses(element));copyOnDrag.insert();if(prepareForDrag){cleanUps.push(prepareForDrag({element,viewEditorModel:this.viewEditorModel,ref:this.props.editorContainerRef,}));}},onDrag:({x,y,element})=>{cleanHooks(this.viewRef.el);element.classList.remove("o-draggable--drop-ready");const hook=getNearestHook(element,{x,y});if(!hook){return;}
if(!isValidHook({hook,element,viewEditorModel:this.viewEditorModel})){return;}
styleNearestHook(this.props.rendererRef,hook);element.classList.add("o-draggable--drop-ready");},onDrop:({element})=>{const targetHook=getActiveHook(this.viewRef.el);if(!targetHook){return;}
const{xpath,position,type,infos}=targetHook.dataset;const droppedData=element.dataset;const isNew=element.classList.contains("o_web_studio_component");const structure=isNew?droppedData.structure:"field";if(isNew){this.addStructure(structure,droppedData.drop,{xpath,position,type,infos,});}else{this.moveStructure(structure,droppedData,{xpath,position});}},onDragEnd:({element})=>{cleanHooks(this.viewRef.el);if(cleanUps){cleanUps.forEach((c)=>c());cleanUps=null;}
copyOnDrag.clean();},});this.applyAutoClick=()=>{if(!this.autoClick){return;}
const{targetInfo,tag,attrs}=this.autoClick;let xpathToClick=targetInfo.xpath;if(tag){if(targetInfo.position!=="inside"){xpathToClick=xpathToClick.split("/").slice(0,-1).join("/");}
const attrForXpath=Object.entries(attrs).filter(([,value])=>!!value).map(([attName,value])=>{return`@${attName}='${value}'`;}).join(" and ");const nodeXpath=`${tag}[${attrForXpath}]`;const fullXpath=`${xpathToClick}/${nodeXpath}`;const nodes=getNodesFromXpath(fullXpath,toRaw(this.viewEditorModel).xmlDoc);this.autoClick=null;if(nodes.length!==1){return;}
const atPosition=countPreviousSiblings(nodes[0])+1;xpathToClick=`${xpathToClick}/${tag}[${atPosition}]`;}
const domEl=this.props.rendererRef.el.querySelector(`[data-studio-xpath='${xpathToClick}'], [studioxpath='${xpathToClick}']`);if(domEl){domEl.click();}};}
get viewEditorModel(){return this.env.viewEditorModel;}
get viewRef(){return this.viewEditorModel.viewRef;}
getNearestHook(draggedEl,{x,y}){const viewRefEl=this.viewRef.el;cleanHooks(viewRefEl);const mouseToleranceRect={x:x-hookPositionTolerance,y:y-hookPositionTolerance,width:hookPositionTolerance*2,height:hookPositionTolerance*2,};const touchingEls=touching(getHooks(viewRefEl),mouseToleranceRect);const closestHookEl=closest(touchingEls,{x,y});return closestHookEl;}
openViewInForm(){return this.action.doAction({type:"ir.actions.act_window",res_model:"ir.ui.view",res_id:this.env.viewEditorModel.mainView.id,views:[[false,"form"]],target:"current",},{clearBreadcrumbs:true});}
openDefaultValues(){const resModel=this.env.viewEditorModel.resModel;this.action.doAction({name:_t("Default Values"),type:"ir.actions.act_window",res_model:"ir.default",target:"current",views:[[false,"list"],[false,"form"],],domain:[["field_id.model","=",resModel]],},{clearBreadcrumbs:true});}
setAutoClick(targetInfo,nodeDescr){if(!targetInfo){this.autoClick=null;return;}
if(targetInfo&&!nodeDescr){this.autoClick={targetInfo,};return;}
let nameAttr=nodeDescr.attrs.name;if(nodeDescr.tag==="field"&&!nameAttr){nameAttr=nodeDescr.field_description.name;}
this.autoClick={targetInfo,tag:nodeDescr.tag,attrs:{name:nameAttr},};}
async addField(droppedData,targetInfo){const data=JSON.parse(droppedData);const isExistingField="fieldName"in data;let newNode;if(!isExistingField){newNode=await this.getNewFieldNode(data);}else{newNode={tag:"field",attrs:{name:data.fieldName},};}
if(!newNode){return;}
if(!isExistingField){this.viewEditorModel.setRenameableField(newNode.field_description?.name,true);}
if(this.viewEditorModel.viewType==="kanban"){newNode.attrs.display="full";}
if(this.viewEditorModel.viewType==="list"){newNode.attrs.optional="show";}
const operation={node:newNode,target:this.viewEditorModel.getFullTarget(targetInfo.xpath),position:targetInfo.position,type:"add",};this.setAutoClick(targetInfo,newNode);return this.viewEditorModel.doOperation(operation);}
async addStructure(structure,droppedData,targetInfo){if(structure==="field"&&!["groupBy","filter"].includes(targetInfo.type)){return this.addField(droppedData,targetInfo);}
if(["notebook","group","separator"].includes(structure)){const operation={node:{tag:structure,attrs:{name:randomName(`studio_${structure}`),},},target:this.viewEditorModel.getFullTarget(targetInfo.xpath),position:targetInfo.position,type:"add",};this.setAutoClick(targetInfo,operation.node);return this.viewEditorModel.doOperation(operation);}
if(structure==="filter"){const filterData=await new Promise((resolve)=>{this.addDialog(FieldConfigurationDialog,{env:this.env,title:_t("New Filter"),size:"md",confirm:(data)=>resolve(data),cancel:()=>resolve(false),Component:FilterConfiguration,componentProps:{resModel:this.viewEditorModel.resModel},});});if(!filterData){return;}
const node={tag:"filter",attrs:{domain:filterData.domain,name:randomName("studio_filter"),string:filterData.filterLabel,},};const operation={node,target:this.viewEditorModel.getFullTarget(targetInfo.xpath),position:targetInfo.position,type:"add",};this.setAutoClick(targetInfo,operation.node);return this.viewEditorModel.doOperation(operation);}
if(this.viewEditorModel.viewType==="search"&&structure==="field"&&["groupBy","filter"].includes(targetInfo.type)){const fieldName=JSON.parse(droppedData).fieldName;const fieldGet=this.viewEditorModel.fields[fieldName];const willBeGroupBy=targetInfo.type==="groupBy";const node={tag:"filter",attrs:{name:randomName(`studio_${willBeGroupBy ? "group" : "filter"}_by`),string:fieldGet.string,},};if(willBeGroupBy){node.attrs.context=`{'group_by': '${fieldName}'}`;if(targetInfo.infos&&JSON.parse(targetInfo.infos).create_group){node.attrs.create_group=true;}}else{node.attrs.date=fieldName;}
const operation={node,target:this.viewEditorModel.getFullTarget(targetInfo.xpath),position:targetInfo.position,type:"add",};this.setAutoClick(targetInfo,operation.node);return this.viewEditorModel.doOperation(operation);}}
async getNewFieldNode(data){const string=sprintf(_t("New %s"),data.string);const newNode={field_description:{field_description:string,name:randomName(`x_studio_${data.fieldType}_field`),type:data.fieldType,model_name:this.viewEditorModel.resModel,special:data.special,},tag:"field",attrs:{widget:data.widget},};if(data.special==="lines"){return newNode;}
const fieldType=data.fieldType;if(fieldType==="selection"&&data.widget==="priority"){newNode.field_description.selection=[["0","Normal"],["1","Low"],["2","High"],["3","Very High"],];return newNode;}
if(["selection","one2many","many2one","many2many","related"].includes(fieldType)){if(fieldType==="one2many"){const count=await this.orm.searchCount("ir.model.fields",[["relation","=",this.viewEditorModel.resModel],["ttype","=","many2one"],['store','=',true]]);if(!count){this.addDialog(ConfirmationDialog,{title:_t("No related many2one fields found"),body:NO_M2O_AVAILABLE,confirm:async()=>{},});return;}}
const fieldParams=await this.openFieldConfiguration(fieldType);if(!fieldParams){return;}
if(fieldType==="selection"){newNode.field_description.selection=fieldParams.selection;}
if(fieldType==="one2many"){newNode.field_description.relation_field_id=fieldParams.relationId[0];}
if(fieldType==="many2many"||fieldType==="many2one"){newNode.field_description.relation_id=fieldParams.relationId[0];}
if(fieldType==="related"){Object.assign(newNode.field_description,fieldParams.relatedParams);if(!newNode.field_description.related){delete newNode.field_description.related;}}}
if(fieldType==="monetary"){if(!this.hasCurrencyField()){const currencyDescription=await openCurrencyConfirmDialog(this.addDialog,this.viewEditorModel.resModel);if(!currencyDescription){return;}
Object.assign(newNode.field_description,currencyDescription);}}
if(fieldType==="integer"){newNode.field_description.default_value="0";}
return newNode;}
openFieldConfiguration(fieldType){let dialogProps;if(fieldType==="selection"){dialogProps={Component:SelectionValuesEditor,isDialog:true,};}else if(["one2many","many2many","many2one"].includes(fieldType)){dialogProps={Component:RelationalFieldConfigurator,componentProps:{fieldType,resModel:this.viewEditorModel.resModel},};}else if(fieldType==="related"){dialogProps={Component:RelatedChainBuilder,componentProps:{resModel:this.viewEditorModel.resModel,shouldOpenCurrencyDialog:!this.hasCurrencyField(),},};}
const fieldParams=new Promise((resolve,reject)=>{this.addDialog(FieldConfigurationDialog,{env:this.env,fieldType,confirm:async(params)=>{resolve(params);},cancel:()=>resolve(false),...dialogProps,});});return fieldParams;}
moveStructure(structure,droppedData,targetInfo){if(structure!=="field"){throw Error("Moving anything else than a field is not supported");}
if(isToXpathEquivalentFromXpath(targetInfo.position,targetInfo.xpath,droppedData.studioXpath)){return;}
const operation={type:"move",node:this.viewEditorModel.getFullTarget(droppedData.studioXpath),target:this.viewEditorModel.getFullTarget(targetInfo.xpath),position:targetInfo.position,};const subViewXpath=this.viewEditorModel.getSubviewXpath();if(subViewXpath){operation.node.subview_xpath=subViewXpath;}
if(this.viewEditorModel.activeNodeXpath===droppedData.studioXpath){this.setAutoClick(targetInfo,operation.node);}
this.viewEditorModel.doOperation(operation);}
hasCurrencyField(){return getCurrencyField(this.viewEditorModel.fields);}}
return __exports;});;

/* /web_studio/static/src/client_action/view_editor/interactive_editor/interactive_editor_sidebar.js */
odoo.define('@web_studio/client_action/view_editor/interactive_editor/interactive_editor_sidebar',['@web/core/l10n/translation','@odoo/owl','@web/core/notebook/notebook','@web/core/utils/hooks'],function(require){'use strict';let __exports={};const{_lt}=require("@web/core/l10n/translation");const{onWillStart,useState,onWillUpdateProps}=require("@odoo/owl");const{Notebook}=require("@web/core/notebook/notebook");const{useBus}=require("@web/core/utils/hooks");const tabsDisplay={new:{class:"o_web_studio_new px-2",title:_lt("Add"),},view:{class:"o_web_studio_view px-2",title:_lt("View"),},properties:{class:"o_web_studio_properties px-2",title:_lt("Properties"),},};const InteractiveEditorSidebar=__exports.InteractiveEditorSidebar=class InteractiveEditorSidebar extends owl.Component{static components={Notebook};static template="web_studio.ViewEditor.InteractiveEditorSidebar";static props={slots:{type:Object},};setup(){this.editorModel=useState(this.env.viewEditorModel);this.tabsDisplay=tabsDisplay;useBus(this.editorModel.bus,"error",()=>this.render(true));this._defaultTab=this.computeDefaultTab(this.props);this.editorModel.sidebarTab=this._defaultTab;onWillStart(()=>{this.editorModel.resetSidebar();});onWillUpdateProps(()=>{const editorModel=this.editorModel;if(editorModel.sidebarTab==="properties"&&!editorModel.activeNode){editorModel.resetSidebar();}});}
get icons(){return{new:"fa-plus",view:"fa-television",properties:"fa-server",};}
computeDefaultTab(props){const slots=props.slots;const defaults=Object.keys(slots).filter((s)=>slots[s].isDefault);if(defaults.length){return defaults[0];}
return"new"in slots?"new":"view";}
get defaultTab(){return this.editorModel.sidebarTab||this._defaultTab;}
onTabClicked(tab){if(tab!=="properties"){this.editorModel.resetSidebar(tab);}
this.editorModel.sidebarTab=tab;}}
return __exports;});;

/* /web_studio/static/src/client_action/view_editor/interactive_editor/properties/field_properties/field_properties.js */
odoo.define('@web_studio/client_action/view_editor/interactive_editor/properties/field_properties/field_properties',['@odoo/owl','@web/core/l10n/translation','@web/core/confirmation_dialog/confirmation_dialog','@web_studio/client_action/view_editor/property/property','@web_studio/client_action/view_editor/interactive_editor/field_configuration/selection_content_dialog','@web/core/utils/hooks','@web_studio/client_action/view_editor/interactive_editor/properties/limit_group_visibility/limit_group_visibility','@web_studio/client_action/view_editor/interactive_editor/properties/field_properties/type_widget_properties','@web_studio/client_action/view_editor/interactive_editor/properties/sidebar_properties_toolbox/sidebar_properties_toolbox','@web_studio/client_action/view_editor/interactive_editor/properties/modifiers/modifiers_properties','@web_studio/client_action/view_editor/view_editor_model'],function(require){'use strict';let __exports={};const{Component,onWillStart,onWillUpdateProps,useState,toRaw}=require("@odoo/owl");const{_t}=require("@web/core/l10n/translation");const{ConfirmationDialog}=require("@web/core/confirmation_dialog/confirmation_dialog");const{Property}=require("@web_studio/client_action/view_editor/property/property");const{SelectionContentDialog}=require("@web_studio/client_action/view_editor/interactive_editor/field_configuration/selection_content_dialog");const{useService}=require("@web/core/utils/hooks");const{LimitGroupVisibility}=require("@web_studio/client_action/view_editor/interactive_editor/properties/limit_group_visibility/limit_group_visibility");const{TypeWidgetProperties}=require("@web_studio/client_action/view_editor/interactive_editor/properties/field_properties/type_widget_properties");const{SidebarPropertiesToolbox}=require("@web_studio/client_action/view_editor/interactive_editor/properties/sidebar_properties_toolbox/sidebar_properties_toolbox");const{ModifiersProperties}=require("@web_studio/client_action/view_editor/interactive_editor/properties/modifiers/modifiers_properties");const{useEditNodeAttributes}=require("@web_studio/client_action/view_editor/view_editor_model");class TechnicalName extends Component{static props={node:{type:Object},};static template="web_studio.ViewEditor.InteractiveEditorProperties.Field.TechnicalName";static components={Property};setup(){this.renameField=(value)=>{return this.env.viewEditorModel.renameField(this.props.node.attrs.name,`x_studio_${value}`,{autoUnique:false});};}
get canEdit(){return(this.env.debug&&this.env.viewEditorModel.isFieldRenameable(this.props.node.attrs.name));}
get fieldName(){const fName=this.props.node.attrs.name;if(this.canEdit){return fName.split("x_studio_")[1];}
return fName;}}
const FieldProperties=__exports.FieldProperties=class FieldProperties extends Component{static template="web_studio.ViewEditor.InteractiveEditorProperties.Field";static props={node:{type:Object},availableOptions:{type:Array,optional:true},};static components={LimitGroupVisibility,Property,TechnicalName,TypeWidgetProperties,SidebarPropertiesToolbox,ModifiersProperties,};setup(){this.dialog=useService("dialog");this.rpc=useService("rpc");this.state=useState({});this.editNodeAttributes=useEditNodeAttributes();onWillStart(async()=>{if(this.canShowDefaultValue){this.state.defaultValue=await this.getDefaultValue(this.props.node);}});onWillUpdateProps(async(nextProps)=>{if(this._canShowDefaultValue(nextProps.node)){this.state.defaultValue=await this.getDefaultValue(nextProps.node);}});}
get viewEditorModel(){return this.env.viewEditorModel;}
async onChangeFieldString(value){if(this.viewEditorModel.isFieldRenameable(this.props.node.field.name)&&value){return this.viewEditorModel.renameField(this.props.node.attrs.name,value,{label:value,});}else{const operation={new_attrs:{string:value},type:"attributes",position:"attributes",target:this.viewEditorModel.getFullTarget(this.viewEditorModel.activeNodeXpath),};operation.node=operation.target;return this.viewEditorModel.doOperation(operation);}}
onChangeAttribute(value,name){return this.editNodeAttributes({[name]:value});}
onChangeDefaultValue(value){this.rpc("/web_studio/set_default_value",{model_name:this.env.viewEditorModel.resModel,field_name:this.props.node.field.name,value,});}
async getDefaultValue(node){const defaultValueObj=await this.rpc("/web_studio/get_default_value",{model_name:this.env.viewEditorModel.resModel,field_name:node.field.name,});return defaultValueObj.default_value;}
get optionalVisibilityChoices(){return{choices:[{label:_t("Show by default"),value:"show"},{label:_t("Hide by default"),value:"hide"},],};}
get defaultValuesInputType(){const node=this.props.node;return node.attrs?.widget==="statusbar"?"selection":node.attrs.widget||node.field.type;}
get defaultValuesChoices(){if(this.props.node.field.selection){return{choices:this.props.node.field.selection.map(([value,label])=>{return{label,value,};}),};}
return undefined;}
_canShowDefaultValue(node){return!["image","many2many","many2one","binary"].includes(node.field.type);}
get canShowDefaultValue(){return this._canShowDefaultValue(this.props.node);}
get canEditSelectionChoices(){return this.props.node.field.manual&&this.props.node.field.type==="selection";}
isAttributeSupported(name){return this.props.availableOptions?.includes(name);}
editSelectionChoices(){const field=this.props.node.field;this.dialog.add(SelectionContentDialog,{defaultChoices:toRaw(field).selection.map(s=>[...s]),onConfirm:async(choices)=>{const result=await this.rpc("/web_studio/edit_field",{model_name:this.env.viewEditorModel.resModel,field_name:field.name,values:{selection:JSON.stringify(choices)},force_edit:false,});let reflectChanges=!result;if(result&&result.records_linked){reflectChanges=false;await new Promise((resolve)=>{this.dialog.add(ConfirmationDialog,{body:result.message||_t("Are you sure you want to remove the selection values?"),confirm:async()=>{await this.rpc("/web_studio/edit_field",{model_name:this.env.viewEditorModel.resModel,field_name:field.name,values:{selection:JSON.stringify(choices)},force_edit:true,});reflectChanges=true;resolve();},cancel:()=>resolve(),});});}
if(reflectChanges){field.selection=choices;}},});}}
return __exports;});;

/* /web_studio/static/src/client_action/view_editor/interactive_editor/properties/field_properties/field_type_properties.js */
odoo.define('@web_studio/client_action/view_editor/interactive_editor/properties/field_properties/field_type_properties',['@web/core/l10n/translation'],function(require){'use strict';let __exports={};const{_lt}=require("@web/core/l10n/translation");const EDITABLE_ATTRIBUTES=__exports.EDITABLE_ATTRIBUTES={context:{name:"context",label:_lt("Context"),type:"string",},domain:{name:"domain",label:_lt("Domain"),type:"domain",getValue({attrs,field}){return{domain:attrs.domain,relation:field.relation,};},},aggregate:{name:"aggregate",label:_lt("Aggregate"),type:"selection",choices:[{value:"sum",label:_lt("Sum")},{value:"avg",label:_lt("Average")},{value:"none",label:_lt("No aggregation")},],getValue({attrs}){return attrs.sum?"sum":attrs.avg?"avg":"none";},},placeholder:{name:"placeholder",label:_lt("Placeholder"),type:"string",},};const FIELD_TYPE_ATTRIBUTES=__exports.FIELD_TYPE_ATTRIBUTES={char:{common:[EDITABLE_ATTRIBUTES.placeholder],},date:{common:[EDITABLE_ATTRIBUTES.placeholder],},datetime:{common:[EDITABLE_ATTRIBUTES.placeholder],},float:{common:[EDITABLE_ATTRIBUTES.placeholder],list:[EDITABLE_ATTRIBUTES.aggregate],},html:{common:[EDITABLE_ATTRIBUTES.placeholder],},integer:{common:[EDITABLE_ATTRIBUTES.placeholder],list:[EDITABLE_ATTRIBUTES.aggregate],},many2many:{common:[EDITABLE_ATTRIBUTES.domain,EDITABLE_ATTRIBUTES.context],},many2one:{common:[EDITABLE_ATTRIBUTES.domain,EDITABLE_ATTRIBUTES.context,EDITABLE_ATTRIBUTES.placeholder,],},monetary:{common:[EDITABLE_ATTRIBUTES.placeholder],list:[EDITABLE_ATTRIBUTES.aggregate],},selection:{common:[EDITABLE_ATTRIBUTES.placeholder],},};return __exports;});;

/* /web_studio/static/src/client_action/view_editor/interactive_editor/properties/field_properties/type_widget_properties.js */
odoo.define('@web_studio/client_action/view_editor/interactive_editor/properties/field_properties/type_widget_properties',['@odoo/owl','@web/core/registry','@web/core/utils/functions','@web_studio/client_action/view_editor/property/property','@web_studio/client_action/view_editor/editors/utils','@web_studio/client_action/view_editor/interactive_editor/properties/field_properties/field_type_properties'],function(require){'use strict';let __exports={};const{Component}=require("@odoo/owl");const{registry}=require("@web/core/registry");const{memoize}=require("@web/core/utils/functions");const{Property}=require("@web_studio/client_action/view_editor/property/property");const{getWowlFieldWidgets}=require("@web_studio/client_action/view_editor/editors/utils");const{EDITABLE_ATTRIBUTES,FIELD_TYPE_ATTRIBUTES}=require("@web_studio/client_action/view_editor/interactive_editor/properties/field_properties/field_type_properties");const TypeWidgetProperties=__exports.TypeWidgetProperties=class TypeWidgetProperties extends Component{static template="web_studio.ViewEditor.InteractiveEditorProperties.Field.TypeWidgetProperties";static components={Property};static props={node:{type:Object},onChangeAttribute:{type:Function},};setup(){this._getAvailableFields=memoize(()=>{const fields=this.env.viewEditorModel.fields;const activeFields=this.env.viewEditorModel.controllerProps.archInfo.activeFields;return Object.keys(activeFields).map((fName)=>{const field=fields[fName];field.name=field.name||fName;return field;});});}
get attributesOfTypeSelection(){return this.getWidgetAttributes("selection");}
get attributesOfTypeField(){const fieldAttributes=this.getWidgetAttributes("field");if(fieldAttributes.length){const fields=this._getAvailableFields();fieldAttributes.forEach((attribute)=>{attribute.choices=this.getFieldChoices(attribute,fields);});return fieldAttributes;}
return[];}
get attributesOfTypeBoolean(){return this.getWidgetAttributes("boolean");}
get attributesOfTypeDomain(){return this.getWidgetAttributes("domain");}
get attributesOfTypeString(){return this.getWidgetAttributes("string");}
get attributesOfTypeDigits(){return this.getWidgetAttributes("digits");}
get supportedOptions(){const widgetName=this.props.node.attrs?.widget||this.props.node.field.type;const fieldRegistry=registry.category("fields").content;const widgetDescription=fieldRegistry[this.env.viewEditorModel.viewType+"."+widgetName]||fieldRegistry[widgetName];return widgetDescription?.[1].supportedOptions||[];}
get widgetChoices(){const widgets=getWowlFieldWidgets(this.props.node.field.type,this.props.node.attrs.widget,[],this.env.debug);return{choices:widgets.map(([value,label])=>{label=label?label:"";return{label:`${label} (${value})`.trim(),value,};}),};}
get _attributesForCurrentTypeAndWidget(){const node=this.props.node;const fieldType=node.field.type;const{viewType}=this.env.viewEditorModel;const fieldCommonViewsProperties=FIELD_TYPE_ATTRIBUTES[fieldType]?.common||[];const fieldSpecificViewProperties=FIELD_TYPE_ATTRIBUTES[fieldType]?.[viewType]||[];return[...fieldCommonViewsProperties,...fieldSpecificViewProperties,...this.supportedOptions,];}
getWidgetAttributes(type){return this._attributesForCurrentTypeAndWidget.filter((attribute)=>attribute.type===type).map((attribute)=>{if(EDITABLE_ATTRIBUTES[attribute.name]){return this.getPropertyFromAttributes(attribute);}
return this.getPropertyFromOptions(attribute);});}
getFieldChoices(attribute,fields){if(attribute.availableTypes){return fields.filter((f)=>attribute.availableTypes.includes(f.type)).map((f)=>{return{label:this.env.debug?`${f.string} (${f.name})`:f.string,value:f.name,};});}
return fields;}
getPropertyFromAttributes(property){let value;value=this.props.node.attrs[property.name];if(property.getValue){const attrs=this.props.node.attrs||{};const field=this.props.node.field||{};value=property.getValue({attrs,field});}
if(value===undefined&&property.default){value=property.default;}
return{...property,value,};}
getPropertyFromOptions(property){let value;value=this.props.node.attrs.options?.[property.name];if(property.type==="string"){value=JSON.stringify(value);}
if(value===undefined&&property.default){value=property.default;}
return{...property,value,};}
getSelectValue(value){return typeof value==="object"?JSON.stringify(value):value;}
onChangeWidget(value){return this.props.onChangeAttribute(value,"widget");}
onChangeProperty(value,name){const currentProperty=this._attributesForCurrentTypeAndWidget.find((e)=>e.name===name);if(EDITABLE_ATTRIBUTES[name]){return this.props.onChangeAttribute(value,name);}
const options={...this.props.node.attrs.options};if(value||currentProperty.type==="boolean"){if(currentProperty.type==="digits"){value=Number(value);if(!Number.isInteger(value)||value<0||value>20){return;}
options[name]=[value*2,value];}else if(["[","{"].includes(value[0])||!isNaN(value)){options[name]=JSON.parse(value);}else{options[name]=value;}}else{delete options[name];}
this.props.onChangeAttribute(JSON.stringify(options),"options");}}
return __exports;});;

/* /web_studio/static/src/client_action/view_editor/interactive_editor/properties/limit_group_visibility/limit_group_visibility.js */
odoo.define('@web_studio/client_action/view_editor/interactive_editor/properties/limit_group_visibility/limit_group_visibility',['@odoo/owl','@web/views/record','@web/views/fields/many2many_tags/many2many_tags_field','@web_studio/client_action/view_editor/view_editor_model'],function(require){'use strict';let __exports={};const{Component}=require("@odoo/owl");const{Record}=require("@web/views/record");const{Many2ManyTagsField}=require("@web/views/fields/many2many_tags/many2many_tags_field");const{useEditNodeAttributes}=require("@web_studio/client_action/view_editor/view_editor_model");const LimitGroupVisibility=__exports.LimitGroupVisibility=class LimitGroupVisibility extends Component{static template="web_studio.ViewEditor.LimitGroupVisibility";static components={Record,Many2ManyTagsField,};static props={node:{type:Object},};setup(){this.editNodeAttributes=useEditNodeAttributes();const m2mFieldsToFetch={display_name:{type:"char"},};this.recordFields={groups_id:{type:"many2many",relation:"res.groups",string:"Groups",relatedFields:m2mFieldsToFetch,},};}
onChangeAttribute(value,name){return this.editNodeAttributes({[name]:value});}
get groupsIds(){const studioGroups=JSON.parse(this.props.node.attrs.studio_groups||"[]");const ids=[];for(let i=0;i<studioGroups.length;i++){ids.push(studioGroups[i].id);}
return ids;}
get recordProps(){return{fields:this.recordFields,values:{groups_id:this.groupsIds},activeFields:this.recordFields,onRecordChanged:(record,changes)=>{const newIds=changes.groups_id[0][2];this.onChangeAttribute(newIds,"groups");},};}}
return __exports;});;

/* /web_studio/static/src/client_action/view_editor/interactive_editor/properties/modifiers/modifiers_properties.js */
odoo.define('@web_studio/client_action/view_editor/interactive_editor/properties/modifiers/modifiers_properties',['@odoo/owl','@web_studio/client_action/view_editor/property/property'],function(require){'use strict';let __exports={};const{Component}=require("@odoo/owl");const{Property}=require("@web_studio/client_action/view_editor/property/property");const ModifiersProperties=__exports.ModifiersProperties=class ModifiersProperties extends Component{static template="web_studio.ViewEditor.InteractiveEditorProperties.Modifiers";static components={Property};static props={node:{type:Object},availableOptions:{type:Array},};isAttributeSupported(name){return this.props.availableOptions?.includes(name);}
onChangeModifier(value,name){const isBoolean=typeof value==="boolean";const newAttrs={};const modifiers={...(this.props.node.attrs.attrs||{}),...this.props.node.attrs.modifiers,};const changingInvisible=name==="invisible";const isInList=this.env.viewEditorModel.viewType==="list";if(!isBoolean){newAttrs[name]="";if(changingInvisible&&isInList){name="column_invisible";}
newAttrs.attrs={...modifiers,[name]:value};}else{delete modifiers[name];if(changingInvisible&&isInList){delete modifiers.invisible;delete modifiers.column_invisible;}
newAttrs.attrs=modifiers;newAttrs[name]=value?"1":"";}
if(!Object.keys(newAttrs.attrs).length){newAttrs.attrs="";}
if(name==="readonly"&&this.env.viewEditorModel.viewType==="form"){newAttrs["force_save"]=value?"True":"False";}
const operation={new_attrs:newAttrs,type:"attributes",position:"attributes",target:this.env.viewEditorModel.getFullTarget(this.env.viewEditorModel.activeNodeXpath),};this.env.viewEditorModel.doOperation(operation);}}
return __exports;});;

/* /web_studio/static/src/client_action/view_editor/interactive_editor/properties/properties.js */
odoo.define('@web_studio/client_action/view_editor/interactive_editor/properties/properties',['@odoo/owl','@web_studio/client_action/view_editor/interactive_editor/properties/sidebar_properties_toolbox/sidebar_properties_toolbox'],function(require){'use strict';let __exports={};const{Component,useState,xml}=require("@odoo/owl");const{SidebarPropertiesToolbox}=require("@web_studio/client_action/view_editor/interactive_editor/properties/sidebar_properties_toolbox/sidebar_properties_toolbox");class DefaultProperties extends Component{static props={node:{type:Object},};static template=xml`
        <SidebarPropertiesToolbox/>
    `;static components={SidebarPropertiesToolbox};}
const Properties=__exports.Properties=class Properties extends Component{static template="web_studio.ViewEditor.InteractiveEditorProperties";static props={propertiesComponents:{type:Object},};static components={DefaultProperties};setup(){this.viewEditorModel=useState(this.env.viewEditorModel);}
get node(){return this.viewEditorModel.activeNode;}
get propertiesComponent(){return this.props.propertiesComponents[this.nodeType]||{};}
get nodeType(){return this.node?.arch.tagName;}}
return __exports;});;

/* /web_studio/static/src/client_action/view_editor/interactive_editor/properties/sidebar_properties_toolbox/sidebar_properties_toolbox.js */
odoo.define('@web_studio/client_action/view_editor/interactive_editor/properties/sidebar_properties_toolbox/sidebar_properties_toolbox',['@odoo/owl','@web/core/utils/hooks','@web/core/confirmation_dialog/confirmation_dialog','@web/core/l10n/translation','@web/core/utils/strings'],function(require){'use strict';let __exports={};const{Component}=require("@odoo/owl");const{useService}=require("@web/core/utils/hooks");const{ConfirmationDialog}=require("@web/core/confirmation_dialog/confirmation_dialog");const{_t}=require("@web/core/l10n/translation");const{sprintf}=require("@web/core/utils/strings");const SidebarPropertiesToolbox=__exports.SidebarPropertiesToolbox=class SidebarPropertiesToolbox extends Component{static props={};static template="web_studio.ViewEditor.InteractiveEditorProperties.Toolbox";setup(){this.orm=useService("orm");this.action=useService("action");this.dialog=useService("dialog");}
get node(){return this.env.viewEditorModel.activeNode;}
get nodeType(){return this.node.arch.tagName;}
onRemoveFromView(){let nodeHumanName=this.nodeType;if(this.nodeType==="t"&&this.node.attrs["t-name"]==="kanban-menu"){nodeHumanName=_t("dropdown");}
this.dialog.add(ConfirmationDialog,{body:sprintf(this.env._t("Are you sure you want to remove this %s from the view?"),nodeHumanName),confirm:()=>{return this.removeNodeFromArch();},cancel:()=>{},});}
async openFormAction(){const resId=await this.orm.searchRead("ir.model.fields",[["model","=",this.env.viewEditorModel.resModel],["name","=",this.node.field.name],],["id"]);return this.action.doAction({type:"ir.actions.act_window",res_model:"ir.model.fields",res_id:resId[0].id,views:[[false,"form"]],target:"current",},{clearBreadcrumbs:true});}
removeNodeFromArch(xpath){const target=this.env.viewEditorModel.getFullTarget(xpath||this.node.xpath);const operation={type:"remove",target,};this.env.viewEditorModel.resetSidebar();return this.env.viewEditorModel.doOperation(operation);}}
return __exports;});;

/* /web_studio/static/src/client_action/view_editor/interactive_editor/sidebar_view_toolbox/sidebar_view_toolbox.js */
odoo.define('@web_studio/client_action/view_editor/interactive_editor/sidebar_view_toolbox/sidebar_view_toolbox',['@odoo/owl'],function(require){'use strict';let __exports={};const{Component}=require("@odoo/owl");const SidebarViewToolbox=__exports.SidebarViewToolbox=class SidebarViewToolbox extends Component{static template="web_studio.ViewEditor.ViewToolbox";static props={canEditXml:{type:Boolean,optional:true},onMore:{type:Function,optional:true},openDefaultValues:{type:Function,optional:true},canEditDefaultValues:{type:Boolean,optional:true},};}
return __exports;});;

/* /web_studio/static/src/client_action/view_editor/operations_utils.js */
odoo.define('@web_studio/client_action/view_editor/operations_utils',[],function(require){'use strict';let __exports={};__exports.viewGroupByOperation=viewGroupByOperation;function viewGroupByOperation(viewType,type,newValue,oldValue=undefined){const operation_type=newValue?"add":"remove";const operation={target:{view_type:viewType,field_names:[operation_type==="add"?newValue:oldValue],operation_type,field_type:type,},type:"graph_pivot_groupbys_fields",};if(oldValue&&newValue){operation.target.operation_type="replace";operation.target.old_field_names=oldValue;}
return operation;}
return __exports;});;

/* /web_studio/static/src/client_action/view_editor/property/property.js */
odoo.define('@web_studio/client_action/view_editor/property/property',['@odoo/owl','@web/core/checkbox/checkbox','@web/core/domain_selector_dialog/domain_selector_dialog','@web/core/select_menu/select_menu','@web/core/utils/hooks'],function(require){'use strict';let __exports={};const{Component}=require("@odoo/owl");const{CheckBox}=require("@web/core/checkbox/checkbox");const{DomainSelectorDialog}=require("@web/core/domain_selector_dialog/domain_selector_dialog");const{SelectMenu}=require("@web/core/select_menu/select_menu");const{useService}=require("@web/core/utils/hooks");const Property=__exports.Property=class Property extends Component{static template="web_studio.Property";static components={CheckBox,SelectMenu,DomainSelectorDialog};static defaultProps={childProps:{},class:"",};static props={isConditional:{type:Boolean,optional:true},name:{type:String},type:{type:String},value:{optional:true},onChange:{type:Function,optional:true},childProps:{type:Object,optional:true},class:{type:String,optional:true},isReadonly:{type:Boolean,optional:true},slots:{type:Object,optional:true,},tooltip:{type:String,optional:true},inputAttributes:{type:Object,optional:true},};setup(){this.dialog=useService("dialog");}
get className(){const propsClass=this.props.class?this.props.class:"";return`o_web_studio_property_${this.props.name} ${propsClass}`;}
getCheckboxClassname(value){if(this.props.isConditional&&value instanceof Array){return"o_web_studio_checkbox_inactive";}}
onConditionalButtonClicked(){const valueType=typeof this.props.value;let value=valueType==="boolean"||valueType==="undefined"?[]:this.props.value;if(typeof value!=="string"){value=JSON.stringify(value);}
this.dialog.add(DomainSelectorDialog,{resModel:this.env.viewEditorModel.resModel,domain:value,isDebugMode:!!this.env.debug,followRelations:false,onConfirm:(domain)=>this.props.onChange(domain,this.props.name),});}
onDomainClicked(){this.dialog.add(DomainSelectorDialog,{resModel:this.props.childProps.relation,domain:this.props.value||"[]",isDebugMode:!!this.env.debug,onConfirm:(domain)=>this.props.onChange(domain,this.props.name),});}
onViewOptionChange(value){this.props.onChange(value,this.props.name);}}
return __exports;});;

/* /web_studio/static/src/client_action/view_editor/studio_view.js */
odoo.define('@web_studio/client_action/view_editor/studio_view',['@web/search/with_search/with_search','@web_studio/client_action/view_editor/editors/utils','@odoo/owl','@web/core/utils/hooks','@web/core/l10n/translation'],function(require){'use strict';let __exports={};const{WithSearch}=require("@web/search/with_search/with_search");const{cleanClickedElements}=require("@web_studio/client_action/view_editor/editors/utils");const{Component,onError,onMounted,toRaw,useRef,xml,useSubEnv,useEffect}=require("@odoo/owl");const{useService}=require("@web/core/utils/hooks");const{_t}=require("@web/core/l10n/translation");const HEIGHT="height: 100%;";const StudioView=__exports.StudioView=class StudioView extends Component{static props={autoClick:{type:Function,optional:true},"*":true};setup(){this.notification=useService("notification");this.style=this.props.setOverlay?`pointer-events: none; ${HEIGHT}`:HEIGHT;this.withSearchProps={resModel:this.props.resModel,SearchModel:this.props.SearchModel,context:this.props.context,domain:this.props.domain,globalState:this.props.globalState,searchViewArch:this.props.searchViewArch,searchViewFields:this.props.searchViewFields,irFilters:this.props.searchViewIrFilters,display:this.props.display,};this.viewEditorModel=this.env.viewEditorModel;this.viewRenderer=useRef("viewRenderer");this.controllerProps={...this.viewEditorModel.controllerProps};useEffect((xpath)=>{if(xpath){this.updateActiveNode({xpath,resetSidebarOnNotFound:true});}},()=>[this.viewEditorModel.activeNodeXpath]);const rawModel=toRaw(this.viewEditorModel);useEffect(()=>{rawModel.isInEdition=false;},()=>[rawModel.isInEdition]);onError((error)=>{if(rawModel.isInEdition){this.notification.add(_t("The requested change caused an error in the view. It could be because a field was deleted, but still used somewhere else."),{type:"danger",title:_t("Error"),});this.viewEditorModel.resetSidebar("view");this.viewEditorModel._operations.undo(false);}else{throw error;}});const config={...this.env.config,onNodeClicked:(xpath)=>{if(this.updateActiveNode({xpath})){this.viewEditorModel.activeNodeXpath=xpath;}},};if(this.props.autoClick){onMounted(()=>this.props.autoClick());}
useSubEnv({config,__beforeLeave__:null,__getGlobalState__:null,__getLocalState__:null,__getContext__:null,__getOrderBy__:null,});}
updateActiveNode({xpath,resetSidebarOnNotFound=false}){const vem=this.env.viewEditorModel;cleanClickedElements(this.viewRenderer.el);const el=this.viewRenderer.el.querySelector(`[data-studio-xpath="${xpath}"], [studioxpath="${xpath}"]`);if(!el){if(resetSidebarOnNotFound){vem.resetSidebar();}
return false;}
if(vem.editorInfo.editor.styleClickedElement){vem.editorInfo.editor.styleClickedElement(this.viewRenderer,{xpath});return true;}
const clickable=el.closest(".o-web-studio-editor--element-clickable");if(clickable){clickable.classList.add("o-web-studio-editor--element-clicked");}
return true;}}
StudioView.components={WithSearch};StudioView.template=xml`
    <div t-att-style="style" class="w-100" t-ref="viewRenderer">
        <WithSearch t-props="withSearchProps" t-slot-scope="search">
            <t t-component="viewEditorModel.editorInfo.editor.Controller" t-props="Object.assign(controllerProps, search)" />
        </WithSearch>
    </div>
`;return __exports;});;

/* /web_studio/static/src/client_action/view_editor/view_editor.js */
odoo.define('@web_studio/client_action/view_editor/view_editor',['@odoo/owl','@web/core/utils/hooks','@web/core/registry','@web_studio/client_action/view_editor/studio_view','@web_studio/client_action/view_editor/interactive_editor/interactive_editor','@web_studio/client_action/view_editor/xml_editor/xml_editor','@web_studio/client_action/view_editor/view_editor_hook','@web/webclient/actions/action_service','@web/views/view'],function(require){'use strict';let __exports={};const{Component,useSubEnv,useRef}=require("@odoo/owl");const{useService}=require("@web/core/utils/hooks");const{registry}=require("@web/core/registry");const{StudioView}=require("@web_studio/client_action/view_editor/studio_view");const{InteractiveEditor}=require("@web_studio/client_action/view_editor/interactive_editor/interactive_editor");const{XmlEditor}=require("@web_studio/client_action/view_editor/xml_editor/xml_editor");const{useViewEditorModel}=require("@web_studio/client_action/view_editor/view_editor_hook");const{standardActionServiceProps}=require("@web/webclient/actions/action_service");const{getDefaultConfig}=require("@web/views/view");const ViewEditor=__exports.ViewEditor=class ViewEditor extends Component{static props={...standardActionServiceProps};static components={StudioView,InteractiveEditor,XmlEditor};static template="web_studio.ViewEditor";setup(){this.studio=useService("studio");this.user=useService("user");this.rpc=useService("rpc");this.orm=useService("orm");useSubEnv({config:getDefaultConfig()});this.rootRef=useRef("root");this.rendererRef=useRef("viewRenderer");this.viewEditorModel=useViewEditorModel(this.rendererRef);}
get interactiveEditorKey(){const{viewType,breadcrumbs}=this.viewEditorModel;let key=viewType;if(breadcrumbs.length>1){key+=`_${breadcrumbs.length}`;}
return key;}}
registry.category("actions").add("web_studio.view_editor",ViewEditor);return __exports;});;

/* /web_studio/static/src/client_action/view_editor/view_editor_hook.js */
odoo.define('@web_studio/client_action/view_editor/view_editor_hook',['@odoo/owl','@web/core/utils/hooks','@web_studio/studio_service','@web_studio/client_action/editor/edition_flow','@web_studio/client_action/view_editor/view_editor_model'],function(require){'use strict';let __exports={};const{onWillDestroy,onWillStart,status,useComponent,useEnv,useState,useSubEnv,}=require("@odoo/owl");const{useOwnedDialogs,useService}=require("@web/core/utils/hooks");const{viewTypeToString}=require("@web_studio/studio_service");const{useEditorBreadcrumbs,useEditorFlowFeatures,}=require("@web_studio/client_action/editor/edition_flow");const{ViewEditorModel}=require("@web_studio/client_action/view_editor/view_editor_model");__exports.useViewEditorModel=useViewEditorModel;function useViewEditorModel(viewRef){const env=useEnv();const services=Object.fromEntries(["user","rpc","orm","ui","notification"].map((sName)=>{return[sName,useService(sName)];}));services.studio={...env.services.studio};services.dialog={add:useOwnedDialogs()};const editionFlow=useState(env.editionFlow);useEditorBreadcrumbs({name:viewTypeToString(services.studio.editedViewType)});const viewEditorModel=new ViewEditorModel({env,services,editionFlow,viewRef,});useSubEnv({viewEditorModel});const{_snackBar,_operations}=viewEditorModel;useEditorFlowFeatures({snackBarIndicator:_snackBar,editorOperations:_operations});const component=useComponent();onWillStart(async()=>{return new Promise((resolve,reject)=>{viewEditorModel.load().then(resolve).catch((error)=>{if(status(component)!=="destroyed"){reject(error);}});});});onWillDestroy(()=>{viewEditorModel.isInEdition=false;});return useState(viewEditorModel);}
__exports.useSnackbarWrapper=useSnackbarWrapper;function useSnackbarWrapper(fn){const env=useEnv();return env.viewEditorModel._decorateFunction(fn);}
return __exports;});;

/* /web_studio/static/src/client_action/view_editor/view_editor_model.js */
odoo.define('@web_studio/client_action/view_editor/view_editor_model',['@web/core/registry','@web/search/search_model','@web_studio/client_action/view_editor/editors/xml_utils','@odoo/owl','@web/core/utils/strings','@web_studio/studio_service','@web_studio/client_action/view_editor/editors/utils','@web_studio/client_action/utils','@web/views/view_compiler','@web/core/l10n/translation','@web_studio/client_action/editor/edition_flow','@web/core/utils/concurrency','@web/core/confirmation_dialog/confirmation_dialog'],function(require){'use strict';let __exports={};const{registry}=require("@web/core/registry");const{SearchModel}=require("@web/search/search_model");const{computeXpath,getNodesFromXpath,getNodeAttributes,parseStringToXml,serializeXmlToString,}=require("@web_studio/client_action/view_editor/editors/xml_utils");const{EventBus,markRaw,useEnv,reactive}=require("@odoo/owl");const{sprintf}=require("@web/core/utils/strings");const{viewTypeToString}=require("@web_studio/studio_service");const{xpathToLegacyXpathInfo,cleanClickedElements,}=require("@web_studio/client_action/view_editor/editors/utils");const{Reactive}=require("@web_studio/client_action/utils");const{getModifier,resetViewCompilerCache}=require("@web/views/view_compiler");const{_t}=require("@web/core/l10n/translation");const{EditorOperations,SnackbarIndicator}=require("@web_studio/client_action/editor/edition_flow");const{Race}=require("@web/core/utils/concurrency");const{AlertDialog}=require("@web/core/confirmation_dialog/confirmation_dialog");const editorsRegistry=registry.category("studio_editors");const viewRegistry=registry.category("views");function memoizeOnce(callback){let key,value;return(...args)=>{if(key===args[0]){return value;}
key=args[0];value=callback(...args);return value;};}
class EditorOperationsWithSnackbar extends EditorOperations{constructor(params){super(...arguments);this.snackBar=params.snackBar;this.race=markRaw(new Race());}
_wrapPromise(prom){const _prom=super._wrapPromise(prom);this.snackBar.add(this.race.add(_prom));return _prom;}}
function getFieldsInArch(xmlDoc){return Array.from(xmlDoc.querySelectorAll("field")).filter(el=>!el.parentElement.closest("field")).map((n)=>n.getAttribute("name"));}
function getSubarchPosition(mainArch,xpathToField,archTag){const xpathToArch=`${xpathToField}/${archTag}[not(@studio_subview_inlined)]`;const nodes=getNodesFromXpath(xpathToArch,parseStringToXml(mainArch));let hasArch=false;let position=1;for(const node of nodes){if(!getModifier(node,"invisible")){hasArch=true;break;}
position++;}
return{hasArch,position};}
function getSubArch(mainArch,xpathToField,archTag,position){const xpathToView=`${archTag}[${position}]`;const xpathToArch=`${xpathToField}/${xpathToView}`;const nodes=getNodesFromXpath(xpathToArch,parseStringToXml(mainArch));if(nodes.length!==1){throw new Error(`Single sub-view arch not found for xpath: ${xpathToArch}`);}
return serializeXmlToString(nodes[0]);}
function buildKey(...args){return args.join("_");}
function removeStudioNoFetchFromArch(arch){const xml=parseStringToXml(arch);xml.querySelectorAll(`[studio_no_fetch="1"]`).forEach((n)=>n.remove());return serializeXmlToString(xml);}
const ViewEditorModel=__exports.ViewEditorModel=class ViewEditorModel extends Reactive{constructor({env,services,editionFlow,viewRef}){super();this._isInEdition=false;this.mode="interactive";this.env=env;this.bus=markRaw(new EventBus());this._services=markRaw(services);this._studio=services.studio;this._snackBar=new SnackbarIndicator();this._operations=new EditorOperationsWithSnackbar({do:this._handleOperations.bind(this),onDone:this._handleDone.bind(this),onError:this._handleError.bind(this),snackBar:this._snackBar,});this._decorateCall=async(callback,...args)=>{this._services.ui.block();const prom=callback(...args);this._snackBar.add(prom);try{return await prom;}finally{this._services.ui.unblock();}};this._decorateFunction=(callback)=>{return async(...args)=>{return this._decorateCall(callback,...args);};};this._rpc=services.rpc;this._decoratedRpc=this._decorateFunction(services.rpc);this._editionFlow=editionFlow;this.GROUPABLE_TYPES=["many2one","char","boolean","selection","date","datetime"];this.activeNodeXpath=undefined;this._getEditor=memoizeOnce(()=>{const viewType=this.viewType;const view=viewRegistry.contains(viewType)?viewRegistry.get(viewType):null;const editor=editorsRegistry.contains(viewType)?editorsRegistry.get(viewType):null;return{getProps:editor?editor.props:view.props,editor:this.mode==="interactive"?editor||view:view||editor,};});this._getControllerProps=memoizeOnce(()=>{let{resId,resIds}=this.isEditingSubview?this._subviewInfo:this._studio.editedControllerState||{};resIds=resIds||[];resId=resId||resIds[0];const arch=this.mode==="interactive"?this.arch:removeStudioNoFetchFromArch(this.arch);const rootArchNode=this.xmlDoc.firstElementChild;const controllerClasses=Array.from(new Set(["o_view_controller",`o_${this.viewType}_view`,...(rootArchNode.getAttribute("class")||"").split(" "),])).filter((c)=>c);let controllerProps={info:{},relatedModels:this.viewDescriptions.relatedModels,useSampleModel:["graph","pivot"].includes(this.viewType),searchMenuTypes:[],className:controllerClasses.join(" "),resId,resIds,resModel:this.resModel,arch,fields:this.fields,};if(["list","tree","form"].includes(this.viewType)&&this.mode==="interactive"&&this._subviewInfo){controllerProps.parentRecord=this._subviewInfo.parentRecord;}
const{editor,getProps}=this.editorInfo;controllerProps=getProps?getProps(controllerProps,editor,this.env.config):controllerProps;return controllerProps;});this.__getDefaultStudioViewProps=memoizeOnce(()=>{const editedAction=this._studio.editedAction;let globalState;if(this._views.search&&!this.isEditingSubview){globalState=editedAction.globalState;}
const context=this._subviewInfo?this._subviewInfo.context:editedAction.context;const searchModel=this.editorInfo.editor.SearchModel||SearchModel;return{context,resModel:this.resModel,SearchModel:searchModel,setOverlay:!["form","list","tree","kanban","search"].includes(this.viewType)||this.mode!=="interactive",display:{controlPanel:false,searchPanel:false},globalState,};});this._getActiveNode=memoizeOnce(()=>{if(!this.activeNodeXpath){return undefined;}
const node=getNodesFromXpath(this.activeNodeXpath,this.xmlDoc)[0];if(!node){return null;}
const isField=node.tagName==="field";const attrs=getNodeAttributes(node);let field;if(isField){field=reactive(this.fields[attrs.name]);Object.defineProperty(field,"label",{get(){return field.string;},configurable:true,});}
return reactive({arch:node,attrs,xpath:this.activeNodeXpath,field,});});this._getUnprocessedXmlDoc=memoizeOnce((arch)=>parseStringToXml(arch));this.breadcrumbs=editionFlow.breadcrumbs;this._editionFlow=editionFlow;this._views={};this.studioViewArch="";this.viewDescriptions={relatedModels:{},fields:[],};this.viewRef=viewRef;this.showInvisible=false;this._currentSidebarTab=undefined;this._getFieldsAllowedRename=memoizeOnce(()=>{return new Set();});}
get editorInfo(){return this._getEditor(buildKey(this.viewType,this.mode));}
get controllerProps(){const key=buildKey(this.arch,this.viewType,this.mode,this.resModel,this.breadcrumbs.length>1?this.breadcrumbs.length:1);return this._getControllerProps(key);}
get studioViewProps(){const key=buildKey(this.viewType,this.resModel,this.mode,this.isEditingSubview);return this.__getDefaultStudioViewProps(key);}
get xmlDoc(){return this._getUnprocessedXmlDoc(this.arch);}
get isEditingSubview(){return this.breadcrumbs.length>1;}
set isInEdition(value){value=!!value;if(this.isInEdition===value){return;}
this._isInEdition=value;if(value){this._services.ui.block();}else{this._services.ui.unblock();}}
get isInEdition(){return this._isInEdition;}
get mainView(){return this._views?this._views[this.mainViewType]:undefined;}
get mainArch(){return this.mainView?this.mainView.arch:"";}
get mainViewType(){return this._studio.editedViewType;}
get mainResModel(){return this._studio.editedAction.res_model;}
get arch(){return this.isEditingSubview?this._subviewInfo.getArch(this.mainArch):this.mainArch;}
get viewType(){return this.isEditingSubview?this._subviewInfo.viewType:this.mainViewType;}
get view(){return this._views[this.viewType];}
get resModel(){return this.isEditingSubview?this._subviewInfo.resModel:this.mainResModel;}
get fields(){return this.viewDescriptions.relatedModels[this.resModel];}
get activeNode(){return this._getActiveNode(buildKey(this.activeNodeXpath,this.arch));}
get studioViewKey(){return buildKey(this.arch,JSON.stringify(this.fields));}
get fieldsInArch(){return getFieldsInArch(this.xmlDoc);}
get isChatterAllowed(){return!this.isEditingSubview&&this._isChatterAllowed;}
get sidebarTab(){if(this.activeNodeXpath){return"properties";}
return this._currentSidebarTab;}
set sidebarTab(newTab){this._currentSidebarTab=newTab;}
async editX2ManyView({viewType,fieldName,record,xpath,fieldContext}){const staticList=record.data[fieldName];const resIds=staticList.records.map((r)=>r.resId);const resModel=staticList.resModel;const archTag=viewType==="list"?"tree":viewType;const currentFullXpath=this.getSubviewXpath();let xpathToField=xpath;if(currentFullXpath){const xpathWithoutView=xpath.split("/").slice(2);xpathToField=`${currentFullXpath}/${xpathWithoutView.join("/")}`;}
const{hasArch,position}=getSubarchPosition(this.mainArch,xpathToField,archTag);if(!hasArch){const subViewRef=fieldContext[`${archTag}_view_ref`]||null;this.studioViewArch=await this._createInlineView({subViewType:viewType,fullXpath:xpathToField,subViewRef,resModel,fieldName,});const viewDescriptions=await this._editionFlow.loadViews();this.viewDescriptions=viewDescriptions;Object.assign(this._views,viewDescriptions.views);this._operations.clear(false);}
await this._decorateCall(()=>this.fieldsGet(resModel));const context=Object.fromEntries(Object.entries(fieldContext).filter(([key,val])=>{return!key.startsWith("default_")&&!key.endsWith("_view_ref");}));const x2ManyEditionInfo={name:sprintf("Subview %s",viewTypeToString(viewType)),context,resModel,resId:resIds[0],resIds,viewType,parentRecord:record,xpath:`${xpath}/${archTag}[${position}]`,fieldName,getArch:memoizeOnce((mainArch)=>{return getSubArch(mainArch,xpathToField,archTag,position);}),};this._editionFlow.pushBreadcrumb(x2ManyEditionInfo);}
async fieldsGet(resModel){this.fieldsGetCache=this.fieldsGetCache||new Set();if(!this.fieldsGetCache.has(resModel)){const fg=await this._services.orm.call(resModel,"fields_get");this.fieldsGetCache.add(resModel);Object.assign(this.viewDescriptions.relatedModels[resModel],fg);}}
async load(){const proms=[this._editionFlow.loadViews({forceSearch:true})];if(this.viewType==="form"){proms.push(this._studio.isAllowed("chatter",this.mainResModel));}
const[viewDescriptions,isChatterAllowed]=await Promise.all(proms);this._isChatterAllowed=isChatterAllowed;this.viewDescriptions=viewDescriptions||{relatedModels:{},fields:[],};Object.assign(this._views,viewDescriptions.views);const{mainViewId,viewId,arch}=await this._getStudioViewArch();this.studioViewArch=arch;this.studioViewId=viewId;if(!this.mainView.id){this.env.bus.trigger("CLEAR-CACHES");this.mainView.id=mainViewId;}}
getSubviewXpath(){if(!this.isEditingSubview){return null;}
const temp=[`/${this.mainViewType === "list" ? "tree" : this.mainViewType}[1]`];this.breadcrumbs.slice(1).forEach((bc)=>{const withoutView=bc.xpath.split("/").slice(2);temp.push(...withoutView);});return temp.join("/");}
getFullTarget(xpath,{isXpathFullAbsolute=true}={}){const nodes=getNodesFromXpath(xpath,this.xmlDoc);if(nodes.length!==1){throw new Error("Xpath resolved to nothing or multiple nodes");}
const element=nodes[0];const attrs={};["name","id","class","for"].forEach((attrName)=>{if(element.hasAttribute(attrName)){attrs[attrName]=element.getAttribute(attrName);}});let xpath_info;if(isXpathFullAbsolute){xpath_info=xpathToLegacyXpathInfo(xpath);}else{const fullAbsolute=computeXpath(element,this.viewType==="list"?"tree":this.viewType);xpath_info=xpathToLegacyXpathInfo(fullAbsolute);}
const target={tag:element.tagName,attrs,xpath_info,};const subViewXpath=this.getSubviewXpath();if(subViewXpath){target.subview_xpath=subViewXpath;const subViewTargetInfo=xpathToLegacyXpathInfo(subViewXpath);xpath_info.splice(0,1,subViewTargetInfo[subViewTargetInfo.length-1]);}
return target;}
async doOperation(operation,write=true){return this._operations.do(operation,!write);}
pushOperation(operation){return this._operations.pushOp(operation);}
resetSidebar(tab=null){this.sidebarTab=tab;this.activeNodeXpath=undefined;const resetEl=this.viewRef.el;if(resetEl){cleanClickedElements(resetEl);}}
switchMode(){resetViewCompilerCache();this.mode=this.mode==="interactive"?"xml":"interactive";}
setRenameableField(fieldName,add=true){if(add){this._fieldsAllowedRename.add(fieldName);}else{this._fieldsAllowedRename.delete(fieldName);}}
isFieldRenameable(fieldName){return this._fieldsAllowedRename.has(fieldName);}
async renameField(fieldName,newName,{label,autoUnique=true}={}){newName=newName.toLowerCase().trim().replace(/[^\w\s-]/g,"").replace(/[\s_-]+/g,"_").replace(/^-+|-+$/g,"");if(!newName.startsWith("x_studio_")){newName=`x_studio_${newName}`;}
const existingFields=this.fields;if(autoUnique){const baseName=newName;let index=1;while(newName in existingFields){newName=baseName+"_"+index;index++;}}
if(!autoUnique&&newName in existingFields){this._services.dialog.add(AlertDialog,{body:_t("A field with the same name already exists."),});return;}
this.isInEdition=true;const prom=this._rpc("/web_studio/rename_field",{studio_view_id:this.studioViewId,studio_view_arch:this.studioViewArch,model:this.resModel,old_name:fieldName,new_name:newName,new_label:label,});this._snackBar.add(prom);try{await prom;}catch(e){this.isInEdition=false;throw e;}
const strOperations=JSON.stringify(this._operations.operations);const chars="[^\\w\\u007F-\\uFFFF]";const re=new RegExp(`(${chars}|^)${fieldName}(${chars}|$)`,"g");this._operations.clear();this.setRenameableField(fieldName,false);this.setRenameableField(newName,true);this._operations.doMulti(JSON.parse(strOperations.replace(re,`$1${newName}$2`)));}
async _createInlineView({subViewType,fullXpath,subViewRef,resModel,fieldName}){subViewType=subViewType==="list"?"tree":subViewType;const context={...this._services.user.context,lang:false,studio:true};if(subViewRef){context[`${subViewType}_view_ref`]=subViewRef;}
const studioViewArch=await this._decoratedRpc("/web_studio/create_inline_view",{model:resModel,view_id:this.mainView.id,field_name:fieldName,subview_type:subViewType,subview_xpath:fullXpath,context,});this.env.bus.trigger("CLEAR-CACHES");return studioViewArch;}
async _editView(operations){const context={...this._services.user.context,...(this._studio.editedAction.context||{}),lang:false,studio:true,};return this._rpc("/web_studio/edit_view",{view_id:this.mainView.id,studio_view_arch:this.studioViewArch,operations:operations,model:this.resModel,context,});}
async _editViewArch(viewId,viewArch){const context={...this._services.user.context,...(this._studio.editedAction.context||{}),lang:false,studio:true,};const result=await this._rpc("/web_studio/edit_view_arch",{view_id:viewId,view_arch:viewArch,context,});return result;}
async _handleOperations({mode,operations,lastOp}){this.isInEdition=true;if(lastOp.type!=="replace_arch"){operations=operations.filter((op)=>op.type!=="replace_arch");return this._editView(operations);}else{const viewId=lastOp.viewId;let{newArch,oldArch}=lastOp;if(mode==="undo"){const _newArch=newArch;newArch=oldArch;oldArch=_newArch;}
return this._editViewArch(viewId,newArch);}}
_handleDone({mode,pending,pendingUndone,result}){this.env.bus.trigger("CLEAR-CACHES");if(result){this.viewDescriptions.relatedModels=result.models;const oldArch=this._views[this.mainViewType].arch;const newArch=result.views[this.mainViewType].arch;this._views[this.mainViewType].arch=newArch;if(oldArch===newArch){this.isInEdition=false;}
if(!this.studioViewId&&result.studio_view_id){this.studioViewId=result.studio_view_id;}}
const isUndoing=mode==="undo";const pendingOps=isUndoing?pendingUndone:pending;const lastOperation=pendingOps[pendingOps.length-1];if(lastOperation&&lastOperation.type==="replace_arch"){if(lastOperation.viewId===this.studioViewId){this.studioViewArch=isUndoing?lastOperation.oldArch:lastOperation.newArch;this._operations.clear();const ops=isUndoing?this._operations.undone:this._operations.operations;ops.push(lastOperation);}}}
async _handleError({mode,pending,error}){this.isInEdition=false;this._services.notification.add(_t("This operation caused an error, probably because a xpath was broken"),{type:"danger",title:_t("Error"),});Promise.resolve().then(()=>{throw error;});this.resetSidebar("view");this.bus.trigger("error");}
async _getStudioViewArch(){const result=await this._rpc("/web_studio/get_studio_view_arch",{model:this.resModel,view_type:this.viewType,view_id:this.mainView.id,context:{...this._services.user.context,lang:false},});return{arch:result.studio_view_arch,viewId:result.studio_view_id,mainViewId:result.main_view_id,};}
get _subviewInfo(){if(!this.isEditingSubview){return null;}
const length=this.breadcrumbs.length;return this.breadcrumbs[length-1];}
get _fieldsAllowedRename(){return this._getFieldsAllowedRename(this.breadcrumbs.length>1?this.breadcrumbs.length:1);}}
__exports.useEditNodeAttributes=useEditNodeAttributes;function useEditNodeAttributes({isRoot=false}={}){const vem=useEnv().viewEditorModel;function editNodeAttributes(newAttributes){let target;let node;if(isRoot){target=vem.getFullTarget(`/${vem.viewType === "list" ? "tree" : vem.viewType}`);target.isSubviewAttr=true;}else{target=vem.getFullTarget(vem.activeNodeXpath);const{arch,attrs}=vem.activeNode;node={tag:arch.tagName,attrs,};}
const operation={new_attrs:newAttributes,type:"attributes",position:"attributes",target,};if(node){operation.node=node;}
return vem.doOperation(operation);}
return editNodeAttributes;}
return __exports;});;

/* /web_studio/static/src/client_action/view_editor/view_structures/view_structures.js */
odoo.define('@web_studio/client_action/view_editor/view_structures/view_structures',['@odoo/owl','@web/core/l10n/translation'],function(require){'use strict';let __exports={};const{Component,useState}=require("@odoo/owl");const{_lt}=require("@web/core/l10n/translation");const ExistingFields=__exports.ExistingFields=class ExistingFields extends Component{static props={fieldsInArch:{type:Array},fields:{type:Object},filterFields:{type:Boolean,optional:true},folded:{type:Boolean,optional:true},};static defaultProps={folded:true,filterFields:true,};static template="web_studio.ViewStructures.ExistingFields";setup(){this.state=useState({folded:this.props.folded,searchValue:"",});}
isMatchingSearch(field){if(!this.state.searchValue){return true;}
const search=this.state.searchValue.toLowerCase();let matches=field.string.toLowerCase().includes(search);if(!matches&&this.env.debug&&field.name){matches=field.name.toLowerCase().includes(search);}
return matches;}
get existingFields(){const fieldsInArch=this.props.fieldsInArch;const filtered=Object.entries(this.props.fields).filter(([fName,field])=>{if(!this.isMatchingSearch(field)||this.props.filterFields&&fieldsInArch.includes(fName)){return false;}
return true;});return filtered.map(([fName,field])=>{return{...field,name:fName,classType:field.type,dropData:JSON.stringify({fieldName:fName}),};});}
getDropInfo(field){return{structure:"field",fieldName:field.name,isNew:false,};}}
const newFields=[{type:"char",string:_lt("Text")},{type:"text",string:_lt("Multine Text")},{type:"integer",string:_lt("Integer")},{type:"float",string:_lt("Decimal")},{type:"html",string:_lt("HTML")},{type:"monetary",string:_lt("Monetary")},{type:"date",string:_lt("Date")},{type:"datetime",string:_lt("Datetime")},{type:"boolean",string:_lt("CheckBox")},{type:"selection",string:_lt("Selection")},{type:"binary",string:_lt("File"),widget:"file"},{type:"one2many",string:_lt("Lines"),special:"lines"},{type:"one2many",string:_lt("One2Many")},{type:"many2one",string:_lt("Many2One")},{type:"many2many",string:_lt("Many2Many")},{type:"binary",string:_lt("Image"),widget:"image",name:"picture"},{type:"many2many",string:_lt("Tags"),widget:"many2many_tags",name:"tags"},{type:"selection",string:_lt("Priority"),widget:"priority"},{type:"binary",string:_lt("Signature"),widget:"signature"},{type:"related",string:_lt("Related Field")},];const NewFields=__exports.NewFields=class NewFields extends Component{static props={};static template="web_studio.ViewStructures.NewFields";get newFieldsComponents(){return newFields.map((f)=>{const classType=f.special||f.name||f.widget||f.type;return{...f,name:classType,classType,dropData:JSON.stringify({fieldType:f.type,widget:f.widget,name:f.name,special:f.special,string:f.string,}),};});}}
return __exports;});;

/* /web_studio/static/src/client_action/view_editor/xml_editor/resizable_panel/resizable_panel.js */
odoo.define('@web_studio/client_action/view_editor/xml_editor/resizable_panel/resizable_panel',['@odoo/owl','@web/core/utils/hooks'],function(require){'use strict';let __exports={};const{Component,onMounted,useExternalListener,useRef}=require("@odoo/owl");const{useRefListener}=require("@web/core/utils/hooks");function useResizableWidth({containerRef,handleRef,minWidth=400,onResize=()=>{}}){containerRef=typeof containerRef=="string"?useRef(containerRef):containerRef;handleRef=typeof handleRef=="string"?useRef(handleRef):handleRef;let isChangingSize=false;useExternalListener(document,"mouseup",()=>onMouseUp());useExternalListener(document,"mousemove",(ev)=>onMouseMove(ev));useRefListener(handleRef,"mousedown",()=>onMouseDown());onMounted(()=>{if(containerRef.el){containerRef.el.classList.add("o_resizable_panel");resize(minWidth);}});function onMouseDown(){isChangingSize=true;}
function onMouseUp(){isChangingSize=false;}
function onMouseMove(ev){if(!isChangingSize||!containerRef.el){return;}
ev.stopPropagation();ev.preventDefault();const containerOffset=containerRef.el.offsetLeft;const pointerRelativePos=ev.clientX-containerOffset;const handlerSpacing=handleRef.el?handleRef.el.offsetWidth/2:10;const width=Math.max(minWidth,pointerRelativePos+handlerSpacing);resize(width);}
function resize(width){containerRef.el.style.width=`${width}px`;onResize(width);}}
const ResizablePanel=__exports.ResizablePanel=class ResizablePanel extends Component{static template="web_studio.ResizablePanel";static components={};static props={onResize:{type:Function,optional:true},minWidth:{type:Number,optional:true},class:{type:String,optional:true},slots:{type:Object},};static defaultProps={onResize:()=>{},minWidth:400,class:"",};setup(){useResizableWidth({containerRef:"containerRef",handleRef:"handleRef",onResize:this.props.onResize,minWidth:this.props.minWidth,});}}
return __exports;});;

/* /web_studio/static/src/client_action/view_editor/xml_editor/xml_editor.js */
odoo.define('@web_studio/client_action/view_editor/xml_editor/xml_editor',['@odoo/owl','@web/core/l10n/translation','@web_studio/client_action/view_editor/xml_editor/resizable_panel/resizable_panel','@web/core/code_editor/code_editor','@web/core/select_menu/select_menu','@web/core/utils/hooks'],function(require){'use strict';let __exports={};const{Component,onWillStart,onWillUpdateProps,useState}=require("@odoo/owl");const{_lt}=require("@web/core/l10n/translation");const{ResizablePanel}=require("@web_studio/client_action/view_editor/xml_editor/resizable_panel/resizable_panel");const{CodeEditor}=require("@web/core/code_editor/code_editor");const{SelectMenu}=require("@web/core/select_menu/select_menu");const{useBus,useService}=require("@web/core/utils/hooks");const XmlEditor=__exports.XmlEditor=class XmlEditor extends Component{static template="web_studio.XmlEditor";static components={ResizablePanel,CodeEditor,SelectMenu};static props={slots:{type:Object},studioViewArch:{type:String},};setup(){this.rpc=useService("rpc");this.viewEditorModel=this.env.viewEditorModel;this.state=useState({resourcesOptions:[],currentResource:null,studioViewArch:this.props.studioViewArch,});useBus(this.viewEditorModel.bus,"error",()=>this.render(true));onWillStart(()=>this.loadResources());onWillUpdateProps((nextProps)=>{this.state.studioViewArch=nextProps.studioViewArch;this.tempCode="";});this.hiddenAlerts=useState({});this.alerts=[{message:_lt("Editing a built-in file through this editor is not advised, as it will prevent it from being updated during future App upgrades."),},];}
isStudioResource(resource){return resource.id===this.viewEditorModel.studioViewId;}
get arch(){const currentResource=this.state.currentResource;if(!currentResource){return"";}
if(this.isStudioResource(currentResource)){return this.state.studioViewArch;}
return currentResource.arch;}
set arch(value){const currentResource=this.state.currentResource;if(!currentResource){return;}
if(this.isStudioResource(currentResource)){this.state.studioViewArch=value;}else{currentResource.arch=value;}}
onFormat(){this.arch=window.vkbeautify.xml(this.tempCode||this.arch,4);}
hideAlert(alert){this.hiddenAlerts[alert.message]=true;}
shouldShowAlert(alert){return!(this.hiddenAlerts[alert.message]===true);}
onCloseClick(){this.env.viewEditorModel.switchMode();}
onCodeChange(code){this.tempCode=code;}
onSaveClick(){if(!this.tempCode){return;}
const resource=this.state.currentResource;const viewId=resource.id;this.env.viewEditorModel.doOperation({type:"replace_arch",viewId,oldArch:resource.oldArch,newArch:this.tempCode,});}
onResourceChange(resource){this.state.currentResource=resource;this.tempCode="";}
async loadResources(){const resources=await this.rpc("/web_editor/get_assets_editor_resources",{key:this.env.viewEditorModel.view.id,get_views:true,get_scss:false,get_js:false,bundles:false,bundles_restriction:[],only_user_custom_files:true,});const resourcesOptions=resources.views.map((res)=>({label:`${res.name} (${res.xml_id})`,value:{...res,oldArch:res.arch,},}));this.state.resourcesOptions=resourcesOptions;if(resourcesOptions.length>=1){const studioView=resourcesOptions.find((opt)=>opt.value.id===this.viewEditorModel.studioViewId);if(studioView){this.state.studioViewArch=studioView.value.arch;this.state.currentResource=studioView.value;}else{this.state.currentResource=this.state.resourcesOptions[0].value;}}}}
return __exports;});;

/* /web_studio/static/src/views/kanban_report/new_report_dialog.js */
odoo.define('@web_studio/views/kanban_report/new_report_dialog',['@odoo/owl','@web/core/dialog/dialog','@web/core/l10n/translation','@web/core/utils/hooks'],function(require){'use strict';let __exports={};const{Component}=require("@odoo/owl");const{Dialog}=require("@web/core/dialog/dialog");const{_t}=require("@web/core/l10n/translation");const{useService}=require("@web/core/utils/hooks");const NewReportDialog=__exports.NewReportDialog=class NewReportDialog extends Component{setup(){this.rpc=useService("rpc");this.user=useService("user");this.layouts=[{name:"web.external_layout",label:_t("External"),description:_t("Business header/footer"),},{name:"web.internal_layout",label:_t("Internal"),description:_t("Minimal header/footer"),},{name:"web.basic_layout",label:_t("Blank"),description:_t("No header/footer"),},];}
async createNewReport(layout){const report=await this.rpc("/web_studio/create_new_report",{model_name:this.props.resModel,layout,context:this.user.context,});this.props.onReportCreated(report);this.props.close();}}
NewReportDialog.template="web_studio.NewReportDialog";NewReportDialog.components={Dialog};NewReportDialog.props=["resModel","onReportCreated","close"];return __exports;});;

/* /web_studio/static/src/views/kanban_report/report_kanban_view.js */
odoo.define('@web_studio/views/kanban_report/report_kanban_view',['@web/core/registry','@web/core/utils/hooks','@web/views/kanban/kanban_view','@web/views/kanban/kanban_controller','@web_studio/views/kanban_report/new_report_dialog'],function(require){'use strict';let __exports={};const{registry}=require("@web/core/registry");const{useService}=require("@web/core/utils/hooks");const{kanbanView}=require("@web/views/kanban/kanban_view");const{KanbanController}=require("@web/views/kanban/kanban_controller");const{NewReportDialog}=require("@web_studio/views/kanban_report/new_report_dialog");class StudioReportKanbanController extends KanbanController{setup(){super.setup();this.actionService=useService("action");this.dialogService=useService("dialog");this.orm=useService("orm");}
createRecord(){this.dialogService.add(NewReportDialog,{resModel:this.props.context.default_model,onReportCreated:(report)=>{this.openRecord({data:report,resId:report.id});},});}
openRecord(record){return this.actionService.doAction("web_studio.action_edit_report",{report:{data:record.data,res_id:record.resId,},});}}
const studioReportKanbanView={...kanbanView,Controller:StudioReportKanbanController,};registry.category("views").add("studio_report_kanban",studioReportKanbanView);return __exports;});;

/* /web_studio/static/src/legacy/js/py.js */
(function(py){var Python=function(expr,type,params){this.expr=expr;this.params=params;if(type==='call'){this.isCall=true;}
if(type==='field'){this.isField=true;}
if(type==='operator'){this.isOperator=true;}};Python.prototype.isPython=true;Python.prototype.toString=function(){return this.expr+'';};function extract(expr){switch(expr.id){case'(name)':switch(expr.value){case'true':return true;case'false':return false;}
return new Python(expr.value,'field');case'(string)':case'(number)':case'(constant)':switch(expr.value){case'None':return null;case'False':return false;case'True':return true;}
return expr.value;case'(':var func=extract(expr.first);var error=false;if(func.isPython&&func.expr==='dict'){var obj={};for(var l=0;l<expr.second.length;++l){var kv=expr.second[l];if(kv.id==="="){obj[extract(kv.first)]=extract(kv.second);}else{error=true;}}
if(!error){return obj;}}
var array=[];for(var l=0;l<expr.second.length;++l){var kv=expr.second[l];array.push(extract(kv));}
var res=new Python(func+'('+array.join(', ')+')','call',{object:func.isField?func.params.slice(0,-1):[],method:func.isField?func.params[func.params.length-1]:func,args:array,});if(error){throw new Error('SyntaxError: '+res);}
return res;case'[':if(expr.second){var value=extract(expr.first);var attribute=extract(expr.second);return new Python(value+'['+attribute+']','attribute',{value:value,attribute:attribute,});}
var array=[];for(var l=0;l<expr.first.length;++l){array.push(extract(expr.first[l]));}
return array;case'{':var obj={};for(var l=0;l<expr.first.length;++l){var kv=expr.first[l];obj[extract(kv[0])]=extract(kv[1]);}
return obj;case'.':if(expr.second.id!=='(name)'){throw new Error('SyntaxError: '+expr);}
var params=[];var first=extract(expr.first);if(first.isAttribute){params.push.apply(params,first.params);}else{params.push(first.expr);}
var second=extract(expr.second);if(second.isAttribute){params.push.apply(params,second.params);}else{params.push(second.expr);}
return new Python(params.join('.'),'field',params);case'=':return extract(expr.first)+'='+extract(expr.second);case'(comparator)':var string='';var values=[];for(var l=0;l<expr.expressions.length;++l){var value=extract(expr.expressions[l]);values.push(value);if(l>0){string+=expr.operators[l-1];}
string+=value;}
return new Python(string,'operator',{operators:expr.operators,values:values,});}}
py.extract=function(str){return extract(py.parse(py.tokenize(str)));};})(typeof exports==='undefined'?py:exports);;

/* /web_studio/static/src/legacy/js/common/abstract_editor_manager.js */
odoo.define('@web_studio/legacy/js/common/abstract_editor_manager',['web.concurrency','web.core','web.Widget','web_studio.bus','web_studio.XMLEditor','web.OwlCompatibility'],function(require){'use strict';let __exports={};const concurrency=require("web.concurrency");const core=require("web.core");const Widget=require("web.Widget");const bus=require("web_studio.bus");const XMLEditor=require("web_studio.XMLEditor");const{ComponentWrapper}=require("web.OwlCompatibility");var _lt=core._lt;var _t=core._t;var AbstractEditorManager=Widget.extend({className:'o_web_studio_editor_manager_legacy',custom_events:{close_xml_editor:'_onCloseXMLEditor',drag_component:'_onDragComponent',node_clicked:'_onNodeClicked',open_xml_editor:'_onOpenXMLEditor',save_xml_editor:'_onSaveXMLEditor',sidebar_tab_changed:'_onSidebarTabChanged',studio_error:'_onStudioError',view_change:'_onViewChange',},error_messages:{wrong_xpath:_lt("This operation caused an error, probably because a xpath was broken"),view_rendering:_lt("The requested change caused an error in the view. It could be because a field was deleted, but still used somewhere else."),},init:function(){this._super.apply(this,arguments);this.editor=undefined;this.sidebar=undefined;this.sidebarScrollTop=undefined;this.mode='edition';this.operations=[];this.operations_undone=[];this.mdp=new concurrency.MutexedDropPrevious();bus.on('undo_clicked',this,this._undo);bus.on('redo_clicked',this,this._redo);},start:function(){var self=this;return this._super.apply(this,arguments).then(function(){return self._instantiateEditor().then(function(editor){var defs=[];var $editorFragment=$('<div>',{class:'o_web_studio_view_renderer',});self.editor=editor;if(self.editor instanceof ComponentWrapper){defs.push(self.editor.mount($editorFragment[0]));}else{defs.push(self.editor.appendTo($editorFragment));}
$editorFragment.appendTo(self.$el);self.sidebar=self._instantiateSidebar();defs.push(self.sidebar.prependTo(self.$el));return Promise.all(defs);});});},destroy:function(){bus.trigger('undo_not_available');bus.trigger('redo_not_available');this._super.apply(this,arguments);},on_attach_callback:function(){if(this.editor&&this.editor.on_attach_callback){this.editor.on_attach_callback();}
this.isInDOM=true;},on_detach_callback:function(){if(this.editor&&this.editor.on_detach_callback){this.editor.on_detach_callback();}
this.isInDOM=false;},_applyChanges:function(remove_last_op,from_xml){var self=this;var lastOp=this.operations.slice(-1)[0];var lastOpID=lastOp&&lastOp.id;bus.trigger('toggle_snack_bar','saving');var def;if(from_xml){def=this.mdp.exec(this._editViewArch.bind(this,lastOp.view_id,lastOp.new_arch)).guardedCatch(function(){self.trigger_up('studio_error',{error:'view_rendering'});});}else{def=this.mdp.exec(function(){var serverOperations=[];_.each(self.operations,function(op){if(op.type!=='replace_arch'){serverOperations.push(_.omit(op,'id'));}});var prom=self._editView(self.view_id,self.studio_view_arch,serverOperations);prom.guardedCatch(function(){self.trigger_up('studio_error',{error:'wrong_xpath'});return self._undo(lastOpID,true).then(function(){return Promise.reject();});});return prom;});}
return def.then(function(result){if(from_xml){self._cleanOperationsStack(lastOp);}
if(remove_last_op){self.operations.pop();}
return self._applyChangeHandling(result,lastOpID,from_xml);}).then(function(){self._updateButtons();if(self.sidebar.state.mode!=='properties'){self._updateSidebar(self.sidebar.state.mode);}
bus.trigger('toggle_snack_bar','saved');});},_applyChangeHandling:function(result,opID,from_xml){return Promise.resolve();},_cleanOperationsStack:function(lastOp){this.operations=[];this.operations_undone=[];},_do:function(op){op.id=_.uniqueId('op_');this.operations.push(op);this.operations_undone=[];return this._applyChanges(false,op.type==='replace_arch');},_getSidebarState:function(mode,params){var newState=mode?{mode:mode}:this.sidebar.state;return Promise.resolve(newState);},_editView:function(view_id,studio_view_arch,operations){return Promise.resolve();},_editViewArch:function(view_id,view_arch){return Promise.resolve();},_instantiateEditor:function(params){return Promise.resolve();},_instantiateSidebar:function(state){},_redo:function(){if(!this.operations_undone.length){return;}
var op=this.operations_undone.pop();this.operations.push(op);return this._applyChanges(false,op.type==='replace_arch');},_updateButtons:function(){if(this.operations.length){bus.trigger('undo_available');}else{bus.trigger('undo_not_available');}
if(this.operations_undone.length){bus.trigger('redo_available');}else{bus.trigger('redo_not_available');}},_updateSidebar:function(mode,params){var self=this;if(this.sidebar.$el){this.sidebarScrollTop=this.sidebar.$el.scrollTop();}
return this._getSidebarState(mode,params).then(function(newState){var oldSidebar=self.sidebar;var previousState=oldSidebar.getLocalState?oldSidebar.getLocalState():undefined;const newSidebar=self._instantiateSidebar(newState,previousState);self.sidebar=newSidebar;var fragment=document.createDocumentFragment();return newSidebar.appendTo(fragment).then(function(){oldSidebar.destroy();if(!newSidebar.isDestroyed()){newSidebar.$el.prependTo(self.$el);if(newSidebar.on_attach_callback){newSidebar.on_attach_callback();}
newSidebar.$el.scrollTop(self.sidebarScrollTop);if(self.mode==='rendering'){newSidebar.$el.detach();}}});});},_undo:function(opID,forget){if(!this.operations.length){return Promise.resolve();}
var op;if(opID){op=_.findWhere(this.operations,{id:opID});this.operations=_.without(this.operations,op);}else{op=this.operations.pop();}
if(!forget){this.operations_undone.push(op);}
if(op.type==='replace_arch'){var undo_op=jQuery.extend(true,{},op);undo_op.old_arch=op.new_arch;undo_op.new_arch=op.old_arch;this.operations.push(undo_op);return this._applyChanges(true,true);}else{return this._applyChanges(false,false);}},_onCloseXMLEditor:function(){this.XMLEditor.destroy();this.XMLEditor=null;this.sidebar.prependTo(this.$el);$('body').removeClass('o_in_studio_xml_editor');this.mode='edition';},_onDragComponent:function(ev){},_onNodeClicked:function(ev){},_onOpenXMLEditor:function(){var self=this;this.mode='rendering';this.XMLEditor=new XMLEditor(this,this.view_id,{position:'left',doNotLoadSCSS:true,doNotLoadJS:true,});this.XMLEditor.prependTo(this.$el).then(function(){self.sidebar.$el.detach();$('body').addClass('o_in_studio_xml_editor');});},_onSaveXMLEditor:function(ev){this._do({type:'replace_arch',view_id:ev.data.view_id,old_arch:ev.data.old_arch,new_arch:ev.data.new_arch,}).then(function(){if(ev.data.on_success){ev.data.on_success();}},function(){if(ev.data.on_fail){ev.data.on_fail();}});},_onSidebarTabChanged:function(ev){this._updateSidebar(ev.data.mode);this.editor.unselectedElements();},_onStudioError:function(ev){this.displayNotification({title:_t("Error"),message:this.error_messages[ev.data.error],type:'danger'});},_onViewChange:function(ev){},});__exports[Symbol.for("default")]=AbstractEditorManager;return __exports;});odoo.define(`web_studio.AbstractEditorManager`,['@web_studio/legacy/js/common/abstract_editor_manager'],function(require){return require('@web_studio/legacy/js/common/abstract_editor_manager')[Symbol.for("default")];});;

/* /web_studio/static/src/legacy/js/common/new_field_dialog.js */
odoo.define('@web_studio/legacy/js/common/new_field_dialog',['web.config','web.core','web.Dialog','web.relational_fields','web.ModelFieldSelector','web.StandaloneFieldManagerMixin'],function(require){'use strict';let __exports={};const config=require("web.config");const core=require("web.core");const Dialog=require("web.Dialog");const relational_fields=require("web.relational_fields");const ModelFieldSelector=require("web.ModelFieldSelector");const StandaloneFieldManagerMixin=require("web.StandaloneFieldManagerMixin");var _t=core._t;var qweb=core.qweb;var Many2one=relational_fields.FieldMany2One;var NewFieldDialog=Dialog.extend(StandaloneFieldManagerMixin,{template:'web_studio.NewFieldDialogLegacy',events:{'keyup .o_web_studio_selection_new_value > input':'_onAddSelectionValue','click .o_web_studio_edit_selection_value':'_onEditSelectionValue','click .o_web_studio_remove_selection_value':'_onRemoveSelectionValue','click .o_web_studio_add_selection_value':'_onAddSelectionValue','click .o_web_studio_clear_selection_value':'_onClearSelectionValue','blur .o_web_studio_selection_editor .o_web_studio_selection_input':'_onSelectionInputBlur',},init:function(parent,model_name,field,fields,field_chain){this.model_name=model_name;this.type=field.type;this.field=field;this.fieldChain=field_chain||[];this.order=field.order;this.followRelations=field.followRelations||function(field){return true;};this.filter=field.filter||function(field){return true;};this.filters=field.filters;if(this.type==='selection'){this.selection=this.field.selection&&this.field.selection.slice()||[];}
this.fields=fields;var options=_.extend({title:_t('Field Properties'),size:'small',buttons:[{text:_t("Confirm"),classes:'btn-primary',click:this._onSave.bind(this),},{text:_t("Cancel"),close:true,}],},options);this._super(parent,options);StandaloneFieldManagerMixin.init.call(this);},renderElement:function(){this._super.apply(this,arguments);if(this.type==='selection'){this.$('.o_web_studio_selection_editor').sortable({axis:'y',containment:'.o_web_studio_field_dialog_form',items:'> li',helper:'clone',handle:'.input-group',opacity:0.6,stop:this._resequenceSelection.bind(this),});}},start:function(){var self=this;var defs=[];var record;var options={mode:'edit',};this.$modal.addClass('o_web_studio_field_modal');if(this.type==='selection'){this.opened().then(function(){self.$('.o_web_studio_selection_new_value > input').focus();});}else if(this.type==='one2many'){defs.push(this.model.makeRecord('ir.model.fields',[{name:'field',relation:'ir.model.fields',type:'many2one',domain:[['relation','=',this.model_name],['ttype','=','many2one'],['model_id.abstract','=',false]],}],{'field':{can_create:false,}}).then(function(recordID){record=self.model.get(recordID);self.many2one_field=new Many2one(self,'field',record,options);self._registerWidget(recordID,'field',self.many2one_field);self.many2one_field.nodeOptions.no_create_edit=!config.isDebug();self.many2one_field.appendTo(self.$('.o_many2one_field'));}));}else if(_.contains(['many2many','many2one'],this.type)){defs.push(this.model.makeRecord('ir.model',[{name:'model',relation:'ir.model',type:'many2one',domain:[['transient','=',false],['abstract','=',false]]}]).then(function(recordID){record=self.model.get(recordID);self.many2one_model=new Many2one(self,'model',record,options);self._registerWidget(recordID,'model',self.many2one_model);self.many2one_model.nodeOptions.no_create_edit=!config.isDebug();self.many2one_model.appendTo(self.$('.o_many2one_model'));}));}else if(this.type==='related'){this.$el.css("overflow","visible").closest(".modal-dialog").css("height","auto");var field_options={order:this.order,filter:this.filter,followRelations:this.followRelations,fields:this.fields,readonly:false,filters:_.extend({},this.filters,{searchable:false}),};this.fieldSelector=new ModelFieldSelector(this,this.model_name,this.fieldChain,field_options);defs.push(this.fieldSelector.appendTo(this.$('.o_many2one_field')));}
defs.push(this._super.apply(this,arguments));return Promise.all(defs);},_resequenceSelection:function(){var self=this;var newSelection=[];this.$('.o_web_studio_selection_editor li').each(function(index,u){var value=u.dataset.value;var string=_.find(self.selection,function(el){return el[0]===value;})[1];newSelection.push([value,string]);});this.selection=newSelection;},_onAddSelectionValue:function(e){if(e.type==="keyup"&&e.which!==$.ui.keyCode.ENTER){return;}
var $input=this.$(".o_web_studio_selection_new_value input");var string=$input.val().trim();if(string&&!_.find(this.selection,function(el){return el[1]===string;})){this.selection.push([string,string]);}
this.renderElement();this.$('.o_web_studio_selection_new_value > input').focus();},_onEditSelectionValue:function(ev){var self=this;var $btn=$(ev.currentTarget);if(config.isDebug()){var val=$btn.closest('li')[0].dataset.value;var index=_.findIndex(this.selection,function(el){return el[0]===val;});new Dialog(this,{title:_t('Edit Value'),size:'small',$content:$(qweb.render('web_studio.SelectionValues.edit',{element:self.selection[index],})),buttons:[{text:_t('Confirm'),classes:'btn-primary',close:true,click:function(){var newValue=this.$('input#o_selection_value').val()||val;var newString=this.$('input#o_selection_label').val();self.selection[index]=[newValue,newString];self.renderElement();}},{text:_t('Close'),close:true},],}).open();}else{$btn.toggleClass('fa-check fa-pencil-square-o');var $input=$btn.closest('li').find('.o_web_studio_selection_input.d-none');var $span=$input.siblings('.o_web_studio_selection_label');$input.val($span.toggleClass('d-none').text().trim()).toggleClass('d-none').focus();}},_onRemoveSelectionValue:function(e){var val=$(e.target).closest('li')[0].dataset.value;var element=_.find(this.selection,function(el){return el[0]===val;});var index=this.selection.indexOf(element);if(index>=0){this.selection.splice(index,1);}
this.renderElement();},_onClearSelectionValue:function(){this.$('.o_web_studio_selection_input').val("").focus();},_onSave:function(){var values={};if(this.type==='one2many'){if(!this.many2one_field.value){this.trigger_up('warning',{title:_t('You must select a related field')});return;}
values.relation_field_id=this.many2one_field.value.res_id;}else if(_.contains(['many2many','many2one'],this.type)){if(!this.many2one_model.value){this.trigger_up('warning',{title:_t('You must select a relation')});return;}
values.relation_id=this.many2one_model.value.res_id;values.field_description=this.many2one_model.m2o_value;}else if(this.type==='selection'){var newSelection=this.$('.o_web_studio_selection_new_value > input').val();if(newSelection){this.selection.push([newSelection,newSelection]);}
if(!this.selection.length){this.trigger_up('warning',{title:_t('You must have at least one option set')});return;}
values.selection=JSON.stringify(this.selection);}else if(this.type==='related'){var selectedField=this.fieldSelector.getSelectedField();if(!selectedField){this.trigger_up('warning',{title:_t('You must select a related field')});return;}
values.string=selectedField.string;values.model=selectedField.model;values.related=this.fieldSelector.chain.join('.');values.type=selectedField.type;values.readonly=true;values.copy=false;values.store=selectedField.store;if(_.contains(['many2one','many2many'],selectedField.type)){values.relation=selectedField.relation;}else if(selectedField.type==='one2many'){values.relational_model=selectedField.model;}else if(selectedField.type==='selection'){values.selection=selectedField.selection;}else if(selectedField.type==='monetary'){var currencyField=_.find(_.last(this.fieldSelector.pages),function(el){return el.name==='currency_id'||el.name==='x_currency_id';});if(currencyField){var chain=this.fieldSelector.chain.slice();chain.splice(chain.length-1,1,currencyField.name);values._currency=chain.join('.');}}
if(_.contains(['one2many','many2many'],selectedField.type)){values.store=false;}}
this.trigger('field_default_values_saved',values);},_onSelectionInputBlur:function(ev){var $input=$(ev.currentTarget);var val=$input.closest('li')[0].dataset.value;var index=_.findIndex(this.selection,function(el){return el[0]===val;});this.selection[index][1]=$input.val();this.renderElement();},});__exports[Symbol.for("default")]=NewFieldDialog;return __exports;});odoo.define(`web_studio.NewFieldDialog`,['@web_studio/legacy/js/common/new_field_dialog'],function(require){return require('@web_studio/legacy/js/common/new_field_dialog')[Symbol.for("default")];});;

/* /web_studio/static/src/legacy/js/common/xml_editor.js */
odoo.define('@web_studio/legacy/js/common/xml_editor',['web_editor.ace'],function(require){'use strict';let __exports={};const AceEditor=require("web_editor.ace");__exports[Symbol.for("default")]=AceEditor.extend({do_hide:function(){this.trigger_up("close_xml_editor");this._super.apply(this,arguments);},_isCustomResource(resID){if(this.currentType==="xml"){return _.str.startsWith(this.views[resID].xml_id,'studio_customization');}else{return this._super(...arguments);}},_saveView:function(session){var self=this;var view=this.views[session.id];var old_arch=view.arch;var new_arch=session.text;return new Promise(function(resolve,reject){self.trigger_up('save_xml_editor',{view_id:session.id,old_arch:old_arch,new_arch:new_arch,on_success:function(){self._toggleDirtyInfo(session.id,"xml",false);view.arch=new_arch;resolve();},on_fail:reject,});});},});return __exports;});odoo.define(`web_studio.XMLEditor`,['@web_studio/legacy/js/common/xml_editor'],function(require){return require('@web_studio/legacy/js/common/xml_editor')[Symbol.for("default")];});;

/* /web_studio/static/src/legacy/js/reports/report_editor.js */
odoo.define('@web_studio/legacy/js/reports/report_editor',['web.core','web.Widget','web_studio.EditorMixin'],function(require){'use strict';let __exports={};const core=require("web.core");const Widget=require("web.Widget");const EditorMixin=require("web_studio.EditorMixin");var _t=core._t;var ReportEditor=Widget.extend(EditorMixin,{template:'web_studio.ReportEditor',nearest_hook_tolerance:500,events:_.extend({},Widget.prototype.events,{'click':'_onClick',}),init:function(parent,params){this._super.apply(this,arguments);this.nodesArchs=params.nodesArchs;this.reportHTML=params.reportHTML;this.paperFormat=params.paperFormat||{};this.$content=$();this.$noContentHelper=$();this.selectedNode=null;this.$targetHighlight=$();this.$dropZone=$();this._onUpdateContentId=_.uniqueId('_processReportPreviewContent');this.isDragging=false;},start:function(){this.$iframe=this.$('iframe');this.$iframe.one('load',this._updateContent.bind(this));return this._super.apply(this,arguments);},destroy:function(){window.top[this._onUpdateContentId]=null;delete window.top[this._onUpdateContentId];if(this.$content){this.$content.off('click');this.$content.off('load');}
return this._super.apply(this,arguments);},beginDragComponent:function(component){this.isDragging=true;if(this.$content.find('.o_web_studio_hook').length===0){this._prepareHooksOnIframeBeforeDrag(component);}},beginPreviewDragComponent:function(component){if(this.isDragging){return;}
this._prepareHooksOnIframeBeforeDrag(component);},_prepareHooksOnIframeBeforeDrag:function(component){var self=this;this._cleanHooks();this.$noContentHelper.remove();var dropIn=component.dropIn;if(component.dropColumns&&component.addEmptyRowsTargets){dropIn=(dropIn?dropIn+',':'')+'.page > .row > div:empty';}
if(dropIn){var inSelectors=dropIn.split(component.selectorSeparator||',');_.each(inSelectors,function(selector){var $target=self.$content.find(selector+"[data-oe-xpath]");_.each($target,function(node){if(!$(node).data('node')){return;}
self._createHookOnNodeAndChildren($(node),component);});});}
if(component.dropColumns){var $hook=self._createHook($('<div/>'),component);var $gridHooks=$('<div class="row o_web_studio_structure_hook"/>');_.each(component.dropColumns,function(column,index){var $col=$('<div class="offset-'+column[0]+' col-'+column[1]+'"/>');$col.append($hook.clone().attr('data-oe-index',index));$gridHooks.append($col);});var $page=this.$content.find('.page');var $children=$page.children().not('.o_web_studio_hook,p:not([data-oe-id])');if($children.length){$gridHooks.find('.o_web_studio_hook').data('oe-node',$children.first()).data('oe-position','before');$children.first().before($gridHooks);_.each($children,function(child){var $child=$(child);var $newHook=$gridHooks.clone();$newHook.find('.o_web_studio_hook').data('oe-node',$child).data('oe-position','after');$child.after($newHook);});}else{$gridHooks.find('.o_web_studio_hook').data('oe-node',$page).data('oe-position','inside');$page.prepend($gridHooks);}
this.$content.find('.o_web_studio_structure_hook + .o_web_studio_hook').remove();this.$content.find('.o_web_studio_structure_hook').prev('.o_web_studio_hook').remove();}
this.$content.find('.o_web_studio_hook + .o_web_studio_hook').remove();this.$dropZone=this.$content.find('.o_web_studio_hook');this.$dropZoneStructure=this.$content.find('.o_web_studio_structure_hook');this.$dropZoneStructure.removeClass('.o_web_studio_nearest').each(function(){$(this).children().children('.o_web_studio_hook:only-child').data('height',$(this).height()+'px');});this._computeNearestHookAndShowIt();this.$dropZone.filter('th, td').each(function(_,item){var $item=$(item);var $node=$item.data('oe-node');var colspan=+$node.data('colspan');if(colspan>1){$node.attr('colspan',colspan*2-1);}});},dragComponent:function(component,x,y){this.isDragging=true;this.$dropZone.filter('.o_web_studio_nearest_hook').removeClass('o_web_studio_nearest_hook').closest(this.$dropZoneStructure).each(function(){$(this).children().css('height','').children('.o_web_studio_hook:only-child').css('height','');});this.$dropZoneStructure.removeClass('o_web_studio_nearest');var bound=this.$iframe[0].getBoundingClientRect();var isInIframe=(x>=bound.left&&x<=bound.right)&&(y>=bound.top&&y<=bound.bottom);if(!isInIframe){return;}
_.each(this.dropPosition,function(box){box.dist=Math.sqrt(Math.pow(box.centerY-(y-bound.top),2)+Math.pow(box.centerX-(x-bound.left),2));});this.dropPosition.sort(function(a,b){return a.dist-b.dist;});if(!this.dropPosition[0]||this.dropPosition[0].dist>this.nearest_hook_tolerance){return;}
var $nearestHook=$(this.dropPosition[0].el);$nearestHook.addClass('o_web_studio_nearest_hook').closest(this.$dropZoneStructure).addClass('o_web_studio_nearest');if(!$nearestHook.data('oe-node')||!$nearestHook.data('oe-node').data('oe-id')){return;}
var $node=$nearestHook.data('oe-node');var id=$node.data('oe-id');var xpath=$node.data('oe-xpath');var position=$nearestHook.data('oe-position');var index=$nearestHook.data('oe-index');var td=$node.is('td, th');var reg,replace;if(td){reg=/^(.*?)\/(thead|tbody|tfoot)(.*?)\/(td|th)(\[[0-9]+\])?/;replace=td&&position==='inside'?'$1/$2/tr/td':'$1/tr/td';xpath=xpath.replace(reg,replace);}
var $nearestHooks=this.$dropZone.filter(function(){var $hook=$(this);var $node=$hook.data('oe-node');return $hook.data('oe-position')===position&&$hook.data('oe-index')===index&&$node.data('oe-id')===id&&(td?$node.data('oe-xpath').replace(reg,replace):$node.data('oe-xpath'))===xpath;});if(td){var pos=$nearestHook.data('oe-node').data('td-position-'+(position==='before'?'before':'after'));$nearestHooks=$nearestHooks.filter(function(){var $node=$(this).data('oe-node');return $node.data('td-position-'+(position==='before'?'before':'after'))===pos;});}
$nearestHooks.addClass('o_web_studio_nearest_hook');},dropComponent:function(component){this.isDragging=false;var $nearestHooks=this.$dropZone.filter('.o_web_studio_nearest_hook');var targets=[];$nearestHooks.get().forEach(function(nearHook){var $active=$(nearHook);var alreadyAdded=false;var nodeData=$active.data('oe-node').data('node');for(var i=0;i<targets.length;i++){if(targets[i].node.attrs['data-oe-id']===nodeData.attrs['data-oe-id']&&targets[i].node.attrs['data-oe-xpath']===nodeData.attrs['data-oe-xpath']){alreadyAdded=true;}}
if(!alreadyAdded){targets.push({node:nodeData,position:$active.data('oe-position'),data:$active.data(),});}});if(targets.length){this.trigger_up('view_change',{component:component,fail:this._cleanHooks.bind(this),targets:targets,operation:{type:'add',position:$nearestHooks.first().data('oe-position'),},});}else{this._cleanHooks();}},endPreviewDragComponent:function(component){this._cleanHooks();},getNodeContext:function(initialNode){var node=initialNode;var $nodes=this._findAssociatedDOMNodes(node);while(!$nodes.length&&node.parent){var index=node.parent.children.indexOf(node);for(index;index>0;index--){$nodes=this._findAssociatedDOMNodes(node.parent.children[index]);if($nodes.length){break;}}
if(!$nodes.length){node=node.parent;}}
if(!$nodes.length){$nodes=this.$content.find('*[data-oe-xpath]');}
return $nodes.data('oe-context');},highlight:function(node){if(!this.$highlight){this.$highlight=$('<span class="o_web_studio_report_highlight"/>');this.$content.find('body').prepend(this.$highlight);}
if(this.$targetHighlight.data('node')!==this.selectedNode){this.$targetHighlight.removeClass('o_web_studio_report_selected');}
var $nodes=this._findAssociatedDOMNodes(node);if($nodes&&$nodes.length){this.$targetHighlight=$nodes.addClass('o_web_studio_report_selected');var position=this.$targetHighlight.offset();this.$highlight.css({top:position.top+'px',left:position.left+'px',bottom:position.top<50?'0':'auto',}).toggleClass('o_web_studio_report_highlight_left',position.left<50).toggleClass('o_web_studio_report_highlight_top',position.top<50).show();}else{this.$highlight.hide();}},selectNode:function(node){if(this.selectedNode){if(this.selectedNode===node){return;}
var $oldSelectedNodes=this._findAssociatedDOMNodes(this.selectedNode);$oldSelectedNodes.removeClass('o_web_studio_report_selected');}
this.selectedNode=node;var $nodesToHighlight=this._findAssociatedDOMNodes(this.selectedNode);$nodesToHighlight.addClass('o_web_studio_report_selected');},unselectedElements:function(){var $nodes=this._findAssociatedDOMNodes(this.selectedNode);$nodes.removeClass('o_web_studio_report_selected');this.selectedNode=null;},update:function(nodesArchs,reportHTML){var self=this;this.nodesArchs=nodesArchs;this.reportHTML=reportHTML;this.$dropZone=$();return this._updateContent().then(function(){if(self.selectedNode){var $nodes=self._findAssociatedDOMNodes(self.selectedNode);if($nodes.length){$nodes.first().click();}else{self.selectedNode=null;self.trigger_up('sidebar_tab_changed',{mode:'new',});}}});},_cleanHooks:function(){if(this.isDragging){return;}
this.$dropZone.filter('th, td').each(function(){var $node=$(this).data('oe-node');if($node){var colspan=$node.data('colspan');if(colspan){$node.attr('colspan',colspan);}}});this.$content.find('.o_web_studio_hook').remove();this.$content.find('.o_web_studio_structure_hook').remove();this._setNoContentHelper();},_createHookOnNodeAndChildren:function($node,component){var $hook=this._createHook($node,component);var $newHook=$hook.clone();var $children=$node.children().not('.o_web_studio_hook,p:not([data-oe-id])')
if($children.length===1&&$children.is('td[colspan="99"]')){return;}
if($children.length){if(component.hookAutoHeight){var height=Math.max.apply(Math,$children.map(function(){return $(this).height();}));$newHook.data('height',height+'px');$newHook.css('height',height+'px');}
$newHook.data('oe-node',$children.first()).data('oe-position','before');$children.first().before($newHook);$children.each(function(_,childNode){var $childNode=$(childNode);var $newHook=$hook.clone().data('oe-node',$childNode).data('oe-position','after');if(component.hookAutoHeight){$newHook.data('height',height+'px');$newHook.css('height',height+'px');}
$childNode.after($newHook);});}else if($node.text()&&$node[0].tagName.toLowerCase()!=='th'&&$node[0].tagName.toLowerCase()!=='td'){if(component.hookAutoHeight){$newHook.data('height',$node.height()+'px');$newHook.css('height',$node.height()+'px');}
$node.before($newHook.clone().data('oe-node',$node).data('oe-position','before'));$node.after($newHook.clone().data('oe-node',$node).data('oe-position','after'));}
else{$newHook.data('oe-node',$node).data('oe-position','inside');$node.append($newHook);}},_computeNearestHookAndShowIt:function(){var self=this;this.dropPosition=[];var dropZone=this.$dropZone.get();dropZone.reverse();_.each(dropZone,function(node){var box=node.getBoundingClientRect();box.el=node;box.centerY=(box.top+box.bottom)/2;box.centerX=(box.left+box.right)/2;self.dropPosition.push(box);});},_connectNodes:function(){var self=this;var nodesNotInView=[];function connectNodes(node){if(!node.attrs){return;}
var $nodes=self._findAssociatedDOMNodes(node);$nodes.data('node',node);node.$nodes=$nodes;if($nodes.length){node.context=$nodes.data('oe-context');}else{nodesNotInView.push(node);}
_.each(node.attrs,function(value,key){if($nodes.attr(key)===undefined){$nodes.attr(key,value);}});_.each(node.children,connectNodes);}
_.each(this.nodesArchs,connectNodes);function connectContextOrder(dom,contextOrder){var $node=$(dom);var newOrder=contextOrder.slice();var node=$node.data('node');if(node){if(node.contextOrder){return node.contextOrder;}
newOrder=node.contextOrder=_.uniq(contextOrder.concat(_.keys(node.context)));}
var children=$node.children().get();for(var k=0;k<children.length;k++){newOrder=connectContextOrder(children[k],newOrder);}
return newOrder;}
var children=this.$content.children().get();for(var k=0;k<children.length;k++){connectContextOrder(children[k],[]);}
var bodyContext=this.$content.find('html').data('oe-context');_.each(nodesNotInView,function(node){node.context=node.parent&&node.parent.context||bodyContext;});},_createHook:function($target,component){var firstChild=$target.children().get(0);var hookTag=((firstChild&&firstChild.tagName)||'div').toLocaleLowerCase();if(!$target.is('tr')&&component.hookTag){hookTag=component.hookTag;}
if(hookTag==='table'){hookTag='div';}
var $hook=$('<'+hookTag+' class="o_web_studio_hook"/>');if($target.hasClass('row')){$hook.addClass('col-3');}
if(component.hookClass){$hook.addClass(component.hookClass);}
return $hook;},_findAssociatedDOMNodes:function(node){if(node){return this.$content.find('[data-oe-id="'+node.attrs['data-oe-id']+'"][data-oe-xpath="'+node.attrs['data-oe-xpath']+'"]');}else{return $();}},_processReportPreviewContent:function(){this.$content=this.$('iframe').contents();this.$content.off('click').on('click',this._onContentClick.bind(this));this._connectNodes();this.$('.o_web_studio_loader').hide();this._resizeIframe();this.$content.find('tr').each(function(){var $tr=$(this);var $tds=$tr.children();var lineMax=0;$tds.each(function(){var $td=$(this);var colspan=+$td.attr('colspan');$td.data('colspan',colspan||1);$td.data('td-position-before',lineMax);lineMax+=colspan||1;$td.data('td-position-after',lineMax);});});this._setNoContentHelper();},_resizeIframe:function(){var self=this;var zoom=96/this.paperFormat.dpi;self.$content.find('main:first').children().each(function(){var sectionZoom=zoom;if(!self.paperFormat.disable_shrinking){sectionZoom=Math.min(zoom,$(this).width()/this.scrollWidth);}
$(this).css({zoom:sectionZoom});});self.$iframe[0].style.height=self.$iframe[0].contentWindow.document.body.scrollHeight+'px';this.$content.find('.footer').css({'position':'fixed','bottom':'0','width':this.$content.find('.page').css('width'),});this.$content.find('html')[0].style.overflow='hidden';$(this.$content).find("img").on("load",function(){self.$iframe[0].style.height=self.$iframe[0].contentWindow.document.body.scrollHeight+'px';});},_setNoContentHelper:function(){var $page=this.$content.find('div.page');if($page.length&&!$page.children().length){this.$noContentHelper=$('<div/>',{class:'o_no_content_helper',text:_t('Drag building block here'),});$page.append(this.$noContentHelper);}},_updateContent:function(){var self=this;this.$content=this.$iframe.contents();var reportHTML=this.reportHTML;var $main=this.$content.find('main:first');if($main.length){$main.replaceWith($(reportHTML).find('main:first'));this._processReportPreviewContent();return Promise.resolve();}
return new Promise(function(resolve,reject){window.top[self._onUpdateContentId]=function(){if(!self.$('iframe')[0].contentWindow){return reject();}
self._processReportPreviewContent();self.trigger_up('iframe_ready');resolve();};if(reportHTML.error){self.displayNotification({message:_.str.sprintf(_t('This report could not be previewed or edited because it could not be rendered with this message: %s. This could be happening because this is a custom report type that needs custom data to be rendered and so is not editable by studio.'),reportHTML.message),type:'danger'});}else{reportHTML=reportHTML.replace('</body>','<script>window.top.'+self._onUpdateContentId+'()</script></body>');}
var cwindow=self.$iframe[0].contentWindow;cwindow.document.open("text/html","replace").write(reportHTML);});},_onClick:function(){this.trigger_up('editor_clicked');},_onContentClick:function(e){e.preventDefault();e.stopPropagation();if($(e.target).hasClass('o_no_content_helper')){return;}
var $node=$(e.target).closest('[data-oe-xpath]');if($node.closest('[t-field], [t-esc]').length){$node=$node.closest('[t-field], [t-esc]');}
this.selectNode($node.data('node'));this.trigger_up('node_clicked',{node:this.selectedNode,});},});__exports[Symbol.for("default")]=ReportEditor;return __exports;});odoo.define(`web_studio.ReportEditor`,['@web_studio/legacy/js/reports/report_editor'],function(require){return require('@web_studio/legacy/js/reports/report_editor')[Symbol.for("default")];});;

/* /web_studio/static/src/legacy/js/reports/report_editor_fields.js */
odoo.define('@web_studio/legacy/js/reports/report_editor_fields',['web.field_registry','web.relational_fields'],function(require){'use strict';let __exports={};const fieldRegistry=require("web.field_registry");const relationalFields=require("web.relational_fields");var FieldMany2ManySelection=relationalFields.FieldMany2ManyTags.extend({init:function(parent,name,record,options){this._super.apply(this,arguments);options.quick_create=false;options.can_create=false;this.selection=_.map(options.attrs.selection,function(s){return{id:s.field_name,res_id:s.field_name,data:{id:s.field_name,display_name:s.label}};});},_isSameValue:function(value){if(value===false){return this.value===false;}
return value.length===this.value.res_ids.length&&_.difference(value,this.value.res_ids).length===0;},_many2oneSearch:function(search_val){var self=this;var records=_.filter(_.pluck(this.selection,'data'),function(r){return r.display_name.indexOf(search_val)!==-1&&!_.findWhere(self.value.data,{id:r.id});});return _.map(records,function(r){return{id:r.id,label:r.display_name,name:r.display_name,value:r.display_name,};});},_render:function(){var self=this;var res_ids=this.value.res_ids;this.value.data=_.filter(this.selection,function(s){return res_ids.indexOf(s.id)!==-1;});return this._super.apply(this,arguments).then(function(){if(self.many2one){self.many2one._autocompleteSources=[];self.many2one._addAutocompleteSource(self._many2oneSearch.bind(self),{});self.many2one.limit=Object.keys(self.selection).length;}});},_setValue:function(value,options){var self=this;var selection=this.value.res_ids;return new Promise(function(resolve,reject){switch(value.operation){case"ADD_M2M":selection=selection.concat([value.ids.id]);break;case"FORGET":selection=_.difference(selection,value.ids);break;default:throw Error('Not implemented');}
if(!(options&&options.forceChange)&&self._isSameValue(selection)){return Promise.resolve();}
self.value.res_ids=selection;self._render();self.trigger_up('field_changed',{dataPointID:self.dataPointID,changes:_.object([self.name],[{operation:'REPLACE_WITH',ids:selection,}]),viewType:self.viewType,doNotSetDirty:options&&options.doNotSetDirty,notifyChange:!options||options.notifyChange!==false,onSuccess:resolve,onFailure:reject,});});},});fieldRegistry.add('many2many_select',FieldMany2ManySelection);__exports[Symbol.for("default")]={FieldMany2ManySelection:FieldMany2ManySelection,};return __exports;});odoo.define(`web_studio.report_fields`,['@web_studio/legacy/js/reports/report_editor_fields'],function(require){return require('@web_studio/legacy/js/reports/report_editor_fields')[Symbol.for("default")];});;

/* /web_studio/static/src/legacy/js/reports/report_editor_manager.js */
odoo.define('@web_studio/legacy/js/reports/report_editor_manager',['web.Dialog','web.Pager','web.utils','web.core','web.session','web_studio.ReportEditorSidebar','web_studio.ReportEditor','web_studio.AbstractEditorManager','web.OwlCompatibility'],function(require){'use strict';let __exports={};const Dialog=require("web.Dialog");const Pager=require("web.Pager");const utils=require("web.utils");const core=require("web.core");const session=require("web.session");const ReportEditorSidebar=require("web_studio.ReportEditorSidebar");const ReportEditor=require("web_studio.ReportEditor");const AbstractEditorManager=require("web_studio.AbstractEditorManager");const{ComponentWrapper,WidgetAdapterMixin}=require("web.OwlCompatibility");var qweb=core.qweb;var _t=core._t;var ReportEditorManager=AbstractEditorManager.extend(WidgetAdapterMixin,{className:AbstractEditorManager.prototype.className+' o_web_studio_report_editor_manager',custom_events:_.extend({},AbstractEditorManager.prototype.custom_events,{editor_clicked:'_onEditorClick',hover_editor:'_onHighlightPreview',node_expanded:'_onNodeExpanded',drop_component:'_onDropComponent',begin_drag_component:'_onBeginDragComponent',element_removed:'_onElementRemoved',iframe_ready:'_onIframeReady',begin_preview_drag_component:'_onBeginPreviewDragComponent',end_preview_drag_component:'_onEndPreviewDragComponent',}),events:_.extend({},AbstractEditorManager.prototype.events,{'click .o_web_studio_report_print':'_onPrintReport',}),init:function(parent,params){this._super.apply(this,arguments);this.view_id=params.reportMainViewID;this.env=params.env;this.models=params.models;this.report=params.report;this.reportHTML=params.reportHTML;this.reportName=this.report.report_name;this.reportViews=params.reportViews;this.initialState=params.initialState||{};this.paperFormat=params.paperFormat;this.widgetsOptions=params.widgetsOptions;this.editorIframeResolved=false;var self=this;this.editorIframeDef=new Promise(function(resolve,reject){self._resolveEditorIframeDef=resolve;}).then(function(){self.editorIframeResolved=true;});const currentMinimum=1;const size=this.env.ids.length;const limit=1;this.withPager=size>1;if(this.withPager){this.pager=new ComponentWrapper(this,Pager,{currentMinimum,limit,size,onPagerChanged:this._onPagerChanged.bind(this),});}},start:async function(){const promises=[this._super(...arguments)];if(this.withPager){const pagerPromise=this.pager.mount(document.createDocumentFragment());promises.push(pagerPromise);}
await Promise.all(promises);this._renderActionsSection();this._setPaperFormat();},destroy:function(){WidgetAdapterMixin.destroy.apply(this,arguments);return this._super.apply(this,arguments);},on_attach_callback:function(){this._super.apply(this,arguments);WidgetAdapterMixin.on_attach_callback.apply(this,arguments);},on_detach_callback:function(){this._super.apply(this,arguments);WidgetAdapterMixin.on_detach_callback.apply(this,arguments);},updateEditor:function(){var nodesArchs=this._computeView(this.reportViews);return this.view.update(nodesArchs,this.reportHTML);},_applyChangeHandling:function(result,opID,from_xml){var self=this;if(result.report_html.error){var error=result.report_html.message.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;");var msg='<pre>'+error+'</pre>';this.displayNotification({title:_t("Error when compiling AST"),message:msg,sticky:true,type:'danger'});return this._undo(opID,true).then(function(){return Promise.reject();});}
if(!from_xml){_.each(result.views,function(view){if(view.studio_view_id&&(view.view_id in self.reportViews)){view.studio_arch=self.reportViews[view.view_id].studio_arch;}});}
this.reportViews=result.views;this.reportHTML=result.report_html;return this.updateEditor();},_computeView:function(views){var nodesArchs=_.mapObject(views,function(view,id){var doc=$.parseXML(view.arch).documentElement;if(!doc.hasAttribute('t-name')){doc=doc.firstElementChild;}
var node=utils.xml_to_json(doc,true);node.id=+id;node.key=view.key;return node;});this._setParentKey(nodesArchs);return nodesArchs;},_editView:function(view_id,studio_view_arch,operations){core.bus.trigger('clear_cache');return this._rpc({route:'/web_studio/edit_report_view',params:{record_id:this.env.currentId,report_name:this.reportName,report_views:this.reportViews,operations:operations,context:session.user_context,},});},_editViewArch:function(view_id,view_arch){core.bus.trigger('clear_cache');return this._rpc({route:'/web_studio/edit_report_view_arch',params:{record_id:this.env.currentId,report_name:this.reportName,view_id:view_id,view_arch:view_arch,context:session.user_context,},});},_getNodeToDelete:function(node){var result=node;while(result.parent&&result.parent.children.length===1&&result.attrs['data-oe-id']===result.parent.attrs['data-oe-id']&&(!result.attrs.class||result.attrs.class.indexOf('page')!==-1)){result=result.parent;}
return result;},_getReportViews:function(){return this._rpc({route:'/web_studio/get_report_views',params:{record_id:this.env.currentId,report_name:this.reportName,context:session.user_context,},});},_instantiateEditor:function(){var nodesArchs=this._computeView(this.reportViews);this.view=new ReportEditor(this,{nodesArchs:nodesArchs,paperFormat:this.paperFormat,reportHTML:this.reportHTML,});return Promise.resolve(this.view);},_instantiateSidebar:function(state,previousState){state=_.defaults(state||{},{mode:this.initialState.sidebarMode||'new',});return new ReportEditorSidebar(this,{report:this.report,widgetsOptions:this.widgetsOptions,models:this.models,state:state,previousState:previousState,paperFormat:this.paperFormat,});},_renderActionsSection:async function(){const actionsSection=Object.assign(document.createElement('div'),{className:'o_web_studio_report_actions',innerHTML:qweb.render('web_studio.PrintSection'),});this.el.appendChild(actionsSection);if(this.withPager){const pagerContainer=Object.assign(document.createElement('div'),{className:'o_web_studio_report_pager',});pagerContainer.appendChild(this.pager.el);actionsSection.append(pagerContainer);}},_setParentKey:function(nodesArchs){function setParent(node,parent){if(_.isObject(node)){node.parent=parent;_.each(node.children,function(child){setParent(child,node);});}}
_.each(nodesArchs,function(node){setParent(node,null);});},_setPaperFormat:function(){var format=this.paperFormat||{};var $container=this.$('.o_web_studio_report_iframe_container');$container.css({'padding-top':Math.max(0,(format.margin_top||0)-(format.header_spacing||0))+'mm','padding-left':(format.margin_left||0)+'mm','padding-right':(format.margin_right||0)+'mm','width':(format.print_page_width||210)+'mm','min-height':(format.print_page_height||297)+'mm',});this.$('.o_web_studio_report_iframe').css({'min-height':(format.print_page_height||297)+'mm',});},_onBeginDragComponent:function(ev){this.view.beginDragComponent(ev.data.widget);},_onBeginPreviewDragComponent:function(ev){this.view.beginPreviewDragComponent(ev.data.widget);},_onDragComponent:function(ev){var position=ev.data.position;this.view.dragComponent(ev.data.widget,position.pageX,position.pageY);},_onDropComponent:function(ev){this.view.dropComponent(ev.data.widget);},_onEditorClick:function(){this.view.unselectedElements();},_onElementRemoved:function(ev){var self=this;var node=this._getNodeToDelete(ev.data.node);var message=_.str.sprintf(_t('Are you sure you want to remove this %s from the view?'),node.tag);Dialog.confirm(this,message,{confirm_callback:function(){self.trigger_up('view_change',{node:node,operation:{type:'remove',structure:'remove',},});},});},_onEndPreviewDragComponent:function(ev){this.view.endPreviewDragComponent(ev.data.widget);},_onHighlightPreview:function(ev){this.view.highlight(ev.data.node);},_onNodeExpanded:function(ev){this.view.selectNode(ev.data.node);},_onIframeReady:function(){this._resolveEditorIframeDef();},_onNodeClicked:function(ev){var node=ev.data.node;if(node){var currentNode=node;var sidebarNodes=[];while(currentNode){sidebarNodes.push({node:currentNode,context:this.view.getNodeContext(currentNode),});currentNode=currentNode.parent;}
this.sidebar.state={mode:'properties',nodes:sidebarNodes,};}else{this.sidebar.state={mode:'new',};}
this._updateSidebar();},_onPagerChanged:async function({currentMinimum,limit}){this._cleanOperationsStack();this.env.currentId=this.env.ids[currentMinimum-1];const result=await this._getReportViews();this.pager.update({currentMinimum,limit});this.reportHTML=result.report_html;this.reportViews=result.views;this.updateEditor();},_onPrintReport:function(){var self=this;this._rpc({route:'/web_studio/print_report',params:{record_id:this.env.currentId,report_name:this.reportName,context:session.user_context,},}).then(function(action){self.do_action(action);});},_onViewChange:function(ev){var self=this;var def;var node=ev.data.node||ev.data.targets[0].node;var operation=_.extend(ev.data.operation,{view_id:+node.attrs['data-oe-id'],xpath:node.attrs['data-oe-xpath'],context:node.context,});if(operation.type==='add'){def=ev.data.component.add({targets:ev.data.targets,}).then(function(result){_.extend(operation,result);});}else{if(node){this.view.selectedNode=node;}else{console.warn("the key 'node' should be present");}}
Promise.resolve(def).then(function(){return self._do(operation);}).guardedCatch(ev.data.fail);},});__exports[Symbol.for("default")]=ReportEditorManager;return __exports;});odoo.define(`web_studio.ReportEditorManager`,['@web_studio/legacy/js/reports/report_editor_manager'],function(require){return require('@web_studio/legacy/js/reports/report_editor_manager')[Symbol.for("default")];});;

/* /web_studio/static/src/legacy/js/reports/report_editor_sidebar.js */
odoo.define('@web_studio/legacy/js/reports/report_editor_sidebar',['web.config','web.core','web.relational_fields','web.StandaloneFieldManagerMixin','web.utils','web.Widget','web_studio.reportEditComponentsRegistry','web_studio.reportNewComponentsRegistry','web_studio.utils'],function(require){'use strict';let __exports={};const config=require("web.config");const core=require("web.core");const relational_fields=require("web.relational_fields");const StandaloneFieldManagerMixin=require("web.StandaloneFieldManagerMixin");const utils=require("web.utils");const Widget=require("web.Widget");const editComponentsRegistry=require("web_studio.reportEditComponentsRegistry");const newComponentsRegistry=require("web_studio.reportNewComponentsRegistry");const studioUtils=require("web_studio.utils");var Many2ManyTags=relational_fields.FieldMany2ManyTags;var Many2One=relational_fields.FieldMany2One;var qweb=core.qweb;var _t=core._t;var ReportEditorSidebar=Widget.extend(StandaloneFieldManagerMixin,{template:'web_studio.ReportEditorSidebar',events:{'change input':'_onChangeReport','click .o_web_studio_sidebar_header > div:not(.inactive)':'_onTab','click .o_web_studio_xml_editor':'_onXMLEditor','click .o_web_studio_parameters':'_onParameters','click .o_web_studio_remove':'_onRemove',},init:function(parent,params){this._super.apply(this,arguments);StandaloneFieldManagerMixin.init.call(this);this.debug=config.isDebug();this.report=params.report;this.state=params.state||{};this.paperFormat=params.paperFormat||{};this.previousState=params.previousState||{};this.models=params.models;this.widgetsOptions=params.widgetsOptions;},willStart:function(){var self=this;var defs=[this._super.apply(this,arguments)];if(this.state.mode==='report'){var defReport=this.model.makeRecord('ir.model.fields',[{name:'groups_id',fields:[{name:'id',type:'integer',},{name:'display_name',type:'char',}],relation:'res.groups',type:'many2many',value:this.report.groups_id,}]).then(function(recordID){self.groupsHandle=recordID;});var defPaperFormat=this.model.makeRecord('ir.model.fields',[{name:'paperformat_id',relation:'report.paperformat',type:'many2one',value:this.report.paperformat_id,}]).then(function(recordID){self.paperformatHandle=recordID;});defs.push(defReport);defs.push(defPaperFormat);}
return Promise.all(defs);},start:function(){var def;switch(this.state.mode){case'report':def=this._startModeReport();break;case'new':def=this._startModeNew();break;case'properties':def=this._startModeProperties();break;}
return Promise.all([this._super.apply(this,arguments),def]);},getLocalState:function(){var self=this;var state={};_.each(this.nodes,function(node){var nodeName=self._computeUniqueNodeName(node.node);state[nodeName]={};_.each(node.widgets,function(comp){state[nodeName][comp.name]=comp.getLocalState();});});return state;},_computeUniqueNodeName:function(node){return node.attrs["data-oe-id"]+node.attrs["data-oe-xpath"].replace(/\[\]\//g,"_");},_getAssociatedDOMNode:function(node){var parser=new DOMParser();var xml=utils.json_node_to_xml(node);var xmlDoc=parser.parseFromString(xml,"text/xml");var xmlNode=xmlDoc.getElementsByTagName(node.tag)[0];return $(xmlNode);},_getComponentsObject:function(components){return _.map(components,function(componentName){var Component=_.find(editComponentsRegistry.map,function(Component){return Component.prototype.name===componentName;});return Component;});},_getComponentsBlacklist:function(components){var blacklist='';_.each(this._getComponentsObject(components),function(Component){if(Component.prototype.blacklist){if(blacklist.length){blacklist+=',';}
blacklist+=Component.prototype.blacklist;}});return blacklist;},_getNodeDisplayName:function(node){var displayName={name:node.tag,attr:'',icon:''};if(node.attrs){if(node.attrs.name){displayName.attr+='('+node.attrs.name+')';}
if(node.attrs['t-field']||node.attrs['t-esc']){displayName.attr+='['+(node.attrs['t-field']||node.attrs['t-esc'])+']';}
if(node.attrs['t-call']){displayName.attr+='[t-call="'+node.attrs['t-call']+'"]';}
if(node.attrs['t-foreach']){displayName.attr+='[foreach="'+node.attrs['t-foreach']+'"]';}}
if(node.key){displayName.attr+=' - '+node.key;}
if(displayName.name==='div'&&node.attrs.class){displayName.attr+=' '+node.attrs.class;}
switch(displayName.name){case't':displayName.icon='fa-cog';break;case'html':case'body':case'main':displayName.icon='fa-file';break;case'table':displayName.icon='fa-table';break;case'thead':case'tr':case'tfoot':displayName.icon='fa-ellipsis-h';if(node.attrs.hasOwnProperty('t-foreach')){displayName.icon='fa-retweet text-primary';}
break;case'tbody':displayName.icon='fa-th';break;case'th':case'td':displayName.icon='fa-square-o';break;case'img':displayName.icon='fa-picture-o';break;case'div':displayName.icon='fa-folder';if(!node.attrs.hasOwnProperty('class')){break;}
if(node.attrs.class.indexOf('col-')!==-1){displayName.icon='fa-columns';}else if(node.attrs.class.indexOf('row')!==-1){displayName.icon='fa-ellipsis-h';}
break;case'address':displayName.icon='fa-address-book-o';break;case'h1':case'h2':case'h3':case'h4':case'h5':case'h6':case'p':case'b':case'i':case'span':case'strong':displayName.icon='fa-i-cursor';break;}
return displayName;},_getNodeEditableComponents:function(node){var self=this;var components=[];var $node=this._getAssociatedDOMNode(node);_.each(editComponentsRegistry.map,function(Component){var selector=Component.prototype.selector;if(self.debug){selector=Component.prototype.debugSelector||selector;}
if($node.is(selector)){components.push(Component.prototype.name);}});_.each(['layout','tif','groups'],function(componentName){if(!_.contains(components,componentName)){components.push(componentName);}});return components;},_startModeNew:function(){var self=this;var defs=[];var $sidebarContent=this.$('.o_web_studio_sidebar_content');_.each(newComponentsRegistry.map,function(components,title){$sidebarContent.append($('<h3>',{html:title,}));var $componentsContainer=$('<div>',{class:'o_web_studio_field_type_container',});_.each(components,function(Component){const component=new Component(self,{models:self.models});const reportModel=self.report&&self.report.model;if(!reportModel||!component.modelWhitelist.length||component.modelWhitelist.includes(reportModel)){defs.push(component.appendTo($componentsContainer));}});$sidebarContent.append($componentsContainer);});return Promise.all(defs);},_startModeProperties:function(){var self=this;var componentsAppendedPromise;var $accordion=this.$('.o_web_studio_sidebar_content .o_web_studio_accordion');var blacklists=[];this.nodes=[];if(!this.debug){var pageNodeIndex=_.findIndex(this.state.nodes,function(node){return node.node.tag==='div'&&_.str.include(node.node.attrs.class,'page');});if(pageNodeIndex!==-1){this.state.nodes.splice(pageNodeIndex+1,this.state.nodes.length-(pageNodeIndex+1));}}
for(var index=this.state.nodes.length-1;index>=0;index--){var node=_.extend({},this.state.nodes[index]);if(!this.debug&&blacklists.length){if(this._getAssociatedDOMNode(node.node).is(blacklists.join(','))){continue;}}
var components=this._getNodeEditableComponents(node.node);node.components=components;var blacklist=this._getComponentsBlacklist(components);if(blacklist.length){blacklists.push(blacklist);}
node.widgets=[];this.nodes.unshift(node);}
this.nodes.reverse();this.nodes.forEach(function(node){var $accordionSection=$(qweb.render('web_studio.AccordionSection',{id:'id_'+studioUtils.randomString(6),header:'header_'+studioUtils.randomString(6),nodeName:self._getNodeDisplayName(node.node).name,nodeAttr:self._getNodeDisplayName(node.node).attr,nodeIcon:self._getNodeDisplayName(node.node).icon,node:node.node,}));var renderingProms=self._getComponentsObject(node.components).map(function(Component){if(!Component){self.displayNotification({title:"Missing component",message:self.state.directive,type:'danger'});return;}
var previousWidgetState=self.previousState[self._computeUniqueNodeName(node.node)]&&self.previousState[self._computeUniqueNodeName(node.node)][Component.prototype.name];var directiveWidget=new Component(self,{widgetsOptions:self.widgetsOptions,node:node.node,context:node.context,state:previousWidgetState,models:self.models,componentsList:node.components,});node.widgets.push(directiveWidget);var fragment=document.createDocumentFragment();return directiveWidget.appendTo(fragment);});componentsAppendedPromise=Promise.all(renderingProms).then(function(){for(var i=0;i<node.widgets.length;i++){var widget=node.widgets[i];var selector='.collapse'+(i>0?'>div:last()':'');widget.$el.appendTo($accordionSection.find(selector));}
var $removeButton=$(qweb.render('web_studio.Sidebar.Remove'));$removeButton.data('node',node.node);$accordionSection.find('.collapse').append($('<hr>')).append($removeButton);});$accordionSection.appendTo($accordion);$accordionSection.on('mouseenter',function(){self.trigger_up('hover_editor',{node:node.node,});}).on('click',function(){self.trigger_up('node_expanded',{node:node.node,});}).on('mouseleave',function(){self.trigger_up('hover_editor',{node:undefined,});}).find('.collapse').on('show.bs.collapse hide.bs.collapse',function(ev){$(this).parent('.card').toggleClass('o_web_studio_active',ev.type==='show');});});var $lastCard=$accordion.find('.card:last');$lastCard.addClass('o_web_studio_active');$lastCard.find('.collapse').addClass('show');return componentsAppendedPromise;},_startModeReport:function(){var defs=[];var paperFormatRecord=this.model.get(this.paperformatHandle);var many2one=new Many2One(this,'paperformat_id',paperFormatRecord,{attrs:{placeholder:_t('By default: ')+this.paperFormat.display_name,},mode:'edit',});this._registerWidget(this.paperformatHandle,'paperformat_id',many2one);defs.push(many2one.appendTo(this.$('.o_web_studio_paperformat_id')));this.paperformatMany2one=many2one;var groupsRecord=this.model.get(this.groupsHandle);var many2many=new Many2ManyTags(this,'groups_id',groupsRecord,{mode:'edit',});this._registerWidget(this.groupsHandle,'groups_id',many2many);defs.push(many2many.appendTo(this.$('.o_groups')));return Promise.all(defs);},_onChangeReport:function(ev){var $input=$(ev.currentTarget);var attribute=$input.attr('name');if(attribute){var newAttrs={};if($input.attr('type')==='checkbox'){newAttrs[attribute]=$input.is(':checked')?'True':'';}else{newAttrs[attribute]=$input.val();}
this.trigger_up('studio_edit_report',newAttrs);}},_onFieldChanged:function(ev){var self=this;StandaloneFieldManagerMixin._onFieldChanged.apply(this,arguments).then(function(){if(self.state.mode!=='report'){return;}
var newAttrs={};var fieldName=ev.target.name;var record;if(fieldName==='groups_id'){record=self.model.get(self.groupsHandle);newAttrs[fieldName]=record.data.groups_id.res_ids;}else if(fieldName==='paperformat_id'){record=self.model.get(self.paperformatHandle);newAttrs[fieldName]=record.data.paperformat_id&&record.data.paperformat_id.res_id;}
self.trigger_up('studio_edit_report',newAttrs);});},_onParameters:function(){this.trigger_up('open_record_form_view');},_onRemove:function(ev){var node=$(ev.currentTarget).data('node');this.trigger_up('element_removed',{node:node,});},_onTab:function(ev){var mode=$(ev.currentTarget).attr('name');if(mode==='options'){return;}
this.trigger_up('sidebar_tab_changed',{mode:mode,});},_onXMLEditor:function(){this.trigger_up('open_xml_editor');},});__exports[Symbol.for("default")]=ReportEditorSidebar;return __exports;});odoo.define(`web_studio.ReportEditorSidebar`,['@web_studio/legacy/js/reports/report_editor_sidebar'],function(require){return require('@web_studio/legacy/js/reports/report_editor_sidebar')[Symbol.for("default")];});;

/* /web_studio/static/src/legacy/js/reports/sidebar_components/abstract_report_component.js */
odoo.define('@web_studio/legacy/js/reports/sidebar_components/abstract_report_component',['web.Widget'],function(require){'use strict';let __exports={};const Widget=require("web.Widget");var AbstractReportComponent=Widget.extend({init:function(parent,params){this.models=params.models;this.node={context:{},contextOrder:[],};this._super.apply(this,arguments);},_getContextKeys:function(node){var self=this;var contextOrder=node.contextOrder||[];var keys=_.compact(_.map(node.context,function(relation,key){if(!self.models[relation]){return{name:key,string:key+' ('+relation+')',type:relation,store:true,related:true,searchable:true,order:-contextOrder.indexOf(key),};}
return{name:key,string:key+' ('+self.models[relation]+')',relation:relation,type:key[key.length-1]==='s'?'one2many':'many2one',store:true,related:true,searchable:true,order:-contextOrder.indexOf(key),};}));keys.sort(function(a,b){return a.order-b.order;});return keys;},});__exports[Symbol.for("default")]=AbstractReportComponent;return __exports;});odoo.define(`web_studio.AbstractReportComponent`,['@web_studio/legacy/js/reports/sidebar_components/abstract_report_component'],function(require){return require('@web_studio/legacy/js/reports/sidebar_components/abstract_report_component')[Symbol.for("default")];});;

/* /web_studio/static/src/legacy/js/reports/sidebar_components/edit_components.js */
odoo.define('@web_studio/legacy/js/reports/sidebar_components/edit_components',['web.Colorpicker','web.config','web.core','web.utils','web.field_registry','web.ModelFieldSelector','web.StandaloneFieldManagerMixin','web.OwlCompatibility','web_editor.wysiwyg','web_studio.AbstractReportComponent','web.DomainSelectorDialog','web.Domain'],function(require){'use strict';let __exports={};const{ColorpickerDialog}=require("web.Colorpicker");const config=require("web.config");const core=require("web.core");const utils=require("web.utils");const fieldRegistry=require("web.field_registry");const ModelFieldSelector=require("web.ModelFieldSelector");const StandaloneFieldManagerMixin=require("web.StandaloneFieldManagerMixin");const{WidgetAdapterMixin}=require("web.OwlCompatibility");const Wysiwyg=require("web_editor.wysiwyg");const Abstract=require("web_studio.AbstractReportComponent");const DomainSelectorDialog=require("web.DomainSelectorDialog");const Domain=require("web.Domain");var py=window.py;var qweb=core.qweb;var AbstractEditComponent=Abstract.extend(WidgetAdapterMixin,StandaloneFieldManagerMixin,{events:{'change input':function(e){e.stopPropagation();},},custom_events:_.extend({},Abstract.prototype.custom_events,{field_changed:'_onDirectiveChange',field_chain_changed:'_onDirectiveChange',}),init:function(parent,params){this._super.apply(this,arguments);StandaloneFieldManagerMixin.init.call(this);this.state=params.state||{};this.node=params.node;this.context=params.context;this.componentsList=params.componentsList;this.directiveFields={};this.directiveRecordId='';this.fieldSelector={};},willStart:function(){var self=this;var directiveModel=[];_.each(this.directiveFields,function(options,directiveKey){var value=options.value;if(!value){value=self.node.attrs[options.attributeName||directiveKey];}
if(options.type==='related'){directiveModel.push({name:directiveKey,type:'char',value:options.freecode?value:self._splitRelatedValue(value).chain.join('.'),});}else{directiveModel.push(_.extend({},{name:directiveKey,value:value,},options));}});var defDirective=this.model.makeRecord('ir.model.fields',directiveModel).then(function(recordId){self.directiveRecordId=recordId;_.each(self.directiveFields,function(options,directiveKey){if(options.type==='related'){self.createFieldSelector(directiveKey,options);}else{self.createField(directiveKey,options);}});});var defParent=this._super.apply(this,arguments);return Promise.all([defDirective,defParent]);},destroy:function(){this._super.apply(this,arguments);WidgetAdapterMixin.destroy.call(this);},on_attach_callback:function(){WidgetAdapterMixin.on_attach_callback.call(this);},on_detach_callback:function(){WidgetAdapterMixin.on_detach_callback.call(this);},createField:function(directiveKey,options){var directiveRecord=this.model.get(this.directiveRecordId);options=_.extend({mode:'edit',attrs:_.extend({quick_create:false,can_create:false},options)},options);var field=directiveRecord.fields[directiveKey];const FieldClass=fieldRegistry.getAny([options.Widget,field.type]);this.fieldSelector[directiveKey]=new FieldClass(this,directiveKey,directiveRecord,options);},createFieldSelector:function(directiveKey,options){var directiveRecord=this.model.get(this.directiveRecordId);var split=this._splitRelatedValue(directiveRecord.data[directiveKey]);if(this.context[split.chain[0]]==='undefined'){console.warn("We don't know what "+split.chain[0]+" is ...");return this.createField(directiveKey);}
if(options.freecode&&split.rest){var InputField=fieldRegistry.get('input');this.fieldSelector[directiveKey]=new InputField(this,directiveKey,directiveRecord,_.extend({mode:'edit',attrs:options},options));return;}
var availableKeys=this._getContextKeys(this.node);if(options.loop){availableKeys=_.filter(availableKeys,function(relation){return relation.type==='one2many'||relation.type==='many2one';});}
this.fieldSelector[directiveKey]=new ModelFieldSelector(this,'record_fake_model',split.chain,_.extend({readonly:options.mode==='readonly',searchable:false,fields:availableKeys,filters:{searchable:false},filter:options.filter||function(){return true;},followRelations:options.followRelations||function(field){return field.type==='many2one';},},options));},getLocalState:function(){},_splitRelatedValue:function(value){var chain=[];var rest=value||'';if(typeof value==="string"){try{value=py.extract(value);}catch{return{chain:[],rest:value,};}}
if(value){if(value.isOperator){if(value.params.values[0].isField){chain=value.params.values[0].expr.split('.');rest=value.expr.slice(chain.length);}else{rest=value.expr;}}
if(value.isCall){rest=(value.params.object.length?'.':'')+value.params.method+'('+value.params.args.join(', ')+')';chain=value.params.object;}
if(value.isField){rest='';chain=value.expr.split('.');}}
return{chain:chain,rest:rest,};},_tSetAttributes:function(newAttrs){var self=this;var node=this.node;var op=[];_.each(newAttrs,function(tvalue,tset){if(tvalue===self.directiveFields[tset].value){return;}
op.push({content:'<attribute name="t-value">'+tvalue+'</attribute>',position:"attributes",view_id:+node.attrs['data-oe-id'],xpath:node.attrs['data-oe-xpath']+"//t[@t-set='"+tset+"']"});});if(!op.length){return;}
this.trigger_up('view_change',{node:node,operation:{inheritance:op,},});},_editDomAttribute:function(attributeName,toAdd,toRemove){var attribute='<attribute name="'+attributeName+'" separator="'+(attributeName==='class'?' ':';')+'"';if(toAdd){attribute+=' add="'+toAdd+'"';}
if(toRemove){attribute+=' remove="'+toRemove+'"';}
attribute+='/>';this.trigger_up('view_change',{node:this.node,operation:{inheritance:[{content:attribute,position:"attributes",view_id:+this.node.attrs['data-oe-id'],xpath:this.node.attrs['data-oe-xpath']}],},});},_triggerViewChange:function(newAttrs){this.trigger_up('view_change',{node:this.node,operation:{type:'attributes',new_attrs:newAttrs,},});},_onDirectiveChange:function(e){var self=this;e.stopPropagation();e.data.dataPointID=this.directiveRecordId;var always=function(){var newAttrs={};_.each(self.fieldSelector,function(fieldType,directiveKey){var directiveTarget=self.fieldSelector[directiveKey];var target=e.target;if(!e.data.forceChange&&target!==directiveTarget){return;}
var data=self.model.get(self.directiveRecordId).data;var fieldValue=data[directiveKey];if(e.data.chain){fieldValue=e.data.chain.join('.');}
if(fieldValue.res_ids){fieldValue=fieldValue.res_ids.slice();}
newAttrs[directiveKey]=fieldValue;});if(e.data.chain){e.data.dataPointID=self.directiveRecordId;e.data.changes=newAttrs;}
self._triggerViewChange(newAttrs);};StandaloneFieldManagerMixin._onFieldChanged.call(this,e).then(always,always);},});var LayoutEditable=AbstractEditComponent.extend({name:'layout',template:'web_studio.ReportLayoutEditable',events:_.extend({},AbstractEditComponent.prototype.events,{"change .o_web_studio_margin>input":"_onMarginInputChange","change .o_web_studio_width>input":"_onWidthInputChange","click .o_web_studio_font_size .dropdown-item-text":"_onFontSizeChange","change .o_web_studio_table_style > select":"_onTableStyleInputChange","click .o_web_studio_text_decoration button":"_onTextDecorationChange","click .o_web_studio_text_alignment button":"_onTextAlignmentChange","change .o_web_studio_classes>input":"_onClassesChange","click .o_web_studio_colors .o_web_studio_reset_color":"_onResetColor","click .o_web_studio_colors .o_web_studio_custom_color":"_onCustomColor",}),init:function(parent,params){this._super.apply(this,arguments);this.debug=config.isDebug();this.isTable=params.node.tag==='table';this.isNodeText=_.contains(this.componentsList,'text');this.canSetColors=!this.isNodeText||this.componentsList.includes("tesc");this.allClasses=params.node.attrs.class||"";this.classesArray=(params.node.attrs.class||"").split(' ');this.stylesArray=(params.node.attrs.style||"").split(';');var fontSizeRegExp=new RegExp(/^\s*(h[123456]{1})|(small)|(display-[1234]{1})\s*$/gim);var backgroundColorRegExp=new RegExp(/^\s*background\-color\s*:/gi);var colorRegExp=new RegExp(/^\s*color\s*:/gi);var widthRegExp=new RegExp(/^\s*width\s*:/gi);const colClassRegex=/\bcol((-(sm|md|lg|xl))?-(\d{1,2}|auto))?\b/;this["margin-top"]=this._findMarginValue('margin-top');this["margin-bottom"]=this._findMarginValue('margin-bottom');this["margin-left"]=this._findMarginValue('margin-left');this["margin-right"]=this._findMarginValue('margin-right');this["background-color-class"]=_.find(this.classesArray,function(item){return!item.indexOf('bg-');});this["font-color-class"]=_.find(this.classesArray,function(item){return!item.indexOf('text-');});this.tableStyle=_.find(this.classesArray,function(item){return!item.indexOf('table-');});this["background-color"]=_.find(this.stylesArray,function(item){return backgroundColorRegExp.test(item);});this.color=_.find(this.stylesArray,function(item){return colorRegExp.test(item);});this.displayWidth=!(params.node.tag==='div'&&_.find(this.classesArray,function(item){return colClassRegex.test(item);}));this.originalWidth=_.find(this.stylesArray,function(item){return widthRegExp.test(item);});if(this.originalWidth){this.width=this.originalWidth.replace(/\D+/g,'');}
this.fontSize=_.find(this.classesArray,function(item){return fontSizeRegExp.test(item);});this.italic=_.contains(this.classesArray,'o_italic');this.bold=_.contains(this.classesArray,'o_bold');this.underline=_.contains(this.classesArray,'o_underline');this.alignment=_.intersection(this.classesArray,['text-start','text-center','text-end'])[0];this.displayAlignment=!_.contains(['inline','float'],this.node.$nodes.css('display'));this.allClasses=params.node.attrs.class||"";},willStart:async function(){await this._super();this._groupColors=await this._getColors();},renderElement:function(){var self=this;this._super.apply(this,arguments);this.$('.o_web_studio_background_colorpicker .o_web_studio_color_palette').append(this._createPalette());this.$('.o_web_studio_background_colorpicker').on("mousedown",'button[data-color]',function(e){self._onColorChange($(e.currentTarget).data('value').replace('text-','bg-'),"background");});this.$('.o_web_studio_font_colorpicker .o_web_studio_color_palette').append(this._createPalette());this.$('.o_web_studio_font_colorpicker').on("mousedown",'button[data-color]',function(e){self._onColorChange($(e.currentTarget).data('value'),"font");});},_createPalette:function(){var $fontPlugin=$('<div/>');this._groupColors.forEach(function(color){var $row;if(typeof color==='string'){$row=$('<h6/>').text(color);}else{$row=$('<div class="o_web_studio_color_row"/>');color.forEach(function(color){var $button=$('<button/>').appendTo($row);$button.attr('data-color',color);if(color.startsWith('#')){$button.css('background-color',color);$button.attr('data-value',color);}else{$button.addClass('bg-'+color);$button.attr('data-value','text-'+color);}
$row.append($button);});}
$fontPlugin.append($row);});return $fontPlugin;},_findMarginValue:function(marginName){if(this.node.attrs.style){var margin=this.node.attrs.style.split(';').map(function(item){return item.trim();}).filter(function(item){return!item.indexOf(marginName);});if(margin.length){var marginValue=margin[0].split(':')[1].trim().replace('px','');return parseInt(marginValue,10);}}},_getColors:async function(){if(!this._colorpickerArch){this._colorpickerArch=await this._rpc({model:'ir.ui.view',method:'render_public_asset',args:['web_editor.colorpicker',{}],});}
var groupColors=[];var $clpicker=$(this._colorpickerArch);$clpicker.children('.o_colorpicker_section').each(function(){if(this.dataset.display){groupColors.push(this.dataset.display);}
var colors=[];$(this).children('button').each(function(){var $el=$(this);if(!$el.hasClass('d-none')){colors.push($el.attr('data-color')||'');}});if(colors.length){groupColors.push(colors);}
if(this.dataset.name==='common'){groupColors=groupColors.concat([['#FF0000','#FF9C00','#FFFF00','#00FF00','#00FFFF','#0000FF','#9C00FF','#FF00FF'],['#F7C6CE','#FFE7CE','#FFEFC6','#D6EFD6','#CEDEE7','#CEE7F7','#D6D6E7','#E7D6DE'],['#E79C9C','#FFC69C','#FFE79C','#B5D6A5','#A5C6CE','#9CC6EF','#B5A5D6','#D6A5BD'],['#E76363','#F7AD6B','#FFD663','#94BD7B','#73A5AD','#6BADDE','#8C7BC6','#C67BA5'],['#CE0000','#E79439','#EFC631','#6BA54A','#4A7B8C','#3984C6','#634AA5','#A54A7B'],['#9C0000','#B56308','#BD9400','#397B21','#104A5A','#085294','#311873','#731842'],['#630000','#7B3900','#846300','#295218','#083139','#003163','#21104A','#4A1031']]);}});return groupColors;},_onColorChange:function(value,type){var isClass=/^(text|bg)-/.test(value);if(isClass){this._editDomAttribute("class",value,type==="background"?this["background-color-class"]:this["font-color-class"]);}else{var attributeName=type==="background"?'background-color':'color';this._editDomAttribute("style",attributeName+':'+value,this[attributeName]);}},_onClassesChange:function(e){e.preventDefault();var newAttrs={class:e.target.value};this.trigger_up('view_change',{node:this.node,operation:{type:'attributes',new_attrs:newAttrs,},});},_onCustomColor:function(e){e.preventDefault();const colorpicker=new ColorpickerDialog(this,{defaultColor:'rgb(255, 0, 0)',});colorpicker.on('colorpicker:saved',this,(ev)=>{var color=ev.data.cssColor;var $button=$('<button/>');$button.attr('data-color',color);$button.attr('data-value',color);$button.css('background-color',color);$(e.target).closest('.dropdown-item').find('.o_web_studio_custom_colors').append($button);$button.mousedown();});colorpicker.open();},_onFontSizeChange:function(e){e.preventDefault();this._editDomAttribute('class',$(e.currentTarget).data('value'),this.fontSize);},_onTableStyleInputChange:function(e){e.preventDefault();this._editDomAttribute("class",e.target.value,this.tableStyle);},_onMarginInputChange:function(e){e.preventDefault();var toRemove,toAdd;if(e.target.value!==""){toAdd=e.target.dataset.margin+':'+e.target.value+'px';}
if(this[e.target.dataset.margin]){toRemove=e.target.dataset.margin+':'+this[e.target.dataset.margin]+'px';}
this._editDomAttribute("style",toAdd,toRemove);},_onResetColor:function(e){e.preventDefault();if(e.currentTarget.dataset.target==="background"){if(this["background-color-class"]){this._editDomAttribute("class",null,this["background-color-class"]);}else if(this["background-color"]){this._editDomAttribute("style",null,this["background-color"]);}}else{if(this["font-color-class"]){this._editDomAttribute("class",null,this["font-color-class"]);}else if(this.color){this._editDomAttribute("style",null,this.color);}}},_onTextAlignmentChange:function(e){e.preventDefault();var data=$(e.currentTarget).data();var toAdd=this.alignment!==data.property?data.property:null;this._editDomAttribute("class",toAdd,this.alignment);},_onTextDecorationChange:function(e){e.preventDefault();var data=$(e.target).closest("button").data();this._editDomAttribute("class",!this[data.property]&&("o_"+data.property),this[data.property]&&("o_"+data.property));},_onWidthInputChange:function(e){e.preventDefault();var addDisplayInlineBlock="";var hasDisplay=_.any((this.node.attrs.style||'').split(';'),function(item){return _.str.startsWith(item,'display');});if(this.node.tag.toLowerCase()==='span'&&!hasDisplay){addDisplayInlineBlock=";display:inline-block";}
this._editDomAttribute("style",e.target.value&&("width:"+e.target.value+"px"+addDisplayInlineBlock),this.originalWidth);}});var TField=AbstractEditComponent.extend({name:'tfield',template:'web_studio.ReportDirectiveTField',selector:'[t-field]',init:function(){this._super.apply(this,arguments);this.directiveFields['t-field']={type:'related',};},start:function(){var self=this;return this._super.apply(this,arguments).then(function(){var $expr=self.$('.o_web_studio_tfield_fieldexpression');return self.fieldSelector['t-field'].appendTo($expr);});},});var TIf=AbstractEditComponent.extend({name:'tif',template:'web_studio.ReportDirectiveTIf',selector:'',events:_.extend({},AbstractEditComponent.prototype.events,{"click .o_field_domain_dialog_button":"_onDialogEditButtonClick",}),init:function(){this._super.apply(this,arguments);this.directiveFields['t-if']={type:'char',};},start:function(){var self=this;try{Domain.prototype.conditionToDomain(this.node.attrs['t-if']||'');}catch(e){console.warn("Can't convert the condition in an Odoo domain",this.node.attrs['t-if'],e);this.$('.o_field_domain_dialog_button').hide();}
return this._super.apply(this,arguments).then(function(){return self.fieldSelector['t-if'].appendTo(self.$('.o_web_studio_tif_ifexpression'));});},_onDialogEditButtonClick:function(e){e.preventDefault();var self=this;var availableKeys=this._getContextKeys(this.node);var defaultDoc=_.findWhere(availableKeys,{relation:this.context.docs,type:'many2one'});defaultDoc=defaultDoc&&defaultDoc.name||_.first(availableKeys).name;var value=Domain.prototype.conditionToDomain(this.node.attrs['t-if']||'');var dialog=new DomainSelectorDialog(this,'record_fake_model',value,{readonly:this.mode==="readonly",debugMode:config.isDebug(),fields:availableKeys,default:[[defaultDoc,'!=',false]],operators:["=","!=",">","<",">=","<=","in","not in","set","not set"],}).open();dialog.on("domain_selected",this,function(e){var condition=Domain.prototype.domainToCondition(e.data.domain);self.$('input').val(condition==='True'?'':condition).trigger('change');});},_onDirectiveChange:function(e){if(e.target.name==="t-if"){return this._super.apply(this,arguments);}
e.stopPropagation();},_isSameValue(value){const currentValue=this.node.attrs['t-if'];const newValue=value['t-if'];if(!currentValue||!newValue||typeof newValue!=="string"){return currentValue===newValue;}
function normalizeValue(value){const charset={"'":/"/,"[":/\(/,"]":/\)/,"','":/',\s+'/,"']":/'\s+]/,"['":/\[\s+'/,}
for(const key in charset){const toReplace=new RegExp(charset[key],"g");value=value.replace(toReplace,key);}
return value;}
return normalizeValue(currentValue)==normalizeValue(newValue);},_triggerViewChange:function(newAttrs){if(!this._isSameValue(newAttrs)){this._super.apply(this,arguments);}},});var TElse=AbstractEditComponent.extend({name:'telse',template:'web_studio.ReportDirectiveTElse',selector:'[t-else]',insertAsLastChildOfPrevious:true,init:function(){this._super.apply(this,arguments);this.tIf=this.node.parent.children[this.node.parent.children.indexOf(this.node)-1].attrs['t-if'];this.directiveFields['t-else']={type:'boolean',};},start:function(){var self=this;return this._super.apply(this,arguments).then(function(){return self.fieldSelector['t-else'].appendTo(self.$('.o_web_studio_telse_elseexpression'));});},_triggerViewChange:function(newAttrs){this.trigger_up('view_change',{node:this.node,operation:{type:'attributes',new_attrs:{'t-else':newAttrs['t-else']?'else':null,},},});},});var TEsc=AbstractEditComponent.extend({name:'tesc',template:'web_studio.ReportDirectiveTEsc',selector:'[t-esc]',init:function(){this._super.apply(this,arguments);this.directiveFields['t-esc']={type:'related',freecode:true,};},start:function(){var self=this;return this._super.apply(this,arguments).then(function(){return self.fieldSelector['t-esc'].appendTo(self.$('.o_web_studio_tesc_escexpression'));});},});var TSet=AbstractEditComponent.extend({name:'tset',template:'web_studio.ReportDirectiveTSet',selector:'[t-set]',init:function(){this._super.apply(this,arguments);this.directiveFields['t-set']={type:'char',};this.directiveFields['t-value']={type:'related',freecode:true,};},start:function(){var self=this;return this._super.apply(this,arguments).then(function(){return Promise.all([self.fieldSelector['t-set'].appendTo(self.$('.o_web_studio_tset_setexpression')),self.fieldSelector['t-value'].appendTo(self.$('.o_web_studio_tset_valueexpression'))]);});},});var TForeach=AbstractEditComponent.extend({name:'tforeach',template:'web_studio.ReportDirectiveTForeach',debugSelector:'[t-foreach]',init:function(){this._super.apply(this,arguments);this.directiveFields['t-foreach']={type:'related',freecode:true,loop:true,};this.directiveFields['t-as']={type:'char',};},start:function(){var self=this;return this._super.apply(this,arguments).then(function(){return Promise.all([self.fieldSelector['t-as'].appendTo(self.$('.o_web_studio_tas_asexpression')),self.fieldSelector['t-foreach'].appendTo(self.$('.o_web_studio_tforeach_foreachexpression'))]);});},});var BlockTotal=AbstractEditComponent.extend({name:'blockTotal',template:'web_studio.BlockTotal',selector:'.o_report_block_total',blacklist:'t, tr, td, th, small, span',init:function(){this._super.apply(this,arguments);this.directiveFields.total_amount_untaxed={type:'related',value:this.node.children[2].attrs['t-value'],filter:function(field){return _.contains(['many2one','float','monetary'],field.type);},followRelations:function(field){return field.type==='many2one';},};this.directiveFields.total_currency_id={type:'related',value:this.node.children[0].attrs['t-value'],filter:function(field){return field.type==='many2one';},followRelations:function(field){return field.type==='many2one'&&field.relation!=='res.currency';},};this.directiveFields.total_amount_total={type:'related',value:this.node.children[1].attrs['t-value'],filter:function(field){return _.contains(['many2one','float','monetary'],field.type);},followRelations:function(field){return field.type==='many2one';},};this.directiveFields.total_amount_by_groups={type:'related',value:this.node.children[3].attrs['t-value'],};},start:function(){var self=this;return this._super.apply(this,arguments).then(function(){return Promise.all([self.fieldSelector.total_currency_id.appendTo(self.$('.o_web_studio_report_currency_id')),self.fieldSelector.total_amount_untaxed.appendTo(self.$('.o_web_studio_report_amount_untaxed')),self.fieldSelector.total_amount_total.appendTo(self.$('.o_web_studio_report_amount_total')),self.fieldSelector.total_amount_by_groups.appendTo(self.$('.o_web_studio_report_amount_by_groups'))]);});},_triggerViewChange:function(newAttrs){this._tSetAttributes(newAttrs);},});var Column=AbstractEditComponent.extend({name:'column',template:'web_studio.ReportColumn',selector:'div[class*=col-]',init:function(){this._super.apply(this,arguments);this.classes=(this.node.attrs.class||"").split(' ');this.sizeClass=_.find(this.classes,function(item){return item.indexOf('col-')!==-1;})||'';this.offsetClass=_.find(this.classes,function(item){return item.indexOf('offset-')!==-1;})||'';this.size=+this.sizeClass.split('col-')[1];this.offset=+this.offsetClass.split('offset-')[1];this.directiveFields.size={type:'integer',value:this.size,};this.directiveFields.offset={type:'integer',value:this.offset,};},start:function(){var self=this;return this._super.apply(this,arguments).then(function(){return Promise.all([self.fieldSelector.size.prependTo(self.$('.o_web_studio_size')),self.fieldSelector.offset.prependTo(self.$('.o_web_studio_offset'))]);});},_triggerViewChange:function(newAttrs){if('size'in newAttrs&&newAttrs.size>=0){this._editDomAttribute("class",'col-'+newAttrs.size,this.sizeClass);}else if('offset'in newAttrs&&newAttrs.offset>=0){this._editDomAttribute("class",'offset-'+newAttrs.offset,this.offsetClass);}},});var Table=AbstractEditComponent.extend({selector:'table.o_report_block_table',blacklist:'thead, tbody, tfoot, tr, td[colspan="99"]',});var TextSelectorTags='span, p, h1, h2, h3, h4, h5, h6, blockquote, pre, small, u, i, b, font, strong, ul, li, dl, dt, ol, th, td';var filter=':not([t-field]):not(:has(t, [t-'+QWeb2.ACTIONS_PRECEDENCE.join('], [t-field], [t-')+']))';var Text=AbstractEditComponent.extend({name:'text',template:'web_studio.ReportText',selector:TextSelectorTags.split(',').join(filter+',')+filter,blacklist:TextSelectorTags,custom_events:{wysiwyg_blur:'_onBlurWysiwygEditor',},init:function(){this._super.apply(this,arguments);this.$node=$(utils.json_node_to_xml(this.node));this.$node.find('*').add(this.$node).each(function(){var node=this;_.each(Array.prototype.slice.call(node.attributes),function(attr){if(!attr.name.indexOf('data-oe-')){node.removeAttribute(attr.name);}});});this.directiveFields.text={type:'text',value:utils.xml_to_str(this.$node[0]).split('>').slice(1).join('>').split('</').slice(0,-1).join('</'),};},start:function(){var self=this;return this._super.apply(this,arguments).then(function(){return self.fieldSelector.text.appendTo(self.$('.o_web_studio_text'));}).then(function(){return self._startWysiwygEditor();});},_onBlurWysiwygEditor:function(){if(!document.querySelector('.modal[role="dialog"]')){this._triggerViewChange({text:this.wysiwyg.getValue()});}},_startWysiwygEditor:function(){var self=this;const options={lang:"odoo",recordInfo:{context:this.context},value:this.directiveFields.text.value,resizable:true,toolbarTemplate:'web_studio.Sidebar.web_editor_toolbar',allowInlineAtRoot:true,allowCommandVideo:false,};this.wysiwyg=new Wysiwyg(this,options);this.$textarea=this.$('textarea:first').val(this.directiveFields.text.value);this.$textarea.after(this.$wysiwygWrapper);this.$textarea.hide();this.$textarea.off().on('input',function(e){e.preventDefault();e.stopImmediatePropagation();self.wysiwyg.setValue($(this).val());self.wysiwyg.trigger_up('wysiwyg_blur');});return this.wysiwyg.insertAfter(this.$textarea);},_triggerViewChange:function(newAttrs){var node=this.node;var $node=this.$node.clone().html(newAttrs.text);var xml=utils.xml_to_str($node[0]).replace(/ xmlns="[^"]+"/,"");this.trigger_up('view_change',{node:node,operation:{inheritance:[{content:xml,position:"replace",view_id:+node.attrs['data-oe-id'],xpath:node.attrs['data-oe-xpath']}],},});},});var Image=LayoutEditable.extend({name:'image',template:'web_studio.ReportImage',selector:'img',init:function(){this._super.apply(this,arguments);this.directiveFields.src={type:'text',value:this.node.attrs.src};},start:function(){var self=this;return this._super.apply(this,arguments).then(function(){return self.fieldSelector.src.appendTo(self.$('.o_web_studio_source'));});},});var Groups=AbstractEditComponent.extend({name:'groups',template:'web_studio.ReportGroups',insertAsLastChildOfPrevious:true,init:function(){this._super.apply(this,arguments);var groups=this.node.attrs.studio_groups&&JSON.parse(this.node.attrs.studio_groups);this.directiveFields.groups={name:'groups',fields:[{name:'id',type:'integer',},{name:'display_name',type:'char',}],value:groups,relation:'res.groups',type:'many2many',Widget:'many2many_tags',};},start:function(){var self=this;return this._super.apply(this,arguments).then(function(){return self.fieldSelector.groups.appendTo(self.$('.o_web_studio_groups'));});},});var TOptions=AbstractEditComponent.extend({name:'toptions',template:'web_studio.ReportDirectiveTOptions',selector:'[t-field], [t-esc]',insertAsLastChildOfPrevious:true,events:_.extend({},AbstractEditComponent.prototype.events,{'change select:first':'_onChangeWidget',}),init:function(parent,params){this._super.apply(this,arguments);this.changes={};this.widgetsOptions=params.widgetsOptions;if(this.widgetsOptions&&this.widgetsOptions.contact){this.widgetsOptions.contact=_.pick(this.widgetsOptions.contact,['fields','separator','no_marker',]);}
this.widget=null;this.values={};this._extractTOptions();},willStart:function(){var self=this;var directiveFields=this.directiveFields;this.widgets=_.map(this.widgetsOptions,function(widgetConf,widgetKey){var values=self.values.widget===widgetKey?self.values:{};var options=_.map(widgetConf,function(option,optionKey){option.key=optionKey;if(option.default_value){option.default_value=option.default_value;}
var required=typeof option.required==='string'?option.required==='value_to_html'&&!('t-field'in self.node.attrs):option.required;var params={key:option.key,string:option.string,required:required,attributeName:'t-options-'+optionKey,value:values[optionKey],};switch(option.type){case'model':params.type='related';break;case'boolean':params.type='boolean';break;case'select':params.type='selection';params.selection=option.params;break;case'float':params.type='float';break;case'integer':params.type='integer';break;case'date':case'datetime':params.type='related';params.filter=function(field){return field.type==='many2one'||field.type==='datetime';};params.followRelations=function(field){return field.type==='many2one';};params.freecode=true;break;case'array':if(option.params&&option.params.type==='selection'){params.type='many2many';params.Widget='many2many_select';params.value=params.value&&params.value.length?params.value:option.default_value||[];params.selection=option.params.params;}else{params.type='char';params.value=JSON.stringify(params.value);}
break;case'selection':if(option.params&&option.params.type==='selection'&&option.params.selection){params.type=option.params.type;params.value=params.value?params.value:option.default_value||false;params.placeholder=option.params.placeholder||'';params.selection=option.params.selection||[];}else{params.type='char';}
break;default:params.type='char';}
directiveFields[widgetKey+':'+optionKey]=params;return params;});options.sort(function(a,b){return(a.type==='boolean'&&b.type==='boolean'?a.string.localeCompare(b.string):a.type==='boolean'&&a.key!=='no_marker'?-1:1);});return{key:widgetKey,string:widgetKey,options:options,};});this.widgets.sort(function(a,b){return a.string.localeCompare(b.string);});this.widget=_.findWhere(this.widgets,{key:this.values.widget&&this.values.widget});return this._super.apply(this,arguments);},start:function(){var defs=[this._super.apply(this,arguments)];if(this.widget){this.$('.o_web_studio_toption_widget select').val(this.widget.key);defs.push(this._updateWidgetOptions());}
return Promise.all(defs);},_extractTOptions:function(){this.values=py.extract(this.node.attrs['t-options']||'{}');for(var k in this.node.attrs){if(k.slice(0,10)==='t-options-'){this.values[k.slice(10)]=py.extract(this.node.attrs[k]);}}},_updateWidgetOptions:function(){var self=this;this.$('button').toggleClass('hidden',!this.widget||!this.widget.options.length);this.$('.o_web_studio_toption_options').remove();if(!this.widget||!this.widget.options.length){return;}
var $options=$(qweb.render('web_studio.ReportDirectiveTOptions.options',this));var mountedComponents=[];var defs=_.map(this.widget.options,function(option){var $option=$options.find('.o_web_studio_toption_option_'+self.widget.key+'_'+option.key);var field=self.fieldSelector[self.widget.key+':'+option.key];if(option.type==="boolean"){return field.prependTo($option.find('label'));}else{return field.appendTo($option);}});return Promise.all(defs).then(function(){self.$el.find('.o_studio_report_options_container').append($options);if(!self.isDestroyed()){mountedComponents.forEach(widget=>widget.on_attach_callback());}});},_triggerViewChange:function(newAttrs){var self=this;var changes={};if(this.widget){var options=_.findWhere(this.widgets,{key:this.widget.key}).options;if(this.values.widget!==this.widget.key){changes['t-options-widget']='"'+this.widget.key+'"';}
_.each(newAttrs,function(val,key){var field=key.split(':');if(self.widget.key===field[0]){var option=_.findWhere(options,{key:field[1]});var value=val;if(value){if(option.type==='char'||option.type==='selection'){value='"'+val.replace(/"/g,'\\"')+'"';}}
if(option.format){value=option.format(value);}
if((self.widget.key!==self.values.widget||value!==self.values[key])){changes['t-options-'+field[1]]=value;}}});}else{changes['t-options-widget']='""';}
this.trigger_up('view_change',{node:this.node,operation:{type:'attributes',new_attrs:changes,},});},_onChangeWidget:function(ev){var widget=_.findWhere(this.widgets,{key:$(ev.target).val()});if(widget!==this.widget){this.widget=widget;this._triggerViewChange({});}
this._updateWidgetOptions();},_onDirectiveChange:function(e){if(e.target.name==='contact:fields'){e.stopPropagation();var changes=_.clone(e.data.changes);var key=_.keys(changes)[0];changes[key]=changes[key].ids;this._triggerViewChange(changes);}else{this._super.apply(this,arguments);}},});__exports[Symbol.for("default")]={BlockTotal:BlockTotal,Column:Column,Groups:Groups,Image:Image,LayoutEditable:LayoutEditable,Table:Table,Text:Text,TField:TField,TForeach:TForeach,TElse:TElse,TEsc:TEsc,TIf:TIf,TOptions:TOptions,TSet:TSet,};return __exports;});odoo.define(`web_studio.reportEditComponents`,['@web_studio/legacy/js/reports/sidebar_components/edit_components'],function(require){return require('@web_studio/legacy/js/reports/sidebar_components/edit_components')[Symbol.for("default")];});;

/* /web_studio/static/src/legacy/js/reports/sidebar_components/edit_components_registry.js */
odoo.define('@web_studio/legacy/js/reports/sidebar_components/edit_components_registry',['web.Registry','web_studio.reportEditComponents'],function(require){'use strict';let __exports={};const Registry=require("web.Registry");const reportEditComponents=require("web_studio.reportEditComponents");var registry=new Registry();registry.add('column',reportEditComponents.Column).add('groups',reportEditComponents.Groups).add('layout',reportEditComponents.LayoutEditable).add('image',reportEditComponents.Image).add('table',reportEditComponents.Table).add('text',reportEditComponents.Text).add('total',reportEditComponents.BlockTotal).add('tEsc',reportEditComponents.TEsc).add('tElse',reportEditComponents.TElse).add('tField',reportEditComponents.TField).add('tForeach',reportEditComponents.TForeach).add('tIf',reportEditComponents.TIf).add('tOptions',reportEditComponents.TOptions).add('tSet',reportEditComponents.TSet);__exports[Symbol.for("default")]=registry;return __exports;});odoo.define(`web_studio.reportEditComponentsRegistry`,['@web_studio/legacy/js/reports/sidebar_components/edit_components_registry'],function(require){return require('@web_studio/legacy/js/reports/sidebar_components/edit_components_registry')[Symbol.for("default")];});;

/* /web_studio/static/src/legacy/js/reports/sidebar_components/report_building_blocks.js */
odoo.define('@web_studio/legacy/js/reports/sidebar_components/report_building_blocks',['web.config','web.core','web.Dialog','web_studio.AbstractReportComponent','web_studio.NewFieldDialog','@web_editor/components/media_dialog/media_dialog','web.OwlCompatibility'],function(require){'use strict';let __exports={};const config=require("web.config");const core=require("web.core");const Dialog=require("web.Dialog");const Abstract=require("web_studio.AbstractReportComponent");const NewFieldDialog=require("web_studio.NewFieldDialog");const{MediaDialogWrapper}=require("@web_editor/components/media_dialog/media_dialog");const{ComponentWrapper}=require("web.OwlCompatibility");var _t=core._t;var _lt=core._lt;var AbstractNewBuildingBlock=Abstract.extend({type:false,structure:false,label:false,fa:false,description:false,addEmptyRowsTargets:true,modelWhitelist:[],draggingThrottle:100,events:_.extend({},Abstract.prototype.events,{mouseenter:'_onHover',focusin:'_onHover',mouseleave:'_onStopHover',focusout:'_onStopHover',}),start:function(){var self=this;this.$el.addClass('o_web_studio_component');this.$el.text(this.label);if(this.fa){this.$el.append('<i class="fa '+this.fa+'">');}
if(config.isDebug()&&this.description){this.$el.addClass('o_web_studio_debug');this.$el.append($('<div>').addClass('o_web_studio_component_description').text(this.description));}
var dragFunction=_.cancellableThrottleRemoveMeSoon(function(e){self.trigger_up('drag_component',{position:{pageX:e.pageX,pageY:e.pageY},widget:self,});},this.draggingThrottle);this.$el.draggable({helper:'clone',opacity:0.4,scroll:false,revertDuration:200,refreshPositions:true,iframeFix:true,start:function(e,ui){$(ui.helper).addClass("ui-draggable-helper");self.trigger_up('begin_drag_component',{widget:self});},drag:dragFunction,stop:function(e){dragFunction.cancel();self.trigger_up('drop_component',{position:{pageX:e.pageX,pageY:e.pageY},widget:self,});}});return this._super.apply(this,arguments);},add:function(options){this.targets=options.targets;var first=options.targets[0];this.index=first.data.oeIndex;this.position=first.data.oePosition;this.node=first.node;return Promise.resolve({type:this.type,options:{columns:this.dropColumns,index:first.data.oeIndex,},});},_onHover:function(e){this.trigger_up('begin_preview_drag_component',{widget:this,});},_onStopHover:function(e){this.trigger_up('end_preview_drag_component',{widget:this,});},_createReportTableColumn:function(options){var self=this;var inheritance=[];var updatedNodes=[];_.each(this.targets,function(target){var node=target.node;var inheritanceItem;if(node.tag==='th'||node.tag==='td'){var loop=self._findParentWithTForeach(node)?true:false;var dataName=loop?'Loop':'';var content='<'+node.tag+'>';if(node.tag==='th'||node.parent.parent.tag==='thead'){content+=options['head'+dataName]||options.head||'';}else if(node.parent.parent.tag==='tfoot'){content+=options['foot'+dataName]||options.foot||'';}else{content+=options['body'+dataName]||options.body||'';}
content+='</'+node.tag+'>';updatedNodes.push(node);inheritanceItem={content:content,position:target.position,xpath:node.attrs['data-oe-xpath'],view_id:+node.attrs['data-oe-id'],};}else if(node.tag==='tr'){updatedNodes.push(node);inheritanceItem={content:'<td>'+(options.tbody||'')+'</td>',position:target.position,xpath:node.attrs['data-oe-xpath'],view_id:+node.attrs['data-oe-id'],};}
inheritance.push(inheritanceItem);});var cellsToGrow=[];_.each(this.targets,function(target){var node=target.node;if(target.position!=='after'){return;}
var nodeIndex=0;var nodeRow=self._getParentNode(node,function(node){return node.tag==='tr';});var cells=self._getChildrenNode(nodeRow,function(node){return node.tag==='td'||node.tag==='th';});for(var k=0;k<cells.length;k++){nodeIndex+=+(cells[k].attrs.colspan||1);if(cells[k]===node){break;}}
var table=self._getParentNode(node,function(node){return node.tag==='table';});var rows=self._getChildrenNode(table,function(node){return node.tag==='tr';});_.each(rows,function(row){if(row===nodeRow){return;}
var cells=self._getChildrenNode(row,function(node){return node.tag==='td'||node.tag==='th';});var cellIndex=0;for(var k=0;k<cells.length;k++){var cell=cells[k];cellIndex+=+(cell.attrs.colspan||1);if(cellIndex>=nodeIndex){if(((+cell.attrs.colspan)>1)&&cellsToGrow.indexOf(cell)===-1){cellsToGrow.push(cell);}
break;}}});});_.each(cellsToGrow,function(node){inheritance.push({content:'<attribute name="colspan">'+((+node.attrs.colspan)+1)+'</attribute>',position:'attributes',xpath:node.attrs['data-oe-xpath'],view_id:+node.attrs['data-oe-id'],});});return inheritance;},_createStructure:function(options){var xml=['<div class="row'];if(this.structureClass){xml.push(' '+this.structureClass);}
xml.push('">');for(var k=0;k<this.dropColumns.length;k++){var column=this.dropColumns[k];xml.push('<div class="col-');xml.push(column[1]);if(column[0]){xml.push(' offset-');xml.push(column[0]);}
xml.push('">');if(options.content&&(k===options.index||options.fillStructure)){xml.push(options.content);}
xml.push('</div>');}
xml.push('</div>');return[{content:xml.join(''),position:this.position,xpath:this.node.attrs['data-oe-xpath'],view_id:+this.node.attrs['data-oe-id'],}];},_createContent:function(options){if(this.dropColumns&&typeof this.index==='number'){return this._createStructure({index:this.index,content:options.contentInStructure||options.content,fillStructure:options.fillStructure||false,});}else{return _.map(this.targets,function(target){var isCol=(target.node.attrs.class||'').match(/(^|\s)(col(-[0-9]+)?)(\s|$)/);return{content:isCol?options.contentInStructure||options.content:options.content,position:target.position,xpath:target.node.attrs['data-oe-xpath'],view_id:+target.node.attrs['data-oe-id'],};});}},_getParentNode:function(node,fn){while(node){if(fn(node)){return node;}
node=node.parent;}},_getChildrenNode:function(parent,fn){var children=[];var stack=[parent];parent=stack.shift();while(parent){if(parent.children){for(var k=0;k<parent.children.length;k++){var node=parent.children[k];if(fn(node)){children.push(node);}}
stack=parent.children.concat(stack);}
parent=stack.shift();}
return children;},_findParentWithTForeach:function(node){if(!node||!node.parent||(node.tag==="div"&&node.attrs.class==="page")){return;}
if(node.attrs["t-foreach"]){return node;}
return this._findParentWithTForeach(node.parent);},});var TextSelectorTags='span, p, h1, h2, h3, h4, h5, h6, blockquote, pre, small, u, i, b, font, strong, ul, li, dl, dt, ol, .page > .row > div:empty';var filter=':not([t-field]):not(:has(t, [t-'+QWeb2.ACTIONS_PRECEDENCE.join('], [t-')+']))';var BlockText=AbstractNewBuildingBlock.extend({type:'text',label:_lt('Text'),dropIn:'.page',className:'o_web_studio_field_char',hookClass:'o_web_studio_block_char',add:function(){var self=this;return this._super.apply(this,arguments).then(function(){return Promise.resolve({inheritance:self._createContent({content:'<div class="row"><div class="col"><span>New Text Block</span></div></div>',})});});},});var InlineText=AbstractNewBuildingBlock.extend({type:'text',label:_lt('Text'),className:'o_web_studio_field_char',hookClass:'o_web_studio_hook_inline',hookAutoHeight:true,dropIn:TextSelectorTags.split(',').join(filter+'|')+filter,selectorSeparator:'|',hookTag:'span',add:function(){var self=this;return this._super.apply(this,arguments).then(function(){return Promise.resolve({inheritance:self._createContent({content:'<span>New Text Block</span>',})});});},});var ColumnHalfText=AbstractNewBuildingBlock.extend({type:'text',label:_lt('Two Columns'),dropIn:'.page',className:'o_web_studio_field_fa',fa:'fa-align-left',hookClass:'o_web_studio_block_char',hookTag:'div',dropColumns:[[0,6],[0,6]],addEmptyRowsTargets:false,add:function(){var self=this;return this._super.apply(this,arguments).then(function(){return Promise.resolve({inheritance:self._createContent({fillStructure:true,contentInStructure:'<span>New Column</span>',})});});},});var ColumnThirdText=AbstractNewBuildingBlock.extend({type:'text',label:_lt('Three Columns'),dropIn:'.page',className:'o_web_studio_field_fa',fa:'fa-align-left',hookClass:'o_web_studio_block_char',hookTag:'div',dropColumns:[[0,4],[0,4],[0,4]],addEmptyRowsTargets:false,add:function(){var self=this;return this._super.apply(this,arguments).then(function(){return Promise.resolve({inheritance:self._createContent({fillStructure:true,contentInStructure:'<span>New Column</span>',})});});},});var TableCellText=AbstractNewBuildingBlock.extend({type:'text',label:_lt('Text in Cell'),className:'o_web_studio_field_char',hookAutoHeight:false,hookClass:'o_web_studio_hook_inline',dropIn:'td, th',hookTag:'span',add:function(){var self=this;return this._super.apply(this,arguments).then(function(){return Promise.resolve({inheritance:self._createContent({content:'<span>New Text Block</span>',})});});},});var AbstractFieldBlock=AbstractNewBuildingBlock.extend({type:'field',add:function(){var self=this;return self._super.apply(this,arguments).then(function(){return new Promise(function(resolve,reject){var field={order:'order',type:'related',filters:{searchable:false},filter:function(field){return!_.contains(['one2many','many2many'],field.type);}};var target=self.targets[0];if(self._filterTargets){target=self._filterTargets()||target;}
var availableKeys=_.filter(self._getContextKeys(target.node),function(field){return!!field.relation&&field.name!=='docs';});var fieldChain=[];if(availableKeys.length){fieldChain.push(_.first(availableKeys).name);}
var dialog=new NewFieldDialog(self,'record_fake_model',field,availableKeys,fieldChain).open();dialog.on('field_default_values_saved',self,function(values){if(values.related.split('.').length<2){Dialog.alert(self,_t('The record field name is missing'));}else{resolve({inheritance:self._dataInheritance(values),});dialog.close();}});dialog.on('closed',self,function(){reject();});});});},});var BlockField=AbstractFieldBlock.extend({label:_lt('Field'),className:'o_web_studio_field_many2one',hookClass:'o_web_studio_hook_field',dropIn:'.page',_dataInheritance:function(values){var $field=$('<span/>').attr('t-field',values.related);if(values.type==='binary'){$field.attr('t-options-widget','"image"');$field.attr('t-options-qweb_img_raw_data','1');}
var fieldHTML=$field.prop('outerHTML');return this._createContent({content:"<div class='row'><div class='col'>"+fieldHTML+"</div></div>",});},});var InlineField=AbstractFieldBlock.extend({label:_lt('Field'),className:'o_web_studio_field_many2one',hookClass:'o_web_studio_hook_inline',hookAutoHeight:true,dropIn:TextSelectorTags.split(',').join(filter+'|')+filter,selectorSeparator:'|',hookTag:'span',_dataInheritance:function(values){var $field=$('<span/>').attr('t-field',values.related);if(values.type==='binary'){$field.attr('t-options-widget','"image"');$field.attr('t-options-qweb_img_raw_data','1');}
var fieldHTML=$field.prop('outerHTML');if(this.node.tag==='td'||this.node.tag==='th'){return this._createReportTableColumn({head:$('<span/>').text(values.string).prop('outerHTML'),bodyLoop:fieldHTML,});}else{return this._createContent({content:fieldHTML,});}},_filterTargets:function(){var self=this;var target=this.targets[0];if(this.targets.length>1&&(target.node.tag==='td'||target.node.tag==='th')){target=_.find(this.targets,function(target){return self._findParentWithTForeach(target.node)?true:false;});}
return target;},});var TableColumnField=AbstractFieldBlock.extend({label:_lt('Field Column'),className:'o_web_studio_field_fa',fa:' fa-plus-square',hookAutoHeight:true,hookClass:'o_web_studio_hook_table_column',dropIn:'tr',_dataInheritance:function(values){var $field=$('<span/>').attr('t-field',values.related);if(values.type==='binary'){$field.attr('t-options-widget','"image"');$field.attr('t-options-qweb_img_raw_data','1');}
var fieldHTML=$field.prop('outerHTML');if(this.node.tag==='td'||this.node.tag==='th'){var targetInLoop=_.find(this.targets,function(target){return this._findParentWithTForeach(target.node);}.bind(this))?true:false;return this._createReportTableColumn({head:$('<span/>').text(values.string).prop('outerHTML'),body:targetInLoop?undefined:fieldHTML,bodyLoop:targetInLoop?fieldHTML:undefined,});}else{return this._createContent({contentInStructure:'<span><strong>'+values.string+':</strong><br/></span>'+fieldHTML,content:fieldHTML,});}},_filterTargets:function(){var self=this;var target=this.targets[this.targets.length-1];if(this.targets.length>1){target=_.find(this.targets,function(target){return self._findParentWithTForeach(target.node)?true:false;});}
return target;},});var TableCellField=AbstractFieldBlock.extend({label:_lt('Field in Cell'),className:'o_web_studio_field_many2one',hookAutoHeight:false,hookClass:'o_web_studio_hook_inline',dropIn:'td, th',hookTag:'span',_dataInheritance:function(values){var $field=$('<span/>').attr('t-field',values.related);if(values.type==='binary'){$field.attr('t-options-widget','"image"');$field.attr('t-options-qweb_img_raw_data','1');}
var fieldHTML=$field.prop('outerHTML');if(this.node.tag==='td'||this.node.tag==='th'){return this._createReportTableColumn({head:$('<span/>').text(values.string).prop('outerHTML'),bodyLoop:fieldHTML,});}else{return this._createContent({contentInStructure:'<span><strong>'+values.string+':</strong><br/></span>'+fieldHTML,content:fieldHTML,});}},_filterTargets:function(){var self=this;var target=this.targets[0];if(this.targets.length>1){target=_.find(this.targets,function(target){return self._findParentWithTForeach(target.node)?true:false;});}
return target;},});var LabelledField=AbstractFieldBlock.extend({label:_lt('Field & Label'),className:'o_web_studio_field_many2one',hookClass:'o_web_studio_hook_information',dropColumns:[[0,3],[0,3],[0,3],[0,3]],hookAutoHeight:false,dropIn:'.page, .row > div.col*:empty',_dataInheritance:function(values){var $field=$('<span/>').attr('t-field',values.related);if(values.type==='binary'){$field.attr('t-options-widget','"image"');$field.attr('t-options-qweb_img_raw_data','1');}
var fieldHTML=$field.prop('outerHTML');return this._createContent({contentInStructure:'<span><strong>'+values.string+':</strong><br/></span>'+fieldHTML,content:fieldHTML,});},});var Image=AbstractNewBuildingBlock.extend({type:'image',label:_lt('Image'),dropIn:'.page',className:'o_web_studio_field_picture',hookClass:'o_web_studio_hook_picture',add:function(){var self=this;return this._super.apply(this,arguments).then(function(){var def=new Promise(function(resolve,reject){const dialog=new ComponentWrapper(this,MediaDialogWrapper,{onlyImages:true,save:el=>{const value=el.attributes.src&&el.attributes.src.value;resolve({inheritance:self._createContent({content:'<img class="img-fluid" src="'+value+'"/>',})});},close:()=>{reject();}});dialog.mount(self.el);});return def;});},});var BlockTitle=AbstractNewBuildingBlock.extend({type:'block_title',label:_lt('Title Block'),className:'o_web_studio_field_char',hookClass:'o_web_studio_hook_title',dropIn:'.page',add:function(){var self=this;return this._super.apply(this,arguments).then(function(){return Promise.resolve({inheritance:[{content:'<div class="row"><div class="col h2"><span>New Title</span></div></div>',position:self.position,xpath:self.node.attrs['data-oe-xpath'],view_id:+self.node.attrs['data-oe-id'],}],});});},});var BlockAddress=AbstractNewBuildingBlock.extend({type:'block_address',label:_lt('Address Block'),fa:'fa-address-card',className:'o_web_studio_field_fa',hookAutoHeight:false,hookClass:'o_web_studio_hook_address',structureClass:'address',dropColumns:[[0,5],[2,5]],add:function(){var self=this;var callersArguments=arguments;return new Promise(function(resolve,reject){self._super.apply(self,callersArguments).then(function(){var field={order:'order',type:'related',filters:{},filter:function(field){return field.type==='many2one';},followRelations:function(field){return field.type==='many2one'&&field.relation!=='res.partner';},};var availableKeys=self._getContextKeys(self.node);var fieldChain=[];if(availableKeys.length){fieldChain.push(_.first(availableKeys).name);}
var dialog=new NewFieldDialog(self,'record_fake_model',field,availableKeys,fieldChain).open();dialog.on('field_default_values_saved',self,function(values){if(!_.contains(values.related,'.')){Dialog.alert(self,_t('Please specify a field name for the selected model.'));return;}
if(values.relation==='res.partner'){resolve({inheritance:self._createContent({content:'<div t-field="'+values.related+'" t-options-widget="\'contact\'"/>',})});dialog.close();}else{Dialog.alert(self,_t('You can only display a user or a partner'));}});dialog.on('closed',self,function(){reject();});});});},});var BlockTable=AbstractNewBuildingBlock.extend({type:'block_table',label:_lt('Data table'),fa:'fa-th-list',className:'o_web_studio_field_fa',hookClass:'o_web_studio_hook_table',dropIn:'.page',add:function(){var self=this;var callersArguments=arguments;return new Promise(function(resolve,reject){self._super.apply(self,callersArguments).then(function(){var field={order:'order',type:'related',filters:{},filter:function(field){return field.type==='many2one'||field.type==='one2many'||field.type==='many2many';},followRelations:function(field){return field.type==='many2one';},};var availableKeys=self._getContextKeys(self.node);var fieldChain=[];if(availableKeys.length){fieldChain.push(_.first(availableKeys).name);}
var dialog=new NewFieldDialog(self,'record_fake_model',field,availableKeys,fieldChain).open();dialog.on('field_default_values_saved',self,function(values){if(values.type==='one2many'||values.type==='many2many'){resolve({inheritance:self._dataInheritance(values),});dialog.close();}else{Dialog.alert(self,_t('You need to use a many2many or one2many field to display a list of items'));}});dialog.on('closed',self,function(){reject();});});});},_dataInheritance:function(values){var target=this.targets[0];return[{content:'<table class="table o_report_block_table">'+'<thead>'+'<tr>'+'<th><span>Name</span></th>'+'</tr>'+'</thead>'+'<tbody>'+'<tr t-foreach="'+values.related+'" t-as="table_line">'+'<td><span t-field="table_line.display_name"/></td>'+'</tr>'+'</tbody>'+'</table>',position:target.position,xpath:target.node.attrs['data-oe-xpath'],view_id:+target.node.attrs['data-oe-id'],}];},});var TableBlockTotal=AbstractNewBuildingBlock.extend({type:'block_total',label:_lt('Subtotal & Total'),fa:'fa-money',className:'o_web_studio_field_fa',dropIn:'.page',hookClass:'o_web_studio_hook_total',dropColumns:[[0,5],[2,5]],modelWhitelist:['account.move','sale.order','purchase.order'],add:function(){var self=this;var callersArguments=arguments;return new Promise(function(resolve,reject){self._super.apply(self,callersArguments).then(function(){var field={order:'order',type:'related',filters:{},filter:function(field){return field.type==='many2one';},followRelations:function(field){return field.type==='many2one'&&!self.modelWhitelist.includes(field.relation);},};var availableKeys=self._getContextKeys(self.node);var fieldChain=[];if(availableKeys.length){fieldChain.push(_.first(availableKeys).name);}
var dialog=new NewFieldDialog(self,'record_fake_model',field,availableKeys,fieldChain).open();dialog.on('field_default_values_saved',self,function(values){resolve({inheritance:self._dataInheritance(values),});dialog.close();});dialog.on('closed',self,function(){reject();});});});},_dataInheritance:function(values){var data=this._dataInheritanceValues(values);return this._createContent({contentInStructure:'<table class="table table-sm">'+`<t t-set="tax_totals" t-value="${data.tax_totals}"/>`+'<t t-call="account.document_tax_totals"/>'+'</table>'});},_dataInheritanceValues:function(values){const tax_totals=`${values.related}.tax_totals`;return{tax_totals};},});__exports[Symbol.for("default")]={BlockText:BlockText,InlineText:InlineText,ColumnHalfText:ColumnHalfText,ColumnThirdText:ColumnThirdText,TableCellText:TableCellText,BlockField:BlockField,InlineField:InlineField,TableColumnField:TableColumnField,TableCellField:TableCellField,LabelledField:LabelledField,Image:Image,BlockTitle:BlockTitle,BlockAddress:BlockAddress,BlockTable:BlockTable,TableBlockTotal:TableBlockTotal,};return __exports;});odoo.define(`web_studio.reportNewComponents`,['@web_studio/legacy/js/reports/sidebar_components/report_building_blocks'],function(require){return require('@web_studio/legacy/js/reports/sidebar_components/report_building_blocks')[Symbol.for("default")];});;

/* /web_studio/static/src/legacy/js/reports/sidebar_components/report_building_blocks_registry.js */
odoo.define('@web_studio/legacy/js/reports/sidebar_components/report_building_blocks_registry',['web.core','web.Registry','web_studio.reportNewComponents'],function(require){'use strict';let __exports={};const core=require("web.core");const Registry=require("web.Registry");const reportNewComponents=require("web_studio.reportNewComponents");var _lt=core._lt;var registry=new Registry();registry.add(_lt('Block'),[reportNewComponents.BlockText,reportNewComponents.BlockField,reportNewComponents.BlockTitle,reportNewComponents.LabelledField,reportNewComponents.Image,reportNewComponents.BlockAddress,]).add(_lt('Inline'),[reportNewComponents.InlineText,reportNewComponents.InlineField,]).add(_lt('Table'),[reportNewComponents.BlockTable,reportNewComponents.TableColumnField,reportNewComponents.TableCellText,reportNewComponents.TableCellField,reportNewComponents.TableBlockTotal,]).add(_lt('Column'),[reportNewComponents.ColumnHalfText,reportNewComponents.ColumnThirdText,]);__exports[Symbol.for("default")]=registry;return __exports;});odoo.define(`web_studio.reportNewComponentsRegistry`,['@web_studio/legacy/js/reports/sidebar_components/report_building_blocks_registry'],function(require){return require('@web_studio/legacy/js/reports/sidebar_components/report_building_blocks_registry')[Symbol.for("default")];});;

/* /web_studio/static/src/legacy/js/views/view_editors/editor_mixin.js */
odoo.define('@web_studio/legacy/js/views/view_editors/editor_mixin',[],function(require){'use strict';let __exports={};__exports[Symbol.for("default")]={findNode:function(viewArch,nodeDescription){const nodesToCheck=[viewArch];while(nodesToCheck.length>0){const node=nodesToCheck.shift();const match=this._satisfiesNodeDescription(node,nodeDescription);if(match)return node;nodesToCheck.push(...(node.children||[]));}},handleDrop:function($drag,node,position){var isNew=$drag.hasClass('o_web_studio_component');var values;if(isNew){values={type:'add',structure:$drag.data('structure'),field_description:$drag.data('field_description'),node:node,new_attrs:$drag.data('new_attrs'),position:position,};}else{var movedFieldName=$drag.data('name');if(node.attrs.name===movedFieldName){return;}
values={type:'move',node:node,position:position,structure:'field',new_attrs:{name:movedFieldName,},};}
this.trigger_up('on_hook_selected');this.trigger_up('view_change',values);},highlightNearestHook:function($helper,position){this.$('.o_web_studio_nearest_hook').removeClass('o_web_studio_nearest_hook');},setSelectable:function($el){var self=this;$el.click(function(){self.unselectedElements();$(this).addClass('o_web_studio_clicked');}).mouseover(function(){if(self.$('.ui-draggable-dragging').length){return;}
$(this).addClass('o_web_studio_hovered');}).mouseout(function(){$(this).removeClass('o_web_studio_hovered');});},unselectedElements:function(){this.selected_node_id=false;var $el=this.$('.o_web_studio_clicked');$el.removeClass('o_web_studio_clicked');if($el.find('.blockUI')){$el.find('.blockUI').parent().unblock();}},_satisfiesNodeDescription:function(node,nodeDescription){const attrs=Object.assign({},nodeDescription);const tag=attrs.tag;delete attrs.tag;const checkAttrs=Object.keys(attrs).length!==0;if(tag&&tag!==node.tag)return false;if(tag&&!checkAttrs)return true;const match=(a1,a2)=>typeof(a1)==='string'?a1.includes(a2):a1===a2;const matchedAttrs=Object.entries(attrs).filter(([attr,value])=>match(node.attrs[attr],value)).map(([attr,value])=>attr);return matchedAttrs.length>0&&matchedAttrs.length===Object.keys(attrs).length;},preprocessArch:function(arch){return arch;},};return __exports;});odoo.define(`web_studio.EditorMixin`,['@web_studio/legacy/js/views/view_editors/editor_mixin'],function(require){return require('@web_studio/legacy/js/views/view_editors/editor_mixin')[Symbol.for("default")];});;

/* /website_studio/static/src/website_form_manager/website_form_manager.js */
odoo.define('@website_studio/website_form_manager/website_form_manager',['@odoo/owl','@web/core/utils/hooks','@web/core/registry','@web/core/l10n/translation','@web/webclient/actions/action_service'],function(require){'use strict';let __exports={};const{Component,onWillStart,useState}=require("@odoo/owl");const{useService}=require("@web/core/utils/hooks");const{registry}=require("@web/core/registry");const{_lt,_t}=require("@web/core/l10n/translation");const{standardActionServiceProps}=require("@web/webclient/actions/action_service");class WebsiteFormManager extends Component{static template="website_studio.FormManager";static props={...standardActionServiceProps};setup(){this.studio=useService("studio");this.rpc=useService("rpc");this.action=useService("action");this.user=useService("user");this.notification=useService("notification");this.state=useState({forms:[]});this.isDesigner=false;onWillStart(()=>{return Promise.all([this.getExistingForms(),this.user.hasGroup("website.group_website_designer").then((r)=>(this.isDesigner=r)),]);});}
get resModel(){return this.studio.editedAction.res_model;}
async getExistingForms(){const forms=await this.rpc("/website_studio/get_forms",{res_model:this.resModel,});this.state.forms=forms;}
async onNewForm(){if(this.isDesigner){const url=await this.rpc("/website_studio/create_form",{res_model:this.resModel,});this.getExistingForms();return this.openFormUrl(url);}else{this.notification.add(_t("Sorry, only users with the following"+" access level are currently allowed to do that:"+" 'Website/Editor and Designer'"),{title:_t("Error"),type:"danger",});}}
openFormUrl(url){return this.action.doAction({type:"ir.actions.act_url",url:`${url}?enable_editor=1`});}}
registry.category("actions").add("website_studio.action_form_manager",WebsiteFormManager);registry.category("web_studio.editor_tabs").add("website",{name:_lt("Website Forms"),action:"website_studio.action_form_manager"});return __exports;});

                    /*******************************************
                    *  Templates                               *
                    *******************************************/

                    odoo.define('web_studio.studio_assets.bundle.xml', ['@web/core/assets'], function(require){
                        'use strict';
                        const { loadXML } = require('@web/core/assets');
                        const templates = `<?xml version="1.0" encoding="UTF-8"?>
<templates xml:space="preserve">
<t t-name="website_studio.FormManager" owl="1">
    <div class="o_website_studio_form_manager">
        <h6><strong>Forms</strong></h6>
        <div class="o_website_studio_forms d-flex flex-row gap-4 ms-4 pb-5">
            <div class="o_website_studio_form o_website_studio_new_form d-flex flex-column align-items-center" t-att-class="!isDesigner ? 'disabled' : ''" t-on-click="onNewForm">
                <div class="o_web_studio_thumbnail" data-new-form="true">
                    <img t-att-src="'/web_studio/static/src/img/default_icon_app.png'" alt="App icon"/>
                </div>
                <div class="o_web_studio_name"><span>new form</span></div>
            </div>
            <div t-foreach="state.forms" t-as="form" class="o_website_studio_form d-flex flex-column align-items-center" t-key="form.id" t-on-click="() =&gt; this.openFormUrl(form.url)">
                <div class="o_web_studio_thumbnail" t-att-data-url="form.url">
                    <img t-att-src="'/web_studio/static/src/img/view_type/form.png'" alt="View form"/>
                </div>
                <div class="o_web_studio_name"><span t-esc="form.name"/></div>
            </div>
        </div>
    </div>
</t>


</templates>`;
                        return loadXML(templates);
                    });